/* empty css                    *//* empty css                */import{R as F2,S as Je,T as tg,d as rB,r as _l,o as gee,e as iB,c as sB,a as ua,F as mee,g as Hy,w as n3,u as q2e,i as X2e,J as Y2e,p as K2e,f as Z2e,K as J2e,_ as Q2e}from"./index-CtLRTTBE.js";function ewe(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var ao={};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const twe=1e-7,nwe=1e-4;class oB{constructor(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,n){this.dataIdsCount++,this.data.set(t,n)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class T_{refCount(t){return Ji("refCount")}incRef(t){return Ji("incRef")}timerAvailable(){return!0}time(t){return Ji("time")}read(t){return Ji("read")}readSync(t){return Ji("readSync")}readToGPU(t,n){return Ji("readToGPU")}numDataIds(){return Ji("numDataIds")}disposeData(t,n){return Ji("disposeData")}write(t,n,r){return Ji("write")}move(t,n,r,i,s){return Ji("move")}createTensorFromGPUData(t,n,r){return Ji("createTensorFromGPUData")}memory(){return Ji("memory")}floatPrecision(){return Ji("floatPrecision")}epsilon(){return this.floatPrecision()===32?twe:nwe}dispose(){return Ji("dispose")}}function Ji(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,Tl(e,t,n)}function rwe(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,Tl(e,n,r),Tl(t,n,r)}function _f(e,t,n){return Math.max(e,Math.min(t,n))}function D_(e){return e%2===0?e:e+1}function Tl(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function yee(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function iwe(e,t){const n=Math.random();return t*n+(1-n)*e}function swe(e,t){let n=0;for(let r=0;r<e.length;r++){const i=Number(e[r])-Number(t[r]);n+=i*i}return n}function D(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Ar(e,t,n=""){D(gt(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function ng(e){D(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Z(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function owe(e){return e.length===0}function bee(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==null&&t[n]!==null&&e[n]!==t[n])return!1;return!0}function gt(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function hp(e){return e%1===0}function awe(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{const t=Math.exp(2*e);return(t-1)/(t+1)}}function Nk(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function UR(e){const t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return I_(t),t}function qd(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function jR(e,t=i=>0,n,r){return new Promise((i,s)=>{let o=0;const a=()=>{if(e()){i();return}o++;const u=t(o);if(n!=null&&o>=n){s();return}r!=null?r(a,u):setTimeout(a,u)};a()})}function aB(e,t){let n=1,r=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(e[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(r===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const i=e.slice();return i[r]=t/n,i}function it(e,t){const n=t.length;return e=e==null?t.map((r,i)=>i):[].concat(e),D(e.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),D(e.every(r=>hp(r)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(r=>r<0?n+r:r)}function hc(e,t){const n=[],r=[],i=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||i?null:it(t,e).sort();let o=0;for(let a=0;a<e.length;++a){if(s!=null){if(s[o]===a&&e[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${e[a]}' is not 1`);(s[o]==null||s[o]>a)&&e[a]===1&&(n.push(e[a]),r.push(a)),s[o]<=a&&o++}e[a]!==1&&(n.push(e[a]),r.push(a))}return{newShape:n,keptDims:r}}function sr(e,t){return $n(e,t)}function $n(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function xee(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function vee(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function uB(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function Ux(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function wee(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function ou(e){return typeof e=="string"||e instanceof String}function $ee(e){return typeof e=="boolean"}function Fk(e){return typeof e=="number"}function rg(e){return Array.isArray(e)?rg(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Fk(e)?"float32":ou(e)?"string":$ee(e)?"bool":"float32"}function Tf(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ok(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Re(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Cee(e,t,n,r=!1){const i=new Array;if(t.length===1){const s=t[0]*(r?2:1);for(let o=0;o<s;o++)i[o]=n[e+o]}else{const s=t[0],o=t.slice(1),a=o.reduce((u,l)=>u*l)*(r?2:1);for(let u=0;u<s;u++)i[u]=Cee(e+u*a,o,n,r)}return i}function $o(e,t,n=!1){if(e.length===0)return t[0];const r=e.reduce((i,s)=>i*s)*(n?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return Cee(0,e,t,n)}function See(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function N_(e,t){const n=Sr(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function Sr(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function lB(e,t){const n=e.reduce((r,i)=>r*i,1);if(t==null||t==="float32")return $o(e,new Float32Array(n));if(t==="int32")return $o(e,new Int32Array(n));if(t==="bool")return $o(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function Ts(e){e.forEach(t=>{D(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function pa(e,t,n){if(t===0)return 0;if(t===1)return e[0];let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function ig(e,t,n){if(t===0)return[];if(t===1)return[e];const r=new Array(t);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}function F_(e){return e&&e.then&&typeof e.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV="tfjsflags";class kee{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=uwe,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){const i=this.urlFlags[t];q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${i}.`),this.set(t,i)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const n=this.evaluateFlag(t);if(F_(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);wV in t&&t[wV].split(",").forEach(r=>{const[i,s]=r.split(":");this.urlFlags[i]=cwe(i,s)})}}function uwe(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(lwe(t,r[0],r[1]),r.join("="))),t}function lwe(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function cwe(e,t){const n=t.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:t}function q(){return cB}let cB=null;function fwe(e){cB=e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let r3;function Eee(){if(r3==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");r3=e}return r3}function hwe(){const e=Eee();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function fB(e,t){const n=hwe();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const O2="Abs",Y0="Acos",K0="Acosh",sg="Add",R2="AddN",O_="All",R_="Any",M2="ArgMax",L2="ArgMin",Z0="Asin",J0="Asinh",Q0="Atan",e1="Atanh",t1="Atan2",P2="AvgPool",M_="AvgPoolGrad",B2="AvgPool3D",L_="AvgPool3DGrad",z2="BatchMatMul",U2="BatchToSpaceND",P_="Bincount",j2="BitwiseAnd",Aee="BroadcastTo",B_="BroadcastArgs",n1="Cast",r1="Ceil",i1="ClipByValue",z_="Complex",W2="ComplexAbs",V2="Concat",G2="Conv2D",U_="Conv2DBackpropFilter",H2="Conv2DBackpropInput",q2="Conv3D",j_="Conv3DBackpropFilterV2",W_="Conv3DBackpropInputV2",s1="Cos",o1="Cosh",V_="Cumprod",X2="Cumsum",G_="CropAndResize",H_="DenseBincount",q_="DepthToSpace",Y2="DepthwiseConv2dNative",X_="DepthwiseConv2dNativeBackpropFilter",Y_="DepthwiseConv2dNativeBackpropInput",K_="Diag",K2="Dilation2D",Rk="Dilation2DBackpropInput",Mk="Dilation2DBackpropFilter",Z_="Draw",a1="RealDiv",J_="Einsum",u1="Elu",Q_="EluGrad",l1="Erf",Z2="Equal",c1="Exp",J2="ExpandDims",f1="Expm1",eT="FFT",tT="Fill",nT="FlipLeftRight",h1="Floor",d1="FloorDiv",Q2="FusedBatchNorm",ew="GatherV2",rT="GatherNd",tw="Greater",p1="GreaterEqual",g1="Identity",iT="IFFT",sT="Imag",m1="IsFinite",y1="IsInf",b1="IsNan",nw="LeakyRelu",rw="Less",iw="LessEqual",oT="LinSpace",x1="Log",v1="Log1p",sw="LogicalAnd",ow="LogicalNot",aw="LogicalOr",dwe="LogicalXor",_ee="LogSoftmax",pwe="LowerBound",uw="LRN",aT="LRNGrad",gwe="MatrixBandPart",lw="Max",w1="Maximum",cw="MaxPool",uT="MaxPoolGrad",fw="MaxPool3D",lT="MaxPool3DGrad",cT="MaxPoolWithArgmax",hw="Mean",dw="Min",$1="Minimum",pw="MirrorPad",C1="Mod",fT="Multinomial",S1="Multiply",gw="Neg",mw="NotEqual",hT="NonMaxSuppressionV3",dT="NonMaxSuppressionV4",pT="NonMaxSuppressionV5",yw="OnesLike",bw="OneHot",xw="Pack",vw="PadV2",mwe="Pool",k1="Pow",ww="Prelu",$w="Prod",gT="RaggedGather",mT="RaggedRange",yT="RaggedTensorToTensor",bT="Range",xT="Real",E1="Reciprocal",A1="Relu",Cw="Reshape",Sw="ResizeNearestNeighbor",vT="ResizeNearestNeighborGrad",kw="ResizeBilinear",wT="ResizeBilinearGrad",_1="Relu6",Ew="Reverse",T1="Round",I1="Rsqrt",$T="ScatterNd",CT="TensorScatterUpdate",ST="SearchSorted",Aw="Select",D1="Selu",_w="Slice",N1="Sin",F1="Sinh",O1="Sign",R1="Sigmoid",M1="Softplus",L1="Sqrt",Tw="Sum",Iw="SpaceToBatchND",Dw="SplitV",Nw="Softmax",kT="SparseFillEmptyRows",ET="SparseReshape",AT="SparseSegmentMean",_T="SparseSegmentSum",TT="SparseToDense",P1="SquaredDifference",IT="Square",Fw="StaticRegexReplace",DT="StridedSlice",NT="StringNGrams",FT="StringSplit",OT="StringToHashBucketFast",B1="Sub",z1="Tan",U1="Tanh",j1="Tile",RT="TopK",MT="Transform",Xd="Transpose",LT="Unique",Ow="Unpack",Rw="UnsortedSegmentSum",ywe="UpperBound",Mw="ZerosLike",W1="Step",Lk="FromPixels",PT="RotateWithOffset",jx="_FusedMatMul",Wx="FusedConv2D",Vx="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ps(...e){q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(...e)}function bwe(...e){q().getBool("IS_TEST")||q().getBool("PROD")||console.log(...e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gm=fB("kernelRegistry",()=>new Map),Gx=fB("gradRegistry",()=>new Map);function Hx(e,t){const n=hB(e,t);return Gm.get(n)}function WR(e){return Gx.get(e)}function Pk(e){const t=Gm.entries(),n=[];for(;;){const{done:r,value:i}=t.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===e&&n.push(o)}return n}function BT(e){const{kernelName:t,backendName:n}=e,r=hB(t,n);Gm.has(r)&&Ps(`The kernel '${t}' for backend '${n}' is already registered`),Gm.set(r,e)}function Tee(e){const{kernelName:t}=e;Gx.has(t)&&q().getBool("DEBUG")&&Ps(`Overriding the gradient for '${t}'`),Gx.set(t,e)}function xwe(e,t){const n=hB(e,t);if(!Gm.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);Gm.delete(n)}function vwe(e){if(!Gx.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);Gx.delete(e)}function wwe(e,t){Pk(e).forEach(r=>{const i=Object.assign({},r,{backendName:t});BT(i)})}function hB(e,t){return`${t}_${e}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iee(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var Dee=tn,lo=null;try{lo=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tn(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}tn.prototype.__isLong__;Object.defineProperty(tn.prototype,"__isLong__",{value:!0});function Is(e){return(e&&e.__isLong__)===!0}tn.isLong=Is;var $V={},CV={};function og(e,t){var n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=CV[e],r)?r:(n=nn(e,(e|0)<0?-1:0,!0),i&&(CV[e]=n),n)):(e|=0,(i=-128<=e&&e<128)&&(r=$V[e],r)?r:(n=nn(e,e<0?-1:0,!1),i&&($V[e]=n),n))}tn.fromInt=og;function co(e,t){if(isNaN(e))return t?Od:fo;if(t){if(e<0)return Od;if(e>=Nee)return Ree}else{if(e<=-kV)return cs;if(e+1>=kV)return Oee}return e<0?co(-e,t).neg():nn(e%Hm|0,e/Hm|0,t)}tn.fromNumber=co;function nn(e,t,n){return new tn(e,t,n)}tn.fromBits=nn;var Bk=Math.pow;function dB(e,t,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return fo;if(typeof t=="number"?(n=t,t=!1):t=!!t,n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return dB(e.substring(1),t,n).neg();for(var i=co(Bk(n,8)),s=fo,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+a),n);if(a<8){var l=co(Bk(n,a));s=s.mul(l).add(co(u))}else s=s.mul(i),s=s.add(co(u))}return s.unsigned=t,s}tn.fromString=dB;function Ta(e,t){return typeof e=="number"?co(e,t):typeof e=="string"?dB(e,t):nn(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}tn.fromValue=Ta;var SV=65536,$we=1<<24,Hm=SV*SV,Nee=Hm*Hm,kV=Nee/2,EV=og($we),fo=og(0);tn.ZERO=fo;var Od=og(0,!0);tn.UZERO=Od;var vm=og(1);tn.ONE=vm;var Fee=og(1,!0);tn.UONE=Fee;var VR=og(-1);tn.NEG_ONE=VR;var Oee=nn(-1,2147483647,!1);tn.MAX_VALUE=Oee;var Ree=nn(-1,-1,!0);tn.MAX_UNSIGNED_VALUE=Ree;var cs=nn(0,-2147483648,!1);tn.MIN_VALUE=cs;var xe=tn.prototype;xe.toInt=function(){return this.unsigned?this.low>>>0:this.low};xe.toNumber=function(){return this.unsigned?(this.high>>>0)*Hm+(this.low>>>0):this.high*Hm+(this.low>>>0)};xe.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(cs)){var n=co(t),r=this.div(n),i=r.mul(n).sub(this);return r.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=co(Bk(t,6),this.unsigned),o=this,a="";;){var u=o.div(s),l=o.sub(u.mul(s)).toInt()>>>0,c=l.toString(t);if(o=u,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};xe.getHighBits=function(){return this.high};xe.getHighBitsUnsigned=function(){return this.high>>>0};xe.getLowBits=function(){return this.low};xe.getLowBitsUnsigned=function(){return this.low>>>0};xe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(cs)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1};xe.isZero=function(){return this.high===0&&this.low===0};xe.eqz=xe.isZero;xe.isNegative=function(){return!this.unsigned&&this.high<0};xe.isPositive=function(){return this.unsigned||this.high>=0};xe.isOdd=function(){return(this.low&1)===1};xe.isEven=function(){return(this.low&1)===0};xe.equals=function(t){return Is(t)||(t=Ta(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};xe.eq=xe.equals;xe.notEquals=function(t){return!this.eq(t)};xe.neq=xe.notEquals;xe.ne=xe.notEquals;xe.lessThan=function(t){return this.comp(t)<0};xe.lt=xe.lessThan;xe.lessThanOrEqual=function(t){return this.comp(t)<=0};xe.lte=xe.lessThanOrEqual;xe.le=xe.lessThanOrEqual;xe.greaterThan=function(t){return this.comp(t)>0};xe.gt=xe.greaterThan;xe.greaterThanOrEqual=function(t){return this.comp(t)>=0};xe.gte=xe.greaterThanOrEqual;xe.ge=xe.greaterThanOrEqual;xe.compare=function(t){if(Is(t)||(t=Ta(t)),this.eq(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};xe.comp=xe.compare;xe.negate=function(){return!this.unsigned&&this.eq(cs)?cs:this.not().add(vm)};xe.neg=xe.negate;xe.add=function(t){Is(t)||(t=Ta(t));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,o=t.high>>>16,a=t.high&65535,u=t.low>>>16,l=t.low&65535,c=0,f=0,h=0,d=0;return d+=s+l,h+=d>>>16,d&=65535,h+=i+u,f+=h>>>16,h&=65535,f+=r+a,c+=f>>>16,f&=65535,c+=n+o,c&=65535,nn(h<<16|d,c<<16|f,this.unsigned)};xe.subtract=function(t){return Is(t)||(t=Ta(t)),this.add(t.neg())};xe.sub=xe.subtract;xe.multiply=function(t){if(this.isZero())return fo;if(Is(t)||(t=Ta(t)),lo){var n=lo.mul(this.low,this.high,t.low,t.high);return nn(n,lo.get_high(),this.unsigned)}if(t.isZero())return fo;if(this.eq(cs))return t.isOdd()?cs:fo;if(t.eq(cs))return this.isOdd()?cs:fo;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(EV)&&t.lt(EV))return co(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,a=t.high>>>16,u=t.high&65535,l=t.low>>>16,c=t.low&65535,f=0,h=0,d=0,p=0;return p+=o*c,d+=p>>>16,p&=65535,d+=s*c,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=s*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*c+i*l+s*u+o*a,f&=65535,nn(d<<16|p,f<<16|h,this.unsigned)};xe.mul=xe.multiply;xe.divide=function(t){if(Is(t)||(t=Ta(t)),t.isZero())throw Error("division by zero");if(lo){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?lo.div_u:lo.div_s)(this.low,this.high,t.low,t.high);return nn(n,lo.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Od:fo;var r,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Od;if(t.gt(this.shru(1)))return Fee;s=Od}else{if(this.eq(cs)){if(t.eq(vm)||t.eq(VR))return cs;if(t.eq(cs))return vm;var o=this.shr(1);return r=o.div(t).shl(1),r.eq(fo)?t.isNegative()?vm:VR:(i=this.sub(t.mul(r)),s=r.add(i.div(t)),s)}else if(t.eq(cs))return this.unsigned?Od:fo;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=fo}for(i=this;i.gte(t);){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:Bk(2,a-48),l=co(r),c=l.mul(t);c.isNegative()||c.gt(i);)r-=u,l=co(r,this.unsigned),c=l.mul(t);l.isZero()&&(l=vm),s=s.add(l),i=i.sub(c)}return s};xe.div=xe.divide;xe.modulo=function(t){if(Is(t)||(t=Ta(t)),lo){var n=(this.unsigned?lo.rem_u:lo.rem_s)(this.low,this.high,t.low,t.high);return nn(n,lo.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};xe.mod=xe.modulo;xe.rem=xe.modulo;xe.not=function(){return nn(~this.low,~this.high,this.unsigned)};xe.and=function(t){return Is(t)||(t=Ta(t)),nn(this.low&t.low,this.high&t.high,this.unsigned)};xe.or=function(t){return Is(t)||(t=Ta(t)),nn(this.low|t.low,this.high|t.high,this.unsigned)};xe.xor=function(t){return Is(t)||(t=Ta(t)),nn(this.low^t.low,this.high^t.high,this.unsigned)};xe.shiftLeft=function(t){return Is(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?nn(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):nn(0,this.low<<t-32,this.unsigned)};xe.shl=xe.shiftLeft;xe.shiftRight=function(t){return Is(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?nn(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):nn(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};xe.shr=xe.shiftRight;xe.shiftRightUnsigned=function(t){if(Is(t)&&(t=t.toInt()),t&=63,t===0)return this;var n=this.high;if(t<32){var r=this.low;return nn(r>>>t|n<<32-t,n>>>t,this.unsigned)}else return t===32?nn(n,0,this.unsigned):nn(n>>>t-32,0,this.unsigned)};xe.shru=xe.shiftRightUnsigned;xe.shr_u=xe.shiftRightUnsigned;xe.toSigned=function(){return this.unsigned?nn(this.low,this.high,!1):this};xe.toUnsigned=function(){return this.unsigned?this:nn(this.low,this.high,!0)};xe.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};xe.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};xe.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};tn.fromBytes=function(t,n,r){return r?tn.fromBytesLE(t,n):tn.fromBytesBE(t,n)};tn.fromBytesLE=function(t,n){return new tn(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)};tn.fromBytesBE=function(t,n){return new tn(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};const Mee=F2(Dee),Cwe=ewe({__proto__:null,default:Mee},[Dee]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vd=Mee||Cwe;function Lw(e){return vd.fromString(e,!0,16)}const Lee=Lw("c3a5c85c97cb3127"),pd=Lw("b492b66fbe98f273"),ii=Lw("9ae16a3b2f90404f");function GR(e){return e.xor(e.shru(47))}function Pee(e,t,n){const r=e.slice(t,t+n);return vd.fromBytes(Array.from(r),!0,!0)}function Kt(e,t){return Pee(e,t,8)}function AV(e,t){return Pee(e,t,4)}function Yn(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function mf(e,t,n=Lw("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let i=t.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function Swe(e,t,n,r,i,s){i=i.add(e),s=Yn(s.add(i).add(r),21);const o=i;return i=i.add(t),i=i.add(n),s=s.add(Yn(i,44)),[i.add(r),s.add(o)]}function _C(e,t,n,r){return Swe(Kt(e,t),Kt(e,t+8),Kt(e,t+16),Kt(e,t+24),n,r)}function kwe(e,t=e.length){if(t>=8){const n=ii.add(t*2),r=Kt(e,0).add(ii),i=Kt(e,t-8),s=Yn(i,37).mul(n).add(r),o=Yn(r,25).add(i).mul(n);return mf(s,o,n)}if(t>=4){const n=ii.add(t*2),r=AV(e,0);return mf(r.shl(3).add(t),AV(e,t-4),n)}if(t>0){const n=e[0],r=e[t>>1],i=e[t-1],s=n+(r<<8),o=t+(i<<2);return GR(ii.mul(s).xor(Lee.mul(o))).mul(ii)}return ii}function Ewe(e,t=e.length){const n=ii.add(t*2),r=Kt(e,0).mul(pd),i=Kt(e,8),s=Kt(e,t-8).mul(n),o=Kt(e,t-16).mul(ii);return mf(Yn(r.add(i),43).add(Yn(s,30)).add(o),r.add(Yn(i.add(ii),18)).add(s),n)}function Awe(e,t=e.length){const n=ii.add(t*2),r=Kt(e,0).mul(ii),i=Kt(e,8),s=Kt(e,t-8).mul(n),o=Kt(e,t-16).mul(ii),a=Yn(r.add(i),43).add(Yn(s,30)).add(o),u=mf(a,r.add(Yn(i.add(ii),18)).add(s),n),l=Kt(e,16).mul(n),c=Kt(e,24),f=a.add(Kt(e,t-32)).mul(n),h=u.add(Kt(e,t-24)).mul(n);return mf(Yn(l.add(c),43).add(Yn(f,30)).add(h),l.add(Yn(c.add(r),18)).add(f),n)}function Bee(e,t=e.length){const n=vd.fromNumber(81,!0);if(t<=32)return t<=16?kwe(e,t):Ewe(e,t);if(t<=64)return Awe(e,t);let r=n,i=n.mul(pd).add(113),s=GR(i.mul(ii).add(113)).mul(ii),o=[vd.UZERO,vd.UZERO],a=[vd.UZERO,vd.UZERO];r=r.mul(ii).add(Kt(e,0));let u=0;const l=(t-1>>6)*64,c=l+(t-1&63)-63;do r=Yn(r.add(i).add(o[0]).add(Kt(e,u+8)),37).mul(pd),i=Yn(i.add(o[1]).add(Kt(e,u+48)),42).mul(pd),r=r.xor(a[1]),i=i.add(o[0]).add(Kt(e,u+40)),s=Yn(s.add(a[0]),33).mul(pd),o=_C(e,u,o[1].mul(pd),r.add(a[0])),a=_C(e,u+32,s.add(a[1]),i.add(Kt(e,u+16))),[s,r]=[r,s],u+=64;while(u!==l);const f=pd.add(s.and(255).shl(1));return u=c,a[0]=a[0].add(t-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=Yn(r.add(i).add(o[0]).add(Kt(e,u+8)),37).mul(f),i=Yn(i.add(o[1]).add(Kt(e,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(Kt(e,u+40))),s=Yn(s.add(a[0]),33).mul(f),o=_C(e,u,o[1].mul(f),r.add(a[0])),a=_C(e,u+32,s.add(a[1]),i.add(Kt(e,u+16))),[s,r]=[r,s],mf(mf(o[0],a[0],f).add(GR(i).mul(Lee)).add(s),mf(o[1],a[1],f).add(r),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dc(e,t){return t==="string"?cu(e):vh([e],t)}function _we(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function vh(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Cu(e)),q().getBool("DEBUG")&&xee(e,t),_we(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){const n=new Uint8Array(e.length);for(let r=0;r<n.length;++r)Math.round(e[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${t}`)}function ti(){return q().platform.now()}function Twe(e,t){return q().platform.fetch(e,t)}function cu(e,t="utf-8"){return t=t||"utf-8",q().platform.encode(e,t)}function tc(e,t="utf-8"){return t=t||"utf-8",q().platform.decode(e,t)}function Kn(e){return q().platform.isTypedArray!=null?q().platform.isTypedArray(e):Iee(e)}function Cu(e,t=[],n=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||F_(e)||e==null||Kn(e)&&n)t.push(e);else if(Array.isArray(e)||Kn(e))for(let r=0;r<e.length;++r)Cu(e[r],t,n);else{let r=-1;for(const i of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(i)&&(r=Math.max(r,Number(i)));for(let i=0;i<=r;i++)Cu(e[i],t,n)}return t}const Iwe=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:gt,arraysEqualWithNull:bee,assert:D,assertNonNegativeIntegerDimensions:Ts,assertNonNull:ng,assertShapesMatch:Ar,bytesFromStringArray:wee,bytesPerElement:Ux,checkConversionForErrors:xee,clamp:_f,computeStrides:Re,convertBackendValuesAndArrayBuffer:See,createScalarValue:dc,createShuffledIndices:UR,decodeString:tc,distSquared:swe,encodeString:cu,fetch:Twe,fingerPrint64:Bee,flatten:Cu,getArrayFromDType:$n,getTypedArrayFromDType:sr,hasEncodingLoss:uB,hexToLong:Lw,indexToLoc:ig,inferDtype:rg,inferFromImplicitShape:aB,isBoolean:$ee,isFunction:Tf,isInt:hp,isNumber:Fk,isPromise:F_,isScalarShape:owe,isString:ou,isTypedArray:Kn,isValidDtype:vee,locToIndex:pa,makeOnesTypedArray:N_,makeZerosNestedTypedArray:lB,makeZerosTypedArray:Sr,nearestDivisor:Ok,nearestLargerEven:D_,now:ti,parseAxisParam:it,randUniform:iwe,repeatedTry:jR,rightPad:qd,shuffle:I_,shuffleCombo:rwe,sizeFromShape:Z,sizeToSquarishShape:Nk,squeezeShape:hc,sum:yee,swap:Tl,tanh:awe,toNestedArray:$o,toTypedArray:vh},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dwe{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new Fwe)}profileKernel(t,n,r){let i;const s=()=>{i=r()};let o;const a=ti();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const l of i)l.dataSync();o=Promise.resolve({kernelMs:ti()-a})}if(q().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<i.length;l++){const c=i[l];c.data().then(f=>{Nwe(f,c.dtype,t)})}return{kernelName:t,outputs:i,inputs:n,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:n,outputs:r,timeMs:i,inputs:s,extraInfo:o}=t;r.forEach(a=>{Promise.all([a.data(),i,o]).then(u=>{this.logger.logKernelProfile(n,a,u[0],u[1],s,u[2])})})}}function Nwe(e,t,n){if(t!=="float32")return!1;for(let r=0;r<e.length;r++){const i=e[r];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class Fwe{logKernelProfile(t,n,r,i,s,o){const a=typeof i=="number"?qd(`${i}ms`,9):i.error,u=qd(t,25),l=n.rank,c=n.size,f=qd(n.shape.toString(),14);let h="";for(const d in s){const p=s[d];if(p!=null){const g=p.shape||n.shape,m=g.length;h+=`${d}: ${m}D ${m>0?g:""} `}}console.log(`%c${u}	%c${a}	%c${l}D ${f}	%c${c}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Owe(e,t,n){const r={},i={};for(let u=0;u<t.length;u++)r[t[u].id]=!0;for(let u=0;u<e.length;u++){const l=e[u],c=l.inputs;for(const f in c){const h=c[f];let d=!1;for(let p=0;p<t.length;p++)if(r[h.id]){l.outputs.forEach(g=>r[g.id]=!0),d=!0,i[l.id]=!0;break}if(d)break}}const s={};s[n.id]=!0;const o={};for(let u=e.length-1;u>=0;u--){const l=e[u],c=l.inputs;for(let f=0;f<l.outputs.length;f++)if(s[l.outputs[f].id]){for(const h in c)s[c[h].id]=!0,o[l.id]=!0;break}}const a=[];for(let u=0;u<e.length;u++){const l=e[u];if(i[l.id]&&o[l.id]){const c={};for(const h in l.inputs){const d=l.inputs[h];r[d.id]&&(c[h]=d)}const f=Object.assign({},l);f.inputs=c,f.outputs=l.outputs,a.push(f)}}return a}function Rwe(e,t,n,r){for(let i=t.length-1;i>=0;i--){const s=t[i],o=[];if(s.outputs.forEach(u=>{const l=e[u.id];l!=null?o.push(l):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const u in s.inputs){if(!(u in a))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(a)}.`);const l=n(()=>a[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);const c=s.inputs[u];if(!gt(l.shape,c.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(e[c.id]==null)e[c.id]=l;else{const f=e[c.id];e[c.id]=r(f,l),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _V=20,qy=3,i3=7;function Mwe(e,t,n,r){const i=Re(t),s=Lwe(e,t,n,i),o=t.length,a=HS(e,t,n,i,s),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${o}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(a.map(l=>"    "+l).join(`
`)),u.join(`
`)}function Lwe(e,t,n,r){const i=Z(t),s=r[r.length-1],o=new Array(s).fill(0),a=t.length,u=n==="complex64"?Ob(e):e;if(a>1)for(let l=0;l<i/s;l++){const c=l*s;for(let f=0;f<s;f++)o[f]=Math.max(o[f],Fb(u[c+f],0,n).length)}return o}function Fb(e,t,n){let r;return Array.isArray(e)?r=`${parseFloat(e[0].toFixed(i3))} + ${parseFloat(e[1].toFixed(i3))}j`:ou(e)?r=`'${e}'`:n==="bool"?r=zee(e):r=parseFloat(e.toFixed(i3)).toString(),qd(r,t)}function zee(e){return e===0?"false":"true"}function HS(e,t,n,r,i,s=!0){const o=n==="complex64"?2:1,a=t[0],u=t.length;if(u===0){if(n==="complex64"){const g=Ob(e);return[Fb(g[0],0,n)]}return n==="bool"?[zee(e[0])]:[e[0].toString()]}if(u===1){if(a>_V){const m=qy*o;let y=Array.from(e.slice(0,m)),b=Array.from(e.slice((a-qy)*o,a*o));return n==="complex64"&&(y=Ob(y),b=Ob(b)),["["+y.map((v,x)=>Fb(v,i[x],n)).join(", ")+", ..., "+b.map((v,x)=>Fb(v,i[a-qy+x],n)).join(", ")+"]"]}return["["+(n==="complex64"?Ob(e):Array.from(e)).map((m,y)=>Fb(m,i[y],n)).join(", ")+"]"]}const l=t.slice(1),c=r.slice(1),f=r[0]*o,h=[];if(a>_V){for(let g=0;g<qy;g++){const m=g*f,y=m+f;h.push(...HS(e.slice(m,y),l,n,c,i,!1))}h.push("...");for(let g=a-qy;g<a;g++){const m=g*f,y=m+f;h.push(...HS(e.slice(m,y),l,n,c,i,g===a-1))}}else for(let g=0;g<a;g++){const m=g*f,y=m+f;h.push(...HS(e.slice(m,y),l,n,c,i,g===a-1))}const d=u===2?",":"";h[0]="["+(a>0?h[0]+d:"");for(let g=1;g<h.length-1;g++)h[g]=" "+h[g]+d;let p=`,
`;for(let g=2;g<u;g++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(s?"":p),h}function Ob(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rn{constructor(t,n,r){if(this.dtype=n,this.shape=t.slice(),this.size=Z(t),r!=null){const i=r.length;D(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||$n(n,this.size),this.strides=Re(t)}set(t,...n){n.length===0&&(n=[0]),D(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const r=this.locToIndex(n);this.values[r]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(const i of t){if(i<0||i>=this.shape[n]){const s=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(s)}n++}let r=t[t.length-1];for(let i=0;i<t.length-1;++i)r+=this.strides[i]*t[i];return this.values[r]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const n=new Array(this.shape.length);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return ta().makeTensor(this.values,this.shape,this.dtype)}}let ta=null,pm=null;function Pwe(e){ta=e}function Bwe(e){pm=e}class zt{constructor(t,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=Z(t),this.strides=Re(t),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return pm.buffer(this.shape,this.dtype,t)}bufferSync(){return pm.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return $o(this.shape,t,this.dtype==="complex64")}arraySync(){return $o(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=ta().read(this.dataId);if(this.dtype==="string"){const n=await t;try{return n.map(r=>tc(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),ta().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=ta().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>tc(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await ta().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),ta().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return pm.print(this,t)}clone(){return this.throwIfDisposed(),pm.clone(this)}toString(t=!1){const n=this.dataSync();return Mwe(n,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),pm.cast(this,t)}variable(t=!0,n,r){return this.throwIfDisposed(),ta().makeVariable(this,t,n,r)}}Object.defineProperty(zt,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function J(){return fB("Tensor",()=>zt)}J();class qx extends zt{constructor(t,n,r,i){super(t.shape,t.dtype,t.dataId,i),this.trainable=n,this.name=r}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!gt(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);ta().disposeTensor(this),this.dataId=t.dataId,ta().incRef(this,null)}dispose(){ta().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(qx,Symbol.hasInstance,{value:e=>e instanceof zt&&e.assign!=null&&e.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var HR;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(HR||(HR={}));var qR;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(qR||(qR={}));var XR;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(XR||(XR={}));var YR;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(YR||(YR={}));var KR;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(KR||(KR={}));const zwe={float32:YR,int32:qR,bool:XR,complex64:KR};function Bi(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return zwe[e][t]}function zT(e){return Bi(e,"int32")}function Uee(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function jee(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bn(e,t){if(e.dtype===t.dtype)return[e,t];const n=Bi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Wee(e,t){D(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function Uwe(e,t){return t.some(n=>n.id===e.id)}function pB(e){const t=[];return Vee(e,t,new Set),t}function Vee(e,t,n){if(e==null)return;if(e instanceof zt){t.push(e);return}if(!jwe(e))return;const r=e;for(const i in r){const s=r[i];n.has(s)||(n.add(s),Vee(s,t,n))}}function jwe(e){return Array.isArray(e)||typeof e=="object"}const Wwe=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:Wee,getTensorsInContainer:pB,isTensorInList:Uwe,makeTypesMatch:bn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s3(e){return e.kernelName!=null}class TV{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class qm{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new TV}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const r=t[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,r=1){return t in this.registryFactory?(Ps(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:r},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:n,asyncInit:r}=this.initializeBackend(t);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Dwe(this.backendInstance),!0}setupRegisteredKernels(){Pk(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){Pk(t).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[t])})}initializeBackend(t){const n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const r=n.factory();if(r&&!(r instanceof T_)&&typeof r.then=="function"){const i=++this.pendingBackendInitId,s=r.then(o=>i<this.pendingBackendInitId?!1:(this.registry[t]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,Ps(`Initialization of backend ${t} failed`),Ps(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(r){return Ps(`Initialization of backend ${t} failed`),Ps(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const r=t[n],{success:i,asyncInit:s}=this.initializeBackend(r);if(s||i)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){const r=this.state.tensorInfo.get(n),i=r.backend,s=this.readSync(n),o=i.refCount(n);i.disposeData(n,!0),r.backend=t,t.move(n,s,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let r=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}let i;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(t,n,r){t();try{const i=r();return n(),i}catch(i){throw n(),i}}nextTensorId(){return qm.nextTensorId++}nextVariableId(){return qm.nextVariableId++}clone(t){const n=z.runKernel(g1,{x:t}),r={x:t},i=o=>({x:()=>{const a="float32",u={x:o},l={dtype:a};return z.runKernel(n1,u,l)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],i,s,{}),n}runKernel(t,n,r){if(this.backendName==null&&this.backend,!(Hx(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,r){const i=this.backend.numDataIds();let s=0;r.forEach(u=>{s+=u.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-s-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let n,r=[];const i=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let u;const l=s3(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(s3(t)){const{kernelName:p,inputs:g,attrs:m}=t;this.backendName==null&&this.backend;const y=Hx(p,this.backendName);D(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();u=y.kernelFunc({inputs:g,attrs:m,backend:this.backend});const v=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,b,v);const x=v.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(i){const w=this.getTensorsForGradient(p,g,x);r=this.saveTensorsForBackwardMode(w)}return x}}else{const{forwardFunc:p}=t,g=m=>{i&&(r=m.map(y=>this.keep(this.clone(y))))};a=()=>{const m=this.backend.numDataIds();u=this.tidy(()=>p(this.backend,g));const y=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,m,y),y}}const{inputs:c,attrs:f}=t,h=s3(t)?null:t.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(d=this.profiler.profileKernel(l,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),i&&this.addTapeNode(l,c,n,h,r,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(u)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(t,n,r){const i=WR(t);if(i!=null){const s=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(D(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(l=>n[l])):a=s.map(l=>n[l]);const u=r.filter((l,c)=>o[c]);return a.concat(u)}return[]}makeTensor(t,n,r,i){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;let s=t;r==="string"&&ou(t[0])&&(s=t.map(u=>cu(u)));const o=i.write(s,n,r),a=new zt(n,r,o,this.nextTensorId());if(this.trackTensor(a,i),r==="string"){const u=this.state.tensorInfo.get(o),l=wee(s);this.state.numBytes+=l-u.bytes,u.bytes=l}return a}makeTensorFromDataId(t,n,r,i){r=r||"float32";const s={dataId:t,shape:n,dtype:r};return this.makeTensorFromTensorInfo(s,i)}makeTensorFromTensorInfo(t,n){const{dataId:r,shape:i,dtype:s}=t,o=new zt(i,s,r,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(t,n=!0,r,i){r=r||this.nextVariableId().toString(),i!=null&&i!==t.dtype&&(t=t.cast(i));const s=new qx(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=t.size*Ux(t.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:r})),t instanceof qx||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const r=t.size*Ux(t.dtype);this.state.numBytes-=r}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,r,i,s,o){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},u=WR(t);u!=null&&(i=u.gradFunc),i!=null&&(a.gradient=l=>(l=l.map((c,f)=>{if(c==null){const h=r[f],d=Sr(h.size,h.dtype);return this.makeTensor(d,h.shape,h.dtype)}return c}),i(l.length>1?l:l[0],s,o))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){const n=pB(t),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const o=this.state.activeScope.track[s];!o.kept&&!r.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(t,n,r,i=!1){if(D(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));D(s instanceof zt,()=>"The result y returned by f() must be a tensor.");const o=Owe(this.state.activeTape,n,s);if(!i&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=r??Vwe(s.shape),Rwe(a,o,l=>this.tidy(l),Gwe);const u=n.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const c of l.saved)c.dispose()}),this.state.activeTape=null),{value:s,grads:u}})}customGrad(t){return D(Tf(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{D(n.every(a=>a instanceof zt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const i={};n.forEach((a,u)=>{i[u]=a});const s=(a,u)=>(r=t(...n,u),D(r.value instanceof zt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),D(Tf(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,u)=>{const l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];D(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),D(c.every(h=>h instanceof zt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return c.forEach((h,d)=>{f[d]=()=>h}),f};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:i})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){const n=ti(),r=await this.backend.time(t);return r.wallMs=ti()-n,r}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new TV;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}qm.nextTensorId=0;qm.nextVariableId=0;function Vwe(e){const t=N_(Z(e),"float32");return z.makeTensor(t,e,"float32")}function Gee(){const e=Eee();if(e._tfengine==null){const t=new kee(e);e._tfengine=new qm(t)}return fwe(e._tfengine.ENV),Pwe(()=>e._tfengine),e._tfengine}const z=Gee();function Gwe(e,t){const n={a:e,b:t};return z.runKernel(sg,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hwe(){return typeof navigator<"u"&&navigator!=null}let ZR;function qwe(e){ZR=e}function gB(e){if(ZR!==void 0)return ZR;if(e||Hwe()){if(e||(e=navigator),e.product==="ReactNative")return!0;const t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){const n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function mB(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const Xwe=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:mB,isMobile:gB,mockIsMobile:qwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zi=q();zi.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});zi.registerFlag("IS_BROWSER",()=>mB());zi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");zi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));zi.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));zi.registerFlag("PROD",()=>!1);zi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>zi.getBool("DEBUG"));zi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);zi.registerFlag("IS_TEST",()=>!1);zi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>zi.getBool("DEBUG"));zi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);zi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);zi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Su(e,t){let n=e;if(Kn(e))return t==="string"?[]:[e.length];if(Uee(e)){const i=e.channels||"RGBA";return[e.height,e.width*i.length]}else if(jee(e))return[e.buffer.size/(t==null?4:Ux(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||Kn(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Hee(e,r,[]),r}function Hee(e,t,n){if(n=n||[],!Array.isArray(e)&&!Kn(e)){D(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}D(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),D(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);const r=t.slice(1);for(let i=0;i<e.length;++i)Hee(e[i],r,n.concat(i))}function IV(e,t,n,r){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function N(e,t,n,r="numeric"){if(e instanceof J())return IV(r,e.dtype,t,n),e;let i=rg(e);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),IV(r,i,t,n),e==null||!Kn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){const u=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${u}'`)}const s=Su(e,i);!Kn(e)&&!Array.isArray(e)&&(e=[e]);const a=i!=="string"?vh(e,i):Cu(e,[],!0);return z.makeTensor(a,s,i)}function Xx(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((s,o)=>N(s,`${t}[${o}]`,n,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qee="__op";function U(e){const t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+qee;const i=(...s)=>{z.startScope(n);try{const o=r(...s);return F_(o)&&console.error("Cannot return a Promise inside of tidy."),z.endScope(o),o}catch(o){throw z.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ywe(e,t){const n=N(e,"real","complex"),r=N(t,"imag","complex");Ar(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return z.runKernel(z_,i)}const If=U({complex_:Ywe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wh(e,t,n,r){if(r==null)r=rg(e);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(jee(e)||Uee(e)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return z.backend.createTensorFromGPUData(e,t||n,r)}if(!Kn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Ts(t);const i=Z(t),s=Z(n);D(i===s,()=>`Based on the provided shape, [${t}], the tensor should have ${i} values but has ${s}`);for(let o=0;o<n.length;++o){const a=n[o],u=o===n.length-1?a!==Z(t.slice(o)):!0;D(n[o]===t[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!Kn(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=r!=="string"?vh(e,r):Cu(e,[],!0),z.makeTensor(e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yd(e,t,n){const r=Su(e,n);return wh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Ia{static join(t){return new Ia(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>Kn(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let n=0;for(let r=0;r<t.length;r++){const i=t[r];r!==t.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const s=n+i.byteLength;this.shards.push({buffer:i,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,n=isNaN(Number(n))?0:n,t=Math.max(0,t),n=Math.min(this.byteLength,n),n<=t)return new ArrayBuffer(0);const r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);const i=n-t,s=new ArrayBuffer(i),o=new Uint8Array(s);let a=0;for(let u=r;u<this.shards.length;u++){const l=this.shards[u],f=t+a-l.start,h=a,p=Math.min(n,l.end)-l.start,g=new Uint8Array(l.buffer,f,p-f);if(o.set(g,h),a+=g.length,n<l.end)break}return s}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function n(i){return t<i.start?-1:t>=i.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=Kwe(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function Kwe(e,t){let n=0,r=e.length;for(;n<=r;){const i=Math.floor((r-n)/2)+n,s=t(e[i]);if(s===0)return i;s<0?r=i:n=i+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zwe(){q().set("PROD",!0)}function Jwe(){q().set("DEBUG",!0)}function Qwe(){q().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function e$e(e){q().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function t$e(){z.disposeVariables()}function Jo(){return z}function zk(){return z.memory()}function n$e(e){return z.profile(e)}function X(e,t){return z.tidy(e,t)}function ot(e){pB(e).forEach(n=>n.dispose())}function ga(e){return z.keep(e)}function r$e(e){return z.time(e)}function i$e(e){return z.setBackend(e)}function s$e(){return z.ready()}function Xee(){return z.backendName}function o$e(e){z.removeBackend(e)}function a$e(e){return z.findBackend(e)}function u$e(e){return z.findBackendFactory(e)}function yB(e,t,n=1){return z.registerBackend(e,t,n)}function bB(){return z.backend}function l$e(e,t){q().setPlatform(e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Df=4;async function JR(e,t){const n=[],r=[],i=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);for(let o=0;o<i.length;++o){const a=i[o],u=Array.isArray(e)?e[o].tensor:e[a];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${u.dtype}`);const l={name:a,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const c=new Promise(async f=>{const h=await u.bytes(),d=h.reduce((m,y)=>m+y.length,0)+Df*h.length,p=new Uint8Array(d);let g=0;for(let m=0;m<h.length;m++){const y=h[m],b=new Uint8Array(new Uint32Array([y.length]).buffer);p.set(b,g),g+=Df,p.set(y,g),g+=y.length}f(p)});r.push(c)}else r.push(u.data());t!=null&&(l.group=t),n.push(l)}const s=await Promise.all(r);return{data:d$e(s),specs:n}}function Yee(e,t){const n=new Ia(e),r={};let i=0;for(const s of t){const o=c$e(s,(a,u)=>n.slice(i+a,i+u));r[s.name]=Kee(s,n.slice(i,i+o)),i+=o}return r}function c$e(e,t){const n=Z(e.shape);let r;if("quantization"in e){const i=e.quantization;r=dp[i.dtype]}else if(e.dtype==="string"){let i=0;for(let s=0;s<n;s++)i+=Df+new Uint32Array(t(i,i+Df))[0];return i}else r=dp[e.dtype];return n*r}async function f$e(e,t){const n=Z(e.shape);let r;if("quantization"in e){const i=e.quantization;r=dp[i.dtype]}else if(e.dtype==="string"){let i=0;for(let s=0;s<n;s++)i+=Df+new Uint32Array(await t(i,i+Df))[0];return i}else r=dp[e.dtype];return n*r}function Kee(e,t){const n=e.name,r=e.dtype,i=e.shape,s=Z(i);let o,a=0;if("quantization"in e){const u=e.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error(`Weight ${e.name} with quantization ${u.dtype} doesn't have corresponding metadata min and scale.`)}else if(u.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${e.name} is quantized with ${u.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${e.name} has unknown quantization dtype ${u.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const l=dp[u.dtype],c=u.dtype==="uint8"?new Uint8Array(t):new Uint16Array(t);if(r==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(c.length);for(let f=0;f<c.length;f++){const h=c[f];o[f]=h*u.scale+u.min}}else if(u.dtype==="float16")o=x$e()(c);else throw new Error(`Unsupported quantization type ${u.dtype} for weight type float32.`);else if(r==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error(`Unsupported quantization type ${u.dtype} for weight type int32.`);o=new Int32Array(c.length);for(let f=0;f<c.length;f++){const h=c[f];o[f]=Math.round(h*u.scale+u.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);a+=s*l}else if(r==="string"){const u=Z(e.shape);o=[];for(let l=0;l<u;l++){const c=new Uint32Array(t.slice(a,a+Df))[0];a+=Df;const f=new Uint8Array(t.slice(a,a+c));o.push(f),a+=c}}else{const u=dp[r];if(r==="float32")o=new Float32Array(t);else if(r==="int32")o=new Int32Array(t);else if(r==="bool")o=new Uint8Array(t);else if(r==="complex64"){o=new Float32Array(t);const l=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let p=0;p<l.length;p++)l[p]=o[p*2],c[p]=o[p*2+1];const f=Yd(l,i,"float32"),h=Yd(c,i,"float32"),d=If(f,h);return f.dispose(),h.dispose(),d}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);a+=s*u}return Yd(o,i,r)}async function DV(e,t,n){let r=new Uint8Array(t);for(;r.byteLength<n;){const{done:i,value:s}=await e.read();if(i&&s==null){const a=n-r.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const o=new Uint8Array(r.length+s.byteLength);o.set(r,0),o.set(new Uint8Array(s),r.length),r=o}return r.buffer}async function h$e(e,t){const n={},r=e.getReader();let i=new ArrayBuffer(0);for(const s of t){const o=await f$e(s,async(l,c)=>(i=await DV(r,i,c),i.slice(l,c)));i=await DV(r,i,o);const a=i.slice(0,o);i=i.slice(o);const u=Kee(s,a);if(n[s.name]=u,Xee()==="webgpu"){const l=bB();"uploadToGPU"in l&&Z(u.shape)>=q().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&l.uploadToGPU(u.dataId)}}return n}function d$e(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach(s=>{if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});const r=new Uint8Array(t);let i=0;return n.forEach(s=>{r.set(new Uint8Array(s.buffer),i),i+=s.byteLength}),r.buffer}const xB=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function NV(e){return xB?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function p$e(e){if(xB)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function g$e(e){if(xB){const r=Buffer.from(e,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function Zee(e){return Ia.join(e)}function FV(e){const t="/";for(e=e.trim();e.endsWith(t);)e=e.slice(0,e.length-1);const n=e.split(t);return n[n.length-1]}function Jee(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(n.initializerSignature=e.initializerSignature),e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),n}function Qee(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(r.trainingConfig=e.trainingConfig),e.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return e.signature!=null&&(r.signature=e.signature),e.userDefinedMetadata!=null&&(r.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(r.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(r.initializerSignature=e.initializerSignature),r}async function vB(e,t){let n,r;return e.weightsManifest!=null&&([n,r]=await t(e.weightsManifest)),Qee(e,n,r)}function Pw(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:NV(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:NV(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new Ia(e.weightData).byteLength}}function QR(e){const t=[];for(const n of e)t.push(...n.weights);return t}function m$e(){const e=n=>{let r=n<<13,i=0;for(;!(r&8388608);)i-=8388608,r<<=1;return r&=-8388609,i+=947912704,r|i},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function y$e(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function b$e(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function x$e(){const e=m$e(),t=y$e(),n=b$e();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let o=0;o<r.length;o++){const a=r[o],u=e[n[a>>10]+(a&1023)]+t[a>>10];s[o]=u}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return pn.instance==null&&(pn.instance=new pn),pn.instance}static registerSaveRouter(t){pn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){pn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return pn.getHandlers(t,"save")}static getLoadHandlers(t,n){return pn.getHandlers(t,"load",n)}static getHandlers(t,n,r){const i=[];return(n==="load"?pn.getInstance().loadRouters:pn.getInstance().saveRouters).forEach(o=>{const a=o(t,r);a!==null&&i.push(a)}),i}}const v$e=e=>pn.registerSaveRouter(e),w$e=e=>pn.registerLoadRouter(e),ete=e=>pn.getSaveHandlers(e),$$e=(e,t)=>pn.getLoadHandlers(e,t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eM="tensorflowjs",tM=1,Rd="models_store",Zc="model_info_store";function tte(){if(!q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function nM(e){const t=e.result;t.createObjectStore(Rd,{keyPath:"modelPath"}),t.createObjectStore(Zc,{keyPath:"modelPath"})}class pp{constructor(t){if(this.indexedDB=tte(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((r,i)=>{const s=this.indexedDB.open(eM,tM);s.onupgradeneeded=()=>nM(s),s.onsuccess=()=>{const o=s.result;if(n==null){const a=o.transaction(Rd,"readonly"),l=a.objectStore(Rd).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(l.result.modelArtifacts)},l.onerror=c=>(o.close(),i(l.error)),a.oncomplete=()=>o.close()}else{n.weightData=Ia.join(n.weightData);const a=Pw(n),u=o.transaction(Zc,"readwrite");let l=u.objectStore(Zc),c;try{c=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return i(h)}let f;c.onsuccess=()=>{f=o.transaction(Rd,"readwrite");const h=f.objectStore(Rd);let d;try{d=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return i(p)}d.onsuccess=()=>r({modelArtifactsInfo:a}),d.onerror=p=>{l=u.objectStore(Zc);const g=l.delete(this.modelPath);g.onsuccess=()=>(o.close(),i(d.error)),g.onerror=m=>(o.close(),i(d.error))}},c.onerror=h=>(o.close(),i(c.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},s.onerror=o=>i(s.error)})}}pp.URL_SCHEME="indexeddb://";const nte=e=>q().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(pp.URL_SCHEME)?C$e(e.slice(pp.URL_SCHEME.length)):null;pn.registerSaveRouter(nte);pn.registerLoadRouter(nte);function C$e(e){return new pp(e)}function S$e(e){return e.startsWith(pp.URL_SCHEME)?e.slice(pp.URL_SCHEME.length):e}class k$e{constructor(){this.indexedDB=tte()}async listModels(){return new Promise((t,n)=>{const r=this.indexedDB.open(eM,tM);r.onupgradeneeded=()=>nM(r),r.onsuccess=()=>{const i=r.result,s=i.transaction(Zc,"readonly"),a=s.objectStore(Zc).getAll();a.onsuccess=()=>{const u={};for(const l of a.result)u[l.modelPath]=l.modelArtifactsInfo;t(u)},a.onerror=u=>(i.close(),n(a.error)),s.oncomplete=()=>i.close()},r.onerror=i=>n(r.error)})}async removeModel(t){return t=S$e(t),new Promise((n,r)=>{const i=this.indexedDB.open(eM,tM);i.onupgradeneeded=()=>nM(i),i.onsuccess=()=>{const s=i.result,o=s.transaction(Zc,"readwrite"),a=o.objectStore(Zc),u=a.get(t);let l;u.onsuccess=()=>{if(u.result==null)return s.close(),r(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const c=a.delete(t),f=()=>{l=s.transaction(Rd,"readwrite");const d=l.objectStore(Rd).delete(t);d.onsuccess=()=>n(u.result.modelArtifactsInfo),d.onerror=p=>r(u.error)};c.onsuccess=f,c.onerror=h=>(f(),s.close(),r(u.error))}},u.onerror=c=>(s.close(),r(u.error)),o.oncomplete=()=>{l==null?s.close():l.oncomplete=()=>s.close()}},i.onerror=s=>r(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Il="/",gm="tensorflowjs_models",rte="info",E$e="model_topology",A$e="weight_specs",_$e="weight_data",T$e="model_metadata";function ite(e){return{info:[gm,e,rte].join(Il),topology:[gm,e,E$e].join(Il),weightSpecs:[gm,e,A$e].join(Il),weightData:[gm,e,_$e].join(Il),modelMetadata:[gm,e,T$e].join(Il)}}function ste(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function I$e(e){const t=e.split(Il);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Il)}function D$e(e){return e.startsWith(gp.URL_SCHEME)?e.slice(gp.URL_SCHEME.length):e}class gp{constructor(t){if(!q().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=ite(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),i=Pw(t),s=Ia.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,p$e(s));const o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:i}}catch{throw ste(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=r;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){const a=JSON.parse(s);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=g$e(o),n}}gp.URL_SCHEME="localstorage://";const ote=e=>q().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(gp.URL_SCHEME)?N$e(e.slice(gp.URL_SCHEME.length)):null;pn.registerSaveRouter(ote);pn.registerLoadRouter(ote);function N$e(e){return new gp(e)}class F$e{constructor(){D(q().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),D(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},n=gm+Il,r=Il+rte;for(let i=0;i<this.LS.length;++i){const s=this.LS.key(i);if(s.startsWith(n)&&s.endsWith(r)){const o=I$e(s);t[o]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){t=D$e(t);const n=ite(t);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return ste(n),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _m="://";class ni{constructor(){this.managers={}}static getInstance(){return ni.instance==null&&(ni.instance=new ni),ni.instance}static registerManager(t,n){D(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(_m)&&(t=t.slice(0,t.indexOf(_m))),D(t.length>0,()=>"scheme must not be an empty string.");const r=ni.getInstance();D(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=n}static getManager(t){const n=ni.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(ni.getInstance().managers)}}function qS(e){if(e.indexOf(_m)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ni.getSchemes().join(",")}`);return{scheme:e.split(_m)[0],path:e.split(_m)[1]}}async function ate(e,t,n=!1){D(e!==t,()=>`Old path and new path are the same: '${e}'`);const r=pn.getLoadHandlers(e);D(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),D(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);const i=r[0],s=pn.getSaveHandlers(t);D(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),D(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);const o=s[0],a=qS(e).scheme,u=qS(e).path,l=a===qS(e).scheme,c=await i.load();n&&l&&await ni.getManager(a).removeModel(u);const f=await o.save(c);return n&&!l&&await ni.getManager(a).removeModel(u),f.modelArtifactsInfo}async function O$e(){const e=ni.getSchemes(),t={};for(const n of e){const r=await ni.getManager(n).listModels();for(const i in r){const s=n+_m+i;t[s]=r[i]}}return t}async function R$e(e){const t=qS(e);return ni.getManager(t.scheme).removeModel(t.path)}async function M$e(e,t){return ate(e,t,!1)}async function L$e(e,t){return ate(e,t,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P$e{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}setTimeoutCustom(t,n){if(typeof window>"u"||!q().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,n);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const i=this.functionRefs[r.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return Iee(t)}}if(q().get("IS_BROWSER")){q().setPlatform("browser",new P$e);try{ni.registerManager(gp.URL_SCHEME,new F$e)}catch{}try{ni.registerManager(pp.URL_SCHEME,new k$e)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B$e={importFetch:()=>require("node-fetch")};let o3;class z$e{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,n){return q().global.fetch!=null?q().global.fetch(t,n):(o3==null&&(o3=B$e.importFetch()),o3(t,n))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(t)}decode(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}q().get("IS_NODE")&&!q().get("IS_BROWSER")&&q().setPlatform("node",new z$e);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nt(e,t="float32",n){return t=t||"float32",Ts(e),new Rn(e,t,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$e(e,t){const n=N(e,"x","cast");if(!vee(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:t};return z.runKernel(n1,r,i)}const ge=U({cast_:U$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$e(e){const n={x:N(e,"x","clone","string_or_numeric")};return z.runKernel(g1,n)}const yf=U({clone_:j$e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ute(e,t=!1){console.log(e.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Gee();const W$e={buffer:nt,cast:ge,clone:yf,print:ute};Bwe(W$e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V$e(e,t){let n=N(e,"a","add"),r=N(t,"b","add");[n,r]=bn(n,r);const i={a:n,b:r};return z.runKernel(sg,i)}const ue=U({add_:V$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G$e(e,t){let n=N(e,"a","floorDiv"),r=N(t,"b","floorDiv");[n,r]=bn(n,r);const i={a:n,b:r};return z.runKernel(d1,i)}const wB=U({floorDiv_:G$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H$e(e,t){let n=N(e,"a","div"),r=N(t,"b","div");if([n,r]=bn(n,r),n.dtype==="int32"&&r.dtype==="int32")return wB(n,r);const i={a:n,b:r},s={};return z.runKernel(a1,i,s)}const Oe=U({div_:H$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$e(e,t){let n=N(e,"a","mul"),r=N(t,"b","mul");[n,r]=bn(n,r);const i={a:n,b:r};return z.runKernel(S1,i)}const j=U({mul_:q$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$e(e){const t=N(e,"x","abs");if(t.dtype==="complex64"){const n={x:t};return z.runKernel(W2,n)}else{const n={x:t};return z.runKernel(O2,n)}}const Bn=U({abs_:X$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$e(e){const n={x:N(e,"x","acos")};return z.runKernel(Y0,n)}const lte=U({acos_:Y$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$e(e){const n={x:N(e,"x","acosh")};return z.runKernel(K0,n)}const cte=U({acosh_:K$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$e(e){D(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),D(e.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`);const t=e.map((i,s)=>N(i,`tensors${s}`,"addN")),n=t[0];t.forEach(i=>{if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(i=>{if(!gt(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=t;return z.runKernel(R2,r)}const J$e=U({addN_:Z$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$e(e,t=null,n=!1){const i={x:N(e,"x","all","bool")},s={axis:t,keepDims:n};return z.runKernel(O_,i,s)}const $B=U({all_:Q$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eCe(e,t=null,n=!1){const i={x:N(e,"x","any","bool")},s={axis:t,keepDims:n};return z.runKernel(R_,i,s)}const Uk=U({any_:eCe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tCe(e,t=0){const r={x:N(e,"x","argMax")},i={axis:t};return z.runKernel(M2,r,i)}const Xm=U({argMax_:tCe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nCe(e,t=0){const r={x:N(e,"x","argMin")},i={axis:t};return z.runKernel(L2,r,i)}const fte=U({argMin_:nCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rCe(e){const n={x:N(e,"x","asin")};return z.runKernel(Z0,n)}const hte=U({asin_:rCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iCe(e){const n={x:N(e,"x","asinh")};return z.runKernel(J0,n)}const dte=U({asinh_:iCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sCe(e){const n={x:N(e,"x","atan")};return z.runKernel(Q0,n)}const pte=U({atan_:sCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oCe(e,t){let n=N(e,"a","atan2"),r=N(t,"b","atan2");[n,r]=bn(n,r);const i={a:n,b:r};return z.runKernel(t1,i)}const gte=U({atan2_:oCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aCe(e){const n={x:N(e,"x","atanh")};return z.runKernel(e1,n)}const mte=U({atanh_:aCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bw(e,t,n,r,i="NHWC",s){const o=e[3],a=[...t,o],u=gc(i);return or(e,a,n,s,r,null,null,u)}function Ro(e,t,n,r,i,s,o="channelsLast"){const[a,u]=Yx(t);let l;if(o==="channelsLast")l=[a,u,e[3],e[3]];else if(o==="channelsFirst")l=[a,u,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return or(e,l,n,r,i,s,!1,o)}function pc(e,t,n,r,i,s,o="NDHWC"){const[a,u,l]=rM(t);let c,f;if(o==="NDHWC")f="channelsLast",c=[a,u,l,e[4],e[4]];else if(o==="NCDHW")f="channelsFirst",c=[a,u,l,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return $h(e,c,n,r,i,!1,f,s)}function or(e,t,n,r,i,s,o=!1,a="channelsLast"){let[u,l,c,f]=[-1,-1,-1,-1];if(a==="channelsLast")[u,l,c,f]=e;else if(a==="channelsFirst")[u,f,l,c]=e;else throw new Error(`Unknown dataFormat ${a}`);const[h,d,,p]=t,[g,m]=Yx(n),[y,b]=Yx(r),v=Tm(h,y),x=Tm(d,b),{padInfo:w,outHeight:C,outWidth:$}=cCe(i,l,c,g,m,v,x,s,a),S=o?p*f:p;let k;return a==="channelsFirst"?k=[u,S,C,$]:a==="channelsLast"&&(k=[u,C,$,S]),{batchSize:u,dataFormat:a,inHeight:l,inWidth:c,inChannels:f,outHeight:C,outWidth:$,outChannels:S,padInfo:w,strideHeight:g,strideWidth:m,filterHeight:h,filterWidth:d,effectiveFilterHeight:v,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:b,inShape:e,outShape:k,filterShape:t}}function $h(e,t,n,r,i,s=!1,o="channelsLast",a){let[u,l,c,f,h]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[u,l,c,f,h]=e;else if(o==="channelsFirst")[u,h,l,c,f]=e;else throw new Error(`Unknown dataFormat ${o}`);const[d,p,g,,m]=t,[y,b,v]=rM(n),[x,w,C]=rM(r),$=Tm(d,x),S=Tm(p,w),k=Tm(g,C),{padInfo:E,outDepth:A,outHeight:F,outWidth:_}=fCe(i,l,c,f,y,b,v,$,S,k,a),I=s?m*h:m;let T;return o==="channelsFirst"?T=[u,I,A,F,_]:o==="channelsLast"&&(T=[u,A,F,_,I]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:f,inChannels:h,outDepth:A,outHeight:F,outWidth:_,outChannels:I,padInfo:E,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:d,filterHeight:p,filterWidth:g,effectiveFilterDepth:$,effectiveFilterHeight:S,effectiveFilterWidth:k,dilationDepth:x,dilationHeight:w,dilationWidth:C,inShape:e,outShape:T,filterShape:t}}function uCe(e,t,n,r,i){r==null&&(r=CB(e,t,n));const s=e[0],o=e[1],a=Kx((s-t+2*r)/n+1,i),u=Kx((o-t+2*r)/n+1,i);return[a,u]}function lCe(e,t,n,r,i,s){i==null&&(i=CB(e,t[0],r[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)e[a]+2*i>=t[a]&&(o[a]=Kx((e[a]-t[a]+2*i)/r[a]+1,s));return o}function CB(e,t,n,r=1){const i=Tm(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Yx(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function rM(e){return typeof e=="number"?[e,e,e]:e}function Tm(e,t){return t<=1?e:e+(e-1)*(t-1)}function cCe(e,t,n,r,i,s,o,a,u){let l,c,f;if(typeof e=="number"){l={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};const d=uCe([t,n],s,r,e,a);c=d[0],f=d[1]}else if(e==="same"){c=Math.ceil(t/r),f=Math.ceil(n/i);const h=Math.max(0,(c-1)*r+s-t),d=Math.max(0,(f-1)*i+o-n),p=Math.floor(h/2),g=h-p,m=Math.floor(d/2),y=d-m;l={top:p,bottom:g,left:m,right:y,type:"SAME"}}else if(e==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-s+1)/r),f=Math.ceil((n-o+1)/i);else if(typeof e=="object"){const h=u==="channelsLast"?e[1][0]:e[2][0],d=u==="channelsLast"?e[1][1]:e[2][1],p=u==="channelsLast"?e[2][0]:e[3][0],g=u==="channelsLast"?e[2][1]:e[3][1];l={top:h,bottom:d,left:p,right:g,type:h===0&&d===0&&p===0&&g===0?"VALID":"EXPLICIT"},c=Kx((t-s+h+d)/r+1,a),f=Kx((n-o+p+g)/i+1,a)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:l,outHeight:c,outWidth:f}}function fCe(e,t,n,r,i,s,o,a,u,l,c){let f,h,d,p;if(e==="valid"&&(e=0),typeof e=="number"){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};const m=lCe([t,n,r,1],[a,u,l],1,[i,s,o],e,c);h=m[0],d=m[1],p=m[2]}else if(e==="same"){h=Math.ceil(t/i),d=Math.ceil(n/s),p=Math.ceil(r/o);const g=(h-1)*i+a-t,m=(d-1)*s+u-n,y=(p-1)*o+l-r,b=Math.floor(g/2),v=g-b,x=Math.floor(m/2),w=m-x,C=Math.floor(y/2),$=y-C;f={top:x,bottom:w,left:C,right:$,front:b,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}function Kx(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Nf(e){const[t,n,r]=Yx(e);return t===1&&n===1&&r===1}function _r(e,t){return Nf(e)||Nf(t)}function mp(e){return Yx(e).every(t=>t>0)}function gc(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function Si(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")D(hp(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(i=>{D(hp(i),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hCe(e,t){const r={x:N(e,"x","reshape","string_or_numeric")},i={shape:t};return z.runKernel(Cw,r,i)}const V=U({reshape_:hCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dCe(e,t,n,r,i){const s=N(e,"x","avgPool","float32"),o=1;D(_r(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=s,u=!1;s.rank===3&&(u=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2]])),D(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Si("avgPool",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i};let f=z.runKernel(P2,l,c);return f=ge(f,s.dtype),u?V(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const UT=U({avgPool_:dCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pCe(e,t,n,r,i,s="NDHWC"){const o=N(e,"x","avgPool3d","float32");let a=o,u=!1;o.rank===4&&(u=!0,a=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),D(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),D(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),D(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Si("avgPool3d",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let f=z.runKernel(B2,l,c);return f=ge(f,a.dtype),u?V(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const yte=U({avgPool3d_:pCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gCe(e,t=0){D(e.length>=1,()=>"Pass at least one tensor to concat");const n=Xx(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return yf(n[0]);const r=n,i={axis:t};return z.runKernel(V2,r,i)}const nr=U({concat_:gCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mCe(e,t,n=!1,r=!1){let i=N(e,"a","matMul"),s=N(t,"b","matMul");[i,s]=bn(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return z.runKernel(z2,o,a)}const st=U({matMul_:mCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yCe(e){const n={x:N(e,"x","sigmoid","float32")};return z.runKernel(R1,n)}const fu=U({sigmoid_:yCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bCe(e,t,n){const r=N(e,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:t,size:n};return z.runKernel(_w,i,s)}const xt=U({slice_:bCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xCe(e){const n={x:N(e,"x","tanh","float32")};return z.runKernel(U1,n)}const Ym=U({tanh_:xCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vCe(e,t,n,r,i,s){const o=N(e,"forgetBias","basicLSTMCell"),a=N(t,"lstmKernel","basicLSTMCell"),u=N(n,"lstmBias","basicLSTMCell"),l=N(r,"data","basicLSTMCell"),c=N(i,"c","basicLSTMCell"),f=N(s,"h","basicLSTMCell"),h=nr([l,f],1),d=st(h,a),p=ue(d,u),g=p.shape[0],m=p.shape[1]/4,y=[g,m],b=xt(p,[0,0],y),v=xt(p,[0,m],y),x=xt(p,[0,m*2],y),w=xt(p,[0,m*3],y),C=ue(j(fu(b),Ym(v)),j(c,fu(ue(o,x)))),$=j(Ym(C),fu(w));return[C,$]}const wCe=U({basicLSTMCell_:vCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ce(e,t,n){const r=N(e,"x","batchToSpaceND"),i=t.reduce((a,u)=>a*u);D(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),D(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),D(r.shape[0]%i===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`);const s={x:r},o={blockShape:t,crops:n};return z.runKernel(U2,s,o)}const jT=U({batchToSpaceND_:$Ce});function CCe(e){let t;return e.rank===0||e.rank===1?t=V(e,[1,1,1,e.size]):e.rank===2?t=V(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=V(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SCe(e,t,n,r,i,s){s==null&&(s=.001);const o=N(e,"x","batchNorm"),a=N(t,"mean","batchNorm"),u=N(n,"variance","batchNorm");let l;i!=null&&(l=N(i,"scale","batchNorm"));let c;r!=null&&(c=N(r,"offset","batchNorm")),D(a.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:CCe(o),scale:l,offset:c,mean:a,variance:u},d={varianceEpsilon:s},p=z.runKernel(Q2,h,d);return V(p,o.shape)}const zw=U({batchNorm_:SCe});function kCe(e,t,n,r,i,s){const o=N(e,"x","batchNorm"),a=N(t,"mean","batchNorm"),u=N(n,"variance","batchNorm");let l;i!=null&&(l=N(i,"scale","batchNorm"));let c;return r!=null&&(c=N(r,"offset","batchNorm")),D(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),D(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),D(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&D(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&D(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),zw(o,a,u,c,l,s)}const bte=U({batchNorm2d_:kCe});function ECe(e,t,n,r,i,s){const o=N(e,"x","batchNorm"),a=N(t,"mean","batchNorm"),u=N(n,"variance","batchNorm");let l;i!=null&&(l=N(i,"scale","batchNorm"));let c;return r!=null&&(c=N(r,"offset","batchNorm")),D(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),D(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),D(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&D(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&D(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),zw(o,a,u,c,l,s)}const xte=U({batchNorm3d_:ECe});function ACe(e,t,n,r,i,s){const o=N(e,"x","batchNorm"),a=N(t,"mean","batchNorm"),u=N(n,"variance","batchNorm");let l;i!=null&&(l=N(i,"scale","batchNorm"));let c;return r!=null&&(c=N(r,"offset","batchNorm")),D(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),D(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),D(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&D(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&D(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),zw(o,a,u,c,l,s)}const vte=U({batchNorm4d_:ACe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ce(e,t,n){const r=N(e,"x","bincount"),i=N(t,"weights","bincount");D(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),D(n>=0,()=>`size must be non-negative, but got ${n}.`),D(i.size===r.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`);const s={x:r,weights:i},o={size:n};return z.runKernel(P_,s,o)}const wte=U({bincount_:_Ce});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TCe(e,t){const n=N(e,"x","bitwiseAnd"),r=N(t,"y","bitwiseAnd");if(!gt(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if(n.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);const i={a:n,b:r};return z.runKernel(j2,i)}const ICe=U({bitwiseAnd_:TCe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DCe(e,t){const n=N(e,"s0","broadcastArgs","int32"),r=N(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return z.runKernel(B_,i)}const NCe=U({broadcastArgs_:DCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FCe(e,t){let n=N(e,"broadcastTo","x");const r=n.shape;if(Ts(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const l=n.shape.slice();for(;l.length<t.length;)l.unshift(1);n=V(n,l)}const i=n.shape,s=Array.from(t);for(let l=t.length-1;l>=0;l--)if(i[l]===t[l])s[l]=1;else if(n.shape[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(s.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return yf(n);const a={x:n},u={reps:s};return z.runKernel(j1,a,u)}const Im=U({broadcastTo_:FCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OCe(e){const n={x:N(e,"x","ceil","float32")};return z.runKernel(r1,n)}const $te=U({ceil_:OCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1(e,t,n){Ts(e),n=n||rg(t);const r={shape:e,value:t,dtype:n};return z.runKernel(tT,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RCe(e,t,n){const r=N(e,"x","clipByValue");if(D(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return V1(r.shape,t,r.dtype);const i={x:r},s={clipValueMin:t,clipValueMax:n};return z.runKernel(i1,i,s)}const ys=U({clipByValue_:RCe});function MCe(e){return nr(e,0)}const Cte=U({concat1d_:MCe});function LCe(e,t){return nr(e,t)}const Ste=U({concat2d_:LCe});function PCe(e,t){return nr(e,t)}const kte=U({concat3d_:PCe});function BCe(e,t){return nr(e,t)}const Ete=U({concat4d_:BCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zCe(e,t,n,r,i="NHWC",s=[1,1],o){const a=N(e,"x","conv2d","float32"),u=N(t,"filter","conv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),D(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Si("conv2d",r,o);const f=i==="NHWC"?l.shape[3]:l.shape[1];D(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),D(_r(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),D(mp(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),D(mp(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:l,filter:u},d={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},p=z.runKernel(G2,h,d);return c?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Ff=U({conv2d_:zCe});function UCe(e,t,n,r,i="NWC",s=1,o){const a=N(e,"x","conv1d"),u=N(t,"filter","conv1d");let l=a,c=!1;a.rank===2&&(c=!0,l=V(a,[1,a.shape[0],a.shape[1]])),D(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),D(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Si("conv1d",r,o),D(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),D(_r(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),D(mp(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),D(mp(n),()=>"Error in conv1D: Stride should be larger than 0."),D(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const f=V(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=V(l,[l.shape[0],1,l.shape[1],l.shape[2]]),m=Ff(h,f,[1,n],r,"NHWC",[1,s],o);return c?V(m,[m.shape[2],m.shape[3]]):V(m,[m.shape[0],m.shape[2],m.shape[3]])}const SB=U({conv1d_:UCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jCe(e,t,n,r,i,s="NHWC",o){D(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,u=t,l=!1;t.rank===3&&(l=!0,u=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,e[0],e[1],e[2]]),D(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),D(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),D(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=s==="NHWC"?a[3]:a[1],f=s==="NHWC"?u.shape[3]:u.shape[1];D(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),D(f===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`),Si("conv2dDerInput",i,o);const h={dy:u,filter:n},d={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a},p=z.runKernel(H2,h,d);return l?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const kB=U({conv2DBackpropInput_:jCe});function WCe(e,t,n,r,i,s){const o=N(e,"x","conv2dTranspose"),a=N(t,"filter","conv2dTranspose");return kB(n,o,a,r,i,"NHWC",s)}const EB=U({conv2dTranspose_:WCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(e,t,n,r,i="NDHWC",s=[1,1,1]){const o=N(e,"x","conv3d"),a=N(t,"filter","conv3d");let u=o,l=!1;o.rank===4&&(l=!0,u=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),D(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),D(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),D(u.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`),D(_r(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),D(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),D(mp(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),D(mp(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:u,filter:a},f={strides:n,pad:r,dataFormat:i,dilations:s},h=z.runKernel(q2,c,f);return l?V(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Ate=U({conv3d_:VCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GCe(e,t,n,r,i){D(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,o=t,a=!1;t.rank===4&&(a=!0,o=V(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);const u=s[4],l=o.shape[4];D(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),D(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),D(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),D(u===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`),D(l===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${n.shape[4]}.`);const c={dy:o,filter:n},f={pad:i,strides:r,inputShape:s},h=z.runKernel(W_,c,f);return a?V(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const _te=U({conv3DBackpropInput_:GCe});function HCe(e,t,n,r,i){const s=N(e,"x","conv3dTranspose"),o=N(t,"filter","conv3dTranspose");return _te(n,s,o,r,i)}const Tte=U({conv3dTranspose_:HCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qCe(e){const n={x:N(e,"x","cos","float32")};return z.runKernel(s1,n)}const WT=U({cos_:qCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XCe(e){const n={x:N(e,"x","cosh","float32")};return z.runKernel(o1,n)}const AB=U({cosh_:XCe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YCe(e,t=0,n=!1,r=!1){const s={x:N(e,"x","cumprod")},o={axis:t,exclusive:n,reverse:r};return z.runKernel(V_,s,o)}const jk=U({cumprod_:YCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KCe(e,t=0,n=!1,r=!1){const s={x:N(e,"x","cumsum")},o={axis:t,exclusive:n,reverse:r};return z.runKernel(X2,s,o)}const _B=U({cumsum_:KCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZCe(e,t,n,r=!1){const i=N(e,"x","denseBincount"),s=N(t,"weights","denseBincount");D(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),D(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),D(n>=0,()=>`size must be non-negative, but got ${n}.`),D(s.size===i.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`);const o={x:i,weights:s},a={size:n,binaryOutput:r};return z.runKernel(H_,o,a)}const iM=U({denseBincount_:ZCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JCe(e,t,n="NHWC"){const r=N(e,"x","depthToSpace","float32"),i=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];D(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),D(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t}  for depthToSpace with input shape
    ${r.shape}`),D(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),D(o%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},u={blockSize:t,dataFormat:n};return z.runKernel(q_,a,u)}const Ite=U({depthToSpace_:JCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QCe(e,t,n,r,i="NHWC",s=[1,1],o){const a=N(e,"x","depthwiseConv2d","float32"),u=N(t,"filter","depthwiseConv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),D(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const f=i==="NHWC"?l.shape[3]:l.shape[1];D(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Si("depthwiseConv2d",r,o);const h={x:l,filter:u},d={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},p=z.runKernel(Y2,h,d);return c?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Uw=U({depthwiseConv2d_:QCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eSe(e){const n={x:N(e,"x","diag")};return z.runKernel(K_,n)}const tSe=U({diag_:eSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nSe(e,t,n,r,i=[1,1],s="NHWC"){const o=N(e,"x","dilation2d"),a=N(t,"filter","dilation2d");D(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),D(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),D(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let u=o,l=!1;o.rank===3&&(u=V(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),D(u.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${a.shape[2]}`);const c={x:u,filter:a},f={strides:n,pad:r,dilations:i},h=z.runKernel(K2,c,f);return l?V(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Dte=U({dilation2d_:nSe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yp(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=e[s]||1;(t[t.length-1-i]||1)>1&&o===1&&r.unshift(s)}return r}function Mn(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[e.length-r-1],s=t.length-r-1,o=t[s];(i==null||i===1&&o>1)&&n.unshift(s)}return n}function Ke(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let i=0;i<n;i++){let s=e[e.length-i-1];s==null&&(s=1);let o=t[t.length-i-1];if(o==null&&(o=1),s===1)r[n-i-1]=o;else if(o===1)r[n-i-1]=s;else if(s!==o){const a=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(a)}else r[n-i-1]=s}return r}const rSe=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Ke,getBroadcastDims:yp,getReductionAxes:Mn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(e,t){let n=N(e,"a","equal","string_or_numeric"),r=N(t,"b","equal","string_or_numeric");[n,r]=bn(n,r),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(Z2,i)}const $a=U({equal_:iSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(e,t,n){const r=N(t,"a","where"),i=N(n,"b","where"),s=N(e,"condition","where","bool"),o=Ke(Ke(s.shape,r.shape),i.shape),a=Im(s,o),u=Im(r,o),l=Im(i,o),c={condition:a,t:u,e:l};return z.runKernel(Aw,c)}const jr=U({where_:sSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oSe(e){const n={x:N(e,"x","zerosLike")};return z.runKernel(Mw,n)}const mt=U({zerosLike_:oSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSe(e,t){let n=N(e,"a","div"),r=N(t,"b","div");[n,r]=bn(n,r);const i=Oe(n,r),s=mt(i),o=$a(r,s);return jr(o,s,i)}const Nte=U({divNoNan_:aSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uSe(e,t){const n=N(e,"t1","dot"),r=N(t,"t2","dot");D((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];if(D(i===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`),n.rank===1&&r.rank===1){const o=V(n,[1,-1]),a=V(r,[-1,1]),u=st(o,a);return V(u,[])}else if(n.rank===1&&r.rank===2){const o=V(n,[1,-1]),a=V(r,[r.shape[0],r.shape[1]]),u=st(o,a);return V(u,[u.size])}else if(n.rank===2&&r.rank===1){const o=V(r,[-1,1]),a=st(n,o);return V(a,[a.size])}else{const o=V(r,[r.shape[0],r.shape[1]]);return st(n,o)}}const Fte=U({dot_:uSe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lSe(e,...t){const n=t.map((i,s)=>N(i,`tensors${s}`,"einsum")),r={equation:e};return z.runKernel(J_,n,r)}const mm=U({einsum_:lSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cSe(e){const n={x:N(e,"x","elu","float32")};return z.runKernel(u1,n)}const jw=U({elu_:cSe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fSe(e,t){const n=N(e,"x","ensureShape","string_or_numeric");if(!bee(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}const hSe=U({ensureShape_:fSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dSe(e){let t=N(e,"x","erf");D(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=ge(t,"float32"));const n={x:t};return z.runKernel(l1,n)}const Ote=U({erf_:dSe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Rte(e,t,n){const r=e.length+t.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)n.indexOf(a)===-1?i.push(e[s++]):i.push(t[o++]);return i}function ar(e,t){const n=[],r=e.length;for(let s=0;s<r;s++)t.indexOf(s)===-1&&n.push(e[s]);const i=t.map(s=>e[s]);return[n,i]}function Tn(e,t){const n=t.map(r=>1);return Rte(e,n,t)}function Tr(e,t,n){D(TB(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function xn(e,t){if(TB(e,t))return null;const n=[];for(let r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(r=>n.push(r)),n}function Ch(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function In(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pSe(e,t=null,n=!1){const i={x:N(e,"x","max")},s={reductionIndices:t,keepDims:n};return z.runKernel(lw,i,s)}const Co=U({max_:pSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gSe(e,t=null,n=!1){const i={x:N(e,"x","min")},s={axis:t,keepDims:n};return z.runKernel(dw,i,s)}const Zx=U({min_:gSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(e,t){let n=N(e,"base","pow"),r=N(t,"exp","pow");[n,r]=bn(n,r);const i={a:n,b:r};return z.runKernel(k1,i)}const Of=U({pow_:mSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ve(e,t){if((Kn(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Kn(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return wh(e,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ySe(e){const n={x:N(e,"x","sqrt","float32")};return z.runKernel(L1,n)}const Vr=U({sqrt_:ySe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bSe(e){const t=N(e,"x","square"),n={};return z.runKernel("Square",{x:t},n)}const Gt=U({square_:bSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xSe(e,t=null,n=!1){let r=N(e,"x","sum");r.dtype==="bool"&&(r=ge(r,"int32"));const i={x:r},s={axis:t,keepDims:n};return z.runKernel(Tw,i,s)}const _e=U({sum_:xSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vSe(e,t="euclidean",n=null,r=!1){e=N(e,"x","norm");const i=Mte(e,t,n);let s=i.shape;if(r){const o=it(n,e.shape);s=Tn(i.shape,o)}return V(i,s)}function Mte(e,t,n=null){if(e.rank===0)return Bn(e);if(e.rank!==1&&n===null)return Mte(V(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return _e(Bn(e),n);if(t===1/0)return Co(Bn(e),n);if(t===-1/0)return Zx(Bn(e),n);if(t==="euclidean"||t===2)return Vr(_e(Of(Bn(e),Ve(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return Co(_e(Bn(e),n[0]),n[1]-1);if(t===1/0)return Co(_e(Bn(e),n[1]),n[0]);if(t===-1/0)return Zx(_e(Bn(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return Vr(_e(Gt(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Ww=U({norm_:vSe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wSe(e,t=null,n=!1){return Ww(e,"euclidean",t,n)}const Lte=U({euclideanNorm_:wSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Se(e){const n={x:N(e,"x","exp")};return z.runKernel(c1,n)}const bs=U({exp_:$Se});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CSe(e,t=0){const n=N(e,"x","expandDims","string_or_numeric");D(t<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},i={dim:t};return z.runKernel(J2,r,i)}const si=U({expandDims_:CSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SSe(e){const n={x:N(e,"x","expm1")};return z.runKernel(f1,n)}const Pte=U({expm1_:SSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kSe(e,t){const n=N(e,"x","tile","string_or_numeric");D(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const r={x:n},i={reps:t};return z.runKernel(j1,r,i)}const ho=U({tile_:kSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(e,t,n,r="float32"){t==null&&(t=e);const i=nt([e,t],r),s=e<=t?e:t;for(let a=0;a<s;++a)i.set(1,a,a);const o=V(i.toTensor(),[e,t]);if(n==null)return o;if(n.length===1)return ho(si(o,0),[n[0],1,1]);if(n.length===2)return ho(si(si(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return ho(si(si(si(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const IB=U({eye_:ESe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ASe(e){const n={x:N(e,"x","floor","float32")};return z.runKernel(h1,n)}const Vw=U({floor_:ASe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Se(e,t,n=0,r=0){const i=N(e,"x","gather"),s=N(t,"indices","gather","int32"),o={x:i,indices:s},a={axis:n,batchDims:r};return z.runKernel(ew,o,a)}const Gw=U({gather_:_Se});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(e,t){let n=N(e,"a","greater","string_or_numeric"),r=N(t,"b","greater","string_or_numeric");[n,r]=bn(n,r),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(tw,i)}const Ds=U({greater_:TSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ISe(e,t){let n=N(e,"a","greaterEqual","string_or_numeric"),r=N(t,"b","greaterEqual","string_or_numeric");[n,r]=bn(n,r),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(p1,i)}const Sh=U({greaterEqual_:ISe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DSe(e){const n={input:N(e,"input","imag")};return z.runKernel(sT,n)}const VT=U({imag_:DSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(e){const n={x:N(e,"x","isFinite")};return z.runKernel(m1,n)}const Bte=U({isFinite_:NSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FSe(e){const n={x:N(e,"x","isInf")};return z.runKernel(y1,n)}const zte=U({isInf_:FSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OSe(e){const n={x:N(e,"x","isNaN")};return z.runKernel(b1,n)}const Ute=U({isNaN_:OSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RSe(e,t=.2){const r={x:N(e,"x","leakyRelu")},i={alpha:t};return z.runKernel(nw,r,i)}const GT=U({leakyRelu_:RSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MSe(e,t){let n=N(e,"a","less","string_or_numeric"),r=N(t,"b","less","string_or_numeric");[n,r]=bn(n,r),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(rw,i)}const Jx=U({less_:MSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSe(e,t){let n=N(e,"a","lessEqual","string_or_numeric"),r=N(t,"b","lessEqual","string_or_numeric");[n,r]=bn(n,r),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(iw,i)}const ag=U({lessEqual_:LSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jte(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return z.runKernel(oT,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PSe(e,t=5,n=1,r=1,i=.5){const s=N(e,"x","localResponseNormalization");D(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),D(hp(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=s,a=!1;s.rank===3&&(a=!0,o=V(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const u={x:o},l={depthRadius:t,bias:n,alpha:r,beta:i},c=z.runKernel(uw,u,l);return a?V(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Wte=U({localResponseNormalization_:PSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSe(e){const n={x:N(e,"x","log","float32")};return z.runKernel(x1,n)}const Hs=U({log_:BSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zSe(e){const n={x:N(e,"x","log1p")};return z.runKernel(v1,n)}const HT=U({log1p_:zSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function USe(e){return D(Tf(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{const r=N(t,"x","tf.grad","string_or_numeric"),i=n!=null?N(n,"dy","tf.grad"):null;return z.tidy(()=>{const{value:s,grads:o}=z.gradients(()=>e(r),[r],i);return i!=null&&Ar(s.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),qT(o),o[0]})}}function jSe(e){return D(Tf(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{D(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=Xx(t,"args","tf.grads","string_or_numeric"),i=n!=null?N(n,"dy","tf.grads"):null;return z.tidy(()=>{const{value:s,grads:o}=z.gradients(()=>e(...r),r,i);return i!=null&&Ar(s.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),qT(o),o})}}function WSe(e){return D(Tf(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{D(t instanceof zt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),D(n==null||n instanceof zt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=z.gradients(()=>e(t),[t],n);return qT(r),{grad:r[0],value:i}}}function VSe(e){return D(Tf(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{D(Array.isArray(t)&&t.every(i=>i instanceof zt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),D(n==null||n instanceof zt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=z.gradients(()=>e(...t),t,n);return n!=null&&Ar(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),qT(r.grads),r}}function Vte(e,t){D(Tf(e),()=>"The f passed in variableGrads(f) must be a function"),D(t==null||Array.isArray(t)&&t.every(l=>l instanceof qx),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=t!=null;if(!n){t=[];for(const l in z.registeredVariables)t.push(z.registeredVariables[l])}const r=n?t.filter(l=>!l.trainable):null,i=t.length;t=t.filter(l=>l.trainable),D(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const s=!0,{value:o,grads:a}=z.gradients(e,t,null,s);D(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),D(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const u={};return t.forEach((l,c)=>{a[c]!=null&&(u[l.name]=a[c])}),r!=null&&r.forEach(l=>u[l.name]=null),{value:o,grads:u}}function ku(e){return z.customGrad(e)}function qT(e){if(e.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GSe(e){const n={x:N(e,"x","neg")};return z.runKernel(gw,n)}const rn=U({neg_:GSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(e){const n={x:N(e,"x","softplus")};return z.runKernel(M1,n)}const G1=U({softplus_:HSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qSe(e){const t=N(e,"x","logSigmoid");return ku(r=>({value:rn(G1(rn(r))),gradFunc:o=>j(o,fu(rn(r)))}))(t)}const Gte=U({logSigmoid_:qSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(e,t){let n=N(e,"a","sub"),r=N(t,"b","sub");[n,r]=bn(n,r);const i={a:n,b:r};return z.runKernel(B1,i)}const ke=U({sub_:XSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YSe(e,t=-1){const n=N(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return ku((i,s)=>{const a=Co(i,t,!0),u=ke(i,a),l=ke(ge(u,"float32"),Hs(_e(bs(u),t,!0)));return s([l]),{value:l,gradFunc:(f,h)=>{const[d]=h,p=!0,g=bs(d);return ke(f,j(_e(f,t,p),g))}}})(n)}const DB=U({logSoftmax_:YSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KSe(e,t=null,n=!1){const r=N(e,"x","logSumExp"),i=it(t,r.shape),s=Co(r,i,!0),o=ke(r,s),a=bs(o),u=_e(a,i),l=Hs(u),c=ue(V(s,l.shape),l);if(n){const f=Tn(c.shape,i);return V(c,f)}return c}const XT=U({logSumExp_:KSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSe(e,t){const n=N(e,"a","logicalAnd","bool"),r=N(t,"b","logicalAnd","bool");Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(sw,i)}const Eu=U({logicalAnd_:ZSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JSe(e){const n={x:N(e,"x","logicalNot","bool")};return z.runKernel(ow,n)}const YT=U({logicalNot_:JSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QSe(e,t){const n=N(e,"a","logicalOr","bool"),r=N(t,"b","logicalOr","bool");Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(aw,i)}const NB=U({logicalOr_:QSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eke(e,t){const n=N(e,"a","logicalXor","bool"),r=N(t,"b","logicalXor","bool");return Ke(n.shape,r.shape),Eu(NB(e,t),YT(Eu(e,t)))}const Hte=U({logicalXor_:eke});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TC=2147483648;function tke(e,t,n="left"){const r=N(e,"sortedSequence","searchSorted"),i=N(t,"values","searchSorted"),s=r.shape[r.shape.length-1],o=i.shape[i.shape.length-1],a=V(r,[-1,s]),u=V(i,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Z(u.shape)>=TC)throw new Error(`values tensor size must less than ${TC}`);if(a.shape[1]>=TC)throw new Error(`trailing dim_size must less than ${TC} for int32 output type, was ${a.shape[1]}`);const l={sortedSequence:a,values:u},c={side:n};return z.runKernel(ST,l,c)}const FB=U({searchSorted_:tke});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nke(e,t){return FB(e,t,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(e,t,n,r,i){const s=N(e,"x","maxPool"),o=1;let a=s,u=!1;s.rank===3&&(u=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2]])),D(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),D(_r(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),Si("maxPool",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i},f=z.runKernel(cw,l,c);return u?V(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const KT=U({maxPool_:rke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ike(e,t=[1,1,1],n,r,i,s="NDHWC"){const o=N(e,"x","maxPool3d");let a=o,u=!1;o.rank===4&&(u=!0,a=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),D(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),D(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),Si("maxPool3d",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},f=z.runKernel(fw,l,c);return u?V(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const qte=U({maxPool3d_:ike});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ske(e,t,n,r,i=!1){const o={x:N(e,"x","maxPoolWithArgmax")},a={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},u=z.runKernel(cT,o,a);return{result:u[0],indexes:u[1]}}const oke=U({maxPoolWithArgmax_:ske});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ake(e,t){let n=N(e,"a","maximum"),r=N(t,"b","maximum");[n,r]=bn(n,r),n.dtype==="bool"&&(n=ge(n,"int32"),r=ge(r,"int32")),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(w1,i)}const mc=U({maximum_:ake});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uke(e,t=null,n=!1){const i={x:N(e,"x","mean")},s={axis:t,keepDims:n};return z.runKernel(hw,i,s)}const wn=U({mean_:uke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(e,t="float32"){if(Ts(e),t==="complex64"){const r=zn(e,"float32"),i=zn(e,"float32");return If(r,i)}const n=Sr(Z(e),t);return z.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fs(e,t="float32"){if(Ts(e),t==="complex64"){const r=fs(e,"float32"),i=zn(e,"float32");return If(r,i)}const n=N_(Z(e),t);return z.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lke(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let r=N(e,"x","meshgrid",e instanceof zt?e.dtype:"float32");if(t===void 0)return[r];let i=N(t,"y","meshgrid",t instanceof zt?t.dtype:"float32");const s=Z(r.shape),o=Z(i.shape);return n==="xy"?(r=V(r,[1,-1]),i=V(i,[-1,1]),[st(fs([o,1],r.dtype),r),st(i,fs([1,s],i.dtype))]):(r=V(r,[-1,1]),i=V(i,[1,-1]),[st(r,fs([1,o],r.dtype)),st(fs([s,1],i.dtype),i)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(e,t){let n=N(e,"a","minimum"),r=N(t,"b","minimum");[n,r]=bn(n,r),n.dtype==="bool"&&(n=ge(n,"int32"),r=ge(r,"int32")),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel($1,i)}const bp=U({minimum_:cke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fke(e,t,n){D(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=N(e,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");D(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);const i=n==="reflect"?1:0;for(let a=0;a<r.rank;a++)D(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),D(t[a][0]>=0&&t[a][0]<=r.shape[a]-i&&t[a][1]>=0&&t[a][1]<=r.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape ${r.shape}`);const s={paddings:t,mode:n},o={x:r};return z.runKernel(pw,o,s)}const Xte=U({mirrorPad_:fke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hke(e,t){let n=N(e,"a","mod"),r=N(t,"b","mod");[n,r]=bn(n,r);const i={a:n,b:r};return z.runKernel(C1,i)}const Yte=U({mod_:hke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dke(e,t=null,n=!1){e=N(e,"x","moments");const r=it(t,e.shape),i=wn(e,r,n);let s=i.shape;n||(s=Tn(i.shape,r));const o=Gt(ke(ge(e,"float32"),V(i,s))),a=wn(o,r,n);return{mean:i,variance:a}}const ZT=U({moments_:dke});function pke(e,t,n,r){const i=N(t,"data","multiRNNCell"),s=Xx(n,"c","multiRNNCell"),o=Xx(r,"h","multiRNNCell");let a=i;const u=[];for(let f=0;f<e.length;f++){const h=e[f](a,s[f],o[f]);u.push(h[0]),u.push(h[1]),a=h[1]}const l=[],c=[];for(let f=0;f<u.length;f+=2)l.push(u[f]),c.push(u[f+1]);return[l,c]}const gke=U({multiRNNCell_:pke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mke(e,t,n,r=!1){const i=N(e,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const u={logits:o===1?V(i,[1,-1]):i},l={numSamples:t,seed:n,normalized:r},c=z.runKernel(fT,u,l);return o===1?V(c,[c.size]):c}const yke=U({multinomial_:mke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bke(e,t){let n=N(e,"a","notEqual","string_or_numeric"),r=N(t,"b","notEqual","string_or_numeric");[n,r]=bn(n,r),Ke(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(mw,i)}const Km=U({notEqual_:bke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xke(e,t,n=1,r=0,i="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const o={indices:N(e,"indices","oneHot","int32")},a={dtype:i,depth:t,onValue:n,offValue:r};return z.runKernel(bw,o,a)}const Qx=U({oneHot_:xke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vke(e){const n={x:N(e,"x","onesLike")};return z.runKernel(yw,n)}const qs=U({onesLike_:vke});function wke(e,t){const n=N(e,"v1","outerProduct"),r=N(t,"v2","outerProduct");D(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=V(n,[-1,1]),s=V(r,[1,-1]);return st(i,s)}const $ke=U({outerProduct_:wke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cke(e,t,n=0){const r=N(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:t,constantValue:n},s={x:r};return z.runKernel(vw,s,i)}const kh=U({pad_:Cke});function Ske(e,t,n=0){return D(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),kh(e,[t],n)}const kke=U({pad1d_:Ske});function Eke(e,t,n=0){return D(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),kh(e,t,n)}const Ake=U({pad2d_:Eke});function _ke(e,t,n=0){return D(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),kh(e,t,n)}const Tke=U({pad3d_:_ke});function Ike(e,t,n=0){return D(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),kh(e,t,n)}const Dke=U({pad4d_:Ike});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nke(e,t,n){const r=N(e,"x","spaceToBatchND");D(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),D(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),D(r.shape.reduce((o,a,u)=>u>0&&u<=t.length?o&&(a+n[u-1][0]+n[u-1][1])%t[u-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const i={x:r},s={blockShape:t,paddings:n};return z.runKernel(Iw,i,s)}const JT=U({spaceToBatchND_:Nke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fke(e,t,n,r,i,s,o){i==null&&(i=[1,1]),s==null&&(s=1),r===0&&(r="valid");const a=N(e,"x","maxPool");let u=a,l=!1;a.rank===3&&(l=!0,u=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(_r(s,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`);const c=Ro(u.shape,t,s,i,r),f=[c.dilationHeight,c.dilationWidth];let h;r==="same"?h=Rke([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];const d=f[0]===1&&f[1]===1,[p,g]=Oke([c.inHeight,c.inWidth],f,h),m=d?r:"valid",y=d?u:JT(u,f,p),v=(n==="avg"?()=>UT(y,t,s,m,o):()=>KT(y,t,s,m,o))(),x=d?v:jT(v,f,g);return l?V(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Oke(e,t,n){const r=n.map(c=>c[0]),i=n.map(c=>c[1]),s=e.concat(r,i),o=t.map((c,f)=>(c-s[f]%c)%c),a=i.map((c,f)=>c+o[f]),u=t.map((c,f)=>[r[f],a[f]]),l=t.map((c,f)=>[0,o[f]]);return[u,l]}function Rke(e,t){const r=e.map((o,a)=>o+(o-1)*(t[a]-1)).map(o=>o-1),i=r.map(o=>Math.floor(o/2)),s=r.map((o,a)=>o-i[a]);return r.map((o,a)=>[i[a],s[a]])}const Kte=U({pool_:Fke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mke(e,t){const n=N(e,"x","prelu"),r=N(t,"alpha","prelu"),i={x:n,alpha:r};return z.runKernel(ww,i)}const QT=U({prelu_:Mke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lke(e,t=null,n=!1){let r=N(e,"x","prod");r.dtype==="bool"&&(r=ge(r,"int32"));const i={x:r},s={axis:t,keepDims:n};return z.runKernel($w,i,s)}const Zte=U({prod_:Lke});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pke(e,t,n,r){const i=e.map((c,f)=>N(c,`tensors${f}`,"raggedGather","int32")),s=N(t,"paramsDenseValues","raggedGather"),o=N(n,"indices","raggedGather","int32"),a={paramsNestedSplits:i,paramsDenseValues:s,indices:o},u={outputRaggedRank:r},l=z.runKernel(gT,a,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}const Bke=U({raggedGather_:Pke});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zke(e,t,n){const r=N(e,"starts","raggedRange"),i=N(t,"limits","raggedRange",r.dtype),s=N(n,"deltas","raggedRange",r.dtype),o={starts:r,limits:i,deltas:s},a=z.runKernel(mT,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const Uke=U({raggedRange_:zke});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jke(e,t,n,r,i){const s=N(e,"shape","raggedTensorToTensor","int32"),o=N(t,"values","raggedTensorToTensor"),a=N(n,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map((f,h)=>N(f,`tensors${h}`,"raggedTensorToTensor","int32")),l={shape:s,values:o,defaultValue:a,rowPartitionTensors:u},c={rowPartitionTypes:i};return z.runKernel(yT,l,c)}const Wke=U({raggedTensorToTensor_:jke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vke(e,t,n){Ts(e);const r=Z(e);let i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else if(n==="bool")i=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let s=0;s<r;s++)i[s]=t();return z.makeTensor(i,e,n)}const Gke=U({rand_:Vke});var OB={exports:{}};OB.exports;(function(e){(function(t,n,r){function i(u){var l=this,c=a();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function s(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new i(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&s(f,c),h.state=function(){return s(c,{})}),h}function a(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Je,e,!1)})(OB);var Hke=OB.exports,RB={exports:{}};RB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Je,e,!1)})(RB);var qke=RB.exports,MB={exports:{}};MB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Je,e,!1)})(MB);var Xke=MB.exports,LB={exports:{}};LB.exports;(function(e){(function(t,n,r){function i(a){var u=this;u.next=function(){var c=u.x,f=u.i,h,d;return h=c[f],h^=h>>>7,d=h^h<<24,h=c[f+1&7],d^=h^h>>>10,h=c[f+3&7],d^=h^h>>>3,h=c[f+4&7],d^=h^h<<7,h=c[f+7&7],h=h^h<<13,d^=h^h<<9,c[f]=d,u.i=f+1&7,d};function l(c,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],c.x=d,c.i=0,h=256;h>0;--h)c.next()}l(u,a)}function s(a,u){return u.x=a.x.slice(),u.i=a.i,u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(c.x&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Je,e,!1)})(LB);var Yke=LB.exports,PB={exports:{}};PB.exports;(function(e){(function(t,n,r){function i(a){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,d,p;return u.w=c=c+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(c^c>>>16)|0};function l(c,f){var h,d,p,g,m,y=[],b=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,b=Math.max(b,f.length)),p=0,g=-32;g<b;++g)f&&(d^=f.charCodeAt((g+32)%f.length)),g===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,g>=0&&(m=m+1640531527|0,h=y[g&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(y[(f&&f.length||0)&127]=-1),p=127,g=4*128;g>0;--g)d=y[p+34&127],h=y[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,y[p]=d^h;c.w=m,c.X=y,c.i=p}l(u,a)}function s(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(c.X&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Je,e,!1)})(PB);var Kke=PB.exports,BB={exports:{}};BB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=a|0):l+=a;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function s(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Je,e,!1)})(BB);var Zke=BB.exports,Jte={exports:{}};const Jke={},Qke=Object.freeze(Object.defineProperty({__proto__:null,default:Jke},Symbol.toStringTag,{value:"Module"})),eEe=tg(Qke);(function(e){(function(t,n,r){var i=256,s=6,o=52,a="random",u=r.pow(i,s),l=r.pow(2,o),c=l*2,f=i-1,h;function d(x,w,C){var $=[];w=w==!0?{entropy:!0}:w||{};var S=y(m(w.entropy?[x,v(n)]:x??b(),3),$),k=new p($),E=function(){for(var A=k.g(s),F=u,_=0;A<l;)A=(A+_)*i,F*=i,_=k.g(1);for(;A>=c;)A/=2,F/=2,_>>>=1;return(A+_)/F};return E.int32=function(){return k.g(4)|0},E.quick=function(){return k.g(4)/4294967296},E.double=E,y(v(k.S),n),(w.pass||C||function(A,F,_,I){return I&&(I.S&&g(I,k),A.state=function(){return g(k,{})}),_?(r[a]=A,F):A})(E,S,"global"in w?w.global:this==r,w.state)}function p(x){var w,C=x.length,$=this,S=0,k=$.i=$.j=0,E=$.S=[];for(C||(x=[C++]);S<i;)E[S]=S++;for(S=0;S<i;S++)E[S]=E[k=f&k+x[S%C]+(w=E[S])],E[k]=w;($.g=function(A){for(var F,_=0,I=$.i,T=$.j,O=$.S;A--;)F=O[I=f&I+1],_=_*i+O[f&(O[I]=O[T=f&T+F])+(O[T]=F)];return $.i=I,$.j=T,_})(i)}function g(x,w){return w.i=x.i,w.j=x.j,w.S=x.S.slice(),w}function m(x,w){var C=[],$=typeof x,S;if(w&&$=="object")for(S in x)try{C.push(m(x[S],w-1))}catch{}return C.length?C:$=="string"?x:x+"\0"}function y(x,w){for(var C=x+"",$,S=0;S<C.length;)w[f&S]=f&($^=w[f&S]*19)+C.charCodeAt(S++);return v(w)}function b(){try{var x;return h&&(x=h.randomBytes)?x=x(i):(x=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(x)),v(x)}catch{var w=t.navigator,C=w&&w.plugins;return[+new Date,t,C,t.screen,v(n)]}}function v(x){return String.fromCharCode.apply(0,x)}if(y(r.random(),n),e.exports){e.exports=d;try{h=eEe}catch{}}else r["seed"+a]=d})(typeof self<"u"?self:Je,[],Math)})(Jte);var tEe=Jte.exports,nEe=Hke,rEe=qke,iEe=Xke,sEe=Yke,oEe=Kke,aEe=Zke,ug=tEe;ug.alea=nEe;ug.xor128=rEe;ug.xorwow=iEe;ug.xorshift7=sEe;ug.xor4096=oEe;ug.tychei=aEe;var eI=ug;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uEe=.001,Qte=.1;function lEe(e,t,n){return n==null&&(n=zB()),sM(e,t,(r,i)=>UB(r,i,n))}function zB(){return z.backend.floatPrecision()===32?uEe:Qte}function sM(e,t,n){let r=!0;if((Kn(e)||Kn(t))&&(r=!1),Kn(e)&&Kn(t)&&(r=!0),r){const o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(e)&&Array.isArray(t)){const o=Su(e),a=Su(t);if(!gt(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const i=Kn(e)?e:Cu(e),s=Kn(t)?t:Cu(t);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.
Actual:   ${i}.
Expected: ${s}.`);for(let o=0;o<s.length;++o){const a=i[o],u=s[o];if(!n(a,u))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${u}.
Actual:   ${i}.
Expected: ${s}.`)}typeof expect<"u"&&expect().nothing()}function cEe(e,t){e().then(()=>t.fail(),()=>t()),typeof expect<"u"&&expect().nothing()}function fEe(e,t){const n=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return ou(e)||ou(e[0])||ou(t)||ou(t[0])?sM(e,n,(r,i)=>r==i):sM(e,t,(r,i)=>UB(r,i,0))}function hEe(e,t,n){if(n==null&&(n=zB()),!UB(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`);typeof expect<"u"&&expect().nothing()}function UB(e,t,n){return!isFinite(e)&&!isFinite(t)?!0:!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function dEe(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function pEe(e,t){const n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let i=0;i<r.length;i++)if(n[i]!==r[i])throw new Error(`Expected ArrayBuffer value at ${i} to be ${r[i]} but got ${n[i]} instead`)}function ene(e){for(let t=0;t<e.length;t++){const n=e[t];Array.isArray(n)?ene(n):e[t]=cu(n)}return e}function gEe(e){const t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise(n=>{t.addEventListener("loadeddata",r=>n(t)),t.load()})}async function mEe(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise(t=>{e.requestVideoFrameCallback(t)})}const yEe=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:Qte,createVideoElement:gEe,encodeStrings:ene,expectArrayBuffersEqual:pEe,expectArraysClose:lEe,expectArraysEqual:fEe,expectNumbersClose:hEe,expectPromiseToFail:cEe,expectValuesInRange:dEe,play:mEe,testEpsilon:zB},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jB{constructor(t,n,r,i,s){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=s||Math.random();this.random=eI.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let t,n,r=!1;for(;!r;){let i,s,o;do i=2*this.random()-1,s=2*this.random()-1,o=i*i+s*s;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class bEe{constructor(t,n,r,i){this.alpha=t,this.beta=1/n,this.dtype=r;const s=i||Math.random();this.randu=eI.alea(s.toString()),this.randn=new jB(0,1,r,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,n,r,i,s,o;for(;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,t=i*i,n=1-.331*t*t,r=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<n||Math.log(s)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}}class xEe{constructor(t=0,n=1,r,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=eI.alea(i)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vEe(e,t,n=1,r="float32",i){if(Ts(e),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);const s=new bEe(t,n,r,i),o=nt(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const wEe=U({randomGamma_:vEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ee(e,t=0,n=1,r,i){if(Ts(e),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const s=new jB(t,n,r,!1,i),o=nt(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const WB=U({randomNormal_:$Ee});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CEe(e,t,n){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return WB(e,0,1,t,n)}const SEe=U({randomStandardNormal_:CEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kEe(e,t=0,n=1,r="float32",i){Ts(e);const s=nt(e,r),o=new xEe(t,n,null,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const lg=U({randomUniform_:kEe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EEe(e,t,n,r){return lg(e,t,n,"int32",r)}const AEe=U({randomUniformInt_:EEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zm(e,t,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:e,stop:t,step:n,dtype:r};return z.runKernel(bT,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee(e){const n={input:N(e,"input","real")};return z.runKernel(xT,n)}const ev=U({real_:_Ee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TEe(e){const n={x:N(e,"x","reciprocal")};return z.runKernel(E1,n)}const tne=U({reciprocal_:TEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IEe(e){const n={x:N(e,"x","relu")};return z.runKernel(A1,n)}const ju=U({relu_:IEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DEe(e){const n={x:N(e,"x","relu6")};return z.runKernel(_1,n)}const VB=U({relu6_:DEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NEe(e,t){const r={x:N(e,"x","reverse")},i={dims:t};return z.runKernel(Ew,r,i)}const Eo=U({reverse_:NEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEe(e){const t=N(e,"x","reverse");return D(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Eo(t,0)}const OEe=U({reverse1d_:FEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function REe(e,t){const n=N(e,"x","reverse");return D(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),Eo(n,t)}const MEe=U({reverse2d_:REe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LEe(e,t){const n=N(e,"x","reverse");return D(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),Eo(n,t)}const PEe=U({reverse3d_:LEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BEe(e,t){const n=N(e,"x","reverse");return D(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),Eo(n,t)}const zEe=U({reverse4d_:BEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UEe(e){const n={x:N(e,"x","round")};return z.runKernel(T1,n)}const GB=U({round_:UEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jEe(e){const n={x:N(e,"x","rsqrt","float32")};return z.runKernel(I1,n)}const HB=U({rsqrt_:jEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WEe(e){const n={x:N(e,"x","selu")};return z.runKernel(D1,n)}const qB=U({selu_:WEe});function VEe(e,t,n,r,i,s=[1,1],o="NHWC"){const a=N(e,"x","separableConv2d"),u=N(t,"depthwiseFilter","separableConv2d"),l=N(n,"pointwiseFilter","separableConv2d");let c=a,f=!1;if(a.rank===3&&(f=!0,c=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),D(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),D(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),D(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),D(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const h=u.shape[2],d=u.shape[3];D(l.shape[2]===h*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*d}, but got ${l.shape[2]}.`);const p=Uw(c,u,r,i,o,s),m=Ff(p,l,1,"valid",o);return f?V(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const XB=U({separableConv2d_:VEe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function GEe(e,t){const n=N(e,"x","setdiff1d"),r=N(t,"y","setdiff1d");D(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),D(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),D(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),s=await r.data(),o=new Set(s);let a=0;for(let c=0;c<i.length;c++)o.has(i[c])||a++;const u=new Rn([a],n.dtype),l=new Rn([a],"int32");for(let c=0,f=0;c<i.length;c++)o.has(i[c])||(u.values[f]=i[c],l.values[f]=c,f++);return[u.toTensor(),l.toTensor()]}const HEe=GEe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qEe(e){const n={x:N(e,"x","sign")};return z.runKernel(O1,n)}const nne=U({sign_:qEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XEe(e){const n={x:N(e,"x","sin","float32")};return z.runKernel(N1,n)}const YB=U({sin_:XEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YEe(e){const n={x:N(e,"x","sinh")};return z.runKernel(F1,n)}const KB=U({sinh_:YEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KEe(e,t,n){const r=N(e,"x","slice1d");return D(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),xt(r,[t],[n])}const tI=U({slice1d_:KEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZEe(e,t,n){const r=N(e,"x","slice2d");return D(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),xt(r,t,n)}const ZB=U({slice2d_:ZEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JEe(e,t,n){const r=N(e,"x","slice3d");return D(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),xt(r,t,n)}const nI=U({slice3d_:JEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QEe(e,t,n){const r=N(e,"x","slice4d");return D(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),xt(r,t,n)}const tv=U({slice4d_:QEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eAe(e,t=-1){const n=N(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const r={logits:n},i={dim:t};return z.runKernel(Nw,r,i)}const rI=U({softmax_:eAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tAe(e){D(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);const t={input:e};return z.runKernel(eT,t)}const iI=U({fft_:tAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nAe(e){D(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);const t={input:e};return z.runKernel(iT,t)}const nv=U({ifft_:nAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rAe(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const i=V(e,[n,t]);r=nv(i)}else{const i=[n,2*(t-1)],s=V(ev(e),[n,t]),o=V(VT(e),[n,t]),a=Eo(xt(s,[0,1],[n,t-2]),1),u=j(Eo(xt(o,[0,1],[n,t-2]),1),Ve(-1)),l=nr([s,a],1),c=nr([o,u],1),f=V(If(l,c),[i[0],i[1]]);r=nv(f)}if(r=ev(r),e.rank===3&&e.shape[0]!==0){const i=r,s=e.shape[0];r=V(r,[s,r.shape[0]/s,r.shape[1]]),i.dispose()}return r}const JB=U({irfft_:rAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iAe(e,t,n=0){const i={x:N(e,"x","split")},s={numOrSizeSplits:t,axis:n};return z.runKernel(Dw,i,s)}const gs=U({split_:iAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sAe(e,t){D(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1];const r=e.size/n;let i;if(t!=null&&t<n){const p=e.shape.map(m=>0),g=e.shape.map(m=>m);g[e.shape.length-1]=t,i=xt(e,p,g),n=t}else if(t!=null&&t>n){const p=e.shape.map(g=>g);p[e.shape.length-1]=t-n,i=nr([e,zn(p)],e.shape.length-1),n=t}else i=e;const s=mt(i),o=V(If(i,s),[r,n]),a=iI(o),u=Math.floor(n/2)+1,l=ev(a),c=VT(a),f=gs(l,[u,n-u],l.shape.length-1),h=gs(c,[u,n-u],c.shape.length-1),d=i.shape.slice();return d[i.shape.length-1]=u,V(If(f[0],h[0]),d)}const sI=U({rfft_:sAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oAe(e,t){let n=N(e,"a","squaredDifference"),r=N(t,"b","squaredDifference");[n,r]=bn(n,r),Ke(n.shape,r.shape);const i={a:n,b:r},s={};return z.runKernel(P1,i,s)}const QB=U({squaredDifference_:oAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aAe(e,t){const n=N(e,"x","squeeze","string_or_numeric");return V(n,hc(n.shape,t).newShape)}const cg=U({squeeze_:aAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uAe(e,t=0){const n=Xx(e,"tensors","stack","string_or_numeric");D(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&D(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,i={axis:t};return z.runKernel(xw,r,i)}const Au=U({stack_:uAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lAe(e,t=0){const r={x:N(e,"x","step")},i={alpha:t};return z.runKernel(W1,r,i)}const H1=U({step_:lAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cAe(e,t,n,r,i=0,s=0,o=0,a=0,u=0){const c={x:N(e,"x","stridedSlice","string_or_numeric")},f={begin:t,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};return z.runKernel(DT,c,f)}const rne=U({stridedSlice_:cAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fAe(e){const n={x:N(e,"x","tan","float32")};return z.runKernel(z1,n)}const ine=U({tan_:fAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function li(e,t){ng(e);const n=Su(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return wh(e,null,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ql(e,t,n){if(ng(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Su(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return wh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sne(e,t,n){if(ng(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=Su(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return wh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hAe(e,t,n){if(ng(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const r=Su(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return wh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dAe(e,t,n){if(ng(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const r=Su(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return wh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pAe(e,t,n){if(ng(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const r=Su(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,wh(e,t,r,n)}function e5(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(e.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+e.length-r)throw new Error(s+` update.rank != ${i+e.length-r}`);for(let o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(s+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${e[o+i]})`)}function oI(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}e5(n,t,e)}function Eh(e,t,n){const r=t.shape.length,i=r>1?t.shape[r-1]:1,s=n.length;let o=1;for(let f=i;f<s;++f)o*=n[f];const a=i<1?1:i,u=Z(t.shape)/a,l=[...Re(n.slice(0,i)),1],c=Z(n);return{sliceRank:i,numUpdates:u,sliceSize:o,strides:l,outputSize:c}}const gAe=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:Eh,validateInput:oI,validateUpdateShape:e5},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mAe(e,t,n){const r=N(e,"tensor","tensorScatterupdate"),i=N(t,"indices","tensorScatterupdate","int32"),s=N(n,"updates","tensorScatterupdate");if(oI(s,i,r.shape),r.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${s.dtype}.`);const o={tensor:r,indices:i,updates:s},a={};return z.runKernel(CT,o,a)}const yAe=U({tensorScatterUpdate_:mAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bAe(e,t=1,n=!0){const r=N(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${t}`);const s={x:r},o={k:t,sorted:n},[a,u]=z.runKernel(RT,s,o);return{values:a,indices:u}}const one=U({topk_:bAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xAe(e,t=0,n=1,r,i){if(Ts(e),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const s=new jB(t,n,r,!0,i),o=nt(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const t5=U({truncatedNormal_:xAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vAe(e,t=0){const n=N(e,"x","unique","string_or_numeric");D(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:t},[s,o]=z.runKernel(LT,r,i);return{values:s,indices:o}}const ane=U({unique_:vAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wAe(e,t,n){const r=N(e,"x","unsortedSegmentSum"),i=N(t,"segmentIds","unsortedSegmentSum","int32");D(hp(n),()=>"numSegments must be of dtype int");const s={x:r,segmentIds:i},o={numSegments:n};return z.runKernel(Rw,s,o)}const n5=U({unsortedSegmentSum_:wAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ae(e,t=0){const n=N(e,"x","unstack","string_or_numeric");D(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const r={value:n},i={axis:t};return z.runKernel(Ow,r,i)}const Rf=U({unstack_:$Ae});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CAe(e,t){return FB(e,t,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function une(e,t=!0,n,r){return z.makeVariable(e,t,n,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aI(e,t){const n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);const r=nt(e,"int32"),i=nt([n.length,e.length],"int32");for(let s=0;s<n.length;s++){const o=r.indexToLoc(n[s]),a=s*e.length;i.values.set(o,a)}return i.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function SAe(e){const t=N(e,"condition","whereAsync","bool"),n=await t.data(),r=aI(t.shape,n);return e!==t&&t.dispose(),r}const lne=SAe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function kAe(e,t,n){const r=N(e,"tensor","boolMask"),i=N(t,"mask","boolMask","bool"),s=n??0,o=i.rank,a=r.shape;D(o>0,()=>"mask cannot be scalar"),Ar(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let g=s;g<s+o;g++)u*=a[g];const l=a.slice(0,s).concat([u],a.slice(s+o)),c=V(r,l),f=V(i,[-1]),h=await lne(f),d=cg(h,[1]),p=Gw(c,d,s);return e!==r&&r.dispose(),t!==i&&i.dispose(),d.dispose(),c.dispose(),f.dispose(),h.dispose(),p}const EAe=kAe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AAe(e,t,n){const r=N(e,"x","transpose");if(t==null&&(t=r.shape.map((o,a)=>a).reverse()),D(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(o=>{D(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();const i={x:r},s={perm:t};return r.dtype==="complex64"?X(()=>{let o=ev(r),a=VT(r);return o=z.runKernel(Xd,{x:o},s),a=z.runKernel(Xd,{x:a},s),n&&(a=rn(a)),If(o,a)}):z.runKernel(Xd,i,s)}const dt=U({transpose_:AAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ae(e,t,n,r,i=!0){const s=N(e,"v","movingAverage"),o=N(t,"x","movingAverage"),a=N(n,"decay","movingAverage");Wee(s,o),D(gt(s.shape,o.shape),()=>"Shape mismatch in v and x");const u=Ve(1),l=ke(u,a);let c=j(ke(o,s),l);if(i){D(r!=null,()=>"When using zeroDebias: true, step is required.");const f=N(r,"step","movingAverage");c=Oe(c,ke(u,Of(a,f)))}return ue(s,c)}const TAe=U({movingAverage_:_Ae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IAe(e,t,n){Ts(n);const r=N(e,"indices","scatterND","int32"),i=N(t,"updates","scatterND");oI(i,r,n);const s={indices:r,updates:i},o={shape:n};return z.runKernel($T,s,o)}const DAe=U({scatterND_:IAe});function NAe(e,t,n,r){if(e.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const i=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const o=t.size;if(!(t.rank===0||t.rank===1&&o===i))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${i}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FAe(e,t,n,r=0){Ts(n);const i=N(e,"sparseIndices","sparseToDense","int32"),s=N(t,"sparseValues","sparseToDense","string_or_numeric"),o=N(r,"defaultValue","sparseToDense",s.dtype);NAe(i,s,n,o);const a={sparseIndices:i,sparseValues:s,defaultValue:o},u={outputShape:n};return z.runKernel(TT,a,u)}const OAe=U({sparseToDense_:FAe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RAe(e,t){const n=N(t,"indices","gatherND","int32"),i={params:N(e,"x","gatherND","string_or_numeric"),indices:n};return z.runKernel(rT,i)}const MAe=U({gatherND_:RAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LAe(e,t){if(t==null)return e.shape.slice();if(gt(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)t[r]==null&&e.shape[r]!=null?n.push(e.shape[r]):n.push(t[r]);return n}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PAe(e,t,n,r){const i=N(e,"x","dropout");if(D(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),D(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof zt?i.clone():i;const s=LAe(i,n),o=1-t,a=Oe(Vw(ue(lg(s,0,1,"float32",r),o)),o);return j(i,a)}const cne=U({dropout_:PAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fne(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function r5(e,t,n){const r=1-e%2,i=new Float32Array(e);for(let s=0;s<e;++s){const o=2*Math.PI*s/(e+r-1);i[s]=t-n*Math.cos(o)}return li(i,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function BAe(e,t,n=1){const r=N(e,"predictions","inTopK"),i=N(t,"targets","inTopK");D(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),D(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),Ar(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];D(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);const o=await r.data(),a=await i.data(),[u,l]=[o.length/s,s],c=sr("bool",u);for(let f=0;f<u;f++){const h=f*l,d=o.subarray(h,h+l),p=[];for(let g=0;g<d.length;g++)p.push({value:d[g],index:g});p.sort((g,m)=>m.value-g.value),c[f]=0;for(let g=0;g<n;g++)if(p[g].index===a[f]){c[f]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),Yd(c,i.shape,"bool")}const zAe=BAe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UAe(e,t,n,r,i,s="NHWC",o){let a=e;e.rank===3&&(a=V(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=V(t,[1,t.shape[0],t.shape[1],t.shape[2]])),D(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),D(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),D(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const l=s==="NHWC"?a.shape[3]:a.shape[1],c=s==="NHWC"?u.shape[3]:u.shape[1];D(l===n[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`),D(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Si("conv2dDerFilter",i,o);const f={x:a,dy:u},h={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,filterShape:n};return z.runKernel(U_,f,h)}const i5=U({conv2DBackpropFilter_:UAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uI(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return j(e,H1(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function lI(e,t){let n=t;const r=Mn(e.shape,t.shape);return r.length>0&&(n=_e(n,r)),V(n,e.shape)}function cI(e,t,n,r){if(t==="linear")return e;if(t==="relu")return ju(e);if(t==="elu")return jw(e);if(t==="relu6")return VB(e);if(t==="prelu")return QT(e,n);if(t==="leakyrelu")return GT(e,r);if(t==="sigmoid")return fu(e);throw new Error(`Unknown fused activation ${t}.`)}const fI=(e,t)=>!(e>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jAe({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",fI(z.state.gradientDepth,u)===!1){D(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=Ff(e,t,n,r,i,s,o);return a!=null&&(C=ue(C,a)),cI(C,u,l,c)}const f=N(e,"x","conv2d","float32"),h=N(t,"filter","conv2d","float32");let d=f,p=!1;f.rank===3&&(p=!0,d=V(f,[1,f.shape[0],f.shape[1],f.shape[2]])),D(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),D(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Si("fused conv2d",r,o);const g=i==="NHWC"?d.shape[3]:d.shape[1];D(h.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${h.shape[2]}.`),D(_r(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const m=or(d.shape,h.shape,n,s,r,o);let y;a!=null&&(y=N(a,"bias","fused conv2d"),[y]=bn(y,f),i==="NHWC"?Ke(m.outShape,y.shape):(D(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),D(y.shape.length===0||y.shape[0]===m.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${m.outChannels})`)));let b;if(l!=null){const C=l.shape;if(D(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)D(C[0]===1||C[0]===m.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${m.outChannels}).`);else if(C.length===3)try{Ke(C,m.outShape)}catch{const S=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${m.outShape}).`;throw Error(S)}b=N(l,"prelu weights","fused conv2d")}const v=(C,$)=>{D(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[S,k,E,A]=$,F=uI(C,E,u);D(Nf(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const _=kB(k.shape,F,S,n,r),I=i5(k,F,S.shape,n,r),T=[_,I];if(A!=null){const O=lI(A,F);T.push(O)}return T},x={x:d,filter:h,bias:y,preluActivationWeights:b},w={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?ku(($,S,k)=>{let E=z.runKernel(Wx,x,w);return k([S,$,E]),p&&(E=V(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:v}})(d,h):ku(($,S,k,E)=>{let A=z.runKernel(Wx,x,w);return E([S,$,A,k]),p&&(A=V(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:v}})(d,h,y)}const hne=U({fusedConv2d_:jAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WAe(e,t,n,r,i,s=[1,1],o){let a=e;e.rank===3&&(a=V(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:a,dy:u},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,filterShape:n};return z.runKernel(X_,l,c)}const dne=U({depthwiseConv2dNativeBackpropFilter_:WAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VAe(e,t,n,r,i,s=[1,1],o){let a=t,u=!1;t.rank===3&&(u=!0,a=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:a,filter:n},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,inputShape:e},f=z.runKernel(Y_,l,c);return u?V(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const pne=U({depthwiseConv2dNativeBackpropInput_:VAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GAe({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(fI(z.state.gradientDepth,u)===!1){let w=Uw(e,t,n,r,i,s,o);return a!=null&&(w=ue(w,a)),cI(w,u,l,c)}const f=N(e,"x","depthwiseConv2d","float32"),h=N(t,"filter","depthwiseConv2d","float32");let d=f,p=!1;f.rank===3&&(p=!0,d=V(f,[1,f.shape[0],f.shape[1],f.shape[2]])),D(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),D(h.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),D(d.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),s==null&&(s=[1,1]),D(_r(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Si("fused depthwiseConv2d",r,o);const g=or(d.shape,h.shape,n,s,r,o,!0);let m;a!=null&&(m=N(a,"bias","fused conv2d"),[m]=bn(m,f),Ke(g.outShape,m.shape));let y;l!=null&&(y=N(l,"prelu weights","fused depthwiseConv2d"));const b=(w,C)=>{D(Nf(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[$,S,k,E]=C,A=uI(w,k,u),F=pne(S.shape,A,$,n,r,s,o),_=dne(S,A,$.shape,n,r,s,o);if(E!=null){const I=lI(m,A);return[F,_,I]}return[F,_]},v={x:d,filter:h,bias:m,preluActivationWeights:y},x={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?ku((C,$,S)=>{let k=z.runKernel(Vx,v,x);return S([$,C,k]),p&&(k=V(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:b}})(d,h):ku((C,$,S,k)=>{let E=z.runKernel(Vx,v,x);return k([$,C,E,S]),p&&(E=V(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:b}})(d,h,m)}const HAe=U({fusedDepthwiseConv2d_:GAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qAe({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(fI(z.state.gradientDepth,s)===!1){let A=st(e,t,n,r);return i!=null&&(A=ue(A,i)),cI(A,s,o,a)}let u=N(e,"a","fused matMul"),l=N(t,"b","fused matMul");[u,l]=bn(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],d=r?l.shape[l.rank-2]:l.shape[l.rank-1],p=u.shape.slice(0,-2),g=l.shape.slice(0,-2),m=Z(p),y=Z(g);D(c===f,()=>`Error in fused matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`);const v=Ke(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([h,d]),x=n?V(u,[m,c,h]):V(u,[m,h,c]),w=r?V(l,[y,d,f]):V(l,[y,f,d]);let C;i!=null&&(C=N(i,"bias","fused matMul"),[C]=bn(C,u),Ke(v,C.shape));let $;o!=null&&($=N(o,"prelu weights","fused matMul"));const S=(A,F)=>{const[_,I,T,O]=F,L=uI(V(A,T.shape),T,s);let M,P;if(!n&&!r?(M=st(L,I,!1,!0),P=st(_,L,!0,!1)):!n&&r?(M=st(L,I,!1,!1),P=st(L,_,!0,!1)):n&&!r?(M=st(I,L,!1,!0),P=st(_,L,!1,!1)):(M=st(I,L,!0,!0),P=st(L,_,!0,!0)),i!=null){const G=lI(O,L);return[M,P,G]}else return[M,P]},k={a:x,b:w,bias:C,preluActivationWeights:$},E={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:a};return i==null?ku((F,_,I)=>{const T=z.runKernel(jx,k,E);return I([F,_,T]),{value:V(T,v),gradFunc:S}})(x,w):ku((F,_,I,T)=>{const O=z.runKernel(jx,k,E);return T([F,_,O,I]),{value:V(O,v),gradFunc:S}})(x,w,C)}const oM=U({fusedMatMul_:qAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XAe=Object.freeze(Object.defineProperty({__proto__:null,conv2d:hne,depthwiseConv2d:HAe,matMul:oM},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YAe(e){return r5(e,.54,.46)}const KAe=U({hammingWindow_:YAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZAe(e){return r5(e,.5,.5)}const gne=U({hannWindow_:ZAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JAe(e,t,n,r=!1,i=0){let s=0;const o=[];for(;s+t<=e.size;)o.push(xt(e,s,t)),s+=n;if(r)for(;s<e.size;){const a=s+t-e.size,u=nr([xt(e,s,t-a),V1([a],i)]);o.push(u),s+=n}return o.length===0?ql([],[0,t]):V(nr(o),[o.length,t])}const mne=U({frame_:JAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QAe(e,t,n,r,i=gne){r==null&&(r=fne(t));const s=mne(e,t,n),o=j(s,i(t));return sI(o,r)}const e_e=U({stft_:QAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_e(e,t,n,r,i="bilinear",s=0){const o=N(e,"image","cropAndResize"),a=N(t,"boxes","cropAndResize","float32"),u=N(n,"boxInd","cropAndResize","int32"),l=a.shape[0];D(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),D(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),D(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),D(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),D(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),D(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const c={image:o,boxes:a,boxInd:u},f={method:i,extrapolationValue:s,cropSize:r};return z.runKernel(G_,c,f)}const n_e=U({cropAndResize_:t_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r_e(e){const t=N(e,"image","flipLeftRight","float32");D(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return z.runKernel(nT,n,{})}const i_e=U({flipLeftRight_:r_e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s_e(e){const t=N(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];D(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),D(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const i=new Array(t.rank);return i.fill(1,0,n),i[n]=3,ho(t,i)}const o_e=U({grayscaleToRGB_:s_e});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a_e(e){const t=N(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];D(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),D(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const i=t.dtype,s=ge(t,"float32"),o=li([.2989,.587,.114]);let a;switch(t.rank){case 2:a=mm("ij,j->i",s,o);break;case 3:a=mm("ijk,k->ij",s,o);break;case 4:a=mm("ijkl,l->ijk",s,o);break;case 5:a=mm("ijklm,m->ijkl",s,o);break;case 6:a=mm("ijklmn,n->ijklm",s,o);break;default:throw new Error("Not a valid tensor rank.")}return a=si(a,-1),ge(a,i)}const u_e=U({rgbToGrayscale_:a_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(e,t,n=0,r=.5){const i=N(e,"image","rotateWithOffset","float32");D(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const s={image:i},o={radians:t,fillValue:n,center:r};return z.runKernel(PT,s,o)}const c_e=U({rotateWithOffset_:l_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q1(e,t,n,r,i,s){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),s==null&&(s=0);const o=e.shape[0];return n=Math.min(n,o),D(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),D(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),D(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),D(t.rank===1,()=>"scores must be a 1D tensor"),D(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`),D(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=N(e,"boxes","nonMaxSuppression","float32"),o=N(t,"scores","nonMaxSuppression","float32"),a=q1(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return z.runKernel(hT,{boxes:s,scores:o},u)}const h_e=U({nonMaxSuppression_:f_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(e,t,n){const r=p_e(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function p_e(e,t,n){return m_e(e,t,n||g_e)}function g_e(e,t){return e>t?1:e<t?-1:0}function m_e(e,t,n){let r=0,i=e.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(t,e[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hI(e,t,n,r,i){return s5(e,t,n,r,i,0)}function dI(e,t,n,r,i,s){return s5(e,t,n,r,i,0,!1,s,!0)}function pI(e,t,n,r,i,s){return s5(e,t,n,r,i,s,!0)}function s5(e,t,n,r,i,s,o=!1,a=!1,u=!1){const l=[];for(let m=0;m<t.length;m++)t[m]>i&&l.push({score:t[m],boxIndex:m,suppressBeginIndex:0});l.sort(OV);const c=s>0?-.5/s:0,f=[],h=[];for(;f.length<n&&l.length>0;){const m=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:v}=m;if(y<i)break;let x=!1;for(let w=f.length-1;w>=v;--w){const C=y_e(e,b,f[w]);if(C>=r){x=!0;break}if(m.score=m.score*b_e(r,c,C),m.score<=i)break}m.suppressBeginIndex=f.length,x||(m.score===y?(f.push(b),h.push(m.score)):m.score>i&&d_e(l,m,OV))}const d=f.length,p=n-d;a&&p>0&&(f.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const g={selectedIndices:f};return o&&(g.selectedScores=h),u&&(g.validOutputs=d),g}function y_e(e,t,n){const r=e.subarray(t*4,t*4+4),i=e.subarray(n*4,n*4+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),d=(a-s)*(u-o),p=(f-l)*(h-c);if(d<=0||p<=0)return 0;const g=Math.max(s,l),m=Math.max(o,c),y=Math.min(a,f),b=Math.min(u,h),v=Math.max(y-g,0)*Math.max(b-m,0);return v/(d+p-v)}function b_e(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function OV(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function x_e(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=N(e,"boxes","nonMaxSuppressionAsync"),o=N(t,"scores","nonMaxSuppressionAsync"),a=q1(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u=await Promise.all([s.data(),o.data()]),l=u[0],c=u[1],{selectedIndices:f}=hI(l,c,n,r,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),li(f,"int32")}const v_e=x_e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w_e(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=N(e,"boxes","nonMaxSuppression"),a=N(t,"scores","nonMaxSuppression"),u=q1(o,a,n,r,i,s);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma;const l={boxes:o,scores:a},c={maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s},f=z.runKernel(pT,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}const $_e=U({nonMaxSuppressionWithScore_:w_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function C_e(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=N(e,"boxes","nonMaxSuppressionAsync"),a=N(t,"scores","nonMaxSuppressionAsync"),u=q1(o,a,n,r,i,s);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma;const l=await Promise.all([o.data(),a.data()]),c=l[0],f=l[1],{selectedIndices:h,selectedScores:d}=pI(c,f,n,r,i,s);return o!==e&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:li(h,"int32"),selectedScores:li(d)}}const S_e=C_e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_e(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=N(e,"boxes","nonMaxSuppression"),a=N(t,"scores","nonMaxSuppression"),u=q1(o,a,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:a},d={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:s},p=z.runKernel(dT,h,d);return{selectedIndices:p[0],validOutputs:p[1]}}const E_e=U({nonMaxSuppressionPadded_:k_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function A_e(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=N(e,"boxes","nonMaxSuppressionAsync"),a=N(t,"scores","nonMaxSuppressionAsync"),u=q1(o,a,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[h,d]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:g}=dI(h,d,l,c,f,s);return o!==e&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:li(p,"int32"),validOutputs:Ve(g,"int32")}}const __e=A_e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_e(e,t,n=!1,r=!1){const i=N(e,"images","resizeBilinear");D(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),D(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),D(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=V(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=z.runKernel(kw,a,u);return o?V(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const yne=U({resizeBilinear_:T_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_e(e,t,n=!1,r=!1){const i=N(e,"images","resizeNearestNeighbor");D(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),D(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),D(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),D(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=V(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=z.runKernel(Sw,a,u);return o?V(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const bne=U({resizeNearestNeighbor_:I_e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_e(e,t="binary",n=!1,r=.5){const i=N(e,"image","threshold"),s=.2989,o=.587,a=.114,u=i.shape[0]*i.shape[1];let l=j(li([r]),255),c,f,h,d;if(D(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),D(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),D(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),D(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),i.shape[2]===3){[c,f,h]=gs(i,[1,1,1],-1);const m=j(c,s),y=j(f,o),b=j(h,a);d=ue(ue(m,y),b)}else d=e;if(t==="otsu"){const m=wte(ge(GB(d),"int32"),Yd([]),256);l=N_e(m,u)}const p=n?ag(d,l):Ds(d,l);return ge(j(p,255),"int32")}function N_e(e,t){let n=li([-1]),r=li([0]),i=li([0]),s,o,a,u,l,c;for(let f=0;f<e.size-1;f++){s=xt(e,0,f+1),o=xt(e,f+1),l=Oe(_e(s),t),c=Oe(_e(o),t);const h=_e(j(s,Zm(0,s.size)));a=Oe(h,_e(s));const d=V1(o.shape,s.size),p=ue(Zm(0,o.size),d),g=j(o,p);u=Oe(_e(g),_e(o));const m=ke(a,u),y=ke(a,u),b=j(l,c);i=j(j(b,m),y);const v=Ds(i,r);r=jr(v,i,r),n=jr(v,li([f]),n)}return n}const F_e=U({threshold_:D_e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_e(e,t,n="nearest",r="constant",i=0,s){const o=N(e,"image","transform","float32"),a=N(t,"transforms","transform","float32");D(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),D(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),D(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);const u={image:o,transforms:a},l={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return z.runKernel(MT,u,l)}const R_e=U({transform_:O_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_e(e,t,n){const r=N(e,"a","bandPart");D(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[s,o]=r.shape.slice(-2);let a,u;typeof t=="number"?(D(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),D(t<=s,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`),a=N(t<0?s:t,"numLower","bandPart")):(D(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=jr(Jx(t,0),s,bp(t,s))),typeof n=="number"?(D(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),D(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),u=N(n<0?o:n,"numUpper","bandPart")):(D(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=jr(Jx(n,0),o,bp(n,o)));const l=V(Zm(0,s,1,"int32"),[-1,1]),c=Zm(0,o,1,"int32"),f=ke(l,c),h=Eu(ag(f,a),Sh(f,rn(u))),d=zn([s,o],r.dtype);return V(Au(Rf(V(r,[-1,s,o])).map(p=>jr(h,p,d))),i)}const L_e=U({bandPart_:M_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_e(e){let t;if(Array.isArray(e)){t=!1,D(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=e[0].shape[0];for(let s=1;s<e.length;++s)D(e[s].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[s].shape[0]} vs. ${i})`)}else t=!0,e=gs(e,e.shape[0],0).map(i=>cg(i,[0]));D(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],r=e;for(let i=0;i<e.length;++i)n.push(z.tidy(()=>{let s=r[i];if(i>0)for(let o=0;o<i;++o){const a=j(_e(j(n[o],s)),n[o]);s=ke(s,a)}return Oe(s,Ww(s,"euclidean"))}));return t?Au(n,0):n}const B_e=U({gramSchmidt_:P_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_e(e,t=!1){if(D(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return RV(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((u,l)=>u*l),r=Rf(V(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],s=[];r.forEach(u=>{const[l,c]=RV(u,t);i.push(l),s.push(c)});const o=V(Au(i,0),e.shape),a=V(Au(s,0),e.shape);return[o,a]}}function RV(e,t=!1){return z.tidy(()=>{D(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],r=e.shape[1];let i=IB(n),s=yf(e);const o=ql([[1]],[1,1]);let a=yf(o);const u=n>=r?r:n;for(let l=0;l<u;++l){const c=s,f=a,h=i;[a,s,i]=z.tidy(()=>{const d=xt(s,[l,l],[n-l,1]),p=Ww(d),g=xt(s,[l,l],[1,1]),m=jr(Ds(g,0),ql([[-1]]),ql([[1]])),y=ke(g,j(m,p)),b=Oe(d,y);b.shape[0]===1?a=yf(o):a=nr([o,xt(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const v=rn(Oe(st(m,y),p)),x=xt(s,[l,0],[n-l,r]),w=j(v,a),C=dt(a);if(l===0)s=ke(x,st(w,st(C,x)));else{const k=ke(x,st(w,st(C,x)));s=nr([xt(s,[0,0],[l,r]),k],0)}const $=dt(w),S=xt(i,[0,l],[n,i.shape[1]-l]);if(l===0)i=ke(S,st(st(S,a),$));else{const k=ke(S,st(st(S,a),$));i=nr([xt(i,[0,0],[n,l]),k],1)}return[a,s,i]}),ot([c,f,h])}return!t&&n>r&&(i=xt(i,[0,0],[n,r]),s=xt(s,[0,0],[r,r])),[i,s]})}const U_e=U({qr_:z_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var oi;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(oi||(oi={}));function j_e(e,t,n=oi.SUM_BY_NONZERO_WEIGHTS){const r=N(e,"losses","computeWeightedLoss");let i=null;t!=null&&(i=N(t,"weights","computeWeightedLoss"));const s=i==null?r:j(r,i);if(n===oi.NONE)return s;if(n===oi.SUM)return _e(s);if(n===oi.MEAN){if(i==null)return wn(s);{const o=r.size/i.size,a=Oe(_e(s),_e(i));return o>1?Oe(a,Ve(o)):a}}if(n===oi.SUM_BY_NONZERO_WEIGHTS){if(i==null)return Oe(_e(s),Ve(r.size));{const o=j(i,fs(r.shape)),a=ge(_e(Km(o,Ve(0))),"float32");return Oe(_e(s),a)}}throw Error(`Unknown reduction: ${n}`)}const yc=U({computeWeightedLoss_:j_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(e,t,n,r=oi.SUM_BY_NONZERO_WEIGHTS){const i=N(e,"labels","absoluteDifference"),s=N(t,"predictions","absoluteDifference");let o=null;n!=null&&(o=N(n,"weights","absoluteDifference")),Ar(i.shape,s.shape,"Error in absoluteDifference: ");const a=Bn(ke(i,s));return yc(a,o,r)}const V_e=U({absoluteDifference_:W_e});function G_e(e,t,n,r,i=oi.SUM_BY_NONZERO_WEIGHTS){const s=N(e,"labels","cosineDistance"),o=N(t,"predictions","cosineDistance");let a=null;r!=null&&(a=N(r,"weights","cosineDistance")),Ar(s.shape,o.shape,"Error in cosineDistance: ");const u=Ve(1),l=ke(u,_e(j(s,o),n,!0));return yc(l,a,i)}const H_e=U({cosineDistance_:G_e});function q_e(e,t,n,r=oi.SUM_BY_NONZERO_WEIGHTS){let i=N(e,"labels","hingeLoss");const s=N(t,"predictions","hingeLoss");let o=null;n!=null&&(o=N(n,"weights","hingeLoss")),Ar(i.shape,s.shape,"Error in hingeLoss: ");const a=Ve(1);i=ke(j(Ve(2),i),a);const u=ju(ke(a,j(i,s)));return yc(u,o,r)}const X_e=U({hingeLoss_:q_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_e(e,t,n,r=1,i=oi.SUM_BY_NONZERO_WEIGHTS){const s=N(e,"labels","huberLoss"),o=N(t,"predictions","huberLoss");let a=null;n!=null&&(a=N(n,"weights","huberLoss")),Ar(s.shape,o.shape,"Error in huberLoss: ");const u=Ve(r),l=Bn(ke(o,s)),c=bp(l,u),f=ke(l,c),h=ue(j(Ve(.5),Gt(c)),j(u,f));return yc(h,a,i)}const K_e=U({huberLoss_:Y_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_e(e,t,n,r=1e-7,i=oi.SUM_BY_NONZERO_WEIGHTS){const s=N(e,"labels","logLoss"),o=N(t,"predictions","logLoss");let a=null;n!=null&&(a=N(n,"weights","logLoss")),Ar(s.shape,o.shape,"Error in logLoss: ");const u=Ve(1),l=Ve(r),c=rn(j(s,Hs(ue(o,l)))),f=j(ke(u,s),Hs(ue(ke(u,o),l))),h=ke(c,f);return yc(h,a,i)}const J_e=U({logLoss_:Z_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_e(e,t,n,r=oi.SUM_BY_NONZERO_WEIGHTS){const i=N(e,"labels","meanSquaredError"),s=N(t,"predictions","meanSquaredError");let o=null;n!=null&&(o=N(n,"weights","meanSquaredError")),Ar(i.shape,s.shape,"Error in meanSquaredError: ");const a=QB(i,s);return yc(a,o,r)}const eTe=U({meanSquaredError_:Q_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tTe(e,t){const n=N(e,"labels","sigmoidCrossEntropyWithLogits"),r=N(t,"logits","sigmoidCrossEntropyWithLogits");Ar(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=ju(r),s=j(r,n),o=HT(bs(rn(Bn(r))));return ue(ke(i,s),o)}function nTe(e,t,n,r=0,i=oi.SUM_BY_NONZERO_WEIGHTS){let s=N(e,"multiClassLabels","sigmoidCrossEntropy");const o=N(t,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=N(n,"weights","sigmoidCrossEntropy")),Ar(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const l=Ve(r),c=Ve(1),f=Ve(.5);s=ue(j(s,ke(c,l)),j(f,l))}const u=tTe(s,o);return yc(u,a,i)}const rTe=U({sigmoidCrossEntropy_:nTe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iTe(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return ku((i,s,o)=>{const u=XT(s,[n],!0),l=ke(ge(s,"float32"),u);o([i,l]);const c=rn(j(l,i));return{value:_e(c,[n]),gradFunc:(d,p)=>{const[g,m]=p,y=Tn(d.shape,[n]);return[j(V(d,y),ke(ge(g,"float32"),bs(m))),j(V(d,y),ke(bs(m),ge(g,"float32")))]}}})(e,t)}function sTe(e,t,n,r=0,i=oi.SUM_BY_NONZERO_WEIGHTS){let s=N(e,"onehotLabels","softmaxCrossEntropy");const o=N(t,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=N(n,"weights","softmaxCrossEntropy")),Ar(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const l=Ve(r),c=Ve(1),f=Ve(s.shape[1]);s=ue(j(s,ke(c,l)),Oe(l,f))}const u=iTe(s,o);return yc(u,a,i)}const oTe=U({softmaxCrossEntropy_:sTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aTe(e,t,n,r){const i=N(e,"indices","sparseFillEmptyRows","int32"),s=N(t,"values","sparseFillEmptyRows"),o=N(n,"denseShape","sparseFillEmptyRows","int32"),a=N(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(i.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${i.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:i,values:s,denseShape:o,defaultValue:a},l=z.runKernel(kT,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}const uTe=U({sparseFillEmptyRows_:aTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lTe(e,t,n){const r=N(e,"inputIndices","sparseReshape","int32"),i=N(t,"inputShape","sparseReshape","int32"),s=N(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const o={inputIndices:r,inputShape:i,newShape:s},a=z.runKernel(ET,o);return{outputIndices:a[0],outputShape:a[1]}}const cTe=U({sparseReshape_:lTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fTe(e,t,n){const r=N(e,"data","sparseSegmentMean"),i=N(t,"indices","sparseSegmentMean","int32"),s=N(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return z.runKernel(AT,o)}const hTe=U({sparseSegmentMean_:fTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dTe(e,t,n){const r=N(e,"data","sparseSegmentSum"),i=N(t,"indices","sparseSegmentSum","int32"),s=N(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return z.runKernel(_T,o)}const pTe=U({sparseSegmentSum_:dTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gTe(e,t,n,r,i,s,o,a){const u=N(e,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=N(t,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:r,leftPad:i,rightPad:s,padWidth:o,preserveShortSequences:a},f={data:u,dataSplits:l},h=z.runKernel(NT,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}const mTe=U({stringNGrams_:gTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yTe(e,t,n=!0){const r=N(e,"input","stringSplit","string"),i=N(t,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(i.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const s={skipEmpty:n},o={input:r,delimiter:i},a=z.runKernel(FT,o,s);return{indices:a[0],values:a[1],shape:a[2]}}const bTe=U({stringSplit_:yTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xTe(e,t){const n=N(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return z.runKernel(OT,i,r)}const vTe=U({stringToHashBucketFast_:xTe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wTe(e,t,n,r=!0){const i=N(e,"input","staticRegexReplace","string"),s={pattern:t,rewrite:n,replaceGlobal:r};return z.runKernel(Fw,{x:i},s)}const $Te=U({staticRegexReplace_:wTe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CTe={fft:iI,ifft:nv,rfft:sI,irfft:JB},STe={hammingWindow:KAe,hannWindow:gne,frame:mne,stft:e_e},au={flipLeftRight:i_e,grayscaleToRGB:o_e,resizeNearestNeighbor:bne,resizeBilinear:yne,rgbToGrayscale:u_e,rotateWithOffset:c_e,cropAndResize:n_e,nonMaxSuppression:h_e,nonMaxSuppressionAsync:v_e,nonMaxSuppressionWithScore:$_e,nonMaxSuppressionWithScoreAsync:S_e,nonMaxSuppressionPadded:E_e,nonMaxSuppressionPaddedAsync:__e,threshold:F_e,transform:R_e},xne={bandPart:L_e,gramSchmidt:B_e,qr:U_e},vne={absoluteDifference:V_e,computeWeightedLoss:yc,cosineDistance:H_e,hingeLoss:X_e,huberLoss:K_e,logLoss:J_e,meanSquaredError:eTe,sigmoidCrossEntropy:rTe,softmaxCrossEntropy:oTe},kTe={sparseFillEmptyRows:uTe,sparseReshape:cTe,sparseSegmentMean:hTe,sparseSegmentSum:pTe},ETe={stringNGrams:mTe,stringSplit:bTe,stringToHashBucketFast:vTe,staticRegexReplace:$Te};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ATe=new Map,aM=new Map;class fg{getClassName(){return this.constructor.className}static fromConfig(t,n){return new t(n)}}class Bs{constructor(){this.classNameMap={}}static getMap(){return Bs.instance==null&&(Bs.instance=new Bs),Bs.instance}static register(t){Bs.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function le(e,t,n){D(e.className!=null,()=>"Class being registered does not have the static className property defined."),D(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),D(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof n>"u"&&(n=e.className);const r=n,i=t+">"+r;return Bs.register(e),ATe.set(i,e),aM.set(e,i),e}function _Te(e){return aM.has(e)?aM.get(e):e.className}const TTe=Object.freeze(Object.defineProperty({__proto__:null,Serializable:fg,SerializationMap:Bs,getRegisteredName:_Te,registerClass:le},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bc extends fg{minimize(t,n=!1,r){const{value:i,grads:s}=this.computeGradients(t,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(o)}else this.applyGradients(s);return ot(s),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,n){return Vte(t,n)}dispose(){this.iterations_!=null&&ot(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ve(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(bc,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o5 extends bc{static get className(){return"Adadelta"}constructor(t,n,r=null){super(),this.learningRate=t,this.rho=n,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r],o=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accum_grad`,variable:X(()=>mt(s).variable(o))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${r}/accum_var`,variable:X(()=>mt(s).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[r];if(a==null)return;const u=this.accumulatedGrads[i].variable,l=this.accumulatedUpdates[i].variable;X(()=>{const c=ue(j(u,this.rho),j(Gt(a),1-this.rho)),f=j(Oe(Vr(ue(l,this.epsilon)),Vr(ue(u,this.epsilon))),a),h=ue(j(l,this.rho),j(Gt(f),1-this.rho));u.assign(c),l.assign(h);const d=ue(j(f,-this.learningRate),s);s.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ot(this.accumulatedGrads.map(t=>t.variable)),ot(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=t.length/2,r=!1;this.accumulatedGrads=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedUpdates=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a5 extends bc{static get className(){return"Adagrad"}constructor(t,n=.1){super(),this.learningRate=t,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accumulator`,variable:X(()=>V1(s.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(t)?t[i].tensor:t[r];if(o==null)return;const a=this.accumulatedGrads[i].variable;X(()=>{const u=ue(a,Gt(o));a.assign(u);const l=ue(j(Oe(o,Vr(ue(u,z.backend.epsilon()))),-this.learningRate),s);s.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ot(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulatedGrads=t.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,n){return new t(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u5 extends bc{static get className(){return"Adam"}constructor(t,n,r,i=null){super(),this.learningRate=t,this.beta1=n,this.beta2=r,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],X(()=>{this.accBeta1=Ve(n).variable(),this.accBeta2=Ve(r).variable()}),i==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);X(()=>{const r=ke(1,this.accBeta1),i=ke(1,this.accBeta2);n.forEach((s,o)=>{const a=z.registeredVariables[s],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:X(()=>mt(a).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${s}/v`,variable:X(()=>mt(a).variable(u))});const l=Array.isArray(t)?t[o].tensor:t[s];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,h=ue(j(c,this.beta1),j(l,1-this.beta1)),d=ue(j(f,this.beta2),j(Gt(l),1-this.beta2)),p=Oe(h,r),g=Oe(d,i);c.assign(h),f.assign(d);const m=ue(j(Oe(p,ue(Vr(g),this.epsilon)),-this.learningRate),a);a.assign(m)}),this.accBeta1.assign(j(this.accBeta1,this.beta1)),this.accBeta2.assign(j(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ot(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&ot(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t),X(()=>{this.accBeta1.assign(Of(this.beta1,this.iterations_+1)),this.accBeta2.assign(Of(this.beta2,this.iterations_+1))});const n=t.length/2,r=!1;this.accumulatedFirstMoment=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedSecondMoment=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l5 extends bc{static get className(){return"Adamax"}constructor(t,n,r,i=null,s=0){super(),this.learningRate=t,this.beta1=n,this.beta2=r,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],X(()=>{this.iteration=Ve(0).variable(),this.accBeta1=Ve(n).variable()}),i==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);X(()=>{const r=ke(1,this.accBeta1),i=Oe(-this.learningRate,ue(j(this.iteration,this.decay),1));n.forEach((s,o)=>{const a=z.registeredVariables[s],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:mt(a).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${s}/v`,variable:mt(a).variable(u)});const l=Array.isArray(t)?t[o].tensor:t[s];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,h=ue(j(c,this.beta1),j(l,1-this.beta1)),d=j(f,this.beta2),p=Bn(l),g=mc(d,p);c.assign(h),f.assign(g);const m=ue(j(Oe(i,r),Oe(h,ue(g,this.epsilon))),a);a.assign(m)}),this.iteration.assign(ue(this.iteration,1)),this.accBeta1.assign(j(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ot(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&ot(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gI extends bc{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=Array.isArray(t)?t[i].tensor:t[r];if(s==null)return;const o=z.registeredVariables[r];X(()=>{const a=ue(j(this.c,s),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=ga(Ve(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,n){return new t(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c5 extends gI{static get className(){return"Momentum"}constructor(t,n,r=!1){super(t),this.learningRate=t,this.momentum=n,this.useNesterov=r,this.accumulations=[],this.m=Ve(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${r}/momentum`,variable:X(()=>mt(s).variable(!1))});const o=this.accumulations[i].variable,a=Array.isArray(t)?t[i].tensor:t[r];a!=null&&X(()=>{let u;const l=ue(j(this.m,o),a);this.useNesterov?u=ue(j(this.c,ue(a,j(l,this.m))),s):u=ue(j(this.c,l),s),o.assign(l),s.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ot(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulations=t.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f5 extends bc{static get className(){return"RMSProp"}constructor(t,n=.9,r=0,i=null,s=!1){if(super(),this.learningRate=t,this.decay=n,this.momentum=r,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=z.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r],o=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${r}/rms`,variable:X(()=>mt(s).variable(o))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${r}/momentum`,variable:X(()=>mt(s).variable(o))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${r}/mg`,variable:X(()=>mt(s).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[r];if(a==null)return;const u=this.accumulatedMeanSquares[i].variable,l=this.accumulatedMoments[i].variable;X(()=>{const c=ue(j(u,this.decay),j(Gt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[i].variable,h=ue(j(f,this.decay),j(a,1-this.decay)),d=Oe(j(a,this.learningRate),Vr(ke(c,ue(Gt(h),this.epsilon)))),p=ue(j(l,this.momentum),d);u.assign(c),f.assign(h),l.assign(p);const g=ke(s,p);s.assign(g)}else{const f=ue(j(u,this.decay),j(Gt(a),1-this.decay)),h=ue(j(l,this.momentum),Oe(j(a,this.learningRate),Vr(ue(f,this.epsilon))));u.assign(f),l.assign(h);const d=ke(s,h);s.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ot(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ot(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&ot(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=this.centered?t.length/3:t.length/2,r=!1;this.accumulatedMeanSquares=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedMoments=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ITe=[o5,a5,u5,l5,c5,f5,gI];function DTe(){for(const e of ITe)le(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NTe="model",FTe=".json",OTe=".weights.bin";function MV(e){return new Promise(t=>setTimeout(t)).then(e)}class xp{constructor(t){if(!q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(xp.URL_SCHEME)&&(t=t.slice(xp.URL_SCHEME.length)),(t==null||t.length===0)&&(t=NTe),this.modelJsonFileName=t+FTe,this.weightDataFileName=t+OTe}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Ia.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const i=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],s=Jee(t,i),o=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await MV(()=>a.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){const u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=r,await MV(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Pw(t)}}}}xp.URL_SCHEME="downloads://";class RTe{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise((t,n)=>{const r=new FileReader;r.onload=i=>{const s=JSON.parse(i.target.result),o=s.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){t({modelTopology:o});return}const u=vB(s,l=>this.loadWeights(l));t(u)},r.onerror=i=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})}loadWeights(t){const n=[],r=[];for(const o of t)n.push(...o.weights),r.push(...o.paths);const i=this.checkManifestAndWeightFiles(t),s=r.map(o=>this.loadWeightsFile(o,i[o]));return Promise.all(s).then(o=>[n,o])}loadWeightsFile(t,n){return new Promise((r,i)=>{const s=new FileReader;s.onload=o=>{const a=o.target.result;r(a)},s.onerror=o=>i(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(t){const n=[],r=this.weightsFiles.map(s=>FV(s.name)),i={};for(const s of t)s.paths.forEach(o=>{const a=FV(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);i[o]=this.weightsFiles[r.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return i}}const MTe=e=>q().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(xp.URL_SCHEME)?LTe(e.slice(xp.URL_SCHEME.length)):null;pn.registerSaveRouter(MTe);function LTe(e="model"){return new xp(e)}function PTe(e){return new RTe(e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(e,t,n,r){o(e),n=n??0,r=r??1,a(n,r);let i=0;const s=u=>(u.then(l=>{const c=n+ ++i/e.length*(r-n);return t(c),l}),u);function o(u){D(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function a(u,l){D(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),D(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),D(l>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${l}`)}return Promise.all(e.map(s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function wne(e,t){t==null&&(t={});const n=t.fetchFunc==null?q().platform.fetch:t.fetchFunc,r=e.map(f=>n(f,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?await Promise.all(r):await LV(r,t.onProgress,0,.5)).map(f=>f.arrayBuffer());return t.onProgress==null?await Promise.all(a):await LV(a,t.onProgress,.5,1)}function BTe(e,t){var n;const r=t.fetchFunc==null?q().platform.fetch:t.fetchFunc;let i=0,s;return(n=t.onProgress)===null||n===void 0||n.call(t,0),new ReadableStream({pull:async o=>{for(var a;i<e.length;){s||(s=(await r(e[i],t.requestInit,{isBinary:!0})).body.getReader());const{done:u,value:l}=await s.read();if(u){i++,s=void 0,(a=t.onProgress)===null||a===void 0||a.call(t,i/e.length);continue}o.enqueue(l);return}o.close()}})}async function zTe(e,t="",n,r){return $ne(o=>wne(o,{requestInit:r}))(e,t,n)}function $ne(e){return async(t,n="",r)=>{const i=t.map(()=>!1),s={},o=r!=null?r.map(()=>!1):[],a=[];if(t.forEach((d,p)=>{let g=0;d.weights.forEach(m=>{const y="quantization"in m?m.quantization.dtype:m.dtype,b=dp[y]*Z(m.shape),v=()=>{i[p]=!0,s[p]==null&&(s[p]=[]),s[p].push({manifestEntry:m,groupOffset:g,sizeBytes:b})};r!=null?r.forEach((x,w)=>{x===m.name&&(v(),o[w]=!0)}):v(),a.push(m.name),g+=b})}),!o.every(d=>d)){const d=r.filter((p,g)=>!o[g]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const u=i.reduce((d,p,g)=>(p&&d.push(g),d),[]),l=[];u.forEach(d=>{t[d].paths.forEach(p=>{const g=n+(n.endsWith("/")?"":"/")+p;l.push(g)})});const c=await e(l),f={};let h=0;return u.forEach(d=>{const p=t[d].paths.length,g=new Ia(c.slice(h,h+p));s[d].forEach(y=>{const b=g.slice(y.groupOffset,y.groupOffset+y.sizeBytes),v=Yee(b,[y.manifestEntry]);for(const x in v)f[x]=v[x]}),h+=p}),f}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UTe="application/octet-stream",jTe="application/json";class h5{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(D(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=q().platform.fetch,D(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&D(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],i=Jee(t,r);if(n.body.append("model.json",new Blob([JSON.stringify(i)],{type:jTe}),"model.json"),t.weightData!=null){const o=Ia.join(t.weightData);n.body.append("model.weights.bin",new Blob([o],{type:UTe}),"model.weights.bin")}const s=await this.fetch(this.path,n);if(s.ok)return{modelArtifactsInfo:Pw(t),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async loadModelJSON(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await t.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=n.modelTopology,i=n.weightsManifest;if(r==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const t=await this.loadModelJSON();return vB(t,n=>this.loadWeights(n))}async loadStream(){const t=await this.loadModelJSON(),n=await this.getWeightUrls(t.weightsManifest),r=QR(t.weightsManifest),i=()=>BTe(n,this.loadOptions);return Object.assign(Object.assign({},t),{weightSpecs:r,getWeightStream:i})}async getWeightUrls(t){const n=Array.isArray(this.path)?this.path[1]:this.path,[r,i]=WTe(n),s=this.weightPathPrefix||r,o=[],a=[];for(const u of t)for(const l of u.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(l)):o.push(s+l+i);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(t){const n=await this.getWeightUrls(t),r=QR(t),i=await wne(n,this.loadOptions);return[r,i]}}h5.URL_SCHEME_REGEX=/^https?:\/\//;function WTe(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),i=n>t?e.substring(n):"";return[r+"/",i]}function uM(e){return e.match(h5.URL_SCHEME_REGEX)!=null}const Cne=(e,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(e)?n=e.every(r=>uM(r)):n=uM(e),n)return d5(e,t)}return null};pn.registerSaveRouter(Cne);pn.registerLoadRouter(Cne);function d5(e,t){return new h5(e,t)}function VTe(e,t){return d5(e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a3{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class Sne{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class GTe{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=n=>Promise.resolve(t.save(n)))}}function HTe(e,t,n,r){const i=arguments;return new GTe(kne(...i))}function kne(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new a3(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new a3({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new a3({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function qTe(e){return new Sne(e)}function XTe(e){return new Sne(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YTe=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Ia,browserFiles:PTe,browserHTTPRequest:VTe,concatenateArrayBuffers:Zee,copyModel:M$e,decodeWeights:Yee,decodeWeightsStream:h$e,encodeWeights:JR,fromMemory:HTe,fromMemorySync:kne,getLoadHandlers:$$e,getModelArtifactsForJSON:vB,getModelArtifactsForJSONSync:Qee,getModelArtifactsInfoForJSON:Pw,getSaveHandlers:ete,getWeightSpecs:QR,http:d5,isHTTPScheme:uM,listModels:O$e,loadWeights:zTe,moveModel:L$e,registerLoadRouter:w$e,registerSaveRouter:v$e,removeModel:R$e,weightsLoaderFactory:$ne,withSaveHandler:qTe,withSaveHandlerSync:XTe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KTe(e,t,n){const r=N(e,"labels","confusionMatrix"),i=N(t,"predictions","confusionMatrix");D(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),D(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),D(i.rank===1,()=>`Expected the rank of predictions to be 1, but got ${i.rank}`),D(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),D(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const s=Qx(ge(r,"int32"),n),o=Qx(ge(i,"int32"),n),a=dt(s),u=st(a,o);return ge(u,"int32")}const ZTe=U({confusionMatrix_:KTe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JTe=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:ZTe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Jh,PV=!1;function Ene(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else if(e.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(Hx(Lk,z.backendName)!=null){const p={pixels:e},g={numChannels:t};return z.runKernel(Lk,p,g)}const[l,c]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let f;if(o)f=e.getContext("2d").getImageData(0,0,l,c).data;else if(r||n)f=e.data;else if(s||i||a){if(Jh==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Jh=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Jh=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Jh.canvas.width=l,Jh.canvas.height=c,Jh.drawImage(e,0,0,l,c),f=Jh.getImageData(0,0,l,c).data}let h;if(t===4)h=new Int32Array(f);else{const p=l*c;h=new Int32Array(p*t);for(let g=0;g<p;g++)for(let m=0;m<t;++m)h[g*t+m]=f[g*4+m]}return sne(h,[c,l,t],"int32")}function QTe(e){return e!=null&&e.data instanceof Uint8Array}function eIe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function tIe(e){return e!=null&&e.width!==0&&e.height!==0}function nIe(e){return eIe()&&!(e instanceof ImageBitmap)&&tIe(e)&&!QTe(e)}async function rIe(e,t=3){let n=null;if(q().getBool("WRAP_TO_IMAGEBITMAP")&&nIe(e)){let r;try{r=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===e.width&&r.height===e.height?n=r:n=e}else n=e;return Ene(n,t)}function Ane(e){if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);const t=e.rank===2?1:e.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}function iIe(e){const t=(e==null?void 0:e.alpha)||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}async function _ne(e,t){let n=N(e,"img","toPixels");if(!(e instanceof zt)){const l=n;n=ge(l,"int32"),l.dispose()}Ane(n);const[r,i]=n.shape.slice(0,2),s=n.rank===2?1:n.shape[2],o=await n.data(),a=n.dtype==="float32"?255:1,u=new Uint8ClampedArray(i*r*4);for(let l=0;l<r*i;++l){const c=[0,0,0,255];for(let h=0;h<s;h++){const d=o[l*s+h];if(n.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(n.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);s===1?(c[0]=d*a,c[1]=d*a,c[2]=d*a):c[h]=d*a}const f=l*4;u[f+0]=Math.round(c[0]),u[f+1]=Math.round(c[1]),u[f+2]=Math.round(c[2]),u[f+3]=Math.round(c[3])}if(t!=null){PV||Hx(Z_,z.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),PV=!0),t.width=i,t.height=r;const l=t.getContext("2d"),c=new ImageData(u,i,r);l.putImageData(c,0,0)}return n!==e&&n.dispose(),u}function sIe(e,t,n){let r=N(e,"img","draw");if(!(e instanceof zt)){const o=r;r=ge(o,"int32"),o.dispose()}Ane(r),iIe(n==null?void 0:n.imageOptions);const i={image:r},s={canvas:t,options:n};z.runKernel(Z_,i,s)}const oIe=U({fromPixels_:Ene}),aIe=Object.freeze(Object.defineProperty({__proto__:null,draw:sIe,fromPixels:oIe,fromPixelsAsync:rIe,toPixels:_ne},Symbol.toStringTag,{value:"Module"}));function mI(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(Z(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const i=t.shape,s=i[i.length-1];let o=1;for(let f=0;f<i.length-1;++f)o*=i[f];const a=e.shape,u=i.slice();u.pop();let l=1;for(let f=s;f<n;++f)l*=a[f],u.push(a[f]);const c=[...Re(e.shape).map(f=>f/l),1].slice(0,s);return[u,o,l,c]}const uIe=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:mI},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lM=-2,lIe=-1;function p5(e,t,n){const r=e.shape.length;D(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),D(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)D(t[i]+n[i]<=e.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${t[i]+n[i]}) would overflow input.shape[${i}] (${e.shape[i]})`)}function cIe(e){const t=[];let n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function g5(e,t,n){const r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function Tne(e,t,n,r){const i=[...e];for(let s=i.length;s<r.length;s++)i.push(1);for(let s=0;s<n;s++)s===0?i[t]=1:(i.splice(t,0,1),i.pop());return i}function Ine(e,t,n){return n<=e?n:n-(t-1)}function Dne(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function fIe(e,t,n,r,i,s,o,a,u){const l=e.length;let c=new Array(l),f=new Array(l),h=new Array(l);if(t.length&&n>0){const d=t[0],p=n+1;c=Nne(o,d,p,r,e),f=Fne(a,d,p,i,e),h=Tne(s,d,p,e)}else for(let d=0;d<l;d++)c[d]=Rne(o,r,s,e,d,u),f[d]=Mne(a,i,s,e,d,u),h[d]=One(s,d,u);return{begin:c,end:f,strides:h}}function Nne(e,t,n,r,i){const s=[...i],o=Dne(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const u=Ine(t,n,a);let l=r[u];e&1<<u&&(l=0),s[a]=l}return s}function Fne(e,t,n,r,i){const s=[...i],o=Dne(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const u=Ine(t,n,a);let l=r[u];e&1<<u&&(l=Number.MAX_SAFE_INTEGER),s[a]=l}for(let a=0;a<s.length;a++){const u=i[a];s[a]<0&&(s[a]+=u),s[a]=_f(0,s[a],i[a])}return s}function One(e,t,n){let r=e[t];return(n&1<<t||r==null)&&(r=1),r}function Rne(e,t,n,r,i,s){let o=t[i];const a=n[i]||1;(e&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),o=_f(0,o,u-1),o}function Mne(e,t,n,r,i,s){let o=t[i];const a=n[i]||1;(e&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),a>0?o=_f(0,o,u):o=_f(-1,o,u-1),o}function m5(e,t,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function y5(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function yI(e,t,n){let r;const i=e.shape.length;typeof t=="number"?r=[t,...new Array(i-1).fill(0)]:t.length<i?r=t.concat(new Array(i-t.length).fill(0)):r=t.slice(),r.forEach(o=>{D(o!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(i).fill(-1):typeof n=="number"?s=[n,...new Array(i-1).fill(-1)]:n.length<i?s=n.concat(new Array(i-n.length).fill(-1)):s=n,s=s.map((o,a)=>o>=0?o:(D(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),e.shape[a]-r[a])),[r,s]}function b5(e,t,n,r,i,s,o,a,u){let l;if(r==null?(l=new Array(t.length),l.fill(1)):l=r,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const f={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};for(let v=0;v<f.dims;v++)c&&1<<v&a&&f.numAddAxisAfterEllipsis++,1<<v&o&&(c=!0);c||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};hIe(f,h);let d=!0,p=!0,g=!0;const m=[],y=[];for(let v=0;v<e.length;++v){if(h.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const x=!!(h.shrinkAxisMask&1<<v),w=e[v];if(w===-1){m.push(x?1:-1);continue}const C=[h.beginMask&1<<v,h.endMask&1<<v],$=[h.strides[v]>0?0:-1,h.strides[v]>0?w:w-1];if(x&&h.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&h.strides[v]===1;const S=!!(h.beginMask&1<<v&&h.endMask&1<<v);if(h.beginValid&&h.endValid){if(x){const F=h.begin[v]<0?w+h.begin[v]:h.begin[v];if(h.begin[v]=F,h.end[v]=h.begin[v]+1,F<0||F>=w)throw Error(`slice index ${h.begin[v]} of dimension ${v} out of bounds.`)}else h.begin[v]=BV(h.begin[v],0,h.strides[v],w,C,$),h.end[v]=BV(h.end[v],1,h.strides[v],w,C,$);const A=h.strides[v]===1&&h.begin[v]===0&&h.end[v]===w;d=d&&A,p=p&&(v===0&&h.strides[v]===1||A)}else d=d&&h.strides[v]===1&&S,p=p&&(v===0&&h.strides[v]===1||S);let k,E=!1;if(h.beginValid&&h.endValid?(k=h.end[v]-h.begin[v],E=!0):x?(k=1,E=!0):S&&w>=0&&(h.strides[v]<0?k=-w:k=w,E=!0),E){let A;k===0||k<0!=h.strides[v]<0?A=0:A=Math.trunc(k/h.strides[v])+(k%h.strides[v]!==0?1:0),m.push(A)}else m.push(-1)}for(let v=0;v<h.finalShapeGatherIndices.length;++v){const x=h.finalShapeGatherIndices[v];x>=0?y.push(m[x]):x===lM&&y.push(1)}return{finalShapeSparse:y.filter((v,x)=>h.finalShapeGatherIndices[x]!==lM),finalShape:y,isIdentity:d,sliceDim0:p,isSimpleSlice:g,begin:h.begin,end:h.end,strides:h.strides}}function hIe(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const i=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<i;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(lM),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[r]),e.end!=null&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(lIe),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function BV(e,t,n,r,i,s){if(i[t])return n>0?s[t]:s[t+1&1];{const o=e<0?r+e:e;return o<s[0]?s[0]:o>s[1]?s[1]:o}}const Lne=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:p5,computeFlatOffset:y5,computeOutShape:g5,getNormalizedAxes:fIe,isSliceContinous:m5,maskToAxes:cIe,parseSliceParams:yI,sliceInfo:b5,startForAxis:Rne,startIndicesWithElidedDims:Nne,stopForAxis:Mne,stopIndicesWithElidedDims:Fne,stridesForAxis:One,stridesWithElidedDims:Tne},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const dIe="4.18.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pne{static sgd(t){return new gI(t)}static momentum(t,n,r=!1){return new c5(t,n,r)}static rmsprop(t,n=.9,r=0,i=null,s=!1){return new f5(t,n,r,i,s)}static adam(t=.001,n=.9,r=.999,i=null){return new u5(t,n,r,i)}static adadelta(t=.001,n=.95,r=null){return new o5(t,n,r)}static adamax(t=.002,n=.9,r=.999,i=null,s=0){return new l5(t,n,r,i,s)}static adagrad(t,n=.1){return new a5(t,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vl=Pne;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pIe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e();function x5(){return new Promise(e=>pIe(()=>e()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(e,t){const n=e[0].length;e.forEach((i,s)=>{D(i.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),D(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=e[0];e.forEach((i,s)=>{for(let o=0;o<n;o++)D(o===t||i[o]===r[o],()=>`Error in concat${n}D: Shape of tensors[${s}] (${i}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function hu(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var na;(function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"})(na||(na={}));function Bne(e,t,n){let r=new Array;if(n==null&&t==null)return r;if(t==null)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(n==null)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const s=n[i],o=r[r.length-n.length+i],a=r[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${i+e}] = ${s} but shape[${i+e}] = ${a}`)}else r[o]=s}return r}function zne(e){const t={FIRST_DIM_SIZE:na.FIRST_DIM_SIZE,VALUE_ROWIDS:na.VALUE_ROWIDS,ROW_LENGTHS:na.ROW_LENGTHS,ROW_SPLITS:na.ROW_SPLITS,ROW_LIMITS:na.ROW_LIMITS,ROW_STARTS:na.ROW_STARTS},n=[];for(const r of e)if(r in t)n.push(t[r]);else break;return n}function Une(e){return e.length===0?0:e[0]===na.FIRST_DIM_SIZE?e.length-1:e.length}function jne(e,t){if(e==null||t==null)return;const n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const s=e[i],o=t[i+1];if(s>=0&&o>=0&&s!==1&&s!==o)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${i-e.length}] = ${s} but ragged tensor input.flatValues.shape[${i-e.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w5=30;function bI(e){return e<=w5?e:Ok(e,Math.floor(Math.sqrt(e)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(e,t,n){const r=n*(typeof e=="number"?e:e[0]),i=t*(typeof e=="number"?e:e[1]);return[r,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hw(e,t,n,r=!0){let i=[];if(r)i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const s=t.length;for(let o=0;o<s;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(s+1))}return i}function qw(e,t,n=!0){const r=[];if(n){r.push(t);for(let i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{const i=[],s=[];for(let o=1;o<e;++o)o>=t*2+1||o%2===1?s.push(o):i.push(o);r.push(...i),r.push(0),r.push(...s)}return r}function Xw(e,t,n,r=!0){const i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?r?i.push(t[s-1]*e[s]):i.push(e[s]/t[s-1]):i.push(e[s]);return i}function C5(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function S5(e,t,n){const r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xI=1.7580993408473768,vI=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k5=.3275911,E5=.254829592,A5=-.284496736,_5=1.421413741,T5=-1.453152027,I5=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nc(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(e.length*2);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Wne(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function Vne(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function Gne(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function D5(e,t){const n=e[t*2],r=e[t*2+1];return{real:n,imag:r}}function Hne(e,t,n,r){e[r*2]=t,e[r*2+1]=n}function qne(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const s=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function Xne(e,t,n){const r=(n?2:-2)*Math.PI*(e/t),i=Math.cos(r),s=Math.sin(r);return{real:i,imag:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3="->",gIe=/->/g,zV=",",UV="...";function N5(e,t){e=e.replace(/\s/g,"");const n=(e.length-e.replace(gIe,"").length)/u3.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${u3}").`);const[r,i]=e.split(u3);D(r.indexOf(UV)===-1,()=>`The ellipsis notation ("${UV}") is not supported yet.`);const s=r.split(zV),o=s.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<i.length;++h){const d=i[h];if(!s.some(p=>p.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let h=0;h<r.length;++h){const d=r[h];a.indexOf(d)===-1&&d!==zV&&a.push(d)}const u=new Array(s.length);for(let h=0;h<o;++h){if(new Set(s[h].split("")).size!==s[h].length)throw new Error(`Found duplicate axes in input component ${s[h]}. Support for duplicate axes in input is not implemented yet.`);u[h]=[];for(let d=0;d<s[h].length;++d)u[h].push(a.indexOf(s[h][d]))}const l=a.length,c=i.length,f=[];for(let h=c;h<l;++h)f.push(h);return{allDims:a,summedDims:f,idDims:u}}function F5(e,t){let n=new Array(e);n.fill(-1);for(let i=0;i<t.length;++i)n[t[i]]=i;const r=[];for(let i=0;i<e;++i)n[i]===-1&&r.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:r}}function O5(e,t,n){const r=new Array(e);for(let i=0;i<n.length;++i){const s=n[i].shape;for(let o=0;o<t[i].length;++o)r[t[i][o]]===void 0?r[t[i][o]]=s[o]:D(r[t[i][o]]===s[o],()=>`Expected dimension ${r[t[i][o]]} at axis ${o} of input shaped ${JSON.stringify(s)}, but got dimension ${s[o]}`)}}function R5(e,t){const n=e,r=[];let i=0;e.length===0&&n.push(-1),i=e.length+1;for(let o=0;o<i;++o)r.push([]);const s=[];for(let o=0;o<n.length;++o){const a=n[o],u=mIe(t,a);for(const l of u)s.indexOf(l)===-1&&(r[o].push(l),s.push(l))}return{path:n,steps:r}}function M5(e){return e.every((t,n)=>t===n)}function mIe(e,t){const n=[];for(let r=0;r<e.length;++r)(e[r].length===0||e[r].indexOf(t)!==-1||t===-1)&&n.push(r);return n}function L5(e,t,n=0){let r=[];if(typeof t=="number")D(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{const i=t.reduce((o,a)=>(a===-1&&(o+=1),o),0);D(i<=1,()=>"There should be only one negative value in split array.");const s=t.indexOf(-1);if(s!==-1){const o=t.reduce((a,u)=>u>0?a+u:a);t[s]=e.shape[n]-o}D(e.shape[n]===t.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yne(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function Kne(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function Zne(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jne(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function Qne(e,t){return`size ${e} must be non-negative, not ${t}`}function ere(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function tre(e,t){const n=Z(e),r=Z(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${e} outputShape= ${t}`}function nre(e,t){const n=Z(e),r=Z(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${e} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cM(){return"segment ids must be >= 0"}function rre(){return"segment ids are not increasing"}function ire(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function sre(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ore(e,t){let n=!1,r;for(e<=w5?(r=e,n=!0):r=Ok(e,Math.floor(Math.sqrt(e)));!n;)r>t||r===e?n=!0:r=Ok(e,r+1);return r}function are(e,t,n){const r=[],i=e.length;for(let s=0;s<i;s++)s!==t?r.push(e[s]):r.push(n);return r}function P5(e,t,n,r){const i=t.shape.length,s=e.shape.length;if(r!==0&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let f=0;f<r;++f)if(e.shape[f]!==t.shape[f])throw new Error(`x.shape[${f}]: ${e.shape[f]} should be equal to indices.shape[${f}]: ${t.shape[f]}.`);const o=e.shape[n],a=[];let u=1,l=1,c=1;for(let f=0;f<r;++f)a.push(e.shape[f]),u*=e.shape[f];for(let f=r;f<n;f++)a.push(e.shape[f]),l*=e.shape[f];for(let f=r;f<i;f++)a.push(t.shape[f]);for(let f=n+1;f<s;f++)a.push(e.shape[f]),c*=e.shape[f];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:o,outputShape:a}}const yIe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:P5,computeOutShape:are,segOpComputeOptimalWindowSize:ore},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rc(e){try{return e.map(t=>tc(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function ure(e){return e.map(t=>cu(t))}const lre=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:E5,ERF_A2:A5,ERF_A3:_5,ERF_A4:T5,ERF_A5:I5,ERF_P:k5,PARALLELIZE_THRESHOLD:w5,get RowPartitionType(){return na},SELU_SCALE:vI,SELU_SCALEALPHA:xI,applyActivation:cI,assertAndGetBroadcastShape:Ke,assertAxesAreInnerMostDims:Tr,assertParamsConsistent:v5,assignToTypedArray:Hne,axesAreInnerMostDims:TB,calculateShapes:Eh,checkEinsumDimSizes:O5,checkPadOnDimRoundingMode:Si,combineLocations:Rte,combineRaggedTensorToTensorShapes:Bne,complexWithEvenIndex:Vne,complexWithOddIndex:Gne,computeConv2DInfo:or,computeConv3DInfo:$h,computeDefaultPad:CB,computeDilation2DInfo:Bw,computeOptimalWindowSize:bI,computeOutAndReduceShapes:ar,computeOutShape:hu,computePool2DInfo:Ro,computePool3DInfo:pc,convertConv2DDataFormat:gc,decodeEinsumEquation:N5,eitherStridesOrDilationsAreOne:_r,expandShapeToKeepDim:Tn,exponent:Xne,exponents:qne,fromStringArrayToUint8:ure,fromUint8ToStringArray:rc,getAxesPermutation:xn,getBroadcastDims:yp,getComplexWithIndex:D5,getEinsumComputePath:R5,getEinsumPermutation:F5,getFusedBiasGradient:lI,getFusedDyActivation:uI,getImageCenter:$5,getInnerMostAxes:In,getPermuted:qw,getRaggedRank:Une,getReductionAxes:Mn,getReshaped:Hw,getReshapedPermuted:Xw,getRowPartitionTypesHelper:zne,getSliceBeginCoords:C5,getSliceSize:S5,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Yne,getSparseFillEmptyRowsNegativeIndexErrorMessage:Kne,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Zne,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:ere,getSparseReshapeInputOutputMismatchErrorMessage:nre,getSparseReshapeInputOutputMultipleErrorMessage:tre,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Jne,getSparseReshapeNegativeOutputDimErrorMessage:Qne,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:sre,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:cM,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:rre,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:ire,getUndoAxesPermutation:Ch,isIdentityPermutation:M5,log:bwe,mergeRealAndImagArrays:nc,prepareAndValidate:mI,prepareSplitSize:L5,segment_util:yIe,shouldFuse:fI,slice_util:Lne,splitRealAndImagArrays:Wne,stridesOrDilationsArePositive:mp,tupleValuesAreOne:Nf,upcastType:Bi,validateDefaultValueShape:jne,validateInput:oI,validateUpdateShape:e5,warn:Ps},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bIe=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:hI,nonMaxSuppressionV4Impl:dI,nonMaxSuppressionV5Impl:pI,whereImpl:aI},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */DTe();const xIe=Object.freeze(Object.defineProperty({__proto__:null,Abs:O2,Acos:Y0,Acosh:K0,AdadeltaOptimizer:o5,AdagradOptimizer:a5,AdamOptimizer:u5,AdamaxOptimizer:l5,Add:sg,AddN:R2,All:O_,Any:R_,ArgMax:M2,ArgMin:L2,Asin:Z0,Asinh:J0,Atan:Q0,Atan2:t1,Atanh:e1,AvgPool:P2,AvgPool3D:B2,AvgPool3DGrad:L_,AvgPoolGrad:M_,BatchMatMul:z2,BatchToSpaceND:U2,Bincount:P_,BitwiseAnd:j2,BroadcastArgs:B_,BroadcastTo:Aee,Cast:n1,Ceil:r1,ClipByValue:i1,Complex:z_,ComplexAbs:W2,Concat:V2,Conv2D:G2,Conv2DBackpropFilter:U_,Conv2DBackpropInput:H2,Conv3D:q2,Conv3DBackpropFilterV2:j_,Conv3DBackpropInputV2:W_,Cos:s1,Cosh:o1,CropAndResize:G_,Cumprod:V_,Cumsum:X2,DataStorage:oB,DenseBincount:H_,DepthToSpace:q_,DepthwiseConv2dNative:Y2,DepthwiseConv2dNativeBackpropFilter:X_,DepthwiseConv2dNativeBackpropInput:Y_,Diag:K_,Dilation2D:K2,Dilation2DBackpropFilter:Mk,Dilation2DBackpropInput:Rk,Draw:Z_,get ENV(){return cB},Einsum:J_,Elu:u1,EluGrad:Q_,Environment:kee,Equal:Z2,Erf:l1,Exp:c1,ExpandDims:J2,Expm1:f1,FFT:eT,Fill:tT,FlipLeftRight:nT,Floor:h1,FloorDiv:d1,FromPixels:Lk,FusedBatchNorm:Q2,FusedConv2D:Wx,FusedDepthwiseConv2D:Vx,GatherNd:rT,GatherV2:ew,Greater:tw,GreaterEqual:p1,IFFT:iT,Identity:g1,Imag:sT,IsFinite:m1,IsInf:y1,IsNan:b1,KernelBackend:T_,LRN:uw,LRNGrad:aT,LeakyRelu:nw,Less:rw,LessEqual:iw,LinSpace:oT,Log:x1,Log1p:v1,LogSoftmax:_ee,LogicalAnd:sw,LogicalNot:ow,LogicalOr:aw,LogicalXor:dwe,LowerBound:pwe,MatrixBandPart:gwe,Max:lw,MaxPool:cw,MaxPool3D:fw,MaxPool3DGrad:lT,MaxPoolGrad:uT,MaxPoolWithArgmax:cT,Maximum:w1,Mean:hw,Min:dw,Minimum:$1,MirrorPad:pw,Mod:C1,MomentumOptimizer:c5,Multinomial:fT,Multiply:S1,Neg:gw,NonMaxSuppressionV3:hT,NonMaxSuppressionV4:dT,NonMaxSuppressionV5:pT,NotEqual:mw,OP_SCOPE_SUFFIX:qee,OneHot:bw,OnesLike:yw,Optimizer:bc,OptimizerConstructors:Pne,Pack:xw,PadV2:vw,Pool:mwe,Pow:k1,Prelu:ww,Prod:$w,RMSPropOptimizer:f5,RaggedGather:gT,RaggedRange:mT,RaggedTensorToTensor:yT,Range:bT,get Rank(){return HR},Real:xT,RealDiv:a1,Reciprocal:E1,get Reduction(){return oi},Relu:A1,Relu6:_1,Reshape:Cw,ResizeBilinear:kw,ResizeBilinearGrad:wT,ResizeNearestNeighbor:Sw,ResizeNearestNeighborGrad:vT,Reverse:Ew,RotateWithOffset:PT,Round:T1,Rsqrt:I1,SGDOptimizer:gI,ScatterNd:$T,SearchSorted:ST,Select:Aw,Selu:D1,Sigmoid:R1,Sign:O1,Sin:N1,Sinh:F1,Slice:_w,Softmax:Nw,Softplus:M1,SpaceToBatchND:Iw,SparseFillEmptyRows:kT,SparseReshape:ET,SparseSegmentMean:AT,SparseSegmentSum:_T,SparseToDense:TT,SplitV:Dw,Sqrt:L1,Square:IT,SquaredDifference:P1,StaticRegexReplace:Fw,Step:W1,StridedSlice:DT,StringNGrams:NT,StringSplit:FT,StringToHashBucketFast:OT,Sub:B1,Sum:Tw,Tan:z1,Tanh:U1,Tensor:zt,TensorBuffer:Rn,TensorScatterUpdate:CT,Tile:j1,TopK:RT,Transform:MT,Transpose:Xd,Unique:LT,Unpack:Ow,UnsortedSegmentSum:Rw,UpperBound:ywe,Variable:qx,ZerosLike:Mw,_FusedMatMul:jx,abs:Bn,acos:lte,acosh:cte,add:ue,addN:J$e,all:$B,any:Uk,argMax:Xm,argMin:fte,asin:hte,asinh:dte,atan:pte,atan2:gte,atanh:mte,avgPool:UT,avgPool3d:yte,backend:bB,backend_util:lre,basicLSTMCell:wCe,batchNorm:zw,batchNorm2d:bte,batchNorm3d:xte,batchNorm4d:vte,batchToSpaceND:jT,bincount:wte,bitwiseAnd:ICe,booleanMaskAsync:EAe,broadcastArgs:NCe,broadcastTo:Im,broadcast_util:rSe,browser:aIe,buffer:nt,cast:ge,ceil:$te,clipByValue:ys,clone:yf,complex:If,concat:nr,concat1d:Cte,concat2d:Ste,concat3d:kte,concat4d:Ete,conv1d:SB,conv2d:Ff,conv2dTranspose:EB,conv3d:Ate,conv3dTranspose:Tte,copyRegisteredKernels:wwe,cos:WT,cosh:AB,cosineWindow:r5,cumprod:jk,cumsum:_B,customGrad:ku,denseBincount:iM,deprecationWarn:e$e,depthToSpace:Ite,depthwiseConv2d:Uw,device_util:Xwe,diag:tSe,dilation2d:Dte,disableDeprecationWarnings:Qwe,dispose:ot,disposeVariables:t$e,div:Oe,divNoNan:Nte,dot:Fte,dropout:cne,einsum:mm,elu:jw,enableDebugMode:Jwe,enableProdMode:Zwe,enclosingPowerOfTwo:fne,engine:Jo,ensureShape:hSe,env:q,equal:$a,erf:Ote,euclideanNorm:Lte,exp:bs,expandDims:si,expm1:Pte,eye:IB,fft:iI,fill:V1,findBackend:a$e,findBackendFactory:u$e,floor:Vw,floorDiv:wB,fused:XAe,gather:Gw,gatherND:MAe,gather_util:uIe,getBackend:Xee,getGradient:WR,getKernel:Hx,getKernelsForBackend:Pk,grad:USe,grads:jSe,greater:Ds,greaterEqual:Sh,ifft:nv,imag:VT,image:au,inTopKAsync:zAe,io:YTe,irfft:JB,isFinite:Bte,isInf:zte,isNaN:Ute,keep:ga,kernel_impls:bIe,leakyRelu:GT,less:Jx,lessEqual:ag,linalg:xne,linspace:jte,localResponseNormalization:Wte,log:Hs,log1p:HT,logSigmoid:Gte,logSoftmax:DB,logSumExp:XT,logicalAnd:Eu,logicalNot:YT,logicalOr:NB,logicalXor:Hte,losses:vne,lowerBound:nke,matMul:st,math:JTe,max:Co,maxPool:KT,maxPool3d:qte,maxPoolWithArgmax:oke,maximum:mc,mean:wn,memory:zk,meshgrid:lke,min:Zx,minimum:bp,mirrorPad:Xte,mod:Yte,moments:ZT,movingAverage:TAe,mul:j,multiRNNCell:gke,multinomial:yke,neg:rn,nextFrame:x5,norm:Ww,notEqual:Km,oneHot:Qx,ones:fs,onesLike:qs,op:U,outerProduct:$ke,pad:kh,pad1d:kke,pad2d:Ake,pad3d:Tke,pad4d:Dke,pool:Kte,pow:Of,prelu:QT,print:ute,prod:Zte,profile:n$e,raggedGather:Bke,raggedRange:Uke,raggedTensorToTensor:Wke,rand:Gke,randomGamma:wEe,randomNormal:WB,randomStandardNormal:SEe,randomUniform:lg,randomUniformInt:AEe,range:Zm,ready:s$e,real:ev,reciprocal:tne,registerBackend:yB,registerGradient:Tee,registerKernel:BT,relu:ju,relu6:VB,removeBackend:o$e,reshape:V,reverse:Eo,reverse1d:OEe,reverse2d:MEe,reverse3d:PEe,reverse4d:zEe,rfft:sI,round:GB,rsqrt:HB,scalar:Ve,scatterND:DAe,scatter_util:gAe,searchSorted:FB,selu:qB,separableConv2d:XB,serialization:TTe,setBackend:i$e,setPlatform:l$e,setdiff1dAsync:HEe,sigmoid:fu,sign:nne,signal:STe,sin:YB,sinh:KB,slice:xt,slice1d:tI,slice2d:ZB,slice3d:nI,slice4d:tv,slice_util:Lne,softmax:rI,softplus:G1,spaceToBatchND:JT,sparse:kTe,sparseToDense:OAe,spectral:CTe,split:gs,sqrt:Vr,square:Gt,squaredDifference:QB,squeeze:cg,stack:Au,step:H1,stridedSlice:rne,string:ETe,sub:ke,sum:_e,sumOutType:zT,tan:ine,tanh:Ym,tensor:Yd,tensor1d:li,tensor2d:ql,tensor3d:sne,tensor4d:hAe,tensor5d:dAe,tensor6d:pAe,tensorScatterUpdate:yAe,tensor_util:Wwe,test_util:yEe,tidy:X,tile:ho,time:r$e,topk:one,train:vl,transpose:dt,truncatedNormal:t5,unique:ane,unregisterGradient:vwe,unregisterKernel:xwe,unsortedSegmentSum:n5,unstack:Rf,upcastType:Bi,upperBound:CAe,util:Iwe,valueAndGrad:WSe,valueAndGrads:VSe,variable:une,variableGrads:Vte,version_core:dIe,where:jr,whereAsync:lne,zeros:zn,zerosLike:mt},Symbol.toStringTag,{value:"Module"})),cre=tg(xIe);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.abs=function(){return this.throwIfDisposed(),Bn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.acos=function(){return this.throwIfDisposed(),lte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.acosh=function(){return this.throwIfDisposed(),cte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.add=function(e){return this.throwIfDisposed(),ue(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.all=function(e,t){return this.throwIfDisposed(),$B(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.any=function(e,t){return this.throwIfDisposed(),Uk(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.argMax=function(e){return this.throwIfDisposed(),Xm(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.argMin=function(e){return this.throwIfDisposed(),fte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.asScalar=function(){return this.throwIfDisposed(),D(this.size===1,()=>"The array must have only 1 element."),V(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.asType=function(e){return this.throwIfDisposed(),ge(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.as1D=function(){return this.throwIfDisposed(),V(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.as2D=function(e,t){return this.throwIfDisposed(),V(this,[e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),V(this,[e,t,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),V(this,[e,t,n,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),V(this,[e,t,n,r,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.asin=function(){return this.throwIfDisposed(),hte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.asinh=function(){return this.throwIfDisposed(),dte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.atan=function(){return this.throwIfDisposed(),pte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.atan2=function(e){return this.throwIfDisposed(),gte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.atanh=function(){return this.throwIfDisposed(),mte(this)};J().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),UT(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),jT(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),zw(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Im(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.cast=function(e){return this.throwIfDisposed(),ge(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.ceil=function(){return this.throwIfDisposed(),$te(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ys(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof zt&&(e=[e]),nr([this,...e],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.conv1d=function(e,t,n,r,i,s){return this.throwIfDisposed(),SB(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),EB(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.conv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),Ff(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.cos=function(){return this.throwIfDisposed(),WT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.cosh=function(){return this.throwIfDisposed(),AB(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),jk(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),_B(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Ite(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.depthwiseConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),Uw(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),Dte(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.divNoNan=function(e){return this.throwIfDisposed(),Nte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.div=function(e){return this.throwIfDisposed(),Oe(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.dot=function(e){return this.throwIfDisposed(),Fte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.elu=function(){return this.throwIfDisposed(),jw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.equal=function(e){return this.throwIfDisposed(),$a(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.erf=function(){return this.throwIfDisposed(),Ote(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Lte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.exp=function(){return this.throwIfDisposed(),bs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.expandDims=function(e){return this.throwIfDisposed(),si(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.expm1=function(){return this.throwIfDisposed(),Pte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.fft=function(){return this.throwIfDisposed(),iI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.flatten=function(){return this.throwIfDisposed(),V(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.floor=function(){return this.throwIfDisposed(),Vw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.floorDiv=function(e){return this.throwIfDisposed(),wB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Gw(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Sh(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.greater=function(e){return this.throwIfDisposed(),Ds(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.ifft=function(){return this.throwIfDisposed(),nv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.irfft=function(){return this.throwIfDisposed(),JB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.isFinite=function(){return this.throwIfDisposed(),Bte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.isInf=function(){return this.throwIfDisposed(),zte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.isNaN=function(){return this.throwIfDisposed(),Ute(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.leakyRelu=function(e){return this.throwIfDisposed(),GT(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.lessEqual=function(e){return this.throwIfDisposed(),ag(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.less=function(e){return this.throwIfDisposed(),Jx(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Wte(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.logSigmoid=function(){return this.throwIfDisposed(),Gte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.logSoftmax=function(e){return this.throwIfDisposed(),DB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),XT(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.log=function(){return this.throwIfDisposed(),Hs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.log1p=function(){return this.throwIfDisposed(),HT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Eu(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.logicalNot=function(){return this.throwIfDisposed(),YT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.logicalOr=function(e){return this.throwIfDisposed(),NB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.logicalXor=function(e){return this.throwIfDisposed(),Hte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),st(this,e,t,n)};J().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),KT(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.max=function(e,t){return this.throwIfDisposed(),Co(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.maximum=function(e){return this.throwIfDisposed(),mc(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.mean=function(e,t){return this.throwIfDisposed(),wn(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.min=function(e,t){return this.throwIfDisposed(),Zx(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.minimum=function(e){return this.throwIfDisposed(),bp(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Xte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.mod=function(e){return this.throwIfDisposed(),Yte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.mul=function(e){return this.throwIfDisposed(),j(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.neg=function(){return this.throwIfDisposed(),rn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Ww(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.notEqual=function(e){return this.throwIfDisposed(),Km(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),Qx(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.onesLike=function(){return this.throwIfDisposed(),qs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.pad=function(e,t){return this.throwIfDisposed(),kh(this,e,t)};J().prototype.pool=function(e,t,n,r,i,s){return this.throwIfDisposed(),Kte(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.pow=function(e){return this.throwIfDisposed(),Of(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.prelu=function(e){return this.throwIfDisposed(),QT(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.prod=function(e,t){return this.throwIfDisposed(),Zte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.reciprocal=function(){return this.throwIfDisposed(),tne(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.relu=function(){return this.throwIfDisposed(),ju(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.relu6=function(){return this.throwIfDisposed(),VB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.reshapeAs=function(e){return this.throwIfDisposed(),V(this,e.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.reshape=function(e){return this.throwIfDisposed(),V(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),yne(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),bne(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.reverse=function(e){return this.throwIfDisposed(),Eo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.rfft=function(){return this.throwIfDisposed(),sI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.round=function(){return this.throwIfDisposed(),GB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.rsqrt=function(){return this.throwIfDisposed(),HB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.selu=function(){return this.throwIfDisposed(),qB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.separableConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),XB(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.sigmoid=function(){return this.throwIfDisposed(),fu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.sign=function(){return this.throwIfDisposed(),nne(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.sin=function(){return this.throwIfDisposed(),YB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.sinh=function(){return this.throwIfDisposed(),KB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.slice=function(e,t){return this.throwIfDisposed(),xt(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.softmax=function(e){return this.throwIfDisposed(),rI(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.softplus=function(){return this.throwIfDisposed(),G1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),JT(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.split=function(e,t){return this.throwIfDisposed(),gs(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.sqrt=function(){return this.throwIfDisposed(),Vr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.square=function(){return this.throwIfDisposed(),Gt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.squaredDifference=function(e){return this.throwIfDisposed(),QB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.squeeze=function(e){return this.throwIfDisposed(),cg(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof zt?[this,e]:[this,...e];return Au(n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.step=function(e){return this.throwIfDisposed(),H1(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.stridedSlice=function(e,t,n,r,i,s,o,a){return this.throwIfDisposed(),rne(this,e,t,n,r,i,s,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.sub=function(e){return this.throwIfDisposed(),ke(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.sum=function(e,t){return this.throwIfDisposed(),_e(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.tan=function(){return this.throwIfDisposed(),ine(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.tanh=function(){return this.throwIfDisposed(),Ym(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.tile=function(e){return this.throwIfDisposed(),ho(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.toBool=function(){return this.throwIfDisposed(),ge(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.toFloat=function(){return this.throwIfDisposed(),ge(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.toInt=function(){return this.throwIfDisposed(),ge(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.topk=function(e,t){return this.throwIfDisposed(),one(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.transpose=function(e){return this.throwIfDisposed(),dt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.unique=function(e){return this.throwIfDisposed(),ane(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),n5(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.unstack=function(e){return this.throwIfDisposed(),Rf(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.where=function(e,t){return this.throwIfDisposed(),jr(e,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().prototype.zerosLike=function(){return this.throwIfDisposed(),mt(this)};var B5={};/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var vIe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),wIe=Object.prototype.hasOwnProperty;function fM(e,t){return wIe.call(e,t)}function hM(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)fM(e,i)&&r.push(i);return r}function zs(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function dM(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function gd(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function fre(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function pM(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(pM(e[t]))return!0}else if(typeof e=="object"){for(var r=hM(e),i=r.length,s=0;s<i;s++)if(pM(e[r[s]]))return!0}}return!1}function jV(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var hre=function(e){vIe(t,e);function t(n,r,i,s,o){var a=this.constructor,u=e.call(this,jV(n,{name:r,index:i,operation:s,tree:o}))||this;return u.name=r,u.index=i,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=jV(n,{name:r,index:i,operation:s,tree:o}),u}return t}(Error),kn=hre,$Ie=zs,wm={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Wk(n,this.path);r&&(r=zs(r));var i=Kd(n,{op:"remove",path:this.from}).removed;return Kd(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Wk(n,this.from);return Kd(n,{op:"add",path:this.path,value:zs(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:rv(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},CIe={add:function(e,t,n){return dM(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:wm.move,copy:wm.copy,test:wm.test,_get:wm._get};function Wk(e,t){if(t=="")return e;var n={op:"_get",path:t};return Kd(e,n),n.value}function Kd(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Vk(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Wk(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=rv(e,t.value),o.test===!1)throw new kn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new kn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=zs(e));var a=t.path||"",u=a.split("/"),l=e,c=1,f=u.length,h=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=Vk;;){if(d=u[c],d&&d.indexOf("~")!=-1&&(d=fre(d)),i&&(d=="__proto__"||d=="prototype"&&c>0&&u[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&h===void 0&&(l[d]===void 0?h=u.slice(0,c).join("/"):c==f-1&&(h=t.path),h!==void 0&&p(t,0,e,h)),c++,Array.isArray(l)){if(d==="-")d=l.length;else{if(n&&!dM(d))throw new kn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);dM(d)&&(d=~~d)}if(c>=f){if(n&&t.op==="add"&&d>l.length)throw new kn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=CIe[t.op].call(t,l,d,e);if(o.test===!1)throw new kn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(c>=f){var o=wm[t.op].call(t,l,d,e);if(o.test===!1)throw new kn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[d],n&&c<f&&(!l||typeof l!="object"))throw new kn("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function wI(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new kn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=zs(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Kd(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function SIe(e,t,n){var r=Kd(e,t);if(r.test===!1)throw new kn("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Vk(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new kn("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(wm[e.op]){if(typeof e.path!="string")throw new kn("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new kn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new kn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new kn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&pM(e.value))throw new kn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new kn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new kn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=dre([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new kn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new kn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function dre(e,t,n){try{if(!Array.isArray(e))throw new kn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)wI(zs(t),zs(e),n||!0);else{n=n||Vk;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof kn)return i;throw i}}function rv(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!rv(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!rv(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}const kIe=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:kn,_areEquals:rv,applyOperation:Kd,applyPatch:wI,applyReducer:SIe,deepClone:$Ie,getValueByPointer:Wk,validate:dre,validator:Vk},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var z5=new WeakMap,EIe=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),AIe=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function _Ie(e){return z5.get(e)}function TIe(e,t){return e.observers.get(t)}function IIe(e,t){e.observers.delete(t.callback)}function DIe(e,t){t.unobserve()}function NIe(e,t){var n=[],r,i=_Ie(e);if(!i)i=new EIe(e),z5.set(e,i);else{var s=TIe(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=zs(e),t){r.callback=t,r.next=null;var o=function(){gM(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){gM(r),clearTimeout(r.next),IIe(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new AIe(t,r)),r}function gM(e,t){t===void 0&&(t=!1);var n=z5.get(e.object);U5(n.value,e.object,e.patches,"",t),e.patches.length&&wI(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function U5(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=hM(t),o=hM(e),a=!1,u=o.length-1;u>=0;u--){var l=o[u],c=e[l];if(fM(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?U5(c,f,n,r+"/"+gd(l),i):c!==f&&(i&&n.push({op:"test",path:r+"/"+gd(l),value:zs(c)}),n.push({op:"replace",path:r+"/"+gd(l),value:zs(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+gd(l),value:zs(c)}),n.push({op:"remove",path:r+"/"+gd(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var l=s[u];!fM(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+gd(l),value:zs(t[l])})}}}function FIe(e,t,n){n===void 0&&(n=!1);var r=[];return U5(e,t,r,"",n),r}const OIe=Object.freeze(Object.defineProperty({__proto__:null,compare:FIe,generate:gM,observe:NIe,unobserve:DIe},Symbol.toStringTag,{value:"Module"}));Object.assign({},kIe,OIe,{JsonPatchError:hre,deepClone:zs,escapePathComponent:gd,unescapePathComponent:fre});var RIe=/("(?:[^\\"]|\\.)*")|[:,]/g,MIe=function(t,n){var r,i,s;return n=n||{},r=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),i=r===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,u,l){var c,f,h,d,p,g,m,y,b,v,x,w;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),x=JSON.stringify(a,s),x===void 0)return x;if(m=i-u.length-l,x.length<=m&&(b=x.replace(RIe,function(C,$){return $||C+" "}),b.length<=m))return b;if(s!=null&&(a=JSON.parse(x),s=void 0),typeof a=="object"&&a!==null){if(y=u+r,h=[],f=0,Array.isArray(a))for(v="[",c="]",m=a.length;f<m;f++)h.push(o(a[f],y,f===m-1?0:1)||"null");else for(v="{",c="}",g=Object.keys(a),m=g.length;f<m;f++)d=g[f],p=JSON.stringify(d)+": ",w=o(a[d],y,p.length+(f===m-1?0:1)),w!==void 0&&h.push(p+w);if(h.length>0)return[v,r+h.join(`,
`+y),c].join(`
`+u)}return x}(t,"",0)};const l3=F2(MIe);var mM={exports:{}};const LIe="2.0.0",pre=256,PIe=Number.MAX_SAFE_INTEGER||9007199254740991,BIe=16,zIe=pre-6,UIe=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var $I={MAX_LENGTH:pre,MAX_SAFE_COMPONENT_LENGTH:BIe,MAX_SAFE_BUILD_LENGTH:zIe,MAX_SAFE_INTEGER:PIe,RELEASE_TYPES:UIe,SEMVER_SPEC_VERSION:LIe,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},c3={};const jIe=typeof process=="object"&&c3&&c3.NODE_DEBUG&&/\bsemver\b/i.test(c3.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var CI=jIe;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=$I,s=CI;t=e.exports={};const o=t.re=[],a=t.safeRe=[],u=t.src=[],l=t.t={};let c=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[f,r]],d=g=>{for(const[m,y]of h)g=g.split(`${m}*`).join(`${m}{0,${y}}`).split(`${m}+`).join(`${m}{1,${y}}`);return g},p=(g,m,y)=>{const b=d(m),v=c++;s(g,v,m),l[g]=v,u[v]=m,o[v]=new RegExp(m,y?"g":void 0),a[v]=new RegExp(b,y?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),p("MAINVERSION",`(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${u[l.NUMERICIDENTIFIER]}|${u[l.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${u[l.NUMERICIDENTIFIERLOOSE]}|${u[l.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${u[l.PRERELEASEIDENTIFIER]}(?:\\.${u[l.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${u[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[l.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${f}+`),p("BUILD",`(?:\\+(${u[l.BUILDIDENTIFIER]}(?:\\.${u[l.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${u[l.MAINVERSION]}${u[l.PRERELEASE]}?${u[l.BUILD]}?`),p("FULL",`^${u[l.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${u[l.MAINVERSIONLOOSE]}${u[l.PRERELEASELOOSE]}?${u[l.BUILD]}?`),p("LOOSE",`^${u[l.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${u[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${u[l.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:${u[l.PRERELEASE]})?${u[l.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:${u[l.PRERELEASELOOSE]})?${u[l.BUILD]}?)?)?`),p("XRANGE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),p("COERCE",`${u[l.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",u[l.COERCEPLAIN]+`(?:${u[l.PRERELEASE]})?(?:${u[l.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",u[l.COERCE],!0),p("COERCERTLFULL",u[l.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${u[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",p("TILDE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${u[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",p("CARET",`^${u[l.LONECARET]}${u[l.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${u[l.LONECARET]}${u[l.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${u[l.GTLT]}\\s*(${u[l.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]}|${u[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${u[l.XRANGEPLAIN]})\\s+-\\s+(${u[l.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${u[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[l.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(mM,mM.exports);var Yw=mM.exports;const WIe=Object.freeze({loose:!0}),VIe=Object.freeze({}),GIe=e=>e?typeof e!="object"?WIe:e:VIe;var j5=GIe;const WV=/^[0-9]+$/,gre=(e,t)=>{const n=WV.test(e),r=WV.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1},HIe=(e,t)=>gre(t,e);var mre={compareIdentifiers:gre,rcompareIdentifiers:HIe};const IC=CI,{MAX_LENGTH:VV,MAX_SAFE_INTEGER:DC}=$I,{safeRe:GV,t:HV}=Yw,qIe=j5,{compareIdentifiers:Zg}=mre;let XIe=class Xa{constructor(t,n){if(n=qIe(n),t instanceof Xa){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>VV)throw new TypeError(`version is longer than ${VV} characters`);IC("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=t.trim().match(n.loose?GV[HV.LOOSE]:GV[HV.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>DC||this.major<0)throw new TypeError("Invalid major version");if(this.minor>DC||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>DC||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const s=+i;if(s>=0&&s<DC)return s}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(IC("SemVer.compare",this.version,this.options,t),!(t instanceof Xa)){if(typeof t=="string"&&t===this.version)return 0;t=new Xa(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof Xa||(t=new Xa(t,this.options)),Zg(this.major,t.major)||Zg(this.minor,t.minor)||Zg(this.patch,t.patch)}comparePre(t){if(t instanceof Xa||(t=new Xa(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const r=this.prerelease[n],i=t.prerelease[n];if(IC("prerelease compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Zg(r,i)}while(++n)}compareBuild(t){t instanceof Xa||(t=new Xa(t,this.options));let n=0;do{const r=this.build[n],i=t.build[n];if(IC("prerelease compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Zg(r,i)}while(++n)}inc(t,n,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(r)?1:0;if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(n){let s=[n,i];r===!1&&(s=[n]),Zg(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var qi=XIe;const qV=qi,YIe=(e,t,n=!1)=>{if(e instanceof qV)return e;try{return new qV(e,t)}catch(r){if(!n)return null;throw r}};var X1=YIe;const KIe=X1,ZIe=(e,t)=>{const n=KIe(e,t);return n?n.version:null};var JIe=ZIe;const QIe=X1,eDe=(e,t)=>{const n=QIe(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var tDe=eDe;const XV=qi,nDe=(e,t,n,r,i)=>{typeof n=="string"&&(i=r,r=n,n=void 0);try{return new XV(e instanceof XV?e.version:e,n).inc(t,r,i).version}catch{return null}};var rDe=nDe;const YV=X1,iDe=(e,t)=>{const n=YV(e,null,!0),r=YV(t,null,!0),i=n.compare(r);if(i===0)return null;const s=i>0,o=s?n:r,a=s?r:n,u=!!o.prerelease.length;if(!!a.prerelease.length&&!u)return!a.patch&&!a.minor?"major":o.patch?"patch":o.minor?"minor":"major";const c=u?"pre":"";return n.major!==r.major?c+"major":n.minor!==r.minor?c+"minor":n.patch!==r.patch?c+"patch":"prerelease"};var sDe=iDe;const oDe=qi,aDe=(e,t)=>new oDe(e,t).major;var uDe=aDe;const lDe=qi,cDe=(e,t)=>new lDe(e,t).minor;var fDe=cDe;const hDe=qi,dDe=(e,t)=>new hDe(e,t).patch;var pDe=dDe;const gDe=X1,mDe=(e,t)=>{const n=gDe(e,t);return n&&n.prerelease.length?n.prerelease:null};var yDe=mDe;const KV=qi,bDe=(e,t,n)=>new KV(e,n).compare(new KV(t,n));var Da=bDe;const xDe=Da,vDe=(e,t,n)=>xDe(t,e,n);var wDe=vDe;const $De=Da,CDe=(e,t)=>$De(e,t,!0);var SDe=CDe;const ZV=qi,kDe=(e,t,n)=>{const r=new ZV(e,n),i=new ZV(t,n);return r.compare(i)||r.compareBuild(i)};var W5=kDe;const EDe=W5,ADe=(e,t)=>e.sort((n,r)=>EDe(n,r,t));var _De=ADe;const TDe=W5,IDe=(e,t)=>e.sort((n,r)=>TDe(r,n,t));var DDe=IDe;const NDe=Da,FDe=(e,t,n)=>NDe(e,t,n)>0;var SI=FDe;const ODe=Da,RDe=(e,t,n)=>ODe(e,t,n)<0;var V5=RDe;const MDe=Da,LDe=(e,t,n)=>MDe(e,t,n)===0;var yre=LDe;const PDe=Da,BDe=(e,t,n)=>PDe(e,t,n)!==0;var bre=BDe;const zDe=Da,UDe=(e,t,n)=>zDe(e,t,n)>=0;var G5=UDe;const jDe=Da,WDe=(e,t,n)=>jDe(e,t,n)<=0;var H5=WDe;const VDe=yre,GDe=bre,HDe=SI,qDe=G5,XDe=V5,YDe=H5,KDe=(e,t,n,r)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return VDe(e,n,r);case"!=":return GDe(e,n,r);case">":return HDe(e,n,r);case">=":return qDe(e,n,r);case"<":return XDe(e,n,r);case"<=":return YDe(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};var xre=KDe;const ZDe=qi,JDe=X1,{safeRe:NC,t:FC}=Yw,QDe=(e,t)=>{if(e instanceof ZDe)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(t.includePrerelease?NC[FC.COERCEFULL]:NC[FC.COERCE]);else{const u=t.includePrerelease?NC[FC.COERCERTLFULL]:NC[FC.COERCERTL];let l;for(;(l=u.exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||l.index+l[0].length!==n.index+n[0].length)&&(n=l),u.lastIndex=l.index+l[1].length+l[2].length;u.lastIndex=-1}if(n===null)return null;const r=n[2],i=n[3]||"0",s=n[4]||"0",o=t.includePrerelease&&n[5]?`-${n[5]}`:"",a=t.includePrerelease&&n[6]?`+${n[6]}`:"";return JDe(`${r}.${i}.${s}${o}${a}`,t)};var eNe=QDe,f3,JV;function tNe(){return JV||(JV=1,f3=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),f3}var nNe=At;At.Node=vp;At.create=At;function At(e){var t=this;if(t instanceof At||(t=new At),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(i){t.push(i)});else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}At.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};At.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};At.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};At.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)iNe(this,arguments[e]);return this.length};At.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)sNe(this,arguments[e]);return this.length};At.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};At.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};At.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;n!==null;r++)e.call(t,n.value,r,this),n=n.next};At.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;n!==null;r--)e.call(t,n.value,r,this),n=n.prev};At.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};At.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};At.prototype.map=function(e,t){t=t||this;for(var n=new At,r=this.head;r!==null;)n.push(e.call(t,r.value,this)),r=r.next;return n};At.prototype.mapReverse=function(e,t){t=t||this;for(var n=new At,r=this.tail;r!==null;)n.push(e.call(t,r.value,this)),r=r.prev;return n};At.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else if(this.head)r=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;r!==null;i++)n=e(n,r.value,i),r=r.next;return n};At.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else if(this.tail)r=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;r!==null;i--)n=e(n,r.value,i),r=r.prev;return n};At.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};At.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};At.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new At;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,i=this.head;i!==null&&r<e;r++)i=i.next;for(;i!==null&&r<t;r++,i=i.next)n.push(i.value);return n};At.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new At;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,i=this.tail;i!==null&&r>t;r--)i=i.prev;for(;i!==null&&r>e;r--,i=i.prev)n.push(i.value);return n};At.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;i!==null&&r<e;r++)i=i.next;for(var s=[],r=0;i&&r<t;r++)s.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var r=0;r<n.length;r++)i=rNe(this,i,n[r]);return s};At.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};function rNe(e,t,n){var r=t===e.head?new vp(n,null,t,e):new vp(n,t,t.next,e);return r.next===null&&(e.tail=r),r.prev===null&&(e.head=r),e.length++,r}function iNe(e,t){e.tail=new vp(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function sNe(e,t){e.head=new vp(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function vp(e,t,n,r){if(!(this instanceof vp))return new vp(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{tNe()(At)}catch{}const oNe=nNe,wd=Symbol("max"),wl=Symbol("length"),Jg=Symbol("lengthCalculator"),dx=Symbol("allowStale"),Md=Symbol("maxAge"),bl=Symbol("dispose"),QV=Symbol("noDisposeOnSet"),dr=Symbol("lruList"),Ko=Symbol("cache"),vre=Symbol("updateAgeOnGet"),h3=()=>1;class aNe{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[wd]=t.max||1/0;const n=t.length||h3;if(this[Jg]=typeof n!="function"?h3:n,this[dx]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[Md]=t.maxAge||0,this[bl]=t.dispose,this[QV]=t.noDisposeOnSet||!1,this[vre]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[wd]=t||1/0,Xy(this)}get max(){return this[wd]}set allowStale(t){this[dx]=!!t}get allowStale(){return this[dx]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[Md]=t,Xy(this)}get maxAge(){return this[Md]}set lengthCalculator(t){typeof t!="function"&&(t=h3),t!==this[Jg]&&(this[Jg]=t,this[wl]=0,this[dr].forEach(n=>{n.length=this[Jg](n.value,n.key),this[wl]+=n.length})),Xy(this)}get lengthCalculator(){return this[Jg]}get length(){return this[wl]}get itemCount(){return this[dr].length}rforEach(t,n){n=n||this;for(let r=this[dr].tail;r!==null;){const i=r.prev;eG(this,t,r,n),r=i}}forEach(t,n){n=n||this;for(let r=this[dr].head;r!==null;){const i=r.next;eG(this,t,r,n),r=i}}keys(){return this[dr].toArray().map(t=>t.key)}values(){return this[dr].toArray().map(t=>t.value)}reset(){this[bl]&&this[dr]&&this[dr].length&&this[dr].forEach(t=>this[bl](t.key,t.value)),this[Ko]=new Map,this[dr]=new oNe,this[wl]=0}dump(){return this[dr].map(t=>Gk(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[dr]}set(t,n,r){if(r=r||this[Md],r&&typeof r!="number")throw new TypeError("maxAge must be a number");const i=r?Date.now():0,s=this[Jg](n,t);if(this[Ko].has(t)){if(s>this[wd])return Dm(this,this[Ko].get(t)),!1;const u=this[Ko].get(t).value;return this[bl]&&(this[QV]||this[bl](t,u.value)),u.now=i,u.maxAge=r,u.value=n,this[wl]+=s-u.length,u.length=s,this.get(t),Xy(this),!0}const o=new uNe(t,n,s,i,r);return o.length>this[wd]?(this[bl]&&this[bl](t,n),!1):(this[wl]+=o.length,this[dr].unshift(o),this[Ko].set(t,this[dr].head),Xy(this),!0)}has(t){if(!this[Ko].has(t))return!1;const n=this[Ko].get(t).value;return!Gk(this,n)}get(t){return d3(this,t,!0)}peek(t){return d3(this,t,!1)}pop(){const t=this[dr].tail;return t?(Dm(this,t),t.value):null}del(t){Dm(this,this[Ko].get(t))}load(t){this.reset();const n=Date.now();for(let r=t.length-1;r>=0;r--){const i=t[r],s=i.e||0;if(s===0)this.set(i.k,i.v);else{const o=s-n;o>0&&this.set(i.k,i.v,o)}}}prune(){this[Ko].forEach((t,n)=>d3(this,n,!1))}}const d3=(e,t,n)=>{const r=e[Ko].get(t);if(r){const i=r.value;if(Gk(e,i)){if(Dm(e,r),!e[dx])return}else n&&(e[vre]&&(r.value.now=Date.now()),e[dr].unshiftNode(r));return i.value}},Gk=(e,t)=>{if(!t||!t.maxAge&&!e[Md])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Md]&&n>e[Md]},Xy=e=>{if(e[wl]>e[wd])for(let t=e[dr].tail;e[wl]>e[wd]&&t!==null;){const n=t.prev;Dm(e,t),t=n}},Dm=(e,t)=>{if(t){const n=t.value;e[bl]&&e[bl](n.key,n.value),e[wl]-=n.length,e[Ko].delete(n.key),e[dr].removeNode(t)}};let uNe=class{constructor(t,n,r,i,s){this.key=t,this.value=n,this.length=r,this.now=i,this.maxAge=s||0}};const eG=(e,t,n,r)=>{let i=n.value;Gk(e,i)&&(Dm(e,n),e[dx]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};var lNe=aNe,p3,tG;function Na(){if(tG)return p3;tG=1;class e{constructor(I,T){if(T=r(T),I instanceof e)return I.loose===!!T.loose&&I.includePrerelease===!!T.includePrerelease?I:new e(I.raw,T);if(I instanceof i)return this.raw=I.value,this.set=[[I]],this.format(),this;if(this.options=T,this.loose=!!T.loose,this.includePrerelease=!!T.includePrerelease,this.raw=I.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(O=>this.parseRange(O.trim())).filter(O=>O.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const O=this.set[0];if(this.set=this.set.filter(L=>!p(L[0])),this.set.length===0)this.set=[O];else if(this.set.length>1){for(const L of this.set)if(L.length===1&&g(L[0])){this.set=[L];break}}}this.format()}format(){return this.range=this.set.map(I=>I.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(I){const O=((this.options.includePrerelease&&h)|(this.options.loose&&d))+":"+I,L=n.get(O);if(L)return L;const M=this.options.loose,P=M?a[u.HYPHENRANGELOOSE]:a[u.HYPHENRANGE];I=I.replace(P,A(this.options.includePrerelease)),s("hyphen replace",I),I=I.replace(a[u.COMPARATORTRIM],l),s("comparator trim",I),I=I.replace(a[u.TILDETRIM],c),s("tilde trim",I),I=I.replace(a[u.CARETTRIM],f),s("caret trim",I);let G=I.split(" ").map(ne=>y(ne,this.options)).join(" ").split(/\s+/).map(ne=>E(ne,this.options));M&&(G=G.filter(ne=>(s("loose invalid filter",ne,this.options),!!ne.match(a[u.COMPARATORLOOSE])))),s("range list",G);const H=new Map,Q=G.map(ne=>new i(ne,this.options));for(const ne of Q){if(p(ne))return[ne];H.set(ne.value,ne)}H.size>1&&H.has("")&&H.delete("");const te=[...H.values()];return n.set(O,te),te}intersects(I,T){if(!(I instanceof e))throw new TypeError("a Range is required");return this.set.some(O=>m(O,T)&&I.set.some(L=>m(L,T)&&O.every(M=>L.every(P=>M.intersects(P,T)))))}test(I){if(!I)return!1;if(typeof I=="string")try{I=new o(I,this.options)}catch{return!1}for(let T=0;T<this.set.length;T++)if(F(this.set[T],I,this.options))return!0;return!1}}p3=e;const t=lNe,n=new t({max:1e3}),r=j5,i=kI(),s=CI,o=qi,{safeRe:a,t:u,comparatorTrimReplace:l,tildeTrimReplace:c,caretTrimReplace:f}=Yw,{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:d}=$I,p=_=>_.value==="<0.0.0-0",g=_=>_.value==="",m=(_,I)=>{let T=!0;const O=_.slice();let L=O.pop();for(;T&&O.length;)T=O.every(M=>L.intersects(M,I)),L=O.pop();return T},y=(_,I)=>(s("comp",_,I),_=w(_,I),s("caret",_),_=v(_,I),s("tildes",_),_=$(_,I),s("xrange",_),_=k(_,I),s("stars",_),_),b=_=>!_||_.toLowerCase()==="x"||_==="*",v=(_,I)=>_.trim().split(/\s+/).map(T=>x(T,I)).join(" "),x=(_,I)=>{const T=I.loose?a[u.TILDELOOSE]:a[u.TILDE];return _.replace(T,(O,L,M,P,G)=>{s("tilde",_,O,L,M,P,G);let H;return b(L)?H="":b(M)?H=`>=${L}.0.0 <${+L+1}.0.0-0`:b(P)?H=`>=${L}.${M}.0 <${L}.${+M+1}.0-0`:G?(s("replaceTilde pr",G),H=`>=${L}.${M}.${P}-${G} <${L}.${+M+1}.0-0`):H=`>=${L}.${M}.${P} <${L}.${+M+1}.0-0`,s("tilde return",H),H})},w=(_,I)=>_.trim().split(/\s+/).map(T=>C(T,I)).join(" "),C=(_,I)=>{s("caret",_,I);const T=I.loose?a[u.CARETLOOSE]:a[u.CARET],O=I.includePrerelease?"-0":"";return _.replace(T,(L,M,P,G,H)=>{s("caret",_,L,M,P,G,H);let Q;return b(M)?Q="":b(P)?Q=`>=${M}.0.0${O} <${+M+1}.0.0-0`:b(G)?M==="0"?Q=`>=${M}.${P}.0${O} <${M}.${+P+1}.0-0`:Q=`>=${M}.${P}.0${O} <${+M+1}.0.0-0`:H?(s("replaceCaret pr",H),M==="0"?P==="0"?Q=`>=${M}.${P}.${G}-${H} <${M}.${P}.${+G+1}-0`:Q=`>=${M}.${P}.${G}-${H} <${M}.${+P+1}.0-0`:Q=`>=${M}.${P}.${G}-${H} <${+M+1}.0.0-0`):(s("no pr"),M==="0"?P==="0"?Q=`>=${M}.${P}.${G}${O} <${M}.${P}.${+G+1}-0`:Q=`>=${M}.${P}.${G}${O} <${M}.${+P+1}.0-0`:Q=`>=${M}.${P}.${G} <${+M+1}.0.0-0`),s("caret return",Q),Q})},$=(_,I)=>(s("replaceXRanges",_,I),_.split(/\s+/).map(T=>S(T,I)).join(" ")),S=(_,I)=>{_=_.trim();const T=I.loose?a[u.XRANGELOOSE]:a[u.XRANGE];return _.replace(T,(O,L,M,P,G,H)=>{s("xRange",_,O,L,M,P,G,H);const Q=b(M),te=Q||b(P),ne=te||b(G),oe=ne;return L==="="&&oe&&(L=""),H=I.includePrerelease?"-0":"",Q?L===">"||L==="<"?O="<0.0.0-0":O="*":L&&oe?(te&&(P=0),G=0,L===">"?(L=">=",te?(M=+M+1,P=0,G=0):(P=+P+1,G=0)):L==="<="&&(L="<",te?M=+M+1:P=+P+1),L==="<"&&(H="-0"),O=`${L+M}.${P}.${G}${H}`):te?O=`>=${M}.0.0${H} <${+M+1}.0.0-0`:ne&&(O=`>=${M}.${P}.0${H} <${M}.${+P+1}.0-0`),s("xRange return",O),O})},k=(_,I)=>(s("replaceStars",_,I),_.trim().replace(a[u.STAR],"")),E=(_,I)=>(s("replaceGTE0",_,I),_.trim().replace(a[I.includePrerelease?u.GTE0PRE:u.GTE0],"")),A=_=>(I,T,O,L,M,P,G,H,Q,te,ne,oe,he)=>(b(O)?T="":b(L)?T=`>=${O}.0.0${_?"-0":""}`:b(M)?T=`>=${O}.${L}.0${_?"-0":""}`:P?T=`>=${T}`:T=`>=${T}${_?"-0":""}`,b(Q)?H="":b(te)?H=`<${+Q+1}.0.0-0`:b(ne)?H=`<${Q}.${+te+1}.0-0`:oe?H=`<=${Q}.${te}.${ne}-${oe}`:_?H=`<${Q}.${te}.${+ne+1}-0`:H=`<=${H}`,`${T} ${H}`.trim()),F=(_,I,T)=>{for(let O=0;O<_.length;O++)if(!_[O].test(I))return!1;if(I.prerelease.length&&!T.includePrerelease){for(let O=0;O<_.length;O++)if(s(_[O].semver),_[O].semver!==i.ANY&&_[O].semver.prerelease.length>0){const L=_[O].semver;if(L.major===I.major&&L.minor===I.minor&&L.patch===I.patch)return!0}return!1}return!0};return p3}var g3,nG;function kI(){if(nG)return g3;nG=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(c,f){if(f=n(f),c instanceof t){if(c.loose===!!f.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),o("comparator",c,f),this.options=f,this.loose=!!f.loose,this.parse(c),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(c){const f=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],h=c.match(f);if(!h)throw new TypeError(`Invalid comparator: ${c}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new a(h[2],this.options.loose):this.semver=e}toString(){return this.value}test(c){if(o("Comparator.test",c,this.options.loose),this.semver===e||c===e)return!0;if(typeof c=="string")try{c=new a(c,this.options)}catch{return!1}return s(c,this.operator,this.semver,this.options)}intersects(c,f){if(!(c instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(c.value,f).test(this.value):c.operator===""?c.value===""?!0:new u(this.value,f).test(c.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||s(this.semver,"<",c.semver,f)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||s(this.semver,">",c.semver,f)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}g3=t;const n=j5,{safeRe:r,t:i}=Yw,s=xre,o=CI,a=qi,u=Na();return g3}const cNe=Na(),fNe=(e,t,n)=>{try{t=new cNe(t,n)}catch{return!1}return t.test(e)};var EI=fNe;const hNe=Na(),dNe=(e,t)=>new hNe(e,t).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));var pNe=dNe;const gNe=qi,mNe=Na(),yNe=(e,t,n)=>{let r=null,i=null,s=null;try{s=new mNe(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!r||i.compare(o)===-1)&&(r=o,i=new gNe(r,n))}),r};var bNe=yNe;const xNe=qi,vNe=Na(),wNe=(e,t,n)=>{let r=null,i=null,s=null;try{s=new vNe(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!r||i.compare(o)===1)&&(r=o,i=new xNe(r,n))}),r};var $Ne=wNe;const m3=qi,CNe=Na(),rG=SI,SNe=(e,t)=>{e=new CNe(e,t);let n=new m3("0.0.0");if(e.test(n)||(n=new m3("0.0.0-0"),e.test(n)))return n;n=null;for(let r=0;r<e.set.length;++r){const i=e.set[r];let s=null;i.forEach(o=>{const a=new m3(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||rG(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!n||rG(n,s))&&(n=s)}return n&&e.test(n)?n:null};var kNe=SNe;const ENe=Na(),ANe=(e,t)=>{try{return new ENe(e,t).range||"*"}catch{return null}};var _Ne=ANe;const TNe=qi,wre=kI(),{ANY:INe}=wre,DNe=Na(),NNe=EI,iG=SI,sG=V5,FNe=H5,ONe=G5,RNe=(e,t,n,r)=>{e=new TNe(e,r),t=new DNe(t,r);let i,s,o,a,u;switch(n){case">":i=iG,s=FNe,o=sG,a=">",u=">=";break;case"<":i=sG,s=ONe,o=iG,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(NNe(e,t,r))return!1;for(let l=0;l<t.set.length;++l){const c=t.set[l];let f=null,h=null;if(c.forEach(d=>{d.semver===INe&&(d=new wre(">=0.0.0")),f=f||d,h=h||d,i(d.semver,f.semver,r)?f=d:o(d.semver,h.semver,r)&&(h=d)}),f.operator===a||f.operator===u||(!h.operator||h.operator===a)&&s(e,h.semver))return!1;if(h.operator===u&&o(e,h.semver))return!1}return!0};var q5=RNe;const MNe=q5,LNe=(e,t,n)=>MNe(e,t,">",n);var PNe=LNe;const BNe=q5,zNe=(e,t,n)=>BNe(e,t,"<",n);var UNe=zNe;const oG=Na(),jNe=(e,t,n)=>(e=new oG(e,n),t=new oG(t,n),e.intersects(t,n));var WNe=jNe;const VNe=EI,GNe=Da;var HNe=(e,t,n)=>{const r=[];let i=null,s=null;const o=e.sort((c,f)=>GNe(c,f,n));for(const c of o)VNe(c,t,n)?(s=c,i||(i=c)):(s&&r.push([i,s]),s=null,i=null);i&&r.push([i,null]);const a=[];for(const[c,f]of r)c===f?a.push(c):!f&&c===o[0]?a.push("*"):f?c===o[0]?a.push(`<=${f}`):a.push(`${c} - ${f}`):a.push(`>=${c}`);const u=a.join(" || "),l=typeof t.raw=="string"?t.raw:String(t);return u.length<l.length?u:t};const aG=Na(),X5=kI(),{ANY:y3}=X5,Yy=EI,Y5=Da,qNe=(e,t,n={})=>{if(e===t)return!0;e=new aG(e,n),t=new aG(t,n);let r=!1;e:for(const i of e.set){for(const s of t.set){const o=YNe(i,s,n);if(r=r||o!==null,o)continue e}if(r)return!1}return!0},XNe=[new X5(">=0.0.0-0")],uG=[new X5(">=0.0.0")],YNe=(e,t,n)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===y3){if(t.length===1&&t[0].semver===y3)return!0;n.includePrerelease?e=XNe:e=uG}if(t.length===1&&t[0].semver===y3){if(n.includePrerelease)return!0;t=uG}const r=new Set;let i,s;for(const d of e)d.operator===">"||d.operator===">="?i=lG(i,d,n):d.operator==="<"||d.operator==="<="?s=cG(s,d,n):r.add(d.semver);if(r.size>1)return null;let o;if(i&&s){if(o=Y5(i.semver,s.semver,n),o>0)return null;if(o===0&&(i.operator!==">="||s.operator!=="<="))return null}for(const d of r){if(i&&!Yy(d,String(i),n)||s&&!Yy(d,String(s),n))return null;for(const p of t)if(!Yy(d,String(p),n))return!1;return!0}let a,u,l,c,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1,h=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const d of t){if(c=c||d.operator===">"||d.operator===">=",l=l||d.operator==="<"||d.operator==="<=",i){if(h&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===h.major&&d.semver.minor===h.minor&&d.semver.patch===h.patch&&(h=!1),d.operator===">"||d.operator===">="){if(a=lG(i,d,n),a===d&&a!==i)return!1}else if(i.operator===">="&&!Yy(i.semver,String(d),n))return!1}if(s){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator==="<"||d.operator==="<="){if(u=cG(s,d,n),u===d&&u!==s)return!1}else if(s.operator==="<="&&!Yy(s.semver,String(d),n))return!1}if(!d.operator&&(s||i)&&o!==0)return!1}return!(i&&l&&!s&&o!==0||s&&c&&!i&&o!==0||h||f)},lG=(e,t,n)=>{if(!e)return t;const r=Y5(e.semver,t.semver,n);return r>0?e:r<0||t.operator===">"&&e.operator===">="?t:e},cG=(e,t,n)=>{if(!e)return t;const r=Y5(e.semver,t.semver,n);return r<0?e:r>0||t.operator==="<"&&e.operator==="<="?t:e};var KNe=qNe;const b3=Yw,fG=$I,ZNe=qi,hG=mre,JNe=X1,QNe=JIe,eFe=tDe,tFe=rDe,nFe=sDe,rFe=uDe,iFe=fDe,sFe=pDe,oFe=yDe,aFe=Da,uFe=wDe,lFe=SDe,cFe=W5,fFe=_De,hFe=DDe,dFe=SI,pFe=V5,gFe=yre,mFe=bre,yFe=G5,bFe=H5,xFe=xre,vFe=eNe,wFe=kI(),$Fe=Na(),CFe=EI,SFe=pNe,kFe=bNe,EFe=$Ne,AFe=kNe,_Fe=_Ne,TFe=q5,IFe=PNe,DFe=UNe,NFe=WNe,FFe=HNe,OFe=KNe;var $re={parse:JNe,valid:QNe,clean:eFe,inc:tFe,diff:nFe,major:rFe,minor:iFe,patch:sFe,prerelease:oFe,compare:aFe,rcompare:uFe,compareLoose:lFe,compareBuild:cFe,sort:fFe,rsort:hFe,gt:dFe,lt:pFe,eq:gFe,neq:mFe,gte:yFe,lte:bFe,cmp:xFe,coerce:vFe,Comparator:wFe,Range:$Fe,satisfies:CFe,toComparators:SFe,maxSatisfying:kFe,minSatisfying:EFe,minVersion:AFe,validRange:_Fe,outside:TFe,gtr:IFe,ltr:DFe,intersects:NFe,simplifyRange:FFe,subset:OFe,SemVer:ZNe,re:b3.re,src:b3.src,tokens:b3.t,SEMVER_SPEC_VERSION:fG.SEMVER_SPEC_VERSION,RELEASE_TYPES:fG.RELEASE_TYPES,compareIdentifiers:hG.compareIdentifiers,rcompareIdentifiers:hG.rcompareIdentifiers};function Mo(e,t,n){return e.fields=t||[],e.fname=n,e}function _n(e){return e==null?null:e.fname}function pi(e){return e==null?null:e.fields}function Cre(e){return e.length===1?RFe(e[0]):MFe(e)}const RFe=e=>function(t){return t[e]},MFe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ae(e){throw Error(e)}function AI(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||ae("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&ae("Access path missing closing bracket: "+e),r&&ae("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Mf(e,t,n){const r=AI(e);return e=r.length===1?r[0]:e,Mo((n&&n.get||Cre)(r),[e],t||e)}const LFe=Mf("id"),Ao=Mo(e=>e,[],"identity"),Yc=Mo(()=>0,[],"zero"),Y1=Mo(()=>1,[],"one"),K1=Mo(()=>!0,[],"true"),zc=Mo(()=>!1,[],"false");function OC(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const Sre=0,kre=1,Ere=2,Are=3,_re=4;function PFe(e,t){let n=e||Sre;return{level(r){return arguments.length?(n=+r,this):n},error(){return n>=kre&&OC(t||"error","ERROR",arguments),this},warn(){return n>=Ere&&OC(t||"warn","WARN",arguments),this},info(){return n>=Are&&OC(t||"log","INFO",arguments),this},debug(){return n>=_re&&OC(t||"log","DEBUG",arguments),this}}}var rt=Array.isArray;function ht(e){return e===Object(e)}const dG=e=>e!=="__proto__";function _I(...e){return e.reduce((t,n)=>{for(const r in n)if(r==="signals")t.signals=BFe(t.signals,n.signals);else{const i=r==="legend"?{layout:1}:r==="style"?!0:null;TI(t,r,n[r],i)}return t},{})}function TI(e,t,n,r){if(!dG(t))return;let i,s;if(ht(n)&&!rt(n)){s=ht(e[t])?e[t]:e[t]={};for(i in n)r&&(r===!0||r[i])?TI(s,i,n[i]):dG(i)&&(s[i]=n[i])}else e[t]=n}function BFe(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}function qt(e){return e[e.length-1]}function Lf(e){return e==null||e===""?null:+e}const Tre=e=>t=>e*Math.exp(t),Ire=e=>t=>Math.log(e*t),Dre=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Nre=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Hk=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function II(e,t,n,r){const i=n(e[0]),s=n(qt(e)),o=(s-i)*t;return[r(i-o),r(s-o)]}function zFe(e,t){return II(e,t,Lf,Ao)}function UFe(e,t){var n=Math.sign(e[0]);return II(e,t,Ire(n),Tre(n))}function jFe(e,t,n){return II(e,t,Hk(n),Hk(1/n))}function WFe(e,t,n){return II(e,t,Dre(n),Nre(n))}function DI(e,t,n,r,i){const s=r(e[0]),o=r(qt(e)),a=t!=null?r(t):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function Fre(e,t,n){return DI(e,t,n,Lf,Ao)}function Ore(e,t,n){const r=Math.sign(e[0]);return DI(e,t,n,Ire(r),Tre(r))}function yM(e,t,n,r){return DI(e,t,n,Hk(r),Hk(1/r))}function Rre(e,t,n,r){return DI(e,t,n,Dre(r),Nre(r))}function VFe(e){return 1+~~(new Date(e).getMonth()/3)}function GFe(e){return 1+~~(new Date(e).getUTCMonth()/3)}function Qe(e){return e!=null?rt(e)?e:[e]:[]}function HFe(e,t,n){let r=e[0],i=e[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-s),r+s]}function Pt(e){return typeof e=="function"}const qFe="descending";function Mre(e,t,n){n=n||{},t=Qe(t)||[];const r=[],i=[],s={},o=n.comparator||XFe;return Qe(e).forEach((a,u)=>{a!=null&&(r.push(t[u]===qFe?-1:1),i.push(a=Pt(a)?a:Mf(a,null,n)),(pi(a)||[]).forEach(l=>s[l]=1))}),i.length===0?null:Mo(o(i,r),Object.keys(s))}const NI=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),XFe=(e,t)=>e.length===1?YFe(e[0],t[0]):KFe(e,t,e.length),YFe=(e,t)=>function(n,r){return NI(e(n),e(r))*t},KFe=(e,t,n)=>(t.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=e[a],o=NI(s(r),s(i));return o*t[a]});function _o(e){return Pt(e)?e:()=>e}function Lre(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function pt(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function Pf(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}function Pre(e,t){const n=e.length;let r=-1,i,s,o,a,u;if(t==null){for(;++r<n;)if(s=e[r],s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=e[r],s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}else{for(;++r<n;)if(s=t(e[r],r,e),s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=t(e[r],r,e),s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}return[a,u]}const ZFe=Object.prototype.hasOwnProperty;function tt(e,t){return ZFe.call(e,t)}const RC={};function Z1(e){let t={},n;function r(s){return tt(t,s)&&t[s]!==RC}const i={size:0,empty:0,object:t,has:r,get(s){return r(s)?t[s]:void 0},set(s,o){return r(s)||(++i.size,t[s]===RC&&--i.empty),t[s]=o,this},delete(s){return r(s)&&(--i.size,++i.empty,t[s]=RC),this},clear(){i.size=i.empty=0,i.object=t={}},test(s){return arguments.length?(n=s,i):n},clean(){const s={};let o=0;for(const a in t){const u=t[a];u!==RC&&(!n||!n(u))&&(s[a]=u,++o)}i.size=o,i.empty=0,i.object=t=s}};return e&&Object.keys(e).forEach(s=>{i.set(s,e[s])}),i}function JFe(e,t,n,r,i,s){if(!n&&n!==0)return s;const o=+n;let a=e[0],u=qt(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=o?r:c<=o?i:s}function ye(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),pt(r,n)}function QFe(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function Bre(e){return typeof e=="boolean"}function FI(e){return Object.prototype.toString.call(e)==="[object Date]"}function zre(e){return e&&Pt(e[Symbol.iterator])}function wp(e){return typeof e=="number"}function e3e(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function hn(e){return typeof e=="string"}function Ure(e,t,n){e&&(e=t?Qe(e).map(a=>a.replace(/\\(.)/g,"$1")):Qe(e));const r=e&&e.length,i=n&&n.get||Cre,s=a=>i(t?[a]:AI(a));let o;if(!r)o=function(){return""};else if(r===1){const a=s(e[0]);o=function(u){return""+a(u)}}else{const a=e.map(s);o=function(u){let l=""+a[0](u),c=0;for(;++c<r;)l+="|"+a[c](u);return l}}return Mo(o,e,"key")}function t3e(e,t){const n=e[0],r=qt(e),i=+t;return i?i===1?r:n+i*(r-n):n}const n3e=1e4;function jre(e){e=+e||n3e;let t,n,r;const i=()=>{t={},n={},r=0},s=(o,a)=>(++r>e&&(n=t,t={},r=1),t[o]=a);return i(),{clear:i,has:o=>tt(t,o)||tt(n,o),get:o=>tt(t,o)?t[o]:tt(n,o)?s(o,n[o]):void 0,set:(o,a)=>tt(t,o)?t[o]=a:s(o,a)}}function Wre(e,t,n,r){const i=t.length,s=n.length;if(!s)return t;if(!i)return n;const o=r||new t.constructor(i+s);let a=0,u=0,l=0;for(;a<i&&u<s;++l)o[l]=e(t[a],n[u])>0?n[u++]:t[a++];for(;a<i;++a,++l)o[l]=t[a];for(;u<s;++u,++l)o[l]=n[u];return o}function Rb(e,t){let n="";for(;--t>=0;)n+=e;return n}function r3e(e,t,n,r){const i=n||" ",s=e+"",o=t-s.length;return o<=0?s:r==="left"?Rb(i,o)+s:r==="center"?Rb(i,~~(o/2))+s+Rb(i,Math.ceil(o/2)):s+Rb(i,o)}function OI(e){return e&&qt(e)-e[0]||0}function He(e){return rt(e)?"["+e.map(He)+"]":ht(e)||hn(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Vre(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const i3e=e=>wp(e)||FI(e)?e:Date.parse(e);function Gre(e,t){return t=t||i3e,e==null||e===""?null:t(e)}function Hre(e){return e==null||e===""?null:e+""}function ic(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function s3e(e,t,n,r){const i=r??"…",s=e+"",o=s.length,a=Math.max(0,t-i.length);return o<=t?s:n==="left"?i+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i}function o3e(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const s=t(e[i]);s&&n(s,i,e)}}else e.forEach(n)}function J1(e,t,n){return e.fields=t||[],e.fname=n,e}function a3e(e){return e.length===1?u3e(e[0]):l3e(e)}const u3e=e=>function(t){return t[e]},l3e=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function gi(e){throw Error(e)}function c3e(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||gi("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&gi("Access path missing closing bracket: "+e),r&&gi("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function qre(e,t,n){const r=c3e(e);return e=r.length===1?r[0]:e,J1((n&&n.get||a3e)(r),[e],t||e)}const RI=qre("id"),MI=J1(e=>e,[],"identity");J1(()=>0,[],"zero");J1(()=>1,[],"one");const bM=J1(()=>!0,[],"true");J1(()=>!1,[],"false");function f3e(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const h3e=0,Xre=1,d3e=2,p3e=3,g3e=4;function m3e(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:f3e,r=e||h3e;return{level(i){return arguments.length?(r=+i,this):r},error(){return r>=Xre&&n(t||"error","ERROR",arguments),this},warn(){return r>=d3e&&n(t||"warn","WARN",arguments),this},info(){return r>=p3e&&n(t||"log","INFO",arguments),this},debug(){return r>=g3e&&n(t||"log","DEBUG",arguments),this}}}var _u=Array.isArray;function K5(e){return e===Object(e)}function pG(e){return e==null||e===""?null:+e}function qk(e){return e!=null?_u(e)?e:[e]:[]}function ma(e){return typeof e=="function"}function Z5(e){return ma(e)?e:()=>e}function y3e(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function Q1(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const b3e=Object.prototype.hasOwnProperty;function J5(e,t){return b3e.call(e,t)}function Yre(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),Q1(r,n)}function x3e(e){return Object.prototype.toString.call(e)==="[object Date]"}function v3e(e){return e&&ma(e[Symbol.iterator])}function w3e(e){return typeof e=="number"}function xM(e){return typeof e=="string"}function Q5(e){return _u(e)?"["+e.map(Q5)+"]":K5(e)||xM(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function $3e(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const C3e=e=>w3e(e)||x3e(e)?e:Date.parse(e);function S3e(e,t){return t=t||C3e,e==null||e===""?null:t(e)}function k3e(e){return e==null||e===""?null:e+""}function md(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const s=t(e[i]);s&&n(s,i,e)}}else e.forEach(n)}var gG={},x3={},v3=34,Ky=10,w3=13;function Kre(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function E3e(e,t){var n=Kre(e);return function(r,i){return t(n(r),i,e)}}function mG(e){var t=Object.create(null),n=[];return e.forEach(function(r){for(var i in r)i in t||n.push(t[i]=i)}),n}function Qi(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function A3e(e){return e<0?"-"+Qi(-e,6):e>9999?"+"+Qi(e,6):Qi(e,4)}function _3e(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":A3e(e.getUTCFullYear())+"-"+Qi(e.getUTCMonth()+1,2)+"-"+Qi(e.getUTCDate(),2)+(i?"T"+Qi(t,2)+":"+Qi(n,2)+":"+Qi(r,2)+"."+Qi(i,3)+"Z":r?"T"+Qi(t,2)+":"+Qi(n,2)+":"+Qi(r,2)+"Z":n||t?"T"+Qi(t,2)+":"+Qi(n,2)+"Z":"")}function T3e(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function r(f,h){var d,p,g=i(f,function(m,y){if(d)return d(m,y-1);p=m,d=h?E3e(m,h):Kre(m)});return g.columns=p||[],g}function i(f,h){var d=[],p=f.length,g=0,m=0,y,b=p<=0,v=!1;f.charCodeAt(p-1)===Ky&&--p,f.charCodeAt(p-1)===w3&&--p;function x(){if(b)return x3;if(v)return v=!1,gG;var C,$=g,S;if(f.charCodeAt($)===v3){for(;g++<p&&f.charCodeAt(g)!==v3||f.charCodeAt(++g)===v3;);return(C=g)>=p?b=!0:(S=f.charCodeAt(g++))===Ky?v=!0:S===w3&&(v=!0,f.charCodeAt(g)===Ky&&++g),f.slice($+1,C-1).replace(/""/g,'"')}for(;g<p;){if((S=f.charCodeAt(C=g++))===Ky)v=!0;else if(S===w3)v=!0,f.charCodeAt(g)===Ky&&++g;else if(S!==n)continue;return f.slice($,C)}return b=!0,f.slice($,p)}for(;(y=x())!==x3;){for(var w=[];y!==gG&&y!==x3;)w.push(y),y=x();h&&(w=h(w,m++))==null||d.push(w)}return d}function s(f,h){return f.map(function(d){return h.map(function(p){return c(d[p])}).join(e)})}function o(f,h){return h==null&&(h=mG(f)),[h.map(c).join(e)].concat(s(f,h)).join(`
`)}function a(f,h){return h==null&&(h=mG(f)),s(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?_3e(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function I3e(e){return e}function D3e(e){if(e==null)return I3e;var t,n,r=e.scale[0],i=e.scale[1],s=e.translate[0],o=e.translate[1];return function(a,u){u||(t=n=0);var l=2,c=a.length,f=new Array(c);for(f[0]=(t+=a[0])*r+s,f[1]=(n+=a[1])*i+o;l<c;)f[l]=a[l],++l;return f}}function N3e(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}function Zre(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return yG(e,n)})}:yG(e,t)}function yG(e,t){var n=t.id,r=t.bbox,i=t.properties==null?{}:t.properties,s=Jre(e,t);return n==null&&r==null?{type:"Feature",properties:i,geometry:s}:r==null?{type:"Feature",id:n,properties:i,geometry:s}:{type:"Feature",id:n,bbox:r,properties:i,geometry:s}}function Jre(e,t){var n=D3e(e.transform),r=e.arcs;function i(c,f){f.length&&f.pop();for(var h=r[c<0?~c:c],d=0,p=h.length;d<p;++d)f.push(n(h[d],d));c<0&&N3e(f,p)}function s(c){return n(c)}function o(c){for(var f=[],h=0,d=c.length;h<d;++h)i(c[h],f);return f.length<2&&f.push(f[0]),f}function a(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(a)}function l(c){var f=c.type,h;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":h=s(c.coordinates);break;case"MultiPoint":h=c.coordinates.map(s);break;case"LineString":h=o(c.arcs);break;case"MultiLineString":h=c.arcs.map(o);break;case"Polygon":h=u(c.arcs);break;case"MultiPolygon":h=c.arcs.map(u);break;default:return null}return{type:f,coordinates:h}}return l(t)}function F3e(e,t){var n={},r={},i={},s=[],o=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],h;f.length<3&&!f[1][0]&&!f[1][1]&&(h=t[++o],t[o]=l,t[c]=h)}),t.forEach(function(l){var c=a(l),f=c[0],h=c[1],d,p;if(d=i[f])if(delete i[d.end],d.push(l),d.end=h,p=r[h]){delete r[p.start];var g=p===d?d:d.concat(p);r[g.start=d.start]=i[g.end=p.end]=g}else r[d.start]=i[d.end]=d;else if(d=r[h])if(delete r[d.start],d.unshift(l),d.start=f,p=i[f]){delete i[p.end];var m=p===d?d:p.concat(d);r[m.start=p.start]=i[m.end=d.end]=m}else r[d.start]=i[d.end]=d;else d=[l],r[d.start=f]=i[d.end=h]=d});function a(l){var c=e.arcs[l<0?~l:l],f=c[0],h;return e.transform?(h=[0,0],c.forEach(function(d){h[0]+=d[0],h[1]+=d[1]})):h=c[c.length-1],l<0?[h,f]:[f,h]}function u(l,c){for(var f in l){var h=l[f];delete c[h.start],delete h.start,delete h.end,h.forEach(function(d){n[d<0?~d:d]=1}),s.push(h)}}return u(i,r),u(r,i),t.forEach(function(l){n[l<0?~l:l]||s.push([l])}),s}function Qre(e){return Jre(e,O3e.apply(this,arguments))}function O3e(e,t,n){var r,i,s;if(arguments.length>1)r=R3e(e,t,n);else for(i=0,r=new Array(s=e.arcs.length);i<s;++i)r[i]=i;return{type:"MultiLineString",arcs:F3e(e,r)}}function R3e(e,t,n){var r=[],i=[],s;function o(f){var h=f<0?~f:f;(i[h]||(i[h]=[])).push({i:f,g:s})}function a(f){f.forEach(o)}function u(f){f.forEach(a)}function l(f){f.forEach(u)}function c(f){switch(s=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),i.forEach(n==null?function(f){r.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&r.push(f[0].i)}),r}class Xk extends Map{constructor(t,n=nie){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[r,i]of t)this.set(r,i)}get(t){return super.get(vM(this,t))}has(t){return super.has(vM(this,t))}set(t,n){return super.set(eie(this,t),n)}delete(t){return super.delete(tie(this,t))}}class Yk extends Set{constructor(t,n=nie){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const r of t)this.add(r)}has(t){return super.has(vM(this,t))}add(t){return super.add(eie(this,t))}delete(t){return super.delete(tie(this,t))}}function vM({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function eie({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function tie({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(n),e.delete(r)),n}function nie(e){return e!==null&&typeof e=="object"?e.valueOf():e}const M3e=Math.sqrt(50),L3e=Math.sqrt(10),P3e=Math.sqrt(2);function rie(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=M3e?10:s>=L3e?5:s>=P3e?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?rie(e,t,n*2):[a,u,l]}function bG(e,t,n){return t=+t,e=+e,n=+n,rie(e,t,n)[2]}function B3e(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?bG(t,e,n):bG(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function z3e(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Kk(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Jm(e){return e=Kk(Math.abs(e)),e?e[1]:NaN}function U3e(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function j3e(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var W3e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function iv(e){if(!(t=W3e.exec(e)))throw new Error("invalid format: "+e);var t;return new e6({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}iv.prototype=e6.prototype;function e6(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}e6.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function V3e(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var iie;function G3e(e,t){var n=Kk(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(iie=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Kk(e,Math.max(0,t+s-1))[0]}function xG(e,t){var n=Kk(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const vG={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:z3e,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>xG(e*100,t),r:xG,s:G3e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function wG(e){return e}var $G=Array.prototype.map,CG=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function sie(e){var t=e.grouping===void 0||e.thousands===void 0?wG:U3e($G.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?wG:j3e($G.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=iv(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,v=f.precision,x=f.trim,w=f.type;w==="n"?(b=!0,w="g"):vG[w]||(v===void 0&&(v=12),x=!0,w="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var C=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",$=g==="$"?r:/[%p]/.test(w)?o:"",S=vG[w],k=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function E(A){var F=C,_=$,I,T,O;if(w==="c")_=S(A)+_,A="";else{A=+A;var L=A<0||1/A<0;if(A=isNaN(A)?u:S(Math.abs(A),v),x&&(A=V3e(A)),L&&+A==0&&p!=="+"&&(L=!1),F=(L?p==="("?p:a:p==="-"||p==="("?"":p)+F,_=(w==="s"?CG[8+iie/3]:"")+_+(L&&p==="("?")":""),k){for(I=-1,T=A.length;++I<T;)if(O=A.charCodeAt(I),48>O||O>57){_=(O===46?i+A.slice(I+1):A.slice(I))+_,A=A.slice(0,I);break}}}b&&!m&&(A=t(A,1/0));var M=F.length+A.length+_.length,P=M<y?new Array(y-M+1).join(h):"";switch(b&&m&&(A=t(P+A,P.length?y-_.length:1/0),P=""),d){case"<":A=F+A+_+P;break;case"=":A=F+P+A+_;break;case"^":A=P.slice(0,M=P.length>>1)+F+A+_+P.slice(M);break;default:A=P+F+A+_;break}return s(A)}return E.toString=function(){return f+""},E}function c(f,h){var d=l((f=iv(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Jm(h)/3)))*3,g=Math.pow(10,-p),m=CG[8+p/3];return function(y){return d(g*y)+m}}return{format:l,formatPrefix:c}}var MC,oie,aie;H3e({thousands:",",grouping:[3],currency:["$",""]});function H3e(e){return MC=sie(e),oie=MC.format,aie=MC.formatPrefix,MC}function q3e(e){return Math.max(0,-Jm(Math.abs(e)))}function X3e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Jm(t)/3)))*3-Jm(Math.abs(e)))}function Y3e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Jm(t)-Jm(e))+1}const $3=new Date,C3=new Date;function ur(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>ur(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>($3.setTime(+s),C3.setTime(+o),e($3),e(C3),Math.floor(n($3,C3))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const sv=ur(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);sv.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ur(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):sv);sv.range;const ov=1e3,Bf=ov*60,av=Bf*60,uv=av*24,uie=uv*7,t6=ur(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*ov)},(e,t)=>(t-e)/ov,e=>e.getUTCSeconds());t6.range;const lie=ur(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*ov)},(e,t)=>{e.setTime(+e+t*Bf)},(e,t)=>(t-e)/Bf,e=>e.getMinutes());lie.range;const cie=ur(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Bf)},(e,t)=>(t-e)/Bf,e=>e.getUTCMinutes());cie.range;const fie=ur(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*ov-e.getMinutes()*Bf)},(e,t)=>{e.setTime(+e+t*av)},(e,t)=>(t-e)/av,e=>e.getHours());fie.range;const hie=ur(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*av)},(e,t)=>(t-e)/av,e=>e.getUTCHours());hie.range;const Nm=ur(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Bf)/uv,e=>e.getDate()-1);Nm.range;const Fm=ur(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/uv,e=>e.getUTCDate()-1);Fm.range;const K3e=ur(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/uv,e=>Math.floor(e/uv));K3e.range;function hg(e){return ur(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Bf)/uie)}const n6=hg(0),Zk=hg(1),Z3e=hg(2),J3e=hg(3),Qm=hg(4),Q3e=hg(5),eOe=hg(6);n6.range;Zk.range;Z3e.range;J3e.range;Qm.range;Q3e.range;eOe.range;function dg(e){return ur(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/uie)}const r6=dg(0),Jk=dg(1),tOe=dg(2),nOe=dg(3),e0=dg(4),rOe=dg(5),iOe=dg(6);r6.range;Jk.range;tOe.range;nOe.range;e0.range;rOe.range;iOe.range;const wM=ur(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());wM.range;const $M=ur(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());$M.range;const zf=ur(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());zf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ur(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});zf.range;const Uf=ur(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Uf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ur(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Uf.range;const lv="year",cv="quarter",fv="month",hv="week",dv="date",LI="day",i6="dayofyear",pv="hours",gv="minutes",mv="seconds",PI="milliseconds",sOe=[lv,cv,fv,hv,dv,LI,i6,pv,gv,mv,PI];sOe.reduce((e,t,n)=>(e[t]=1+n,e),{});const oOe={[lv]:zf,[cv]:wM.every(3),[fv]:wM,[hv]:n6,[dv]:Nm,[LI]:Nm,[i6]:Nm,[pv]:fie,[gv]:lie,[mv]:t6,[PI]:sv},aOe={[lv]:Uf,[cv]:$M.every(3),[fv]:$M,[hv]:r6,[dv]:Fm,[LI]:Fm,[i6]:Fm,[pv]:hie,[gv]:cie,[mv]:t6,[PI]:sv};function uOe(e){return oOe[e]}function lOe(e){return aOe[e]}function S3(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function k3(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Zy(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function die(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=Jy(i),c=Qy(i),f=Jy(s),h=Qy(s),d=Jy(o),p=Qy(o),g=Jy(a),m=Qy(a),y=Jy(u),b=Qy(u),v={a:L,A:M,b:P,B:G,c:null,d:TG,e:TG,f:NOe,g:jOe,G:VOe,H:TOe,I:IOe,j:DOe,L:pie,m:FOe,M:OOe,p:H,q:Q,Q:NG,s:FG,S:ROe,u:MOe,U:LOe,V:POe,w:BOe,W:zOe,x:null,X:null,y:UOe,Y:WOe,Z:GOe,"%":DG},x={a:te,A:ne,b:oe,B:he,c:null,d:IG,e:IG,f:YOe,g:sRe,G:aRe,H:HOe,I:qOe,j:XOe,L:mie,m:KOe,M:ZOe,p:we,q:Ae,Q:NG,s:FG,S:JOe,u:QOe,U:eRe,V:tRe,w:nRe,W:rRe,x:null,X:null,y:iRe,Y:oRe,Z:uRe,"%":DG},w={a:E,A,b:F,B:_,c:I,d:AG,e:AG,f:kOe,g:EG,G:kG,H:_G,I:_G,j:wOe,L:SOe,m:vOe,M:$Oe,p:k,q:xOe,Q:AOe,s:_Oe,S:COe,u:pOe,U:gOe,V:mOe,w:dOe,W:yOe,x:T,X:O,y:EG,Y:kG,Z:bOe,"%":EOe};v.x=C(n,v),v.X=C(r,v),v.c=C(t,v),x.x=C(n,x),x.X=C(r,x),x.c=C(t,x);function C(B,Y){return function(K){var R=[],Ce=-1,ce=0,Ee=B.length,Se,qe,bt;for(K instanceof Date||(K=new Date(+K));++Ce<Ee;)B.charCodeAt(Ce)===37&&(R.push(B.slice(ce,Ce)),(qe=SG[Se=B.charAt(++Ce)])!=null?Se=B.charAt(++Ce):qe=Se==="e"?" ":"0",(bt=Y[Se])&&(Se=bt(K,qe)),R.push(Se),ce=Ce+1);return R.push(B.slice(ce,Ce)),R.join("")}}function $(B,Y){return function(K){var R=Zy(1900,void 0,1),Ce=S(R,B,K+="",0),ce,Ee;if(Ce!=K.length)return null;if("Q"in R)return new Date(R.Q);if("s"in R)return new Date(R.s*1e3+("L"in R?R.L:0));if(Y&&!("Z"in R)&&(R.Z=0),"p"in R&&(R.H=R.H%12+R.p*12),R.m===void 0&&(R.m="q"in R?R.q:0),"V"in R){if(R.V<1||R.V>53)return null;"w"in R||(R.w=1),"Z"in R?(ce=k3(Zy(R.y,0,1)),Ee=ce.getUTCDay(),ce=Ee>4||Ee===0?Jk.ceil(ce):Jk(ce),ce=Fm.offset(ce,(R.V-1)*7),R.y=ce.getUTCFullYear(),R.m=ce.getUTCMonth(),R.d=ce.getUTCDate()+(R.w+6)%7):(ce=S3(Zy(R.y,0,1)),Ee=ce.getDay(),ce=Ee>4||Ee===0?Zk.ceil(ce):Zk(ce),ce=Nm.offset(ce,(R.V-1)*7),R.y=ce.getFullYear(),R.m=ce.getMonth(),R.d=ce.getDate()+(R.w+6)%7)}else("W"in R||"U"in R)&&("w"in R||(R.w="u"in R?R.u%7:"W"in R?1:0),Ee="Z"in R?k3(Zy(R.y,0,1)).getUTCDay():S3(Zy(R.y,0,1)).getDay(),R.m=0,R.d="W"in R?(R.w+6)%7+R.W*7-(Ee+5)%7:R.w+R.U*7-(Ee+6)%7);return"Z"in R?(R.H+=R.Z/100|0,R.M+=R.Z%100,k3(R)):S3(R)}}function S(B,Y,K,R){for(var Ce=0,ce=Y.length,Ee=K.length,Se,qe;Ce<ce;){if(R>=Ee)return-1;if(Se=Y.charCodeAt(Ce++),Se===37){if(Se=Y.charAt(Ce++),qe=w[Se in SG?Y.charAt(Ce++):Se],!qe||(R=qe(B,K,R))<0)return-1}else if(Se!=K.charCodeAt(R++))return-1}return R}function k(B,Y,K){var R=l.exec(Y.slice(K));return R?(B.p=c.get(R[0].toLowerCase()),K+R[0].length):-1}function E(B,Y,K){var R=d.exec(Y.slice(K));return R?(B.w=p.get(R[0].toLowerCase()),K+R[0].length):-1}function A(B,Y,K){var R=f.exec(Y.slice(K));return R?(B.w=h.get(R[0].toLowerCase()),K+R[0].length):-1}function F(B,Y,K){var R=y.exec(Y.slice(K));return R?(B.m=b.get(R[0].toLowerCase()),K+R[0].length):-1}function _(B,Y,K){var R=g.exec(Y.slice(K));return R?(B.m=m.get(R[0].toLowerCase()),K+R[0].length):-1}function I(B,Y,K){return S(B,t,Y,K)}function T(B,Y,K){return S(B,n,Y,K)}function O(B,Y,K){return S(B,r,Y,K)}function L(B){return o[B.getDay()]}function M(B){return s[B.getDay()]}function P(B){return u[B.getMonth()]}function G(B){return a[B.getMonth()]}function H(B){return i[+(B.getHours()>=12)]}function Q(B){return 1+~~(B.getMonth()/3)}function te(B){return o[B.getUTCDay()]}function ne(B){return s[B.getUTCDay()]}function oe(B){return u[B.getUTCMonth()]}function he(B){return a[B.getUTCMonth()]}function we(B){return i[+(B.getUTCHours()>=12)]}function Ae(B){return 1+~~(B.getUTCMonth()/3)}return{format:function(B){var Y=C(B+="",v);return Y.toString=function(){return B},Y},parse:function(B){var Y=$(B+="",!1);return Y.toString=function(){return B},Y},utcFormat:function(B){var Y=C(B+="",x);return Y.toString=function(){return B},Y},utcParse:function(B){var Y=$(B+="",!0);return Y.toString=function(){return B},Y}}}var SG={"-":"",_:" ",0:"0"},Ir=/^\s*\d+/,cOe=/^%/,fOe=/[\\^$*+?|[\]().{}]/g;function _t(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function hOe(e){return e.replace(fOe,"\\$&")}function Jy(e){return new RegExp("^(?:"+e.map(hOe).join("|")+")","i")}function Qy(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function dOe(e,t,n){var r=Ir.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function pOe(e,t,n){var r=Ir.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function gOe(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function mOe(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function yOe(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function kG(e,t,n){var r=Ir.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function EG(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function bOe(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function xOe(e,t,n){var r=Ir.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function vOe(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function AG(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function wOe(e,t,n){var r=Ir.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function _G(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function $Oe(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function COe(e,t,n){var r=Ir.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function SOe(e,t,n){var r=Ir.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function kOe(e,t,n){var r=Ir.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function EOe(e,t,n){var r=cOe.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function AOe(e,t,n){var r=Ir.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function _Oe(e,t,n){var r=Ir.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function TG(e,t){return _t(e.getDate(),t,2)}function TOe(e,t){return _t(e.getHours(),t,2)}function IOe(e,t){return _t(e.getHours()%12||12,t,2)}function DOe(e,t){return _t(1+Nm.count(zf(e),e),t,3)}function pie(e,t){return _t(e.getMilliseconds(),t,3)}function NOe(e,t){return pie(e,t)+"000"}function FOe(e,t){return _t(e.getMonth()+1,t,2)}function OOe(e,t){return _t(e.getMinutes(),t,2)}function ROe(e,t){return _t(e.getSeconds(),t,2)}function MOe(e){var t=e.getDay();return t===0?7:t}function LOe(e,t){return _t(n6.count(zf(e)-1,e),t,2)}function gie(e){var t=e.getDay();return t>=4||t===0?Qm(e):Qm.ceil(e)}function POe(e,t){return e=gie(e),_t(Qm.count(zf(e),e)+(zf(e).getDay()===4),t,2)}function BOe(e){return e.getDay()}function zOe(e,t){return _t(Zk.count(zf(e)-1,e),t,2)}function UOe(e,t){return _t(e.getFullYear()%100,t,2)}function jOe(e,t){return e=gie(e),_t(e.getFullYear()%100,t,2)}function WOe(e,t){return _t(e.getFullYear()%1e4,t,4)}function VOe(e,t){var n=e.getDay();return e=n>=4||n===0?Qm(e):Qm.ceil(e),_t(e.getFullYear()%1e4,t,4)}function GOe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+_t(t/60|0,"0",2)+_t(t%60,"0",2)}function IG(e,t){return _t(e.getUTCDate(),t,2)}function HOe(e,t){return _t(e.getUTCHours(),t,2)}function qOe(e,t){return _t(e.getUTCHours()%12||12,t,2)}function XOe(e,t){return _t(1+Fm.count(Uf(e),e),t,3)}function mie(e,t){return _t(e.getUTCMilliseconds(),t,3)}function YOe(e,t){return mie(e,t)+"000"}function KOe(e,t){return _t(e.getUTCMonth()+1,t,2)}function ZOe(e,t){return _t(e.getUTCMinutes(),t,2)}function JOe(e,t){return _t(e.getUTCSeconds(),t,2)}function QOe(e){var t=e.getUTCDay();return t===0?7:t}function eRe(e,t){return _t(r6.count(Uf(e)-1,e),t,2)}function yie(e){var t=e.getUTCDay();return t>=4||t===0?e0(e):e0.ceil(e)}function tRe(e,t){return e=yie(e),_t(e0.count(Uf(e),e)+(Uf(e).getUTCDay()===4),t,2)}function nRe(e){return e.getUTCDay()}function rRe(e,t){return _t(Jk.count(Uf(e)-1,e),t,2)}function iRe(e,t){return _t(e.getUTCFullYear()%100,t,2)}function sRe(e,t){return e=yie(e),_t(e.getUTCFullYear()%100,t,2)}function oRe(e,t){return _t(e.getUTCFullYear()%1e4,t,4)}function aRe(e,t){var n=e.getUTCDay();return e=n>=4||n===0?e0(e):e0.ceil(e),_t(e.getUTCFullYear()%1e4,t,4)}function uRe(){return"+0000"}function DG(){return"%"}function NG(e){return+e}function FG(e){return Math.floor(+e/1e3)}var Qg,bie,xie,vie,wie;lRe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function lRe(e){return Qg=die(e),bie=Qg.format,xie=Qg.parse,vie=Qg.utcFormat,wie=Qg.utcParse,Qg}function Mb(e){const t={};return n=>t[n]||(t[n]=e(n))}function cRe(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=fRe(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function fRe(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function $ie(e){const t=Mb(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=iv(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return cRe(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=iv(o??",f");const a=B3e(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=X3e(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=Y3e(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=q3e(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}let CM;hRe();function hRe(){return CM=$ie({format:oie,formatPrefix:aie})}function dRe(e){return $ie(sie(e))}function OG(e){return arguments.length?CM=dRe(e):CM}function RG(e,t,n){n=n||{},K5(n)||gi(`Invalid time multi-format specifier: ${n}`);const r=t(mv),i=t(gv),s=t(pv),o=t(dv),a=t(hv),u=t(fv),l=t(cv),c=t(lv),f=e(n[PI]||".%L"),h=e(n[mv]||":%S"),d=e(n[gv]||"%I:%M"),p=e(n[pv]||"%I %p"),g=e(n[dv]||n[LI]||"%a %d"),m=e(n[hv]||"%b %d"),y=e(n[fv]||"%B"),b=e(n[cv]||"%B"),v=e(n[lv]||"%Y");return x=>(r(x)<x?f:i(x)<x?h:s(x)<x?d:o(x)<x?p:u(x)<x?a(x)<x?g:m:c(x)<x?l(x)<x?y:b:v)(x)}function Cie(e){const t=Mb(e.format),n=Mb(e.utcFormat);return{timeFormat:r=>xM(r)?t(r):RG(t,uOe,r),utcFormat:r=>xM(r)?n(r):RG(n,lOe,r),timeParse:Mb(e.parse),utcParse:Mb(e.utcParse)}}let SM;pRe();function pRe(){return SM=Cie({format:bie,parse:xie,utcFormat:vie,utcParse:wie})}function gRe(e){return Cie(die(e))}function kM(e){return arguments.length?SM=gRe(e):SM}const MG=(e,t)=>Q1({},e,t);function mRe(e,t){const n=arguments.length;return n&&n!==2&&gi("defaultLocale expects either zero or two arguments."),n?MG(OG(e),kM(t)):MG(OG(),kM())}const yRe=/^(data:|([A-Za-z]+:)?\/\/)/,bRe=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,xRe=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,LG="file://";function vRe(e,t){return n=>({options:n||{},sanitize:$Re,load:wRe,fileAccess:!!t,file:CRe(t),http:kRe(e)})}async function wRe(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function $Re(e,t){t=Q1({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=bRe.test(e.replace(xRe,""));(e==null||typeof e!="string"||!a)&&gi("Sanitize failure, invalid URI: "+Q5(e));const u=yRe.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(LG))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(LG.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function CRe(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):SRe}async function SRe(){gi("No file system access.")}function kRe(e){return e?async function(t,n){const r=Q1({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?ma(s[i])?s[i]():s.text():gi(s.status+""+s.statusText)}:ERe}async function ERe(){gi("No HTTP fetch method available.")}const ARe=e=>e!=null&&e===e,_Re=e=>e==="true"||e==="false"||e===!0||e===!1,TRe=e=>!Number.isNaN(Date.parse(e)),Sie=e=>!Number.isNaN(+e)&&!(e instanceof Date),IRe=e=>Sie(e)&&Number.isInteger(+e),PG={boolean:$3e,integer:pG,number:pG,date:S3e,string:k3e,unknown:MI},LC=[_Re,IRe,Sie,TRe],DRe=["boolean","integer","number","date"];function NRe(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=LC.length,i=LC.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&ARe(u)&&!LC[a](u)&&(i[a]=0,++o,o===LC.length))return"string";return DRe[i.reduce((s,o)=>s===0?o:s,0)-1]}function FRe(e,t){return t.reduce((n,r)=>(n[r]=NRe(e,r),n),{})}function BG(e){const t=function(n,r){const i={delimiter:e};return s6(n,r?Q1(r,i):i)};return t.responseType="text",t}function s6(e,t){return t.header&&(e=t.header.map(Q5).join(t.delimiter)+`
`+e),T3e(t.delimiter).parse(e+"")}s6.responseType="text";function ORe(e){return typeof Buffer=="function"&&ma(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function o6(e,t){const n=t&&t.property?qre(t.property):MI;return K5(e)&&!ORe(e)?RRe(n(e),t):n(JSON.parse(e))}o6.responseType="json";function RRe(e,t){return!_u(e)&&v3e(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const MRe={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function kie(e,t){let n,r,i,s;return e=o6(e,t),t&&t.feature?(n=Zre,i=t.feature):t&&t.mesh?(n=Qre,i=t.mesh,s=MRe[t.filter]):gi("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,s):gi("Invalid TopoJSON object: "+i),r&&r.features||[r]}kie.responseType="json";const E3={dsv:s6,csv:BG(","),tsv:BG("	"),json:o6,topojson:kie};function Eie(e,t){return arguments.length>1?(E3[e]=t,this):J5(E3,e)?E3[e]:null}function LRe(e){const t=Eie(e);return t&&t.responseType||"text"}function PRe(e,t,n,r){t=t||{};const i=Eie(t.type||"json");return i||gi("Unknown data format type: "+t.type),e=i(e,t),t.parse&&BRe(e,t.parse,n,r),J5(e,"columns")&&delete e.columns,e}function BRe(e,t,n,r){if(!e.length)return;const i=kM();n=n||i.timeParse,r=r||i.utcParse;let s=e.columns||Object.keys(e[0]),o,a,u,l,c,f;t==="auto"&&(t=FRe(e,s)),s=Object.keys(t);const h=s.map(d=>{const p=t[d];let g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(g[0]==="utc"?r:n)(m);if(!PG[p])throw Error("Illegal format pattern: "+d+":"+p);return PG[p]});for(u=0,c=e.length,f=s.length;u<c;++u)for(o=e[u],l=0;l<f;++l)a=s[l],o[a]=h[l](o[a])}const zRe=vRe(typeof fetch<"u"&&fetch,null);function BI(e){const t=e||MI,n=[],r={};return n.add=i=>{const s=t(i);return r[s]||(r[s]=1,n.push(i)),n},n.remove=i=>{const s=t(i);if(r[s]){r[s]=0;const o=n.indexOf(i);o>=0&&n.splice(o,1)}return n},n}async function XS(e,t){try{await t(e)}catch(n){e.error(n)}}const Aie=Symbol("vega_id");let URe=1;function zI(e){return!!(e&&Le(e))}function Le(e){return e[Aie]}function _ie(e,t){return e[Aie]=t,e}function Nt(e){const t=e===Object(e)?e:{data:e};return Le(t)?t:_ie(t,URe++)}function a6(e){return UI(e,Nt({}))}function UI(e,t){for(const n in e)t[n]=e[n];return t}function Tie(e,t){return _ie(t,Le(e))}function pg(e,t){return e?t?(n,r)=>e(n,r)||Le(t(n))-Le(t(r)):(n,r)=>e(n,r)||Le(n)-Le(r):null}function Iie(e){return e&&e.constructor===gg}function gg(){const e=[],t=[],n=[],r=[],i=[];let s=null,o=!1;return{constructor:gg,insert(a){const u=qk(a),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(a){const u=ma(a)?r:t,l=qk(a),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(a,u,l){const c={field:u,value:Z5(l)};return ma(a)?(c.filter=a,i.push(c)):(c.tuple=a,n.push(c)),this},encode(a,u){return ma(a)?i.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return s=a,this},reflow(){return o=!0,this},pulse(a,u){const l={},c={};let f,h,d,p,g,m;for(f=0,h=u.length;f<h;++f)l[Le(u[f])]=1;for(f=0,h=t.length;f<h;++f)g=t[f],l[Le(g)]=-1;for(f=0,h=r.length;f<h;++f)p=r[f],u.forEach(b=>{p(b)&&(l[Le(b)]=-1)});for(f=0,h=e.length;f<h;++f)g=e[f],m=Le(g),l[m]?l[m]=1:a.add.push(Nt(e[f]));for(f=0,h=u.length;f<h;++f)g=u[f],l[Le(g)]<0&&a.rem.push(g);function y(b,v,x){x?b[v]=x(b):a.encode=v,o||(c[Le(b)]=b)}for(f=0,h=n.length;f<h;++f)d=n[f],g=d.tuple,p=d.field,m=l[Le(g)],m>0&&(y(g,p,d.value),a.modifies(p));for(f=0,h=i.length;f<h;++f)d=i[f],p=d.filter,u.forEach(b=>{p(b)&&l[Le(b)]>0&&y(b,d.field,d.value)}),a.modifies(d.field);if(o)a.mod=t.length||r.length?u.filter(b=>l[Le(b)]>0):u.slice();else for(m in c)a.mod.push(c[m]);return(s||s==null&&(t.length||r.length))&&a.clean(!0),a}}}const YS="_:mod:_";function jI(){Object.defineProperty(this,YS,{writable:!0,value:{}})}jI.prototype={set(e,t,n,r){const i=this,s=i[e],o=i[YS];return t!=null&&t>=0?(s[t]!==n||r)&&(s[t]=n,o[t+":"+e]=-1,o[e]=-1):(s!==n||r)&&(i[e]=n,o[e]=_u(n)?1+n.length:-1),i},modified(e,t){const n=this[YS];if(arguments.length){if(_u(e)){for(let r=0;r<e.length;++r)if(n[e[r]])return!0;return!1}}else{for(const r in n)if(n[r])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[YS]={},this}};let jRe=0;const WRe="pulse",VRe=new jI,GRe=1,HRe=2;function Zt(e,t,n,r){this.id=++jRe,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function zG(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Zt.prototype={targets(){return this._targets||(this._targets=BI(RI))},set(e){return this.value!==e?(this.value=e,1):0},skip:zG(GRe),modified:zG(HRe),parameters(e,t,n){t=t!==!1;const r=this._argval=this._argval||new jI,i=this._argops=this._argops||[],s=[];let o,a,u,l;const c=(f,h,d)=>{d instanceof Zt?(d!==this&&(t&&d.targets().add(this),s.push(d)),i.push({op:d,name:f,index:h})):r.set(f,h,d)};for(o in e)if(a=e[o],o===WRe)qk(a).forEach(f=>{f instanceof Zt?f!==this&&(f.targets().add(this),s.push(f)):gi("Pulse parameters must be operator instances.")}),this.source=a;else if(_u(a))for(r.set(o,-1,Array(u=a.length)),l=0;l<u;++l)c(o,l,a[l]);else c(o,-1,a);return this.marshall().clear(),n&&(i.initonly=!0),s},marshall(e){const t=this._argval||VRe,n=this._argops;let r,i,s,o;if(n){const a=n.length;for(i=0;i<a;++i)r=n[i],s=r.op,o=s.modified()&&s.stamp===e,t.set(r.name,r.index,s.value,o);if(n.initonly){for(i=0;i<a;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function qRe(e,t,n,r){let i=1,s;return e instanceof Zt?s=e:e&&e.prototype instanceof Zt?s=new e:ma(e)?s=new Zt(null,e):(i=0,s=new Zt(e,t)),this.rank(s),i&&(r=n,n=t),n&&this.connect(s,s.parameters(n,r)),this.touch(s),s}function XRe(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}let YRe=0;function WI(e,t,n){this.id=++YRe,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Uc(e,t,n){return new WI(e,t,n)}WI.prototype={_filter:bM,_apply:MI,targets(){return this._targets||(this._targets=BI(RI))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Uc(e);return this.targets().add(t),t},apply(e){const t=Uc(null,e);return this.targets().add(t),t},merge(){const e=Uc();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Uc();return this.targets().add(Uc(null,null,y3e(e,n=>{const r=n.dataflow;t.receive(n),r&&r.run&&r.run()}))),t},between(e,t){let n=!1;return e.targets().add(Uc(null,null,()=>n=!0)),t.targets().add(Uc(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=bM,this._targets=null}};function KRe(e,t,n,r){const i=this,s=Uc(n,r),o=function(l){l.dataflow=i;try{s.receive(l)}catch(c){i.error(c)}finally{i.run()}};let a;typeof e=="string"&&typeof document<"u"?a=document.querySelectorAll(e):a=qk(e);const u=a.length;for(let l=0;l<u;++l)a[l].addEventListener(t,o);return s}function ZRe(e,t){const n=this.locale();return PRe(e,t,n.timeParse,n.utcParse)}function JRe(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function QRe(e,t){const n=this;let r=0,i;try{i=await n.loader().load(e,{context:"dataflow",response:LRe(t&&t.type)});try{i=n.parse(i,t)}catch(s){r=-2,n.warn("Data ingestion failed",e,s)}}catch(s){r=-1,n.warn("Loading failed",e,s)}return{data:i,status:r}}async function eMe(e,t,n){const r=this,i=r._pending||tMe(r);i.requests+=1;const s=await r.request(t,n);return r.pulse(e,r.changeset().remove(bM).insert(s.data||[])),i.done(),s}function tMe(e){let t;const n=new Promise(r=>t=r);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const nMe={skip:!0};function rMe(e,t,n,r,i){return(e instanceof Zt?sMe:iMe)(this,e,t,n,r,i),this}function iMe(e,t,n,r,i,s){const o=Q1({},s,nMe);let a,u;ma(n)||(n=Z5(n)),r===void 0?a=l=>e.touch(n(l)):ma(r)?(u=new Zt(null,r,i,!1),a=l=>{u.evaluate(l);const c=n(l),f=u.value;Iie(f)?e.pulse(c,f,s):e.update(c,f,o)}):a=l=>e.update(n(l),r,o),t.apply(a)}function sMe(e,t,n,r,i,s){if(r===void 0)t.targets().add(n);else{const o=s||{},a=new Zt(null,oMe(n,r),i,!1);a.modified(o.force),a.rank=t.rank,t.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),e.connect(n,[a]))}}function oMe(e,t){return t=ma(t)?t:Z5(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}function aMe(e){e.rank=++this._rank}function uMe(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&gi("Cycle detected in dataflow graph.")}const Qk={},Ka=1,Wc=2,xl=4,lMe=Ka|Wc,UG=Ka|xl,em=Ka|Wc|xl,jG=8,eb=16,WG=32,VG=64;function bf(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function A3(e,t){const n=[];return md(e,t,r=>n.push(r)),n}function GG(e,t){const n={};return e.visit(t,r=>{n[Le(r)]=1}),r=>n[Le(r)]?null:r}function PC(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}bf.prototype={StopPropagation:Qk,ADD:Ka,REM:Wc,MOD:xl,ADD_REM:lMe,ADD_MOD:UG,ALL:em,REFLOW:jG,SOURCE:eb,NO_SOURCE:WG,NO_FIELDS:VG,fork(e){return new bf(this.dataflow).init(this,e)},clone(){const e=this.fork(em);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(em|eb)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new bf(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&VG)&&(n.fields=e.fields),t&Ka?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&Wc?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&xl?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&WG?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||em;return t&Ka&&this.add.length||t&Wc&&this.rem.length||t&xl&&this.mod.length},reflow(e){if(e)return this.fork(em).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(xl,GG(this,Ka))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return _u(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?_u(e)?e.some(r=>n[r]):n[e]:!!n:!1},filter(e,t){const n=this;return e&Ka&&(n.addF=PC(n.addF,t)),e&Wc&&(n.remF=PC(n.remF,t)),e&xl&&(n.modF=PC(n.modF,t)),e&eb&&(n.srcF=PC(n.srcF,t)),n},materialize(e){e=e||em;const t=this;return e&Ka&&t.addF&&(t.add=A3(t.add,t.addF),t.addF=null),e&Wc&&t.remF&&(t.rem=A3(t.rem,t.remF),t.remF=null),e&xl&&t.modF&&(t.mod=A3(t.mod,t.modF),t.modF=null),e&eb&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(e&eb)return md(n.source,n.srcF,r),n;e&Ka&&md(n.add,n.addF,r),e&Wc&&md(n.rem,n.remF,r),e&xl&&md(n.mod,n.modF,r);const i=n.source;if(e&jG&&i){const s=n.add.length+n.mod.length;s===i.length||(s?md(i,GG(n,UG),r):md(i,n.srcF,r))}return n}};function u6(e,t,n,r){const i=this;let s=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(const o of n)if(o.stamp===t){if(o.fields){const a=i.fields||(i.fields={});for(const u in o.fields)a[u]=1}o.changed(i.ADD)&&(s|=i.ADD),o.changed(i.REM)&&(s|=i.REM),o.changed(i.MOD)&&(s|=i.MOD)}this.changes=s}Yre(u6,bf,{fork(e){const t=new bf(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?_u(e)?e.some(r=>n[r]):n[e]:0},filter(){gi("MultiPulse does not support filtering.")},materialize(){gi("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let s=0;if(e&n.SOURCE)for(;s<i;++s)r[s].visit(e,t);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(e,t);return n}});async function cMe(e,t,n){const r=this,i=[];if(r._pulse)return Die(r);if(r._pending&&await r._pending,t&&await XS(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new bf(r,s,e),r._touched.forEach(c=>r._enqueue(c,!0)),r._touched=BI(RI);let o=0,a,u,l;try{for(;r._heap.size()>0;){if(a=r._heap.pop(),a.rank!==a.qrank){r._enqueue(a,!0);continue}u=a.run(r._getPulse(a,e)),u.then?u=await u:u.async&&(i.push(u.async),u=Qk),u!==Qk&&a._targets&&a._targets.forEach(c=>r._enqueue(c)),++o}}catch(c){r._heap.clear(),l=c}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${o} operators`),l&&(r._postrun=[],r.error(l)),r._postrun.length){const c=r._postrun.sort((f,h)=>h.priority-f.priority);r._postrun=[];for(let f=0;f<c.length;++f)await XS(r,c[f].callback)}return n&&await XS(r,n),i.length&&Promise.all(i).then(c=>r.runAsync(null,()=>{c.forEach(f=>{try{f(r)}catch(h){r.error(h)}})})),r}async function fMe(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running}function hMe(e,t,n){return this._pulse?Die(this):(this.evaluate(e,t,n),this)}function dMe(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}}function Die(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function pMe(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function gMe(e,t){const n=e.source,r=this._clock;return n&&_u(n)?new u6(this,r,n.map(i=>i.pulse),t):this._input[e.id]||mMe(this._pulse,n&&n.pulse)}function mMe(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Qk&&(e.source=t.source),e)}const l6={skip:!1,force:!1};function yMe(e,t){const n=t||l6;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function bMe(e,t,n){const r=n||l6;return(e.set(t)||r.force)&&this.touch(e,r),this}function xMe(e,t,n){this.touch(e,n||l6);const r=new bf(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this}function vMe(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Nie(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,wMe(t,0,e)):r=n,r}}}function Nie(e,t,n,r){let i,s;const o=e[n];for(;n>t;){if(s=n-1>>1,i=e[s],r(o,i)<0){e[n]=i,n=s;continue}break}return e[n]=o}function wMe(e,t,n){const r=t,i=e.length,s=e[t];let o=(t<<1)+1,a;for(;o<i;)a=o+1,a<i&&n(e[o],e[a])>=0&&(o=a),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=s,Nie(e,r,t,n)}function Om(){this.logger(m3e()),this.logLevel(Xre),this._clock=0,this._rank=0,this._locale=mRe();try{this._loader=zRe()}catch{}this._touched=BI(RI),this._input={},this._pulse=null,this._heap=vMe((e,t)=>e.qrank-t.qrank),this._postrun=[]}function tb(e){return function(){return this._log[e].apply(this,arguments)}}Om.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:tb("error"),warn:tb("warn"),info:tb("info"),debug:tb("debug"),logLevel:tb("level"),cleanThreshold:1e4,add:qRe,connect:XRe,rank:aMe,rerank:uMe,pulse:xMe,touch:yMe,update:bMe,changeset:gg,ingest:JRe,parse:ZRe,preload:eMe,request:QRe,events:KRe,on:rMe,evaluate:cMe,run:hMe,runAsync:fMe,runAfter:dMe,_enqueue:pMe,_getPulse:gMe};function ee(e,t){Zt.call(this,e,null,t)}Yre(ee,Zt,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const t0={};function Fie(e){const t=Oie(e);return t&&t.Definition||null}function Oie(e){return e=e&&e.toLowerCase(),J5(t0,e)?t0[e]:null}function ey(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Kw(e){let t=e,n=e;e.length===1&&(t=(o,a)=>e(o)-a,n=$Me(e));function r(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)<0?u=c+1:l=c}return u}function i(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)>0?l=c:u=c+1}return u}function s(o,a,u,l){u==null&&(u=0),l==null&&(l=o.length);const c=r(o,a,u,l-1);return c>u&&t(o[c-1],a)>-t(o[c],a)?c-1:c}return{left:r,center:s,right:i}}function $Me(e){return(t,n)=>ey(e(t),n)}function Rie(e){return e===null?NaN:+e}function*CMe(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&(r=+r)>=r&&(yield r)}}const Mie=Kw(ey),jf=Mie.right,SMe=Mie.left;Kw(Rie).center;function kMe(e,t){let n=0,r,i=0,s=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(r=o-i,i+=r/++n,s+=r*(o-i));else{let o=-1;for(let a of e)(a=t(a,++o,e))!=null&&(a=+a)>=a&&(r=a-i,i+=r/++n,s+=r*(a-i))}if(n>1)return s/(n-1)}function EMe(e,t){const n=kMe(e,t);return n&&Math.sqrt(n)}class Li{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[r++]=a),t=o}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=t[--n];n>0&&(r=o,i=t[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}function AMe(e,t){return Array.from(t,n=>e[n])}var EM=Math.sqrt(50),AM=Math.sqrt(10),_M=Math.sqrt(2);function TM(e,t,n){var r,i=-1,s,o,a;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((r=t<e)&&(s=e,e=t,t=s),(a=Lie(e,t,n))===0||!isFinite(a))return[];if(a>0){let u=Math.round(e/a),l=Math.round(t/a);for(u*a<e&&++u,l*a>t&&--l,o=new Array(s=l-u+1);++i<s;)o[i]=(u+i)*a}else{a=-a;let u=Math.round(e*a),l=Math.round(t*a);for(u/a<e&&++u,l/a>t&&--l,o=new Array(s=l-u+1);++i<s;)o[i]=(u+i)/a}return r&&o.reverse(),o}function Lie(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,i);return i>=0?(s>=EM?10:s>=AM?5:s>=_M?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(s>=EM?10:s>=AM?5:s>=_M?2:1)}function Wf(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),s=r/i;return s>=EM?i*=10:s>=AM?i*=5:s>=_M&&(i*=2),t<e?-i:i}function Zd(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function IM(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function Pie(e,t,n=0,r=e.length-1,i=ey){for(;r>n;){if(r-n>600){const u=r-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),d=Math.max(n,Math.floor(t-l*f/u+h)),p=Math.min(r,Math.floor(t+(u-l)*f/u+h));Pie(e,t,d,p,i)}const s=e[t];let o=n,a=r;for(nb(e,n,t),i(e[r],s)>0&&nb(e,n,r);o<a;){for(nb(e,o,a),++o,--a;i(e[o],s)<0;)++o;for(;i(e[a],s)>0;)--a}i(e[n],s)===0?nb(e,n,a):(++a,nb(e,a,r)),a<=t&&(n=a+1),t<=a&&(r=a-1)}return e}function nb(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function DM(e,t,n){if(e=Float64Array.from(CMe(e,n)),!!(r=e.length)){if((t=+t)<=0||r<2)return IM(e);if(t>=1)return Zd(e);var r,i=(r-1)*t,s=Math.floor(i),o=Zd(Pie(e,s).subarray(0,s+1)),a=IM(e.subarray(s+1));return o+(a-o)*(i-s)}}function Bie(e,t,n=Rie){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function _Me(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function zie(e,t){return DM(e,.5,t)}function*TMe(e){for(const t of e)yield*t}function Uie(e){return Array.from(TMe(e))}function Us(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function jie(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function*Wie(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)r=t(r,++n,e),r!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function c6(e,t,n){const r=Float64Array.from(Wie(e,n));return r.sort(ey),t.map(i=>Bie(r,i))}function f6(e,t){return c6(e,[.25,.5,.75],t)}function h6(e,t){const n=e.length,r=EMe(e,t),i=f6(e,t),s=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,s)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function Vie(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let s=e.extent[0],o=e.extent[1],a,u,l,c,f,h;const d=e.span||o-s||Math.abs(s)||1;if(e.step)a=e.step;else if(e.steps){for(c=d/t,f=0,h=e.steps.length;f<h&&e.steps[f]<c;++f);a=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/r),l=e.minstep||0,a=Math.max(l,Math.pow(n,Math.round(Math.log(d)/r)-u));Math.ceil(d/a)>t;)a*=n;for(f=0,h=i.length;f<h;++f)c=a/i[f],c>=l&&d/c<=t&&(a=c)}c=Math.log(a);const p=c>=0?0:~~(-c/r)+1,g=Math.pow(n,-p-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(s/a+g)*a,s=s<c?c-a:c,o=Math.ceil(o/a)*a),{start:s,stop:o===s?s+a:o,step:a}}var Ca=Math.random;function IMe(e){Ca=e}function Gie(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(Wie(e,r)),s=i.length,o=t;let a,u,l,c;for(l=0,c=Array(o);l<o;++l){for(a=0,u=0;u<s;++u)a+=i[~~(Ca()*s)];c[l]=a/s}return c.sort(ey),[DM(c,n/2),DM(c,1-n/2)]}function Hie(e,t,n,r){r=r||(h=>h);const i=e.length,s=new Float64Array(i);let o=0,a=1,u=r(e[0]),l=u,c=u+t,f;for(;a<i;++a){if(f=r(e[a]),f>=c){for(l=(u+l)/2;o<a;++o)s[o]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;o<a;++o)s[o]=l;return n?DMe(s,t+t/4):s}function DMe(e,t){const n=e.length;let r=0,i=1,s,o;for(;e[r]===e[i];)++i;for(;i<n;){for(s=i+1;e[i]===e[s];)++s;if(e[i]-e[i-1]<t){for(o=i+(r+s-i-i>>1);o<i;)e[o++]=e[i];for(;o>i;)e[o--]=e[r]}r=i,i=s}return e}function NMe(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function FMe(e,t){t==null&&(t=e,e=0);let n,r,i;const s={min(o){return arguments.length?(n=o||0,i=r-n,s):n},max(o){return arguments.length?(r=o||0,i=r-n,s):r},sample(){return n+Math.floor(i*Ca())},pdf(o){return o===Math.floor(o)&&o>=n&&o<r?1/i:0},cdf(o){const a=Math.floor(o);return a<n?0:a>=r?1:(a-n+1)/i},icdf(o){return o>=0&&o<=1?n-1+Math.floor(o*i):NaN}};return s.min(e).max(t)}const qie=Math.sqrt(2*Math.PI),OMe=Math.SQRT2;let rb=NaN;function VI(e,t){e=e||0,t=t??1;let n=0,r=0,i,s;if(rb===rb)n=rb,rb=NaN;else{do n=Ca()*2-1,r=Ca()*2-1,i=n*n+r*r;while(i===0||i>1);s=Math.sqrt(-2*Math.log(i)/i),n*=s,rb=r*s}return e+n*t}function d6(e,t,n){n=n??1;const r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*qie)}function GI(e,t,n){t=t||0,n=n??1;const r=(e-t)/n,i=Math.abs(r);let s;if(i>37)s=0;else{const o=Math.exp(-i*i/2);let a;i<7.07106781186547?(a=.0352624965998911*i+.700383064443688,a=a*i+6.37396220353165,a=a*i+33.912866078383,a=a*i+112.079291497871,a=a*i+221.213596169931,a=a*i+220.206867912376,s=o*a,a=.0883883476483184*i+1.75566716318264,a=a*i+16.064177579207,a=a*i+86.7807322029461,a=a*i+296.564248779674,a=a*i+637.333633378831,a=a*i+793.826512519948,a=a*i+440.413735824752,s=s/a):(a=i+.65,a=i+4/a,a=i+3/a,a=i+2/a,a=i+1/a,s=o/a/2.506628274631)}return r>0?1-s:s}function HI(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*OMe*RMe(2*e-1)}function RMe(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function p6(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>VI(n,r),pdf:s=>d6(s,n,r),cdf:s=>GI(s,n,r),icdf:s=>HI(s,n,r)};return i.mean(e).stdev(t)}function g6(e,t){const n=p6();let r=0;const i={data(s){return arguments.length?(e=s,r=s?s.length:0,i.bandwidth(t)):e},bandwidth(s){return arguments.length?(t=s,!t&&e&&(t=h6(e)),i):t},sample(){return e[~~(Ca()*r)]+t*n.sample()},pdf(s){let o=0,a=0;for(;a<r;++a)o+=n.pdf((s-e[a])/t);return o/t/r},cdf(s){let o=0,a=0;for(;a<r;++a)o+=n.cdf((s-e[a])/t);return o/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function m6(e,t){return e=e||0,t=t??1,Math.exp(e+VI()*t)}function y6(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*qie*e)}function b6(e,t,n){return GI(Math.log(e),t,n)}function x6(e,t,n){return Math.exp(HI(e,t,n))}function Xie(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>m6(n,r),pdf:s=>y6(s,n,r),cdf:s=>b6(s,n,r),icdf:s=>x6(s,n,r)};return i.mean(e).stdev(t)}function Yie(e,t){let n=0,r;function i(o){const a=[];let u=0,l;for(l=0;l<n;++l)u+=a[l]=o[l]==null?1:+o[l];for(l=0;l<n;++l)a[l]/=u;return a}const s={weights(o){return arguments.length?(r=i(t=o||[]),s):t},distributions(o){return arguments.length?(o?(n=o.length,e=o):(n=0,e=[]),s.weights(t)):e},sample(){const o=Ca();let a=e[n-1],u=r[0],l=0;for(;l<n-1;u+=r[++l])if(o<u){a=e[l];break}return a.sample()},pdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*e[u].pdf(o);return a},cdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*e[u].cdf(o);return a},icdf(){throw Error("Mixture icdf not supported.")}};return s.distributions(e).weights(t)}function v6(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Ca()}function w6(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function $6(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function C6(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function Kie(e,t){let n,r;const i={min(s){return arguments.length?(n=s||0,i):n},max(s){return arguments.length?(r=s??1,i):r},sample:()=>v6(n,r),pdf:s=>w6(s,n,r),cdf:s=>$6(s,n,r),icdf:s=>C6(s,n,r)};return t==null&&(t=e??1,e=0),i.min(e).max(t)}function Zw(e,t,n,r){const i=r-e*e,s=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-s*e,s]}function qI(e,t,n,r){e=e.filter(d=>{let p=t(d),g=n(d);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),r&&e.sort((d,p)=>t(d)-t(p));const i=e.length,s=new Float64Array(i),o=new Float64Array(i);let a=0,u=0,l=0,c,f,h;for(h of e)s[a]=c=+t(h),o[a]=f=+n(h),++a,u+=(c-u)/a,l+=(f-l)/a;for(a=0;a<i;++a)s[a]-=u,o[a]-=l;return[s,o,u,l]}function Jw(e,t,n,r){let i=-1,s,o;for(const a of e)s=t(a),o=n(a),s!=null&&(s=+s)>=s&&o!=null&&(o=+o)>=o&&r(s,o,++i)}function ty(e,t,n,r,i){let s=0,o=0;return Jw(e,t,n,(a,u)=>{const l=u-i(a),c=u-r;s+=l*l,o+=c*c}),1-s/o}function S6(e,t,n){let r=0,i=0,s=0,o=0,a=0;Jw(e,t,n,(c,f)=>{++a,r+=(c-r)/a,i+=(f-i)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=Zw(r,i,s,o),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:ty(e,t,n,i,l)}}function Zie(e,t,n){let r=0,i=0,s=0,o=0,a=0;Jw(e,t,n,(c,f)=>{++a,c=Math.log(c),r+=(c-r)/a,i+=(f-i)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=Zw(r,i,s,o),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:ty(e,t,n,i,l)}}function Jie(e,t,n){const[r,i,s,o]=qI(e,t,n);let a=0,u=0,l=0,c=0,f=0,h,d,p;Jw(e,t,n,(b,v)=>{h=r[f++],d=Math.log(v),p=h*v,a+=(v*d-a)/f,u+=(p-u)/f,l+=(p*d-l)/f,c+=(h*p-c)/f});const[g,m]=Zw(u/o,a/o,l/o,c/o),y=b=>Math.exp(g+m*(b-s));return{coef:[Math.exp(g-m*s),m],predict:y,rSquared:ty(e,t,n,o,y)}}function Qie(e,t,n){let r=0,i=0,s=0,o=0,a=0,u=0;Jw(e,t,n,(f,h)=>{const d=Math.log(f),p=Math.log(h);++u,r+=(d-r)/u,i+=(p-i)/u,s+=(d*p-s)/u,o+=(d*d-o)/u,a+=(h-a)/u});const l=Zw(r,i,s,o),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:ty(e,t,n,a,c)}}function k6(e,t,n){const[r,i,s,o]=qI(e,t,n),a=r.length;let u=0,l=0,c=0,f=0,h=0,d,p,g,m;for(d=0;d<a;)p=r[d],g=i[d++],m=p*p,u+=(m-u)/d,l+=(m*p-l)/d,c+=(m*m-c)/d,f+=(p*g-f)/d,h+=(m*g-h)/d;const y=c-u*u,b=u*y-l*l,v=(h*u-f*l)/b,x=(f*y-h*l)/b,w=-v*u,C=$=>($=$-s,v*$*$+x*$+w+o);return{coef:[w-x*s+v*s*s+o,x-2*v*s,v],predict:C,rSquared:ty(e,t,n,o,C)}}function ese(e,t,n,r){if(r===1)return S6(e,t,n);if(r===2)return k6(e,t,n);const[i,s,o,a]=qI(e,t,n),u=i.length,l=[],c=[],f=r+1;let h,d,p,g,m;for(h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h)*s[p];for(l.push(g),m=new Float64Array(f),d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h+d);m[d]=g}c.push(m)}c.push(l);const y=LMe(c),b=v=>{v-=o;let x=a+y[0]+y[1]*v+y[2]*v*v;for(h=3;h<f;++h)x+=y[h]*Math.pow(v,h);return x};return{coef:MMe(f,y,-o,a),predict:b,rSquared:ty(e,t,n,a,b)}}function MMe(e,t,n,r){const i=Array(e);let s,o,a,u;for(s=0;s<e;++s)i[s]=0;for(s=e-1;s>=0;--s)for(a=t[s],u=1,i[s]+=a,o=1;o<=s;++o)u*=(s+1-o)/o,i[s-o]+=a*Math.pow(n,o)*u;return i[0]+=r,i}function LMe(e){const t=e.length-1,n=[];let r,i,s,o,a;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(s=r;s<t+1;++s)a=e[s][r],e[s][r]=e[s][o],e[s][o]=a;for(i=r+1;i<t;++i)for(s=t;s>=r;s--)e[s][i]-=e[s][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(a=0,s=i+1;s<t;++s)a+=e[s][i]*n[s];n[i]=(e[t][i]-a)/e[i][i]}return n}const HG=2,qG=1e-12;function tse(e,t,n,r){const[i,s,o,a]=qI(e,t,n,!0),u=i.length,l=Math.max(2,~~(r*u)),c=new Float64Array(u),f=new Float64Array(u),h=new Float64Array(u).fill(1);for(let d=-1;++d<=HG;){const p=[0,l-1];for(let m=0;m<u;++m){const y=i[m],b=p[0],v=p[1],x=y-i[b]>i[v]-y?b:v;let w=0,C=0,$=0,S=0,k=0;const E=1/Math.abs(i[x]-y||1);for(let _=b;_<=v;++_){const I=i[_],T=s[_],O=PMe(Math.abs(y-I)*E)*h[_],L=I*O;w+=O,C+=L,$+=T*O,S+=T*L,k+=I*L}const[A,F]=Zw(C/w,$/w,S/w,k/w);c[m]=A+F*y,f[m]=Math.abs(s[m]-c[m]),BMe(i,m+1,p)}if(d===HG)break;const g=zie(f);if(Math.abs(g)<qG)break;for(let m=0,y,b;m<u;++m)y=f[m]/(6*g),h[m]=y>=1?qG:(b=1-y*y)*b}return zMe(i,c,o,a)}function PMe(e){return(e=1-e*e*e)*e*e}function BMe(e,t,n){const r=e[t];let i=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>i&&e[s]-r<=r-e[i];)n[0]=++i,n[1]=s,++s}function zMe(e,t,n,r){const i=e.length,s=[];let o=0,a=0,u=[],l;for(;o<i;++o)l=e[o]+n,u[0]===l?u[1]+=(t[o]-u[1])/++a:(a=0,u[1]+=r,u=[l,t[o]],s.push(u));return u[1]+=r,s}const UMe=.5*Math.PI/180;function XI(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=g=>[g,e(g)],s=t[0],o=t[1],a=o-s,u=a/r,l=[i(s)],c=[];if(n===r){for(let g=1;g<r;++g)l.push(i(s+g/n*a));return l.push(i(o)),l}else{c.push(i(o));for(let g=n;--g>0;)c.push(i(s+g/n*a))}let f=l[0],h=c[c.length-1];const d=1/a,p=jMe(f[1],c);for(;h;){const g=i((f[0]+h[0])/2);g[0]-f[0]>=u&&WMe(f,g,h,d,p)>UMe?c.push(g):(f=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function jMe(e,t){let n=e,r=e;const i=t.length;for(let s=0;s<i;++s){const o=t[s][1];o<n&&(n=o),o>r&&(r=o)}return 1/(r-n)}function WMe(e,t,n,r,i){const s=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),o=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(s-o)}var _3=new Date,T3=new Date;function Dr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=function(s){return e(s=new Date(+s)),s},i.ceil=function(s){return e(s=new Date(s-1)),t(s,1),e(s),s},i.round=function(s){var o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=function(s,o){return t(s=new Date(+s),o==null?1:Math.floor(o)),s},i.range=function(s,o,a){var u=[],l;if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=function(s){return Dr(function(o){if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},function(o,a){if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););})},n&&(i.count=function(s,o){return _3.setTime(+s),T3.setTime(+o),e(_3),e(T3),Math.floor(n(_3,T3))},i.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?function(o){return r(o)%s===0}:function(o){return i.count(0,o)%s===0}):i}),i}var eE=Dr(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});eE.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Dr(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):eE};const E6=eE;eE.range;const Ol=1e3,po=Ol*60,Rl=po*60,$p=Rl*24,A6=$p*7,XG=$p*30,I3=$p*365;var nse=Dr(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*Ol)},function(e,t){return(t-e)/Ol},function(e){return e.getUTCSeconds()});const Jc=nse;nse.range;var rse=Dr(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ol)},function(e,t){e.setTime(+e+t*po)},function(e,t){return(t-e)/po},function(e){return e.getMinutes()});const _6=rse;rse.range;var ise=Dr(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ol-e.getMinutes()*po)},function(e,t){e.setTime(+e+t*Rl)},function(e,t){return(t-e)/Rl},function(e){return e.getHours()});const T6=ise;ise.range;var sse=Dr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*po)/$p,e=>e.getDate()-1);const xf=sse;sse.range;function mg(e){return Dr(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*po)/A6})}var ny=mg(0),tE=mg(1),VMe=mg(2),GMe=mg(3),n0=mg(4),HMe=mg(5),qMe=mg(6);ny.range;tE.range;VMe.range;GMe.range;n0.range;HMe.range;qMe.range;var yv=Dr(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()});yv.range;var I6=Dr(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});I6.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Dr(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};const Vf=I6;I6.range;var ose=Dr(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*po)},function(e,t){return(t-e)/po},function(e){return e.getUTCMinutes()});const D6=ose;ose.range;var ase=Dr(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Rl)},function(e,t){return(t-e)/Rl},function(e){return e.getUTCHours()});const N6=ase;ase.range;var use=Dr(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/$p},function(e){return e.getUTCDate()-1});const vf=use;use.range;function yg(e){return Dr(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/A6})}var ry=yg(0),nE=yg(1),XMe=yg(2),YMe=yg(3),r0=yg(4),KMe=yg(5),ZMe=yg(6);ry.range;nE.range;XMe.range;YMe.range;r0.range;KMe.range;ZMe.range;var bv=Dr(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()});bv.range;var F6=Dr(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});F6.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Dr(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};const Gf=F6;F6.range;function lse(e,t,n,r,i,s){const o=[[Jc,1,Ol],[Jc,5,5*Ol],[Jc,15,15*Ol],[Jc,30,30*Ol],[s,1,po],[s,5,5*po],[s,15,15*po],[s,30,30*po],[i,1,Rl],[i,3,3*Rl],[i,6,6*Rl],[i,12,12*Rl],[r,1,$p],[r,2,2*$p],[n,1,A6],[t,1,XG],[t,3,3*XG],[e,1,I3]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=Kw(([,,m])=>m).right(o,h);if(d===o.length)return e.every(Wf(l/I3,c/I3,f));if(d===0)return E6.every(Math.max(Wf(l,c,f),1));const[p,g]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(g)}return[a,u]}const[JMe,QMe]=lse(Gf,bv,ry,vf,N6,D6),[e4e,t4e]=lse(Vf,yv,ny,xf,T6,_6),Wr="year",xs="quarter",mi="month",Qn="week",vs="date",ai="day",Tu="dayofyear",Xs="hours",Ys="minutes",To="seconds",Sa="milliseconds",O6=[Wr,xs,mi,Qn,vs,ai,Tu,Xs,Ys,To,Sa],D3=O6.reduce((e,t,n)=>(e[t]=1+n,e),{});function R6(e){const t=Qe(e).slice(),n={};return t.length||ae("Missing time unit."),t.forEach(i=>{tt(D3,i)?n[i]=1:ae("Invalid time unit: ".concat(i,"."))}),(n[Qn]||n[ai]?1:0)+(n[xs]||n[mi]||n[vs]?1:0)+(n[Tu]?1:0)>1&&ae("Incompatible time units: ".concat(e)),t.sort((i,s)=>D3[i]-D3[s]),t}const n4e={[Wr]:"%Y ",[xs]:"Q%q ",[mi]:"%b ",[vs]:"%d ",[Qn]:"W%U ",[ai]:"%a ",[Tu]:"%j ",[Xs]:"%H:00",[Ys]:"00:%M",[To]:":%S",[Sa]:".%L",["".concat(Wr,"-").concat(mi)]:"%Y-%m ",["".concat(Wr,"-").concat(mi,"-").concat(vs)]:"%Y-%m-%d ",["".concat(Xs,"-").concat(Ys)]:"%H:%M"};function cse(e,t){const n=pt({},n4e,t),r=R6(e),i=r.length;let s="",o=0,a,u;for(o=0;o<i;)for(a=r.length;a>o;--a)if(u=r.slice(o,a).join("-"),n[u]!=null){s+=n[u],o=a;break}return s.trim()}const $d=new Date;function M6(e){return $d.setFullYear(e),$d.setMonth(0),$d.setDate(1),$d.setHours(0,0,0,0),$d}function fse(e){return dse(new Date(e))}function hse(e){return NM(new Date(e))}function dse(e){return xf.count(M6(e.getFullYear())-1,e)}function NM(e){return ny.count(M6(e.getFullYear())-1,e)}function FM(e){return M6(e).getDay()}function r4e(e,t,n,r,i,s,o){if(0<=e&&e<100){const a=new Date(-1,t,n,r,i,s,o);return a.setFullYear(e),a}return new Date(e,t,n,r,i,s,o)}function pse(e){return mse(new Date(e))}function gse(e){return OM(new Date(e))}function mse(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return vf.count(t-1,e)}function OM(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return ry.count(t-1,e)}function RM(e){return $d.setTime(Date.UTC(e,0,1)),$d.getUTCDay()}function i4e(e,t,n,r,i,s,o){if(0<=e&&e<100){const a=new Date(Date.UTC(-1,t,n,r,i,s,o));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(e,t,n,r,i,s,o))}function yse(e,t,n,r,i){const s=t||1,o=qt(e),a=(y,b,v)=>(v=v||y,s4e(n[v],r[v],y===o&&s,b)),u=new Date,l=ic(e),c=l[Wr]?a(Wr):_o(2012),f=l[mi]?a(mi):l[xs]?a(xs):Yc,h=l[Qn]&&l[ai]?a(ai,1,Qn+ai):l[Qn]?a(Qn,1):l[ai]?a(ai,1):l[vs]?a(vs,1):l[Tu]?a(Tu,1):Y1,d=l[Xs]?a(Xs):Yc,p=l[Ys]?a(Ys):Yc,g=l[To]?a(To):Yc,m=l[Sa]?a(Sa):Yc;return function(y){u.setTime(+y);const b=c(u);return i(b,f(u),h(u,b),d(u),p(u),g(u),m(u))}}function s4e(e,t,n,r){const i=n<=1?e:r?(s,o)=>r+n*Math.floor((e(s,o)-r)/n):(s,o)=>n*Math.floor(e(s,o)/n);return t?(s,o)=>t(i(s,o),o):i}function i0(e,t,n){return t+e*7-(n+6)%7}const o4e={[Wr]:e=>e.getFullYear(),[xs]:e=>Math.floor(e.getMonth()/3),[mi]:e=>e.getMonth(),[vs]:e=>e.getDate(),[Xs]:e=>e.getHours(),[Ys]:e=>e.getMinutes(),[To]:e=>e.getSeconds(),[Sa]:e=>e.getMilliseconds(),[Tu]:e=>dse(e),[Qn]:e=>NM(e),[Qn+ai]:(e,t)=>i0(NM(e),e.getDay(),FM(t)),[ai]:(e,t)=>i0(1,e.getDay(),FM(t))},a4e={[xs]:e=>3*e,[Qn]:(e,t)=>i0(e,0,FM(t))};function bse(e,t){return yse(e,t||1,o4e,a4e,r4e)}const u4e={[Wr]:e=>e.getUTCFullYear(),[xs]:e=>Math.floor(e.getUTCMonth()/3),[mi]:e=>e.getUTCMonth(),[vs]:e=>e.getUTCDate(),[Xs]:e=>e.getUTCHours(),[Ys]:e=>e.getUTCMinutes(),[To]:e=>e.getUTCSeconds(),[Sa]:e=>e.getUTCMilliseconds(),[Tu]:e=>mse(e),[Qn]:e=>OM(e),[ai]:(e,t)=>i0(1,e.getUTCDay(),RM(t)),[Qn+ai]:(e,t)=>i0(OM(e),e.getUTCDay(),RM(t))},l4e={[xs]:e=>3*e,[Qn]:(e,t)=>i0(e,0,RM(t))};function xse(e,t){return yse(e,t||1,u4e,l4e,i4e)}const c4e={[Wr]:Vf,[xs]:yv.every(3),[mi]:yv,[Qn]:ny,[vs]:xf,[ai]:xf,[Tu]:xf,[Xs]:T6,[Ys]:_6,[To]:Jc,[Sa]:E6},f4e={[Wr]:Gf,[xs]:bv.every(3),[mi]:bv,[Qn]:ry,[vs]:vf,[ai]:vf,[Tu]:vf,[Xs]:N6,[Ys]:D6,[To]:Jc,[Sa]:E6};function iy(e){return c4e[e]}function sy(e){return f4e[e]}function vse(e,t,n){return e?e.offset(t,n):void 0}function wse(e,t,n){return vse(iy(e),t,n)}function $se(e,t,n){return vse(sy(e),t,n)}function Cse(e,t,n,r){return e?e.range(t,n,r):void 0}function Sse(e,t,n,r){return Cse(iy(e),t,n,r)}function kse(e,t,n,r){return Cse(sy(e),t,n,r)}const Lb=1e3,Pb=Lb*60,Bb=Pb*60,YI=Bb*24,h4e=YI*7,YG=YI*30,MM=YI*365,Ese=[Wr,mi,vs,Xs,Ys,To,Sa],zb=Ese.slice(0,-1),Ub=zb.slice(0,-1),jb=Ub.slice(0,-1),d4e=jb.slice(0,-1),p4e=[Wr,Qn],KG=[Wr,mi],Ase=[Wr],ib=[[zb,1,Lb],[zb,5,5*Lb],[zb,15,15*Lb],[zb,30,30*Lb],[Ub,1,Pb],[Ub,5,5*Pb],[Ub,15,15*Pb],[Ub,30,30*Pb],[jb,1,Bb],[jb,3,3*Bb],[jb,6,6*Bb],[jb,12,12*Bb],[d4e,1,YI],[p4e,1,h4e],[KG,1,YG],[KG,3,3*YG],[Ase,1,MM]];function _se(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(OI(t))/n;let i=Kw(a=>a[2]).right(ib,r),s,o;return i===ib.length?(s=Ase,o=Wf(t[0]/MM,t[1]/MM,n)):i?(i=ib[r/ib[i-1][2]<ib[i][2]/r?i-1:i],s=i[0],o=i[1]):(s=Ese,o=Math.max(Wf(t[0],t[1],n),1)),{units:s,step:o}}function g4e(e){return t=>{const n=e.length;let r=1,i=String(e[0](t));for(;r<n;++r)i+="|"+e[r](t);return i}}function LM(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:g4e(e)}function Tse(e,t,n){return n||e+(t?"_"+t:"")}const N3=()=>{},m4e={init:N3,add:N3,rem:N3,idx:0},xv={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Qw=Object.keys(xv);function y4e(e,t){return n=>pt({name:e,out:n||e},m4e,t)}Qw.forEach(e=>{xv[e]=y4e(e,xv[e])});function Ise(e,t){return xv[e](t)}function Dse(e,t){return e.idx-t.idx}function b4e(e){const t={};e.forEach(r=>t[r.name]=r);const n=r=>{r.req&&r.req.forEach(i=>{t[i]||n(t[i]=xv[i]())})};return e.forEach(n),Object.values(t).sort(Dse)}function x4e(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function v4e(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function w4e(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function $4e(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function Nse(e,t){const n=t||Ao,r=b4e(e),i=e.slice().sort(Dse);function s(o){this._ops=r,this._out=i,this.cell=o,this.init()}return s.prototype.init=x4e,s.prototype.add=v4e,s.prototype.rem=w4e,s.prototype.set=$4e,s.prototype.get=n,s.fields=e.map(o=>o.out),s}function L6(e){this._key=e?Mf(e):Le,this.reset()}const Hr=L6.prototype;Hr.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};Hr.add=function(e){this._add.push(e)};Hr.rem=function(e){this._rem.push(e)};Hr.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,s=Array(r-i),o={};let a,u,l;for(a=0;a<i;++a)o[n(t[a])]=1;for(a=0,u=0;a<r;++a)o[n(l=e[a])]?o[n(l)]=0:s[u++]=l;return this._rem=[],this._add=s};Hr.distinct=function(e){const t=this.values(),n={};let r=t.length,i=0,s;for(;--r>=0;)s=e(t[r])+"",tt(n,s)||(n[s]=1,++i);return i};Hr.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Pre(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};Hr.argmin=function(e){return this.extent(e)[0]||{}};Hr.argmax=function(e){return this.extent(e)[1]||{}};Hr.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};Hr.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};Hr.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=f6(this.values(),e),this._get=e),this._q};Hr.q1=function(e){return this.quartile(e)[0]};Hr.q2=function(e){return this.quartile(e)[1]};Hr.q3=function(e){return this.quartile(e)[2]};Hr.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=Gie(this.values(),1e3,.05,e),this._get=e),this._ci};Hr.ci0=function(e){return this.ci(e)[0]};Hr.ci1=function(e){return this.ci(e)[1]};function Hf(e){ee.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Hf.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Qw},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};ye(Hf,ee,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),r.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function s(a){let u,l,c,f;for(u in a)for(c=a[u].tuple,l=0;l<i;++l)r[l][f=c[n[l]]]=f}s(e._prev),s(t);function o(a,u,l){const c=n[l],f=r[l++];for(const h in f){const d=a?a+"|"+h:h;u[c]=f[h],l<i?o(d,u,l):t[d]||e.cell(d,u)}}o("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(m){const y=Qe(pi(m)),b=y.length;let v=0,x;for(;v<b;++v)r[x=y[v]]||(r[x]=1,t.push(x))}this._dims=Qe(e.groupby),this._dnames=this._dims.map(m=>{const y=_n(m);return i(m),n.push(y),y}),this.cellkey=e.key?e.key:LM(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],o=e.ops||["count"],a=e.as||[],u=s.length,l={};let c,f,h,d,p,g;for(u!==o.length&&ae("Unmatched number of fields and aggregate ops."),g=0;g<u;++g){if(c=s[g],f=o[g],c==null&&f!=="count"&&ae("Null aggregate field specified."),d=_n(c),p=Tse(f,d,a[g]),n.push(p),f==="count"){this._counts.push(p);continue}h=l[d],h||(i(c),h=l[d]=[],h.field=c,this._measures.push(h)),f!=="count"&&(this._countOnly=!1),h.push(Ise(f,p))}return this._measures=this._measures.map(m=>Nse(m,m.field)),{}},cellkey:LM(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let s=0;s<i;++s)n.agg[s]=new r[s](n)}return n.store&&(n.data=new L6),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,s={};for(let o=0;o<i;++o)s[n[o]]=r[o](e);return t?Tie(t.tuple,s):Nt(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const r=e.agg;for(let i=0,s=r.length;i<s;++i)r[i].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,s=e.add,o=e.rem,a=e.mod;let u,l,c,f;if(r)for(l in r)u=r[l],(!i||u.num)&&o.push(u.tuple);for(c=0,f=this._alen;c<f;++c)s.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&i?o:a).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const C4e=1e-14;function P6(e){ee.call(this,null,e)}P6.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};ye(P6,ee,{transform(e,t){const n=e.interval!==!1,r=this._bins(e),i=r.start,s=r.step,o=e.as||["bin0","bin1"],a=o[0],u=o[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(pi(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=r(c);c[a]=f,c[u]=f==null?null:i+s*(1+(f-i)/s)}:c=>c[a]=r(c)),t.modifies(n?o:a)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Vie(e),r=n.step;let i=n.start,s=i+Math.ceil((n.stop-i)/r)*r,o,a;(o=e.anchor)!=null&&(a=o-(i+r*Math.floor((o-i)/r)),i+=a,s+=a);const u=function(l){let c=Lf(t(l));return c==null?null:c<i?-1/0:c>s?1/0:(c=Math.max(i,Math.min(c,s-r)),i+r*Math.floor(C4e+(c-i)/r))};return u.start=i,u.stop=n.stop,u.step=r,this.value=Mo(u,pi(t),e.name||"bin_"+_n(t))}});function Fse(e,t,n){const r=e;let i=t||[],s=n||[],o={},a=0;return{add:u=>s.push(u),remove:u=>o[r(u)]=++a,size:()=>i.length,data:(u,l)=>(a&&(i=i.filter(c=>!o[r(c)]),o={},a=0),l&&u&&i.sort(u),s.length&&(i=u?Wre(u,i,s.sort(u)):i.concat(s),s=[]),i)}}function B6(e){ee.call(this,[],e)}B6.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};ye(B6,ee,{transform(e,t){const n=t.fork(t.ALL),r=Fse(Le,this.value,n.materialize(n.ADD).add),i=e.sort,s=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(pg(i),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function Ose(e){Zt.call(this,null,S4e,e)}ye(Ose,Zt);function S4e(e){return this.value&&!e.modified()?this.value:Mre(e.fields,e.orders)}function z6(e){ee.call(this,null,e)}z6.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function k4e(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}ye(z6,ee,{transform(e,t){const n=f=>h=>{for(var d=k4e(a(h),e.case,s)||[],p,g=0,m=d.length;g<m;++g)o.test(p=d[g])||f(p)},r=this._parameterCheck(e,t),i=this._counts,s=this._match,o=this._stop,a=e.field,u=e.as||["text","count"],l=n(f=>i[f]=1+(i[f]||0)),c=n(f=>i[f]-=1);return r?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],s=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let a,u,l;for(a in n)u=r[a],l=n[a]||0,!u&&l?(r[a]=u=Nt({}),u[i]=a,u[s]=l,o.add.push(u)):l===0?(u&&o.rem.push(u),n[a]=null,r[a]=null):u[s]!==l&&(u[s]=l,o.mod.push(u));return o.modifies(t)}});function U6(e){ee.call(this,null,e)}U6.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};ye(U6,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],s=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let a=this.value;return o?(a&&(n.rem=a),a=t.materialize(t.SOURCE).source,n.add=this.value=E4e(a,i,s,e.filter||K1)):n.mod=a,n.source=this.value,n.modifies(r)}});function E4e(e,t,n,r){for(var i=[],s={},o=e.length,a=0,u,l;a<o;++a)for(s[t]=l=e[a],u=0;u<o;++u)s[n]=e[u],r(s)&&(i.push(Nt(s)),s={},s[t]=l);return i}const ZG={kde:g6,mixture:Yie,normal:p6,lognormal:Xie,uniform:Kie},A4e="distributions",JG="function",_4e="field";function Rse(e,t){const n=e[JG];tt(ZG,n)||ae("Unknown distribution function: "+n);const r=ZG[n]();for(const i in e)i===_4e?r.data((e.from||t()).map(e[i])):i===A4e?r[i](e[i].map(s=>Rse(s,t))):typeof r[i]===JG&&r[i](e[i]);return r}function j6(e){ee.call(this,null,e)}const Mse=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],T4e={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Mse},{name:"weights",type:"number",array:!0}]};j6.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Mse.concat(T4e)},{name:"as",type:"string",array:!0,default:["value","density"]}]};ye(j6,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Rse(e.distribution,I4e(t)),i=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&ae("Invalid density method: "+o),!e.extent&&!r.data&&ae("Missing density extent parameter."),o=r[o];const a=e.as||["value","density"],u=e.extent||Pf(r.data()),l=XI(o,u,i,s).map(c=>{const f={};return f[a[0]]=c[0],f[a[1]]=c[1],Nt(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function I4e(e){return()=>e.materialize(e.SOURCE).source}function Lse(e,t){return e?e.map((n,r)=>t[r]||_n(n)):null}function W6(e,t,n){const r=[],i=f=>f(u);let s,o,a,u,l,c;if(t==null)r.push(e.map(n));else for(s={},o=0,a=e.length;o<a;++o)u=e[o],l=t.map(i),c=s[l],c||(s[l]=c=[],c.dims=l,r.push(c)),c.push(n(u));return r}const Pse="bin";function V6(e){ee.call(this,null,e)}V6.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:Pse}]};const D4e=(e,t)=>OI(Pf(e,t))/30;ye(V6,ee,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,r=W6(t.source,e.groupby,Ao),i=e.smooth||!1,s=e.field,o=e.step||D4e(n,s),a=pg((p,g)=>s(p)-s(g)),u=e.as||Pse,l=r.length;let c=1/0,f=-1/0,h=0,d;for(;h<l;++h){const p=r[h].sort(a);d=-1;for(const g of Hie(p,o,i,s))g<c&&(c=g),g>f&&(f=g),p[++d][u]=g}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(u)}});function Bse(e){Zt.call(this,null,N4e,e),this.modified(!0)}ye(Bse,Zt);function N4e(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Mo(n=>t(n,e),pi(t),_n(t))}function G6(e){ee.call(this,[void 0,void 0],e)}G6.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};ye(G6,ee,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let s=n[0],o=n[1];if((i||s==null)&&(s=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,a=>{const u=Lf(r(a));u!=null&&(u<s&&(s=u),u>o&&(o=u))}),!Number.isFinite(s)||!Number.isFinite(o)){let a=_n(r);a&&(a=` for field "${a}"`),t.dataflow.warn(`Infinite extent${a}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]}});function H6(e,t){Zt.call(this,e),this.parent=t,this.count=0}ye(H6,Zt,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function KI(e){ee.call(this,{},e),this._keys=Z1();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let r=0,i=t.active;r<i;++r)n(t[r],r,t)}}ye(KI,ee,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let s=tt(i,e)&&i[e],o,a;return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=r||(a=this._group[e])&&a.tuple,o=n.dataflow,s=new H6(n.fork(n.NO_SOURCE),this),o.add(s).connect(t(o,e,a)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&t[i]!=null;++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,s=this._keys,o=e.modified("key"),a=u=>this.subflow(u,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=Le(u),c=s.get(l);c!==void 0&&(s.delete(l),a(c).rem(u))}),t.visit(t.ADD,u=>{const l=r(u);s.set(Le(u),l),a(l).add(u)}),o||t.modified(r.fields)?t.visit(t.MOD,u=>{const l=Le(u),c=s.get(l),f=r(u);c===f?a(f).mod(u):(s.set(l,f),a(c).rem(u),a(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{a(s.get(Le(u))).mod(u)}),o&&t.visit(t.REFLOW,u=>{const l=Le(u),c=s.get(l),f=r(u);c!==f&&(s.set(l,f),a(c).rem(u),a(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}});function zse(e){Zt.call(this,null,F4e,e)}ye(zse,Zt);function F4e(e){return this.value&&!e.modified()?this.value:rt(e.name)?Qe(e.name).map(t=>Mf(t)):Mf(e.name,e.as)}function q6(e){ee.call(this,Z1(),e)}q6.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};ye(q6,ee,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),s=i.add,o=i.rem,a=i.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const h=Le(f);r.has(h)?r.delete(h):o.push(f)}),t.visit(t.ADD,f=>{u(f,e)?s.push(f):r.set(Le(f),1)});function c(f){const h=Le(f),d=u(f,e),p=r.get(h);d&&p?(r.delete(h),s.push(f)):!d&&!p?(r.set(h,1),o.push(f)):l&&d&&!p&&a.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}});function X6(e){ee.call(this,[],e)}X6.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};ye(X6,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Lse(r,e.as||[]),s=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,a=>{const u=r.map(p=>p(a)),l=u.reduce((p,g)=>Math.max(p,g.length),0);let c=0,f,h,d;for(;c<l;++c){for(h=a6(a),f=0;f<o;++f)h[i[f]]=(d=u[f][c])==null?null:d;s&&(h[s]=c),n.add.push(h)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)}});function Y6(e){ee.call(this,[],e)}Y6.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};ye(Y6,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(_n),s=e.as||["key","value"],o=s[0],a=s[1],u=r.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=a6(l),f[o]=i[c],f[a]=r[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(s)}});function K6(e){ee.call(this,null,e)}K6.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};ye(K6,ee,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),s=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(s,o=>o[r]=n(o,e))}});function Use(e){ee.call(this,[],e)}ye(Use,ee,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i=this.value,s=e.size-i.length,o,a,u;if(s>0){for(o=[];--s>=0;)o.push(u=Nt(r(e))),i.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else a=i.slice(0,-s),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,i=i.slice(-s);return n.source=this.value=i,n}});const BC={value:"value",median:zie,mean:_Me,min:IM,max:Zd},O4e=[];function Z6(e){ee.call(this,[],e)}Z6.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function R4e(e){var t=e.method||BC.value,n;if(BC[t]==null)ae("Unrecognized imputation method: "+t);else return t===BC.value?(n=e.value!==void 0?e.value:0,()=>n):BC[t]}function M4e(e){const t=e.field;return n=>n?t(n):NaN}ye(Z6,ee,{transform(e,t){var n=t.fork(t.ALL),r=R4e(e),i=M4e(e),s=_n(e.field),o=_n(e.key),a=(e.groupby||[]).map(_n),u=L4e(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,h,d,p,g,m,y,b,v,x,w;for(m=0,v=u.length;m<v;++m)for(h=u[m],p=h.values,d=NaN,b=0;b<f;++b)if(h[b]==null){for(g=u.domain[b],w={_impute:!0},y=0,x=p.length;y<x;++y)w[a[y]]=p[y];w[o]=g,w[s]=Number.isNaN(d)?d=r(h,i):d,l.push(Nt(w))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function L4e(e,t,n,r){var i=y=>y(m),s=[],o=r?r.slice():[],a={},u={},l,c,f,h,d,p,g,m;for(o.forEach((y,b)=>a[y]=b+1),h=0,g=e.length;h<g;++h)m=e[h],p=n(m),d=a[p]||(a[p]=o.push(p)),c=(l=t?t.map(i):O4e)+"",(f=u[c])||(f=u[c]=[],s.push(f),f.values=l),f[d-1]=m;return s.domain=o,s}function J6(e){Hf.call(this,e)}J6.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Qw},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};ye(J6,Hf,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(i=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{pt(s,i[n.cellkey(s)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function Q6(e){ee.call(this,null,e)}Q6.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};ye(Q6,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=W6(r,e.groupby,e.field),s=(e.groupby||[]).map(_n),o=e.bandwidth,a=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;a!=="pdf"&&a!=="cdf"&&ae("Invalid density method: "+a),e.resolve==="shared"&&(c||(c=Pf(r,e.field)),f=h=e.steps||h),i.forEach(d=>{const p=g6(d,o)[a],g=e.counts?d.length:1,m=c||Pf(d);XI(p,m,f,h).forEach(y=>{const b={};for(let v=0;v<s.length;++v)b[s[v]]=d.dims[v];b[u[0]]=y[0],b[u[1]]=y[1]*g,l.push(Nt(b))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function jse(e){Zt.call(this,null,P4e,e)}ye(jse,Zt);function P4e(e){return this.value&&!e.modified()?this.value:Ure(e.fields,e.flat)}function Wse(e){ee.call(this,[],e),this._pending=null}ye(Wse,ee,{transform(e,t){const n=t.dataflow;return this._pending?F3(this,t,this._pending):B4e(e)?t.StopPropagation:e.values?F3(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(i=>(this._pending=Qe(i.data),s=>s.touch(this)))}:n.request(e.url,e.format).then(r=>F3(this,t,Qe(r.data)))}});function B4e(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function F3(e,t,n){n.forEach(Nt);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function ez(e){ee.call(this,{},e)}ez.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};ye(ez,ee,{transform(e,t){const n=e.fields,r=e.index,i=e.values,s=e.default==null?null:e.default,o=e.modified(),a=n.length;let u=o?t.SOURCE:t.ADD,l=t,c=e.as,f,h,d;return i?(h=i.length,a>1&&!c&&ae('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==a*h&&ae('The "as" parameter has too few output field names.'),c=c||i.map(_n),f=function(p){for(var g=0,m=0,y,b;g<a;++g)if(b=r.get(n[g](p)),b==null)for(y=0;y<h;++y,++m)p[c[m]]=s;else for(y=0;y<h;++y,++m)p[c[m]]=i[y](b)}):(c||ae("Missing output field names."),f=function(p){for(var g=0,m;g<a;++g)m=r.get(n[g](p)),p[c[g]]=m??s}),o?l=t.reflow(!0):(d=n.some(p=>t.modified(p.fields)),u|=d?t.MOD:0),t.visit(u,f),l.modifies(c)}});function Vse(e){Zt.call(this,null,z4e,e)}ye(Vse,Zt);function z4e(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r=1/0,i=-1/0,s,o;for(s=0;s<n;++s)o=t[s],o[0]<r&&(r=o[0]),o[1]>i&&(i=o[1]);return[r,i]}function Gse(e){Zt.call(this,null,U4e,e)}ye(Gse,Zt);function U4e(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function Hse(e){ee.call(this,null,e)}ye(Hse,ee,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function tz(e){Hf.call(this,e)}tz.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Qw,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};ye(tz,Hf,{_transform:Hf.prototype.transform,transform(e,t){return this._transform(j4e(e,t),t)}});function j4e(e,t){const n=e.field,r=e.value,i=(e.op==="count"?"__count__":e.op)||"sum",s=pi(n).concat(pi(r)),o=V4e(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(()=>i),fields:o.map(a=>W4e(a,n,r,s)),as:o.map(a=>a+""),modified:e.modified.bind(e)}}function W4e(e,t,n,r){return Mo(i=>t(i)===e?n(i):NaN,r,e+"")}function V4e(e,t,n){const r={},i=[];return n.visit(n.SOURCE,s=>{const o=e(s);r[o]||(r[o]=1,i.push(o))}),i.sort(NI),t?i.slice(0,t):i}function qse(e){KI.call(this,e)}ye(qse,KI,{transform(e,t){const n=e.subflow,r=e.field,i=s=>this.subflow(Le(s),n,t,s);return(e.modified("field")||r&&t.modified(pi(r)))&&ae("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,s=>{const o=i(s);r(s).forEach(a=>o.mod(a))}),t.visit(t.ADD,s=>{const o=i(s);r(s).forEach(a=>o.add(Nt(a)))}),t.visit(t.REM,s=>{const o=i(s);r(s).forEach(a=>o.rem(a))})):(t.visit(t.MOD,s=>i(s).mod(s)),t.visit(t.ADD,s=>i(s).add(s)),t.visit(t.REM,s=>i(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}});function nz(e){ee.call(this,null,e)}nz.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};ye(nz,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Lse(e.fields,e.as||[]),s=r?(a,u)=>G4e(a,u,r,i):UI;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,a=>{const u=Le(a);n.rem.push(o[u]),o[u]=null}),t.visit(t.ADD,a=>{const u=s(a,Nt({}));o[Le(a)]=u,n.add.push(u)}),t.visit(t.MOD,a=>{n.mod.push(s(a,o[Le(a)]))}),n}});function G4e(e,t,n,r){for(let i=0,s=n.length;i<s;++i)t[r[i]]=n[i](e);return t}function Xse(e){ee.call(this,null,e)}ye(Xse,ee,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function rz(e){ee.call(this,null,e)}rz.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const H4e=1e-14;ye(rz,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=t.materialize(t.SOURCE).source,s=W6(i,e.groupby,e.field),o=(e.groupby||[]).map(_n),a=[],u=e.step||.01,l=e.probs||Us(u/2,1-H4e,u),c=l.length;return s.forEach(f=>{const h=c6(f,l);for(let d=0;d<c;++d){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[r[0]]=l[d],p[r[1]]=h[d],a.push(Nt(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function Yse(e){ee.call(this,null,e)}ye(Yse,ee,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,i=>{const s=Le(i);n.rem.push(r[s]),r[s]=null}),t.visit(t.ADD,i=>{const s=a6(i);r[Le(i)]=s,n.add.push(s)}),t.visit(t.MOD,i=>{const s=r[Le(i)];for(const o in i)s[o]=i[o],n.modifies(o);n.mod.push(s)})),n}});function iz(e){ee.call(this,[],e),this.count=0}iz.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};ye(iz,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,s=this.value.reduce((c,f)=>(c[Le(f)]=1,c),{});let o=this.value,a=this.count,u=0;function l(c){let f,h;o.length<i?o.push(c):(h=~~((a+1)*Ca()),h<o.length&&h>=u&&(f=o[h],s[Le(f)]&&n.rem.push(f),o[h]=c)),++a}if(t.rem.length&&(t.visit(t.REM,c=>{const f=Le(c);s[f]&&(s[f]=-1,n.rem.push(c)),--a}),o=o.filter(c=>s[Le(c)]!==-1)),(t.rem.length||r)&&o.length<i&&t.source&&(u=a=o.length,t.visit(t.SOURCE,c=>{s[Le(c)]||l(c)}),u=-1),r&&o.length>i){const c=o.length-i;for(let f=0;f<c;++f)s[Le(o[f])]=-1,n.rem.push(o[f]);o=o.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{s[Le(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=o.filter(c=>!s[Le(c)])),this.count=a,this.value=n.source=o,n}});function sz(e){ee.call(this,null,e)}sz.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};ye(sz,ee,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Us(e.start,e.stop,e.step||1).map(i=>{const s={};return s[r]=i,Nt(s)}),n.add=t.add.concat(this.value),n}});function Kse(e){ee.call(this,null,e),this.modified(!0)}ye(Kse,ee,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function oz(e){ee.call(this,null,e)}const Zse=["unit0","unit1"];oz.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:O6,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Zse}]};ye(oz,ee,{transform(e,t){const n=e.field,r=e.interval!==!1,i=e.timezone==="utc",s=this._floor(e,t),o=(i?sy:iy)(s.unit).offset,a=e.as||Zse,u=a[0],l=a[1],c=s.step;let f=s.start||1/0,h=s.stop||-1/0,d=t.ADD;return(e.modified()||t.modified(pi(n)))&&(t=t.reflow(!0),d=t.SOURCE,f=1/0,h=-1/0),t.visit(d,p=>{const g=n(p);let m,y;g==null?(p[u]=null,r&&(p[l]=null)):(p[u]=m=y=s(g),r&&(p[l]=y=o(m,c)),m<f&&(f=m),y>h&&(h=y))}),s.start=f,s.stop=h,t.modifies(r?a:u)},_floor(e,t){const n=e.timezone==="utc",{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:_se({extent:e.extent||Pf(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=R6(r),o=this.value||{},a=(n?xse:bse)(s,i);return a.unit=qt(s),a.units=s,a.step=i,a.start=o.start,a.stop=o.stop,this.value=a}});function Jse(e){ee.call(this,Z1(),e)}ye(Jse,ee,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,s=a=>i.set(r(a),a);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,a=>i.delete(r(a))),t.visit(t.ADD,s)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}});function Qse(e){ee.call(this,null,e)}ye(Qse,ee,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(pg(e.sort)):t.source).map(e.field))}});function q4e(e,t,n,r){const i=vv[e](t,n);return{init:i.init||Yc,update:function(s,o){o[r]=i.next(s)}}}const vv={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=vv.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||ae("ntile num must be greater than zero.");const n=vv.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(t*r(i))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||ae("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=X4e(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};function X4e(e,t,n){for(let r=t.length;n<r;++n)if(e(t[n])!=null)return n;return-1}const Y4e=Object.keys(vv);function eoe(e){const t=Qe(e.ops),n=Qe(e.fields),r=Qe(e.params),i=Qe(e.as),s=this.outputs=[],o=this.windows=[],a={},u={},l=[],c=[];let f=!0;function h(d){Qe(pi(d)).forEach(p=>a[p]=1)}h(e.sort),t.forEach((d,p)=>{const g=n[p],m=_n(g),y=Tse(d,m,i[p]);if(h(g),s.push(y),tt(vv,d))o.push(q4e(d,n[p],r[p],y));else{if(g==null&&d!=="count"&&ae("Null aggregate field specified."),d==="count"){l.push(y);return}f=!1;let b=u[m];b||(b=u[m]=[],b.field=g,c.push(b)),b.push(Ise(d,y))}}),(l.length||c.length)&&(this.cell=K4e(c,l,f)),this.inputs=Object.keys(a)}const toe=eoe.prototype;toe.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};toe.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,s=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<s;++o)r[o].update(e,t)};function K4e(e,t,n){e=e.map(u=>Nse(u,u.field));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,s=r.agg=Array(i),o=0;o<i;++o)s[o]=new e[o](r);if(r.store)var a=r.data=new L6;return r.add=function(u){if(r.num+=1,!n){a&&a.add(u);for(let l=0;l<i;++l)s[l].add(s[l].get(u),u)}},r.rem=function(u){if(r.num-=1,!n){a&&a.rem(u);for(let l=0;l<i;++l)s[l].rem(s[l].get(u),u)}},r.set=function(u){let l,c;for(a&&a.values(),l=0,c=t.length;l<c;++l)u[t[l]]=r.num;if(!n)for(l=0,c=s.length;l<c;++l)s[l].set(u)},r.init=function(){r.num=0,a&&a.reset();for(let u=0;u<i;++u)s[u].init()},r}function az(e){ee.call(this,{},e),this._mlen=0,this._mods=[]}az.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Y4e.concat(Qw)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};ye(az,ee,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=pg(e.sort),i=LM(e.groupby),s=a=>this.group(i(a));let o=this.state;(!o||n)&&(o=this.state=new eoe(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,a=>s(a).add(a))):(t.visit(t.REM,a=>s(a).remove(a)),t.visit(t.ADD,a=>s(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)Z4e(this._mods[a],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Fse(Le),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function Z4e(e,t,n,r){const i=r.sort,s=i&&!r.ignorePeers,o=r.frame||[null,0],a=e.data(n),u=a.length,l=s?Kw(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:i||_o(-1)};t.init();for(let f=0;f<u;++f)J4e(c,o,f,u),s&&Q4e(c,l),t.update(c,a[f])}function J4e(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Q4e(e,t){const n=e.i0,r=e.i1-1,i=e.compare,s=e.data,o=s.length-1;n>0&&!i(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),r<o&&!i(s[r],s[r+1])&&(e.i1=t.right(s,s[r]))}const eLe=Object.freeze(Object.defineProperty({__proto__:null,aggregate:Hf,bin:P6,collect:B6,compare:Ose,countpattern:z6,cross:U6,density:j6,dotbin:V6,expression:Bse,extent:G6,facet:KI,field:zse,filter:q6,flatten:X6,fold:Y6,formula:K6,generate:Use,impute:Z6,joinaggregate:J6,kde:Q6,key:jse,load:Wse,lookup:ez,multiextent:Vse,multivalues:Gse,params:Hse,pivot:tz,prefacet:qse,project:nz,proxy:Xse,quantile:rz,relay:Yse,sample:iz,sequence:sz,sieve:Kse,subflow:H6,timeunit:oz,tupleindex:Jse,values:Qse,window:az},Symbol.toStringTag,{value:"Module"}));function oy(e,t,n){return e.fields=t||[],e.fname=n,e}function tLe(e){return e.length===1?nLe(e[0]):rLe(e)}const nLe=e=>function(t){return t[e]},rLe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function Xl(e){throw Error(e)}function iLe(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||Xl("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&Xl("Access path missing closing bracket: "+e),r&&Xl("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function sLe(e,t,n){const r=iLe(e);return e=r.length===1?r[0]:e,oy((n&&n.get||tLe)(r),[e],t||e)}sLe("id");oy(e=>e,[],"identity");oy(()=>0,[],"zero");oy(()=>1,[],"one");const noe=oy(()=>!0,[],"true");oy(()=>!1,[],"false");var Wu=Array.isArray;function uz(e){return e===Object(e)}function du(e){return e[e.length-1]}function oLe(e){return e==null||e===""?null:+e}function lz(e){return e!=null?Wu(e)?e:[e]:[]}function ZI(e){return typeof e=="function"}function JI(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const aLe=Object.prototype.hasOwnProperty;function Dl(e,t){return aLe.call(e,t)}function Ns(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),JI(r,n)}function rE(e){return typeof e=="string"}const uLe=1e4;function lLe(e){e=+e||uLe;let t,n,r;const i=()=>{t={},n={},r=0},s=(o,a)=>(++r>e&&(n=t,t={},r=1),t[o]=a);return i(),{clear:i,has:o=>Dl(t,o)||Dl(n,o),get:o=>Dl(t,o)?t[o]:Dl(n,o)?s(o,n[o]):void 0,set:(o,a)=>Dl(t,o)?t[o]=a:s(o,a)}}function roe(e){return Wu(e)?"["+e.map(roe)+"]":uz(e)||rE(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function ioe(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Rt(e){return function(){return e}}const QG=Math.abs,Xr=Math.atan2,Qh=Math.cos,cLe=Math.max,O3=Math.min,Va=Math.sin,Ld=Math.sqrt,Kr=1e-12,s0=Math.PI,iE=s0/2,soe=2*s0;function fLe(e){return e>1?0:e<-1?s0:Math.acos(e)}function eH(e){return e>=1?iE:e<=-1?-iE:Math.asin(e)}const PM=Math.PI,BM=2*PM,yd=1e-6,hLe=BM-yd;function ooe(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function dLe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return ooe;const n=10**t;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}let cz=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?ooe:dLe(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,r,i){this._append`Q${+t},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(t,n,r,i,s,o){this._append`C${+t},${+n},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(t,n,r,i,s){if(t=+t,n=+n,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,u=r-t,l=i-n,c=o-t,f=a-n,h=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>yd)if(!(Math.abs(f*u-l*c)>yd)||!s)this._append`L${this._x1=t},${this._y1=n}`;else{let d=r-o,p=i-a,g=u*u+l*l,m=d*d+p*p,y=Math.sqrt(g),b=Math.sqrt(h),v=s*Math.tan((PM-Math.acos((g+h-m)/(2*y*b)))/2),x=v/b,w=v/y;Math.abs(x-1)>yd&&this._append`L${t+x*c},${n+x*f}`,this._append`A${s},${s},0,0,${+(f*d>c*p)},${this._x1=t+w*u},${this._y1=n+w*l}`}}arc(t,n,r,i,s,o){if(t=+t,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),u=r*Math.sin(i),l=t+a,c=n+u,f=1^o,h=o?i-s:s-i;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>yd||Math.abs(this._y1-c)>yd)&&this._append`L${l},${c}`,r&&(h<0&&(h=h%BM+BM),h>hLe?this._append`A${r},${r},0,1,${f},${t-a},${n-u}A${r},${r},0,1,${f},${this._x1=l},${this._y1=c}`:h>yd&&this._append`A${r},${r},0,${+(h>=PM)},${f},${this._x1=t+r*Math.cos(s)},${this._y1=n+r*Math.sin(s)}`)}rect(t,n,r,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function fz(){return new cz}fz.prototype=cz.prototype;function QI(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);t=r}return e},()=>new cz(t)}function pLe(e){return e.innerRadius}function gLe(e){return e.outerRadius}function mLe(e){return e.startAngle}function yLe(e){return e.endAngle}function bLe(e){return e&&e.padAngle}function xLe(e,t,n,r,i,s,o,a){var u=n-e,l=r-t,c=o-i,f=a-s,h=f*u-c*l;if(!(h*h<Kr))return h=(c*(t-s)-f*(e-i))/h,[e+h*u,t+h*l]}function zC(e,t,n,r,i,s,o){var a=e-n,u=t-r,l=(o?s:-s)/Ld(a*a+u*u),c=l*u,f=-l*a,h=e+c,d=t+f,p=n+c,g=r+f,m=(h+p)/2,y=(d+g)/2,b=p-h,v=g-d,x=b*b+v*v,w=i-s,C=h*g-p*d,$=(v<0?-1:1)*Ld(cLe(0,w*w*x-C*C)),S=(C*v-b*$)/x,k=(-C*b-v*$)/x,E=(C*v+b*$)/x,A=(-C*b+v*$)/x,F=S-m,_=k-y,I=E-m,T=A-y;return F*F+_*_>I*I+T*T&&(S=E,k=A),{cx:S,cy:k,x01:-c,y01:-f,x11:S*(i/w-1),y11:k*(i/w-1)}}function vLe(){var e=pLe,t=gLe,n=Rt(0),r=null,i=mLe,s=yLe,o=bLe,a=null,u=QI(l);function l(){var c,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=i.apply(this,arguments)-iE,g=s.apply(this,arguments)-iE,m=QG(g-p),y=g>p;if(a||(a=c=u()),d<h&&(f=d,d=h,h=f),!(d>Kr))a.moveTo(0,0);else if(m>soe-Kr)a.moveTo(d*Qh(p),d*Va(p)),a.arc(0,0,d,p,g,!y),h>Kr&&(a.moveTo(h*Qh(g),h*Va(g)),a.arc(0,0,h,g,p,y));else{var b=p,v=g,x=p,w=g,C=m,$=m,S=o.apply(this,arguments)/2,k=S>Kr&&(r?+r.apply(this,arguments):Ld(h*h+d*d)),E=O3(QG(d-h)/2,+n.apply(this,arguments)),A=E,F=E,_,I;if(k>Kr){var T=eH(k/h*Va(S)),O=eH(k/d*Va(S));(C-=T*2)>Kr?(T*=y?1:-1,x+=T,w-=T):(C=0,x=w=(p+g)/2),($-=O*2)>Kr?(O*=y?1:-1,b+=O,v-=O):($=0,b=v=(p+g)/2)}var L=d*Qh(b),M=d*Va(b),P=h*Qh(w),G=h*Va(w);if(E>Kr){var H=d*Qh(v),Q=d*Va(v),te=h*Qh(x),ne=h*Va(x),oe;if(m<s0)if(oe=xLe(L,M,te,ne,H,Q,P,G)){var he=L-oe[0],we=M-oe[1],Ae=H-oe[0],B=Q-oe[1],Y=1/Va(fLe((he*Ae+we*B)/(Ld(he*he+we*we)*Ld(Ae*Ae+B*B)))/2),K=Ld(oe[0]*oe[0]+oe[1]*oe[1]);A=O3(E,(h-K)/(Y-1)),F=O3(E,(d-K)/(Y+1))}else A=F=0}$>Kr?F>Kr?(_=zC(te,ne,L,M,d,F,y),I=zC(H,Q,P,G,d,F,y),a.moveTo(_.cx+_.x01,_.cy+_.y01),F<E?a.arc(_.cx,_.cy,F,Xr(_.y01,_.x01),Xr(I.y01,I.x01),!y):(a.arc(_.cx,_.cy,F,Xr(_.y01,_.x01),Xr(_.y11,_.x11),!y),a.arc(0,0,d,Xr(_.cy+_.y11,_.cx+_.x11),Xr(I.cy+I.y11,I.cx+I.x11),!y),a.arc(I.cx,I.cy,F,Xr(I.y11,I.x11),Xr(I.y01,I.x01),!y))):(a.moveTo(L,M),a.arc(0,0,d,b,v,!y)):a.moveTo(L,M),!(h>Kr)||!(C>Kr)?a.lineTo(P,G):A>Kr?(_=zC(P,G,H,Q,h,-A,y),I=zC(L,M,te,ne,h,-A,y),a.lineTo(_.cx+_.x01,_.cy+_.y01),A<E?a.arc(_.cx,_.cy,A,Xr(_.y01,_.x01),Xr(I.y01,I.x01),!y):(a.arc(_.cx,_.cy,A,Xr(_.y01,_.x01),Xr(_.y11,_.x11),!y),a.arc(0,0,h,Xr(_.cy+_.y11,_.cx+_.x11),Xr(I.cy+I.y11,I.cx+I.x11),y),a.arc(I.cx,I.cy,A,Xr(I.y11,I.x11),Xr(I.y01,I.x01),!y))):a.arc(0,0,h,w,x,y)}if(a.closePath(),c)return a=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-s0/2;return[Qh(f)*c,Va(f)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:Rt(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:Rt(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:Rt(+c),l):n},l.padRadius=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:Rt(+c),l):r},l.startAngle=function(c){return arguments.length?(i=typeof c=="function"?c:Rt(+c),l):i},l.endAngle=function(c){return arguments.length?(s=typeof c=="function"?c:Rt(+c),l):s},l.padAngle=function(c){return arguments.length?(o=typeof c=="function"?c:Rt(+c),l):o},l.context=function(c){return arguments.length?(a=c??null,l):a},l}function aoe(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function uoe(e){this._context=e}uoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function hz(e){return new uoe(e)}function loe(e){return e[0]}function coe(e){return e[1]}function foe(e,t){var n=Rt(!0),r=null,i=hz,s=null,o=QI(a);e=typeof e=="function"?e:e===void 0?loe:Rt(e),t=typeof t=="function"?t:t===void 0?coe:Rt(t);function a(u){var l,c=(u=aoe(u)).length,f,h=!1,d;for(r==null&&(s=i(d=o())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+e(f,l,u),+t(f,l,u));if(d)return s=null,d+""||null}return a.x=function(u){return arguments.length?(e=typeof u=="function"?u:Rt(+u),a):e},a.y=function(u){return arguments.length?(t=typeof u=="function"?u:Rt(+u),a):t},a.defined=function(u){return arguments.length?(n=typeof u=="function"?u:Rt(!!u),a):n},a.curve=function(u){return arguments.length?(i=u,r!=null&&(s=i(r)),a):i},a.context=function(u){return arguments.length?(u==null?r=s=null:s=i(r=u),a):r},a}function hoe(e,t,n){var r=null,i=Rt(!0),s=null,o=hz,a=null,u=QI(l);e=typeof e=="function"?e:e===void 0?loe:Rt(+e),t=typeof t=="function"?t:Rt(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?coe:Rt(+n);function l(f){var h,d,p,g=(f=aoe(f)).length,m,y=!1,b,v=new Array(g),x=new Array(g);for(s==null&&(a=o(b=u())),h=0;h<=g;++h){if(!(h<g&&i(m=f[h],h,f))===y)if(y=!y)d=h,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),p=h-1;p>=d;--p)a.point(v[p],x[p]);a.lineEnd(),a.areaEnd()}y&&(v[h]=+e(m,h,f),x[h]=+t(m,h,f),a.point(r?+r(m,h,f):v[h],n?+n(m,h,f):x[h]))}if(b)return a=null,b+""||null}function c(){return foe().defined(i).curve(o).context(s)}return l.x=function(f){return arguments.length?(e=typeof f=="function"?f:Rt(+f),r=null,l):e},l.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Rt(+f),l):e},l.x1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Rt(+f),l):r},l.y=function(f){return arguments.length?(t=typeof f=="function"?f:Rt(+f),n=null,l):t},l.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Rt(+f),l):t},l.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Rt(+f),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(r).y(t)},l.defined=function(f){return arguments.length?(i=typeof f=="function"?f:Rt(!!f),l):i},l.curve=function(f){return arguments.length?(o=f,s!=null&&(a=o(s)),l):o},l.context=function(f){return arguments.length?(f==null?s=a=null:a=o(s=f),l):s},l}const wLe={draw(e,t){const n=Ld(t/s0);e.moveTo(n,0),e.arc(0,0,n,0,soe)}};function $Le(e,t){let n=null,r=QI(i);e=typeof e=="function"?e:Rt(e||wLe),t=typeof t=="function"?t:Rt(t===void 0?64:+t);function i(){let s;if(n||(n=s=r()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),s)return n=null,s+""||null}return i.type=function(s){return arguments.length?(e=typeof s=="function"?s:Rt(s),i):e},i.size=function(s){return arguments.length?(t=typeof s=="function"?s:Rt(+s),i):t},i.context=function(s){return arguments.length?(n=s??null,i):n},i}function qf(){}function sE(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function eD(e){this._context=e}eD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:sE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:sE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function CLe(e){return new eD(e)}function doe(e){this._context=e}doe.prototype={areaStart:qf,areaEnd:qf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:sE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function SLe(e){return new doe(e)}function poe(e){this._context=e}poe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:sE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function kLe(e){return new poe(e)}function goe(e,t){this._basis=new eD(e),this._beta=t}goe.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r=e[0],i=t[0],s=e[n]-r,o=t[n]-i,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(r+u*s),this._beta*t[a]+(1-this._beta)*(i+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const ELe=function e(t){function n(r){return t===1?new eD(r):new goe(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function oE(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function dz(e,t){this._context=e,this._k=(1-t)/6}dz.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:oE(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:oE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const ALe=function e(t){function n(r){return new dz(r,t)}return n.tension=function(r){return e(+r)},n}(0);function pz(e,t){this._context=e,this._k=(1-t)/6}pz.prototype={areaStart:qf,areaEnd:qf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:oE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const _Le=function e(t){function n(r){return new pz(r,t)}return n.tension=function(r){return e(+r)},n}(0);function gz(e,t){this._context=e,this._k=(1-t)/6}gz.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:oE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const TLe=function e(t){function n(r){return new gz(r,t)}return n.tension=function(r){return e(+r)},n}(0);function mz(e,t,n){var r=e._x1,i=e._y1,s=e._x2,o=e._y2;if(e._l01_a>Kr){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>Kr){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,s,o,e._x2,e._y2)}function moe(e,t){this._context=e,this._alpha=t}moe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:mz(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const ILe=function e(t){function n(r){return t?new moe(r,t):new dz(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function yoe(e,t){this._context=e,this._alpha=t}yoe.prototype={areaStart:qf,areaEnd:qf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:mz(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const DLe=function e(t){function n(r){return t?new yoe(r,t):new pz(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function boe(e,t){this._context=e,this._alpha=t}boe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:mz(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const NLe=function e(t){function n(r){return t?new boe(r,t):new gz(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function xoe(e){this._context=e}xoe.prototype={areaStart:qf,areaEnd:qf,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function FLe(e){return new xoe(e)}function tH(e){return e<0?-1:1}function nH(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(tH(s)+tH(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function rH(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function R3(e,t,n){var r=e._x0,i=e._y0,s=e._x1,o=e._y1,a=(s-r)/3;e._context.bezierCurveTo(r+a,i+a*t,s-a,o-a*n,s,o)}function aE(e){this._context=e}aE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:R3(this,this._t0,rH(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,R3(this,rH(this,n=nH(this,e,t)),n);break;default:R3(this,this._t0,n=nH(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function voe(e){this._context=new woe(e)}(voe.prototype=Object.create(aE.prototype)).point=function(e,t){aE.prototype.point.call(this,t,e)};function woe(e){this._context=e}woe.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}};function OLe(e){return new aE(e)}function RLe(e){return new voe(e)}function $oe(e){this._context=e}$oe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=iH(e),i=iH(t),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function iH(e){var t,n=e.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,s[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/s[t-1],s[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/s[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/s[t];for(s[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}function MLe(e){return new $oe(e)}function tD(e,t){this._context=e,this._t=t}tD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function LLe(e){return new tD(e,.5)}function PLe(e){return new tD(e,0)}function BLe(e){return new tD(e,1)}function xc(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const Coe=()=>typeof Image<"u"?Image:null;function px(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function zLe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function yz(e){let t,n,r;e.length!==2?(t=px,n=(a,u)=>px(e(a),u),r=(a,u)=>e(a)-u):(t=e===px||e===zLe?e:ULe,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function ULe(){return 0}function Soe(e){return e===null?NaN:+e}const jLe=yz(px),Cp=jLe.right;yz(Soe).center;const WLe=Math.sqrt(50),VLe=Math.sqrt(10),GLe=Math.sqrt(2);function uE(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=WLe?10:s>=VLe?5:s>=GLe?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?uE(e,t,n*2):[a,u,l]}function zM(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const r=t<e,[i,s,o]=r?uE(t,e,n):uE(e,t,n);if(!(s>=i))return[];const a=s-i+1,u=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)u[l]=(s-l)/-o;else for(let l=0;l<a;++l)u[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)u[l]=(i+l)/-o;else for(let l=0;l<a;++l)u[l]=(i+l)*o;return u}function UM(e,t,n){return t=+t,e=+e,n=+n,uE(e,t,n)[2]}function lE(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?UM(t,e,n):UM(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function HLe(e,t,n=Soe){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function qLe(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function XLe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function cE(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function o0(e){return e=cE(Math.abs(e)),e?e[1]:NaN}function YLe(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function KLe(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var ZLe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sp(e){if(!(t=ZLe.exec(e)))throw new Error("invalid format: "+e);var t;return new bz({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Sp.prototype=bz.prototype;function bz(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}bz.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function JLe(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var koe;function QLe(e,t){var n=cE(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(koe=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+cE(e,Math.max(0,t+s-1))[0]}function sH(e,t){var n=cE(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const oH={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:XLe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>sH(e*100,t),r:sH,s:QLe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function aH(e){return e}var uH=Array.prototype.map,lH=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ePe(e){var t=e.grouping===void 0||e.thousands===void 0?aH:YLe(uH.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?aH:KLe(uH.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=Sp(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,v=f.precision,x=f.trim,w=f.type;w==="n"?(b=!0,w="g"):oH[w]||(v===void 0&&(v=12),x=!0,w="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var C=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",$=g==="$"?r:/[%p]/.test(w)?o:"",S=oH[w],k=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function E(A){var F=C,_=$,I,T,O;if(w==="c")_=S(A)+_,A="";else{A=+A;var L=A<0||1/A<0;if(A=isNaN(A)?u:S(Math.abs(A),v),x&&(A=JLe(A)),L&&+A==0&&p!=="+"&&(L=!1),F=(L?p==="("?p:a:p==="-"||p==="("?"":p)+F,_=(w==="s"?lH[8+koe/3]:"")+_+(L&&p==="("?")":""),k){for(I=-1,T=A.length;++I<T;)if(O=A.charCodeAt(I),48>O||O>57){_=(O===46?i+A.slice(I+1):A.slice(I))+_,A=A.slice(0,I);break}}}b&&!m&&(A=t(A,1/0));var M=F.length+A.length+_.length,P=M<y?new Array(y-M+1).join(h):"";switch(b&&m&&(A=t(P+A,P.length?y-_.length:1/0),P=""),d){case"<":A=F+A+_+P;break;case"=":A=F+P+A+_;break;case"^":A=P.slice(0,M=P.length>>1)+F+A+_+P.slice(M);break;default:A=P+F+A+_;break}return s(A)}return E.toString=function(){return f+""},E}function c(f,h){var d=l((f=Sp(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(o0(h)/3)))*3,g=Math.pow(10,-p),m=lH[8+p/3];return function(y){return d(g*y)+m}}return{format:l,formatPrefix:c}}var UC,nD,xz;tPe({thousands:",",grouping:[3],currency:["$",""]});function tPe(e){return UC=ePe(e),nD=UC.format,xz=UC.formatPrefix,UC}function Eoe(e){return Math.max(0,-o0(Math.abs(e)))}function Aoe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(o0(t)/3)))*3-o0(Math.abs(e)))}function _oe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,o0(t)-o0(e))+1}const M3=new Date,L3=new Date;function lr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>lr(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(M3.setTime(+s),L3.setTime(+o),e(M3),e(L3),Math.floor(n(M3,L3))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const a0=lr(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);a0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?lr(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):a0);a0.range;const Ml=1e3,go=Ml*60,Ll=go*60,sc=Ll*24,vz=sc*7,cH=sc*30,P3=sc*365,Pl=lr(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Ml)},(e,t)=>(t-e)/Ml,e=>e.getUTCSeconds());Pl.range;const rD=lr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ml)},(e,t)=>{e.setTime(+e+t*go)},(e,t)=>(t-e)/go,e=>e.getMinutes());rD.range;const iD=lr(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*go)},(e,t)=>(t-e)/go,e=>e.getUTCMinutes());iD.range;const sD=lr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ml-e.getMinutes()*go)},(e,t)=>{e.setTime(+e+t*Ll)},(e,t)=>(t-e)/Ll,e=>e.getHours());sD.range;const oD=lr(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Ll)},(e,t)=>(t-e)/Ll,e=>e.getUTCHours());oD.range;const wf=lr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*go)/sc,e=>e.getDate()-1);wf.range;const Jd=lr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/sc,e=>e.getUTCDate()-1);Jd.range;const Toe=lr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/sc,e=>Math.floor(e/sc));Toe.range;function bg(e){return lr(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*go)/vz)}const e$=bg(0),fE=bg(1),nPe=bg(2),rPe=bg(3),u0=bg(4),iPe=bg(5),sPe=bg(6);e$.range;fE.range;nPe.range;rPe.range;u0.range;iPe.range;sPe.range;function xg(e){return lr(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/vz)}const t$=xg(0),hE=xg(1),oPe=xg(2),aPe=xg(3),l0=xg(4),uPe=xg(5),lPe=xg(6);t$.range;hE.range;oPe.range;aPe.range;l0.range;uPe.range;lPe.range;const wv=lr(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());wv.range;const $v=lr(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());$v.range;const Iu=lr(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Iu.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:lr(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Iu.range;const Du=lr(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Du.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:lr(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Du.range;function Ioe(e,t,n,r,i,s){const o=[[Pl,1,Ml],[Pl,5,5*Ml],[Pl,15,15*Ml],[Pl,30,30*Ml],[s,1,go],[s,5,5*go],[s,15,15*go],[s,30,30*go],[i,1,Ll],[i,3,3*Ll],[i,6,6*Ll],[i,12,12*Ll],[r,1,sc],[r,2,2*sc],[n,1,vz],[t,1,cH],[t,3,3*cH],[e,1,P3]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=yz(([,,m])=>m).right(o,h);if(d===o.length)return e.every(lE(l/P3,c/P3,f));if(d===0)return a0.every(Math.max(lE(l,c,f),1));const[p,g]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(g)}return[a,u]}const[cPe,fPe]=Ioe(Du,$v,t$,Toe,oD,iD),[hPe,dPe]=Ioe(Iu,wv,e$,wf,sD,rD),Cv="year",Sv="quarter",kv="month",Ev="week",Av="date",aD="day",wz="dayofyear",_v="hours",Tv="minutes",Iv="seconds",uD="milliseconds",pPe=[Cv,Sv,kv,Ev,Av,aD,wz,_v,Tv,Iv,uD];pPe.reduce((e,t,n)=>(e[t]=1+n,e),{});const gPe={[Cv]:Iu,[Sv]:wv.every(3),[kv]:wv,[Ev]:e$,[Av]:wf,[aD]:wf,[wz]:wf,[_v]:sD,[Tv]:rD,[Iv]:Pl,[uD]:a0},mPe={[Cv]:Du,[Sv]:$v.every(3),[kv]:$v,[Ev]:t$,[Av]:Jd,[aD]:Jd,[wz]:Jd,[_v]:oD,[Tv]:iD,[Iv]:Pl,[uD]:a0};function yPe(e){return gPe[e]}function bPe(e){return mPe[e]}function B3(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function z3(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function sb(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function xPe(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=ob(i),c=ab(i),f=ob(s),h=ab(s),d=ob(o),p=ab(o),g=ob(a),m=ab(a),y=ob(u),b=ab(u),v={a:L,A:M,b:P,B:G,c:null,d:mH,e:mH,f:jPe,g:JPe,G:eBe,H:BPe,I:zPe,j:UPe,L:Doe,m:WPe,M:VPe,p:H,q:Q,Q:xH,s:vH,S:GPe,u:HPe,U:qPe,V:XPe,w:YPe,W:KPe,x:null,X:null,y:ZPe,Y:QPe,Z:tBe,"%":bH},x={a:te,A:ne,b:oe,B:he,c:null,d:yH,e:yH,f:sBe,g:gBe,G:yBe,H:nBe,I:rBe,j:iBe,L:Foe,m:oBe,M:aBe,p:we,q:Ae,Q:xH,s:vH,S:uBe,u:lBe,U:cBe,V:fBe,w:hBe,W:dBe,x:null,X:null,y:pBe,Y:mBe,Z:bBe,"%":bH},w={a:E,A,b:F,B:_,c:I,d:pH,e:pH,f:RPe,g:dH,G:hH,H:gH,I:gH,j:DPe,L:OPe,m:IPe,M:NPe,p:k,q:TPe,Q:LPe,s:PPe,S:FPe,u:SPe,U:kPe,V:EPe,w:CPe,W:APe,x:T,X:O,y:dH,Y:hH,Z:_Pe,"%":MPe};v.x=C(n,v),v.X=C(r,v),v.c=C(t,v),x.x=C(n,x),x.X=C(r,x),x.c=C(t,x);function C(B,Y){return function(K){var R=[],Ce=-1,ce=0,Ee=B.length,Se,qe,bt;for(K instanceof Date||(K=new Date(+K));++Ce<Ee;)B.charCodeAt(Ce)===37&&(R.push(B.slice(ce,Ce)),(qe=fH[Se=B.charAt(++Ce)])!=null?Se=B.charAt(++Ce):qe=Se==="e"?" ":"0",(bt=Y[Se])&&(Se=bt(K,qe)),R.push(Se),ce=Ce+1);return R.push(B.slice(ce,Ce)),R.join("")}}function $(B,Y){return function(K){var R=sb(1900,void 0,1),Ce=S(R,B,K+="",0),ce,Ee;if(Ce!=K.length)return null;if("Q"in R)return new Date(R.Q);if("s"in R)return new Date(R.s*1e3+("L"in R?R.L:0));if(Y&&!("Z"in R)&&(R.Z=0),"p"in R&&(R.H=R.H%12+R.p*12),R.m===void 0&&(R.m="q"in R?R.q:0),"V"in R){if(R.V<1||R.V>53)return null;"w"in R||(R.w=1),"Z"in R?(ce=z3(sb(R.y,0,1)),Ee=ce.getUTCDay(),ce=Ee>4||Ee===0?hE.ceil(ce):hE(ce),ce=Jd.offset(ce,(R.V-1)*7),R.y=ce.getUTCFullYear(),R.m=ce.getUTCMonth(),R.d=ce.getUTCDate()+(R.w+6)%7):(ce=B3(sb(R.y,0,1)),Ee=ce.getDay(),ce=Ee>4||Ee===0?fE.ceil(ce):fE(ce),ce=wf.offset(ce,(R.V-1)*7),R.y=ce.getFullYear(),R.m=ce.getMonth(),R.d=ce.getDate()+(R.w+6)%7)}else("W"in R||"U"in R)&&("w"in R||(R.w="u"in R?R.u%7:"W"in R?1:0),Ee="Z"in R?z3(sb(R.y,0,1)).getUTCDay():B3(sb(R.y,0,1)).getDay(),R.m=0,R.d="W"in R?(R.w+6)%7+R.W*7-(Ee+5)%7:R.w+R.U*7-(Ee+6)%7);return"Z"in R?(R.H+=R.Z/100|0,R.M+=R.Z%100,z3(R)):B3(R)}}function S(B,Y,K,R){for(var Ce=0,ce=Y.length,Ee=K.length,Se,qe;Ce<ce;){if(R>=Ee)return-1;if(Se=Y.charCodeAt(Ce++),Se===37){if(Se=Y.charAt(Ce++),qe=w[Se in fH?Y.charAt(Ce++):Se],!qe||(R=qe(B,K,R))<0)return-1}else if(Se!=K.charCodeAt(R++))return-1}return R}function k(B,Y,K){var R=l.exec(Y.slice(K));return R?(B.p=c.get(R[0].toLowerCase()),K+R[0].length):-1}function E(B,Y,K){var R=d.exec(Y.slice(K));return R?(B.w=p.get(R[0].toLowerCase()),K+R[0].length):-1}function A(B,Y,K){var R=f.exec(Y.slice(K));return R?(B.w=h.get(R[0].toLowerCase()),K+R[0].length):-1}function F(B,Y,K){var R=y.exec(Y.slice(K));return R?(B.m=b.get(R[0].toLowerCase()),K+R[0].length):-1}function _(B,Y,K){var R=g.exec(Y.slice(K));return R?(B.m=m.get(R[0].toLowerCase()),K+R[0].length):-1}function I(B,Y,K){return S(B,t,Y,K)}function T(B,Y,K){return S(B,n,Y,K)}function O(B,Y,K){return S(B,r,Y,K)}function L(B){return o[B.getDay()]}function M(B){return s[B.getDay()]}function P(B){return u[B.getMonth()]}function G(B){return a[B.getMonth()]}function H(B){return i[+(B.getHours()>=12)]}function Q(B){return 1+~~(B.getMonth()/3)}function te(B){return o[B.getUTCDay()]}function ne(B){return s[B.getUTCDay()]}function oe(B){return u[B.getUTCMonth()]}function he(B){return a[B.getUTCMonth()]}function we(B){return i[+(B.getUTCHours()>=12)]}function Ae(B){return 1+~~(B.getUTCMonth()/3)}return{format:function(B){var Y=C(B+="",v);return Y.toString=function(){return B},Y},parse:function(B){var Y=$(B+="",!1);return Y.toString=function(){return B},Y},utcFormat:function(B){var Y=C(B+="",x);return Y.toString=function(){return B},Y},utcParse:function(B){var Y=$(B+="",!0);return Y.toString=function(){return B},Y}}}var fH={"-":"",_:" ",0:"0"},Nr=/^\s*\d+/,vPe=/^%/,wPe=/[\\^$*+?|[\]().{}]/g;function Tt(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function $Pe(e){return e.replace(wPe,"\\$&")}function ob(e){return new RegExp("^(?:"+e.map($Pe).join("|")+")","i")}function ab(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function CPe(e,t,n){var r=Nr.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function SPe(e,t,n){var r=Nr.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function kPe(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function EPe(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function APe(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function hH(e,t,n){var r=Nr.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function dH(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function _Pe(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function TPe(e,t,n){var r=Nr.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function IPe(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function pH(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function DPe(e,t,n){var r=Nr.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function gH(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function NPe(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function FPe(e,t,n){var r=Nr.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function OPe(e,t,n){var r=Nr.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function RPe(e,t,n){var r=Nr.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function MPe(e,t,n){var r=vPe.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function LPe(e,t,n){var r=Nr.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function PPe(e,t,n){var r=Nr.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function mH(e,t){return Tt(e.getDate(),t,2)}function BPe(e,t){return Tt(e.getHours(),t,2)}function zPe(e,t){return Tt(e.getHours()%12||12,t,2)}function UPe(e,t){return Tt(1+wf.count(Iu(e),e),t,3)}function Doe(e,t){return Tt(e.getMilliseconds(),t,3)}function jPe(e,t){return Doe(e,t)+"000"}function WPe(e,t){return Tt(e.getMonth()+1,t,2)}function VPe(e,t){return Tt(e.getMinutes(),t,2)}function GPe(e,t){return Tt(e.getSeconds(),t,2)}function HPe(e){var t=e.getDay();return t===0?7:t}function qPe(e,t){return Tt(e$.count(Iu(e)-1,e),t,2)}function Noe(e){var t=e.getDay();return t>=4||t===0?u0(e):u0.ceil(e)}function XPe(e,t){return e=Noe(e),Tt(u0.count(Iu(e),e)+(Iu(e).getDay()===4),t,2)}function YPe(e){return e.getDay()}function KPe(e,t){return Tt(fE.count(Iu(e)-1,e),t,2)}function ZPe(e,t){return Tt(e.getFullYear()%100,t,2)}function JPe(e,t){return e=Noe(e),Tt(e.getFullYear()%100,t,2)}function QPe(e,t){return Tt(e.getFullYear()%1e4,t,4)}function eBe(e,t){var n=e.getDay();return e=n>=4||n===0?u0(e):u0.ceil(e),Tt(e.getFullYear()%1e4,t,4)}function tBe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Tt(t/60|0,"0",2)+Tt(t%60,"0",2)}function yH(e,t){return Tt(e.getUTCDate(),t,2)}function nBe(e,t){return Tt(e.getUTCHours(),t,2)}function rBe(e,t){return Tt(e.getUTCHours()%12||12,t,2)}function iBe(e,t){return Tt(1+Jd.count(Du(e),e),t,3)}function Foe(e,t){return Tt(e.getUTCMilliseconds(),t,3)}function sBe(e,t){return Foe(e,t)+"000"}function oBe(e,t){return Tt(e.getUTCMonth()+1,t,2)}function aBe(e,t){return Tt(e.getUTCMinutes(),t,2)}function uBe(e,t){return Tt(e.getUTCSeconds(),t,2)}function lBe(e){var t=e.getUTCDay();return t===0?7:t}function cBe(e,t){return Tt(t$.count(Du(e)-1,e),t,2)}function Ooe(e){var t=e.getUTCDay();return t>=4||t===0?l0(e):l0.ceil(e)}function fBe(e,t){return e=Ooe(e),Tt(l0.count(Du(e),e)+(Du(e).getUTCDay()===4),t,2)}function hBe(e){return e.getUTCDay()}function dBe(e,t){return Tt(hE.count(Du(e)-1,e),t,2)}function pBe(e,t){return Tt(e.getUTCFullYear()%100,t,2)}function gBe(e,t){return e=Ooe(e),Tt(e.getUTCFullYear()%100,t,2)}function mBe(e,t){return Tt(e.getUTCFullYear()%1e4,t,4)}function yBe(e,t){var n=e.getUTCDay();return e=n>=4||n===0?l0(e):l0.ceil(e),Tt(e.getUTCFullYear()%1e4,t,4)}function bBe(){return"+0000"}function bH(){return"%"}function xH(e){return+e}function vH(e){return Math.floor(+e/1e3)}var tm,$z,Roe,Cz,Moe;xBe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function xBe(e){return tm=xPe(e),$z=tm.format,Roe=tm.parse,Cz=tm.utcFormat,Moe=tm.utcParse,tm}function Wb(e){const t={};return n=>t[n]||(t[n]=e(n))}function vBe(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=wBe(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function wBe(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function $Be(e){const t=Wb(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=Sp(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return vBe(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=Sp(o??",f");const a=lE(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=Aoe(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=_oe(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=Eoe(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}CBe();function CBe(){return $Be({format:nD,formatPrefix:xz})}function wH(e,t,n){n=n||{},uz(n)||Xl(`Invalid time multi-format specifier: ${n}`);const r=t(Iv),i=t(Tv),s=t(_v),o=t(Av),a=t(Ev),u=t(kv),l=t(Sv),c=t(Cv),f=e(n[uD]||".%L"),h=e(n[Iv]||":%S"),d=e(n[Tv]||"%I:%M"),p=e(n[_v]||"%I %p"),g=e(n[Av]||n[aD]||"%a %d"),m=e(n[Ev]||"%b %d"),y=e(n[kv]||"%B"),b=e(n[Sv]||"%B"),v=e(n[Cv]||"%Y");return x=>(r(x)<x?f:i(x)<x?h:s(x)<x?d:o(x)<x?p:u(x)<x?a(x)<x?g:m:c(x)<x?l(x)<x?y:b:v)(x)}function SBe(e){const t=Wb(e.format),n=Wb(e.utcFormat);return{timeFormat:r=>rE(r)?t(r):wH(t,yPe,r),utcFormat:r=>rE(r)?n(r):wH(n,bPe,r),timeParse:Wb(e.parse),utcParse:Wb(e.utcParse)}}kBe();function kBe(){return SBe({format:$z,parse:Roe,utcFormat:Cz,utcParse:Moe})}const EBe=/^(data:|([A-Za-z]+:)?\/\/)/,ABe=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,_Be=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,$H="file://";function TBe(e,t){return n=>({options:n||{},sanitize:DBe,load:IBe,fileAccess:!!t,file:NBe(t),http:OBe(e)})}async function IBe(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function DBe(e,t){t=JI({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=ABe.test(e.replace(_Be,""));(e==null||typeof e!="string"||!a)&&Xl("Sanitize failure, invalid URI: "+roe(e));const u=EBe.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith($H))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice($H.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function NBe(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):FBe}async function FBe(){Xl("No file system access.")}function OBe(e){return e?async function(t,n){const r=JI({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?ZI(s[i])?s[i]():s.text():Xl(s.status+""+s.statusText)}:RBe}async function RBe(){Xl("No HTTP fetch method available.")}const Loe=TBe(typeof fetch<"u"&&fetch,null);function Vu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ah(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const CH=Symbol("implicit");function Sz(){var e=new Xk,t=[],n=[],r=CH;function i(s){let o=e.get(s);if(o===void 0){if(r!==CH)return r;e.set(s,o=t.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Xk;for(const o of s)e.has(o)||e.set(o,t.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return Sz(t,n).unknown(r)},Vu.apply(i,arguments),i}function ay(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function n$(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function _h(){}var kp=.7,c0=1/kp,Rm="\\s*([+-]?\\d+)\\s*",Dv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",pu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",MBe=/^#([0-9a-f]{3,8})$/,LBe=new RegExp("^rgb\\("+[Rm,Rm,Rm]+"\\)$"),PBe=new RegExp("^rgb\\("+[pu,pu,pu]+"\\)$"),BBe=new RegExp("^rgba\\("+[Rm,Rm,Rm,Dv]+"\\)$"),zBe=new RegExp("^rgba\\("+[pu,pu,pu,Dv]+"\\)$"),UBe=new RegExp("^hsl\\("+[Dv,pu,pu]+"\\)$"),jBe=new RegExp("^hsla\\("+[Dv,pu,pu,Dv]+"\\)$"),SH={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ay(_h,oc,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:kH,formatHex:kH,formatHsl:WBe,formatRgb:EH,toString:EH});function kH(){return this.rgb().formatHex()}function WBe(){return Poe(this).formatHsl()}function EH(){return this.rgb().formatRgb()}function oc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=MBe.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?AH(t):n===3?new Lr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?jC(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?jC(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=LBe.exec(e))?new Lr(t[1],t[2],t[3],1):(t=PBe.exec(e))?new Lr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=BBe.exec(e))?jC(t[1],t[2],t[3],t[4]):(t=zBe.exec(e))?jC(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=UBe.exec(e))?IH(t[1],t[2]/100,t[3]/100,1):(t=jBe.exec(e))?IH(t[1],t[2]/100,t[3]/100,t[4]):SH.hasOwnProperty(e)?AH(SH[e]):e==="transparent"?new Lr(NaN,NaN,NaN,0):null}function AH(e){return new Lr(e>>16&255,e>>8&255,e&255,1)}function jC(e,t,n,r){return r<=0&&(e=t=n=NaN),new Lr(e,t,n,r)}function kz(e){return e instanceof _h||(e=oc(e)),e?(e=e.rgb(),new Lr(e.r,e.g,e.b,e.opacity)):new Lr}function ws(e,t,n,r){return arguments.length===1?kz(e):new Lr(e,t,n,r??1)}function Lr(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}ay(Lr,ws,n$(_h,{brighter:function(e){return e=e==null?c0:Math.pow(c0,e),new Lr(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?kp:Math.pow(kp,e),new Lr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_H,formatHex:_H,formatRgb:TH,toString:TH}));function _H(){return"#"+U3(this.r)+U3(this.g)+U3(this.b)}function TH(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function U3(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function IH(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new tu(e,t,n,r)}function Poe(e){if(e instanceof tu)return new tu(e.h,e.s,e.l,e.opacity);if(e instanceof _h||(e=oc(e)),!e)return new tu;if(e instanceof tu)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,u=(s+i)/2;return a?(t===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-t)/a+2:o=(t-n)/a+4,a/=u<.5?s+i:2-s-i,o*=60):a=u>0&&u<1?0:o,new tu(o,a,u,e.opacity)}function Xf(e,t,n,r){return arguments.length===1?Poe(e):new tu(e,t,n,r??1)}function tu(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}ay(tu,Xf,n$(_h,{brighter:function(e){return e=e==null?c0:Math.pow(c0,e),new tu(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?kp:Math.pow(kp,e),new tu(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Lr(j3(e>=240?e-240:e+120,i,r),j3(e,i,r),j3(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function j3(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Boe=Math.PI/180,zoe=180/Math.PI,dE=18,Uoe=.96422,joe=1,Woe=.82521,Voe=4/29,Mm=6/29,Goe=3*Mm*Mm,VBe=Mm*Mm*Mm;function Hoe(e){if(e instanceof gu)return new gu(e.l,e.a,e.b,e.opacity);if(e instanceof Bl)return qoe(e);e instanceof Lr||(e=kz(e));var t=H3(e.r),n=H3(e.g),r=H3(e.b),i=W3((.2225045*t+.7168786*n+.0606169*r)/joe),s,o;return t===n&&n===r?s=o=i:(s=W3((.4360747*t+.3850649*n+.1430804*r)/Uoe),o=W3((.0139322*t+.0971045*n+.7141733*r)/Woe)),new gu(116*i-16,500*(s-i),200*(i-o),e.opacity)}function Yf(e,t,n,r){return arguments.length===1?Hoe(e):new gu(e,t,n,r??1)}function gu(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}ay(gu,Yf,n$(_h,{brighter:function(e){return new gu(this.l+dE*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new gu(this.l-dE*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=Uoe*V3(t),e=joe*V3(e),n=Woe*V3(n),new Lr(G3(3.1338561*t-1.6168667*e-.4906146*n),G3(-.9787684*t+1.9161415*e+.033454*n),G3(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function W3(e){return e>VBe?Math.pow(e,1/3):e/Goe+Voe}function V3(e){return e>Mm?e*e*e:Goe*(e-Voe)}function G3(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function H3(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function GBe(e){if(e instanceof Bl)return new Bl(e.h,e.c,e.l,e.opacity);if(e instanceof gu||(e=Hoe(e)),e.a===0&&e.b===0)return new Bl(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*zoe;return new Bl(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Kf(e,t,n,r){return arguments.length===1?GBe(e):new Bl(e,t,n,r??1)}function Bl(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function qoe(e){if(isNaN(e.h))return new gu(e.l,0,0,e.opacity);var t=e.h*Boe;return new gu(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}ay(Bl,Kf,n$(_h,{brighter:function(e){return new Bl(this.h,this.c,this.l+dE*(e??1),this.opacity)},darker:function(e){return new Bl(this.h,this.c,this.l-dE*(e??1),this.opacity)},rgb:function(){return qoe(this).rgb()}}));var Xoe=-.14861,Ez=1.78277,Az=-.29227,lD=-.90649,Nv=1.97294,DH=Nv*lD,NH=Nv*Ez,FH=Ez*Az-lD*Xoe;function HBe(e){if(e instanceof Qd)return new Qd(e.h,e.s,e.l,e.opacity);e instanceof Lr||(e=kz(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(FH*r+DH*t-NH*n)/(FH+DH-NH),s=r-i,o=(Nv*(n-i)-Az*s)/lD,a=Math.sqrt(o*o+s*s)/(Nv*i*(1-i)),u=a?Math.atan2(o,s)*zoe-120:NaN;return new Qd(u<0?u+360:u,a,i,e.opacity)}function Ep(e,t,n,r){return arguments.length===1?HBe(e):new Qd(e,t,n,r??1)}function Qd(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}ay(Qd,Ep,n$(_h,{brighter:function(e){return e=e==null?c0:Math.pow(c0,e),new Qd(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?kp:Math.pow(kp,e),new Qd(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Boe,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Lr(255*(t+n*(Xoe*r+Ez*i)),255*(t+n*(Az*r+lD*i)),255*(t+n*(Nv*r)),this.opacity)}}));function Yoe(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function Koe(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return Yoe((n-r/t)*t,o,i,s,a)}}function Zoe(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return Yoe((n-r/t)*t,i,s,o,a)}}const cD=e=>()=>e;function Joe(e,t){return function(n){return e+n*t}}function qBe(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function fD(e,t){var n=t-e;return n?Joe(e,n>180||n<-180?n-360*Math.round(n/360):n):cD(isNaN(e)?t:e)}function XBe(e){return(e=+e)==1?yr:function(t,n){return n-t?qBe(t,n,e):cD(isNaN(t)?n:t)}}function yr(e,t){var n=t-e;return n?Joe(e,n):cD(isNaN(e)?t:e)}const jM=function e(t){var n=XBe(t);function r(i,s){var o=n((i=ws(i)).r,(s=ws(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=yr(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function Qoe(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=ws(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var YBe=Qoe(Koe),KBe=Qoe(Zoe);function _z(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function eae(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ZBe(e,t){return(eae(t)?_z:tae)(e,t)}function tae(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=vg(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function nae(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function ra(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function rae(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=vg(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var WM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,q3=new RegExp(WM.source,"g");function JBe(e){return function(){return e}}function QBe(e){return function(t){return e(t)+""}}function iae(e,t){var n=WM.lastIndex=q3.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=WM.exec(e))&&(i=q3.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:ra(r,i)})),n=q3.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?QBe(u[0].x):JBe(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function vg(e,t){var n=typeof t,r;return t==null||n==="boolean"?cD(t):(n==="number"?ra:n==="string"?(r=oc(t))?(t=r,jM):iae:t instanceof oc?jM:t instanceof Date?nae:eae(t)?_z:Array.isArray(t)?tae:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?rae:ra)(e,t)}function e5e(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function t5e(e,t){var n=fD(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function hD(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var OH=180/Math.PI,VM={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function sae(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*OH,skewX:Math.atan(u)*OH,scaleX:o,scaleY:a}}var WC;function n5e(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?VM:sae(t.a,t.b,t.c,t.d,t.e,t.f)}function r5e(e){return e==null||(WC||(WC=document.createElementNS("http://www.w3.org/2000/svg","g")),WC.setAttribute("transform",e),!(e=WC.transform.baseVal.consolidate()))?VM:(e=e.matrix,sae(e.a,e.b,e.c,e.d,e.e,e.f))}function oae(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:ra(l,f)},{i:g-2,x:ra(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:ra(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:ra(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:ra(l,f)},{i:g-2,x:ra(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var i5e=oae(n5e,"px, ","px)","deg)"),s5e=oae(r5e,", ",")",")"),o5e=1e-12;function RH(e){return((e=Math.exp(e))+1/e)/2}function a5e(e){return((e=Math.exp(e))-1/e)/2}function u5e(e){return((e=Math.exp(2*e))-1)/(e+1)}const l5e=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,g=d*d+p*p,m,y;if(g<o5e)y=Math.log(h/l)/t,m=function($){return[a+$*d,u+$*p,l*Math.exp(t*$*y)]};else{var b=Math.sqrt(g),v=(h*h-l*l+r*g)/(2*l*n*b),x=(h*h-l*l-r*g)/(2*h*n*b),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(x*x+1)-x);y=(C-w)/t,m=function($){var S=$*y,k=RH(w),E=l/(n*b)*(k*u5e(t*S+w)-a5e(w));return[a+E*d,u+E*p,l*k/RH(t*S+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function aae(e){return function(t,n){var r=e((t=Xf(t)).h,(n=Xf(n)).h),i=yr(t.s,n.s),s=yr(t.l,n.l),o=yr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const c5e=aae(fD);var f5e=aae(yr);function h5e(e,t){var n=yr((e=Yf(e)).l,(t=Yf(t)).l),r=yr(e.a,t.a),i=yr(e.b,t.b),s=yr(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function uae(e){return function(t,n){var r=e((t=Kf(t)).h,(n=Kf(n)).h),i=yr(t.c,n.c),s=yr(t.l,n.l),o=yr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const d5e=uae(fD);var p5e=uae(yr);function lae(e){return function t(n){n=+n;function r(i,s){var o=e((i=Ep(i)).h,(s=Ep(s)).h),a=yr(i.s,s.s),u=yr(i.l,s.l),l=yr(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const g5e=lae(fD);var m5e=lae(yr);function Tz(e,t){t===void 0&&(t=e,e=vg);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function y5e(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const b5e=Object.freeze(Object.defineProperty({__proto__:null,interpolate:vg,interpolateArray:ZBe,interpolateBasis:Koe,interpolateBasisClosed:Zoe,interpolateCubehelix:g5e,interpolateCubehelixLong:m5e,interpolateDate:nae,interpolateDiscrete:e5e,interpolateHcl:d5e,interpolateHclLong:p5e,interpolateHsl:c5e,interpolateHslLong:f5e,interpolateHue:t5e,interpolateLab:h5e,interpolateNumber:ra,interpolateNumberArray:_z,interpolateObject:rae,interpolateRgb:jM,interpolateRgbBasis:YBe,interpolateRgbBasisClosed:KBe,interpolateRound:hD,interpolateString:iae,interpolateTransformCss:i5e,interpolateTransformSvg:s5e,interpolateZoom:l5e,piecewise:Tz,quantize:y5e},Symbol.toStringTag,{value:"Module"}));function x5e(e){return function(){return e}}function GM(e){return+e}var MH=[0,1];function hs(e){return e}function HM(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:x5e(isNaN(t)?NaN:.5)}function v5e(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function w5e(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=HM(i,r),s=n(o,s)):(r=HM(r,i),s=n(s,o)),function(a){return s(r(a))}}function $5e(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=HM(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=Cp(e,a,1,r)-1;return s[u](i[u](a))}}function r$(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function dD(){var e=MH,t=MH,n=vg,r,i,s,o=hs,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==hs&&(o=v5e(e[0],e[h-1])),a=h>2?$5e:w5e,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),ra)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,GM),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=hD,c()},f.clamp=function(h){return arguments.length?(o=h?!0:hs,c()):o!==hs},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function cae(){return dD()(hs,hs)}function fae(e,t,n,r){var i=lE(e,t,n),s;switch(r=Sp(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=Aoe(i,o))&&(r.precision=s),xz(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=_oe(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=Eoe(i))&&(r.precision=s-(r.type==="%")*2);break}}return nD(r)}function wg(e){var t=e.domain;return e.ticks=function(n){var r=t();return zM(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return fae(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=UM(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function hae(){var e=cae();return e.copy=function(){return r$(e,hae())},Vu.apply(e,arguments),wg(e)}function dae(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,GM),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return dae(e).unknown(t)},e=arguments.length?Array.from(e,GM):[0,1],wg(n)}function pae(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function LH(e){return Math.log(e)}function PH(e){return Math.exp(e)}function C5e(e){return-Math.log(-e)}function S5e(e){return-Math.exp(-e)}function k5e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function E5e(e){return e===10?k5e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function A5e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function BH(e){return(t,n)=>-e(-t,n)}function Iz(e){const t=e(LH,PH),n=t.domain;let r=10,i,s;function o(){return i=A5e(r),s=E5e(r),n()[0]<0?(i=BH(i),s=BH(s),e(C5e,S5e)):e(LH,PH),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let h=i(l),d=i(c),p,g;const m=a==null?10:+a;let y=[];if(!(r%1)&&d-h<m){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(p=1;p<r;++p)if(g=h<0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}}else for(;h<=d;++h)for(p=r-1;p>=1;--p)if(g=h>0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}y.length*2<m&&(y=zM(l,c,m))}else y=zM(h,d,Math.min(d-h,m)).map(s);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=r===10?"s":","),typeof u!="function"&&(!(r%1)&&(u=Sp(u)).precision==null&&(u.trim=!0),u=nD(u)),a===1/0)return u;const l=Math.max(1,r*a/t.ticks().length);return c=>{let f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=()=>n(pae(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),t}function gae(){const e=Iz(dD()).domain([1,10]);return e.copy=()=>r$(e,gae()).base(e.base()),Vu.apply(e,arguments),e}function zH(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function UH(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Dz(e){var t=1,n=e(zH(t),UH(t));return n.constant=function(r){return arguments.length?e(zH(t=+r),UH(t)):t},wg(n)}function mae(){var e=Dz(dD());return e.copy=function(){return r$(e,mae()).constant(e.constant())},Vu.apply(e,arguments)}function jH(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function _5e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function T5e(e){return e<0?-e*e:e*e}function Nz(e){var t=e(hs,hs),n=1;function r(){return n===1?e(hs,hs):n===.5?e(_5e,T5e):e(jH(n),jH(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},wg(t)}function Fz(){var e=Nz(dD());return e.copy=function(){return r$(e,Fz()).exponent(e.exponent())},Vu.apply(e,arguments),e}function I5e(){return Fz.apply(null,arguments).exponent(.5)}function yae(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=HLe(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[Cp(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(px),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return yae().domain(e).range(t).unknown(r)},Vu.apply(s,arguments)}function bae(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[Cp(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return bae().domain([e,t]).range(i).unknown(s)},Vu.apply(wg(o),arguments)}function xae(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[Cp(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return xae().domain(e).range(t).unknown(n)},Vu.apply(i,arguments)}function D5e(e){return new Date(e)}function N5e(e){return e instanceof Date?+e:+new Date(+e)}function Oz(e,t,n,r,i,s,o,a,u,l){var c=cae(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),v=l("%B"),x=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?g:s(C)<C?m:r(C)<C?i(C)<C?y:b:n(C)<C?v:x)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,N5e)):h().map(D5e)},c.ticks=function(C){var $=h();return e($[0],$[$.length-1],C??10)},c.tickFormat=function(C,$){return $==null?w:l($)},c.nice=function(C){var $=h();return(!C||typeof C.range!="function")&&(C=t($[0],$[$.length-1],C??10)),C?h(pae($,C)):c},c.copy=function(){return r$(c,Oz(e,t,n,r,i,s,o,a,u,l))},c}function F5e(){return Vu.apply(Oz(hPe,dPe,Iu,wv,e$,wf,sD,rD,Pl,$z).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function O5e(){return Vu.apply(Oz(cPe,fPe,Du,$v,t$,Jd,oD,iD,Pl,Cz).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function pD(){var e=0,t=1,n,r,i,s,o=hs,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(vg),l.rangeRound=c(hD),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Th(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Rz(){var e=wg(pD()(hs));return e.copy=function(){return Th(e,Rz())},Ah.apply(e,arguments)}function vae(){var e=Iz(pD()).domain([1,10]);return e.copy=function(){return Th(e,vae()).base(e.base())},Ah.apply(e,arguments)}function wae(){var e=Dz(pD());return e.copy=function(){return Th(e,wae()).constant(e.constant())},Ah.apply(e,arguments)}function Mz(){var e=Nz(pD());return e.copy=function(){return Th(e,Mz()).exponent(e.exponent())},Ah.apply(e,arguments)}function R5e(){return Mz.apply(null,arguments).exponent(.5)}function gD(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=hs,c,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+c(g))-s)*(r*g<r*s?a:u),l(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var y,b,v;return arguments.length?([y,b,v]=m,l=Tz(g,[y,b,v]),d):[l(0),l(.5),l(1)]}}return d.range=p(vg),d.rangeRound=p(hD),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return c=g,i=g(e),s=g(t),o=g(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function $ae(){var e=wg(gD()(hs));return e.copy=function(){return Th(e,$ae())},Ah.apply(e,arguments)}function Cae(){var e=Iz(gD()).domain([.1,1,10]);return e.copy=function(){return Th(e,Cae()).base(e.base())},Ah.apply(e,arguments)}function Sae(){var e=Dz(gD());return e.copy=function(){return Th(e,Sae()).constant(e.constant())},Ah.apply(e,arguments)}function Lz(){var e=Nz(gD());return e.copy=function(){return Th(e,Lz()).exponent(e.exponent())},Ah.apply(e,arguments)}function M5e(){return Lz.apply(null,arguments).exponent(.5)}function L5e(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const P5e="identity",Pz="linear",Zf="log",Bz="pow",zz="sqrt",Uz="symlog",Fv="time",Ov="utc",uy="sequential",i$="diverging",pE="quantile",jz="quantize",kae="threshold",B5e="ordinal",z5e="point",U5e="band",j5e="bin-ordinal",Fr="continuous",s$="discrete",o$="discretizing",Fa="interpolating",Wz="temporal";function W5e(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function V5e(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function Vz(){const e=Sz().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=L5e(f,a,u);let g=r[h-0];i=(d-g)/(p||1),o&&(i=Math.floor(i)),g+=(d-g-i*(f-a))*l,s=i*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=qLe(f).map(y=>g+i*y);return n(h?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let g=+f[0],m=+f[1],y,b,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<d[0]||g>r[1-h])))return y=Math.max(0,Cp(d,g)-1),b=g===m?y:Cp(d,m)-1,g-d[y]>s+1e-10&&++y,h&&(v=y,y=p-b,b=p-v),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return Vz().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function Eae(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Eae(t())},e}function G5e(){return Eae(Vz().paddingInner(1))}var H5e=Array.prototype.map;function q5e(e){return H5e.call(e,oLe)}const X5e=Array.prototype.slice;function Aae(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(Cp(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=q5e(r),n):e.slice()},n.range=function(r){return arguments.length?(t=X5e.call(r),n):t.slice()},n.tickFormat=function(r,i){return fae(e[0],du(e),r??10,i)},n.copy=function(){return Aae().domain(n.domain()).range(n.range())},n}const gE=new Map,Y5e=Symbol("vega_scale");function K5e(e){return e[Y5e]=!0,e}function Z5e(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?W5e(s):s.invertExtent?V5e(s):void 0),s.type=e,K5e(s)};return r.metadata=ioe(lz(n)),r}function on(e,t,n){return arguments.length>1?(gE.set(e,Z5e(e,t,n)),this):J5e(e)?gE.get(e):void 0}on(P5e,dae);on(Pz,hae,Fr);on(Zf,gae,[Fr,Zf]);on(Bz,Fz,Fr);on(zz,I5e,Fr);on(Uz,mae,Fr);on(Fv,F5e,[Fr,Wz]);on(Ov,O5e,[Fr,Wz]);on(uy,Rz,[Fr,Fa]);on(`${uy}-${Pz}`,Rz,[Fr,Fa]);on(`${uy}-${Zf}`,vae,[Fr,Fa,Zf]);on(`${uy}-${Bz}`,Mz,[Fr,Fa]);on(`${uy}-${zz}`,R5e,[Fr,Fa]);on(`${uy}-${Uz}`,wae,[Fr,Fa]);on(`${i$}-${Pz}`,$ae,[Fr,Fa]);on(`${i$}-${Zf}`,Cae,[Fr,Fa,Zf]);on(`${i$}-${Bz}`,Lz,[Fr,Fa]);on(`${i$}-${zz}`,M5e,[Fr,Fa]);on(`${i$}-${Uz}`,Sae,[Fr,Fa]);on(pE,yae,[o$,pE]);on(jz,bae,o$);on(kae,xae,o$);on(j5e,Aae,[s$,o$]);on(B5e,Sz,s$);on(U5e,Vz,s$);on(z5e,G5e,s$);function J5e(e){return gE.has(e)}function mD(e,t){const n=gE.get(e);return n&&n.metadata[t]}function _ae(e){return mD(e,s$)}function Q5e(e){return mD(e,o$)}function e6e(e){return mD(e,Zf)}function t6e(e){return mD(e,Wz)}function n6e(e,t,n){return Tz(r6e(t||"rgb",n),e)}function r6e(e,t){const n=b5e[i6e(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function i6e(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const s6e={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},o6e={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Tae(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function Iae(e,t){for(const n in e)a6e(n,t(e[n]))}const WH={};Iae(o6e,Tae);Iae(s6e,e=>n6e(Tae(e)));function a6e(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(WH[e]=t,this):WH[e]}const u6e="symbol",l6e="discrete",c6e=e=>Wu(e)?e.map(t=>String(t)):String(e),f6e=(e,t)=>e[1]-t[1],h6e=(e,t)=>t[1]-e[1];function d6e(e,t,n){let r=e.range(),i=r[0],s=du(r),o=f6e;if(i>s&&(r=s,s=i,i=r,o=h6e),i=Math.floor(i),s=Math.ceil(s),t=t.map(a=>[a,e(a)]).filter(a=>i<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],du(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function Dae(e,t){return e.bins?d6e(e,e.bins):e.ticks?e.ticks(t):e.domain()}function p6e(e,t,n,r,i,s){const o=t.type;let a=c6e;if(o===Fv||i===Fv)a=e.timeFormat(r);else if(o===Ov||i===Ov)a=e.utcFormat(r);else if(e6e(o)){const u=e.formatFloat(r);if(s||t.bins)a=u;else{const l=Nae(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,r)}else r&&(a=e.format(r));return a}function Nae(e,t,n){const r=Dae(e,t),i=e.base(),s=Math.log(i),o=Math.max(1,i*t/r.length),a=u=>{let l=u/Math.pow(i,Math.round(Math.log(u)/s));return l*i<i-.5&&(l*=i),l<=o};return n?r.filter(a):a}const qM={[pE]:"quantiles",[jz]:"thresholds",[kae]:"domain"},Fae={[pE]:"quantiles",[jz]:"domain"};function g6e(e,t){return e.bins?b6e(e.bins):e.type===Zf?Nae(e,t,!0):qM[e.type]?y6e(e[qM[e.type]]()):Dae(e,t)}function m6e(e,t,n){const r=t[Fae[t.type]](),i=r.length;let s=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)s=Math.min(s,r[o]-r[o-1]);return e.formatSpan(0,s,3*10,n)}function y6e(e){const t=[-1/0].concat(e);return t.max=1/0,t}function b6e(e){const t=e.slice(0,-1);return t.max=du(e),t}const x6e=e=>qM[e.type]||e.bins;function v6e(e,t,n,r,i,s,o){const a=Fae[t.type]&&s!==Fv&&s!==Ov?m6e(e,t,i):p6e(e,t,n,i,s,o);return r===u6e&&x6e(t)?w6e(a):r===l6e?$6e(a):C6e(a)}const w6e=e=>(t,n,r)=>{const i=VH(r[n+1],VH(r.max,1/0)),s=GH(t,e),o=GH(i,e);return s&&o?s+" – "+o:o?"< "+o:"≥ "+s},VH=(e,t)=>e??t,$6e=e=>(t,n)=>n?e(t):null,C6e=e=>t=>e(t),GH=(e,t)=>Number.isFinite(e)?t(e):null;function S6e(e,t,n,r){const i=r||t.type;return rE(n)&&t6e(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===Fv?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===Ov?e.utcFormat("%A, %d %B %Y, %X UTC"):v6e(e,t,5,null,n,r,!0)}function Oae(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=S6e(e,t,n.format,n.formatType);if(Q5e(t.type)){const s=g6e(t).slice(1).map(i),o=s.length;return`${o} boundar${o===1?"y":"ies"}: ${s.join(", ")}`}else if(_ae(t.type)){const s=t.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return`${o} value${o===1?"":"s"}: ${a}`}else{const s=t.domain();return`values from ${i(s[0])} to ${i(du(s))}`}}let k6e=0;const mE="p_";function Gz(e){return e&&e.gradient}function Rae(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?mE:"";return i||(i=e.id="gradient_"+k6e++,r==="radial"?(e.x1=Ga(e.x1,.5),e.y1=Ga(e.y1,.5),e.r1=Ga(e.r1,0),e.x2=Ga(e.x2,.5),e.y2=Ga(e.y2,.5),e.r2=Ga(e.r2,.5),s=mE):(e.x1=Ga(e.x1,0),e.y1=Ga(e.y1,0),e.x2=Ga(e.x2,1),e.y2=Ga(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function Ga(e,t){return e??t}const HH={basis:{curve:CLe},"basis-closed":{curve:SLe},"basis-open":{curve:kLe},bundle:{curve:ELe,tension:"beta",value:.85},cardinal:{curve:ALe,tension:"tension",value:0},"cardinal-open":{curve:TLe,tension:"tension",value:0},"cardinal-closed":{curve:_Le,tension:"tension",value:0},"catmull-rom":{curve:ILe,tension:"alpha",value:.5},"catmull-rom-closed":{curve:DLe,tension:"alpha",value:.5},"catmull-rom-open":{curve:NLe,tension:"alpha",value:.5},linear:{curve:hz},"linear-closed":{curve:FLe},monotone:{horizontal:RLe,vertical:OLe},natural:{curve:MLe},step:{curve:LLe},"step-after":{curve:BLe},"step-before":{curve:PLe}};function Mae(e,t,n){var r=Dl(HH,e)&&HH[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const E6e={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},A6e=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,_6e=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,T6e=/^((\s+,?\s*)|(,\s*))/,I6e=/^[01]/;function Lae(e){const t=[];return(e.match(A6e)||[]).forEach(r=>{let i=r[0];const s=i.toLowerCase(),o=E6e[s],a=D6e(s,o,r.slice(1).trim()),u=a.length;if(u<o||u&&u%o!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([i,...a.slice(0,o)]),u!==o){s==="m"&&(i=i==="M"?"L":"l");for(let l=o;l<u;l+=o)t.push([i,...a.slice(l,l+o)])}}),t}function D6e(e,t,n){const r=[];for(let i=0;t&&i<n.length;)for(let s=0;s<t;++s){const o=e==="a"&&(s===3||s===4)?I6e:_6e,a=n.slice(i).match(o);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");i+=a[0].length,r.push(+a[0]);const u=n.slice(i).match(T6e);u!==null&&(i+=u[0].length)}return r}const Jf=Math.PI/180,N6e=1e-14,Cd=Math.PI/2,nu=Math.PI*2,nm=Math.sqrt(3)/2;var X3={},Y3={},Pae=[].join;function F6e(e,t,n,r,i,s,o,a,u){const l=Pae.call(arguments);if(X3[l])return X3[l];const c=o*Jf,f=Math.sin(c),h=Math.cos(c);n=Math.abs(n),r=Math.abs(r);const d=h*(a-e)*.5+f*(u-t)*.5,p=h*(u-t)*.5-f*(a-e)*.5;let g=d*d/(n*n)+p*p/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=h/n,y=f/n,b=-f/r,v=h/r,x=m*a+y*u,w=b*a+v*u,C=m*e+y*t,$=b*e+v*t;let k=1/((C-x)*(C-x)+($-w)*($-w))-.25;k<0&&(k=0);let E=Math.sqrt(k);s==i&&(E=-E);const A=.5*(x+C)-E*($-w),F=.5*(w+$)+E*(C-x),_=Math.atan2(w-F,x-A);let T=Math.atan2($-F,C-A)-_;T<0&&s===1?T+=nu:T>0&&s===0&&(T-=nu);const O=Math.ceil(Math.abs(T/(Cd+.001))),L=[];for(let M=0;M<O;++M){const P=_+M*T/O,G=_+(M+1)*T/O;L[M]=[A,F,P,G,n,r,f,h]}return X3[l]=L}function O6e(e){const t=Pae.call(e);if(Y3[t])return Y3[t];var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7];const c=l*o,f=-u*a,h=u*o,d=l*a,p=Math.cos(i),g=Math.sin(i),m=Math.cos(s),y=Math.sin(s),b=.5*(s-i),v=Math.sin(b*.5),x=8/3*v*v/Math.sin(b),w=n+p-x*g,C=r+g+x*p,$=n+m,S=r+y,k=$+x*y,E=S-x*m;return Y3[t]=[c*w+f*C,h*w+d*C,c*k+f*E,h*k+d*E,c*$+f*S,h*$+d*S]}const to=["l",0,0,0,0,0,0,0];function R6e(e,t,n){const r=to[0]=e[0];if(r==="a"||r==="A")to[1]=t*e[1],to[2]=n*e[2],to[3]=e[3],to[4]=e[4],to[5]=e[5],to[6]=t*e[6],to[7]=n*e[7];else if(r==="h"||r==="H")to[1]=t*e[1];else if(r==="v"||r==="V")to[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)to[i]=(i%2==1?t:n)*e[i];return to}function XM(e,t,n,r,i,s){var o,a=null,u=0,l=0,c=0,f=0,h,d,p,g,m=0,y=0;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var b=0,v=t.length;b<v;++b){switch(o=t[b],(i!==1||s!==1)&&(o=R6e(o,i,s)),o[0]){case"l":u+=o[1],l+=o[2],e.lineTo(u+n,l+r);break;case"L":u=o[1],l=o[2],e.lineTo(u+n,l+r);break;case"h":u+=o[1],e.lineTo(u+n,l+r);break;case"H":u=o[1],e.lineTo(u+n,l+r);break;case"v":l+=o[1],e.lineTo(u+n,l+r);break;case"V":l=o[1],e.lineTo(u+n,l+r);break;case"m":u+=o[1],l+=o[2],m=u,y=l,e.moveTo(u+n,l+r);break;case"M":u=o[1],l=o[2],m=u,y=l,e.moveTo(u+n,l+r);break;case"c":h=u+o[5],d=l+o[6],c=u+o[3],f=l+o[4],e.bezierCurveTo(u+o[1]+n,l+o[2]+r,c+n,f+r,h+n,d+r),u=h,l=d;break;case"C":u=o[5],l=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,c+n,f+r,u+n,l+r);break;case"s":h=u+o[3],d=l+o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,u+o[1]+n,l+o[2]+r,h+n,d+r),c=u+o[1],f=l+o[2],u=h,l=d;break;case"S":h=o[3],d=o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"q":h=u+o[3],d=l+o[4],c=u+o[1],f=l+o[2],e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"Q":h=o[3],d=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"t":h=u+o[1],d=l+o[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-p,f=2*l-g):a[0]==="q"&&(c=2*u-c,f=2*l-f),p=c,g=f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d,c=u+o[1],f=l+o[2];break;case"T":h=o[1],d=o[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"a":qH(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+r]),u+=o[6],l+=o[7];break;case"A":qH(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),u=o[6],l=o[7];break;case"z":case"Z":u=m,l=y,e.closePath();break}a=o}}function qH(e,t,n,r){const i=F6e(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const o=O6e(i[s]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const XH=.5773502691896257,YH={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,nu)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n,i=r-n*XH,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n,i=r-n*XH;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function M6e(e){return Dl(YH,e)?YH[e]:L6e(e)}var K3={};function L6e(e){if(!Dl(K3,e)){const t=Lae(e);K3[e]={draw:function(n,r){XM(n,t,0,0,Math.sqrt(r)/2)}}}return K3[e]}const Mc=.448084975506;function P6e(e){return e.x}function B6e(e){return e.y}function z6e(e){return e.width}function U6e(e){return e.height}function dl(e){return typeof e=="function"?e:()=>+e}function VC(e,t,n){return Math.max(t,Math.min(e,n))}function j6e(){var e=P6e,t=B6e,n=z6e,r=U6e,i=dl(0),s=i,o=i,a=i,u=null;function l(c,f,h){var d,p=f??+e.call(this,c),g=h??+t.call(this,c),m=+n.call(this,c),y=+r.call(this,c),b=Math.min(m,y)/2,v=VC(+i.call(this,c),0,b),x=VC(+s.call(this,c),0,b),w=VC(+o.call(this,c),0,b),C=VC(+a.call(this,c),0,b);if(u||(u=d=fz()),v<=0&&x<=0&&w<=0&&C<=0)u.rect(p,g,m,y);else{var $=p+m,S=g+y;u.moveTo(p+v,g),u.lineTo($-x,g),u.bezierCurveTo($-Mc*x,g,$,g+Mc*x,$,g+x),u.lineTo($,S-C),u.bezierCurveTo($,S-Mc*C,$-Mc*C,S,$-C,S),u.lineTo(p+w,S),u.bezierCurveTo(p+Mc*w,S,p,S-Mc*w,p,S-w),u.lineTo(p,g+v),u.bezierCurveTo(p,g+Mc*v,p+Mc*v,g,p+v,g),u.closePath()}if(d)return u=null,d+""||null}return l.x=function(c){return arguments.length?(e=dl(c),l):e},l.y=function(c){return arguments.length?(t=dl(c),l):t},l.width=function(c){return arguments.length?(n=dl(c),l):n},l.height=function(c){return arguments.length?(r=dl(c),l):r},l.cornerRadius=function(c,f,h,d){return arguments.length?(i=dl(c),s=f!=null?dl(f):i,a=h!=null?dl(h):i,o=d!=null?dl(d):s,l):i},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function W6e(){var e,t,n,r,i=null,s,o,a,u;function l(f,h,d){const p=d/2;if(s){var g=a-h,m=f-o;if(g||m){var y=Math.hypot(g,m),b=(g/=y)*u,v=(m/=y)*u,x=Math.atan2(m,g);i.moveTo(o-b,a-v),i.lineTo(f-g*p,h-m*p),i.arc(f,h,p,x-Math.PI,x),i.lineTo(o+b,a+v),i.arc(o,a,u,x,x+Math.PI)}else i.arc(f,h,p,0,nu);i.closePath()}else s=1;o=f,a=h,u=p}function c(f){var h,d=f.length,p,g=!1,m;for(i==null&&(i=m=fz()),h=0;h<=d;++h)!(h<d&&r(p=f[h],h,f))===g&&(g=!g)&&(s=0),g&&l(+e(p,h,f),+t(p,h,f),+n(p,h,f));if(m)return i=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(r=f,c):r},c.context=function(f){return arguments.length?(f==null?i=null:i=f,c):i},c}function a$(e,t){return e??t}const u$=e=>e.x||0,l$=e=>e.y||0,V6e=e=>e.width||0,G6e=e=>e.height||0,H6e=e=>(e.x||0)+(e.width||0),q6e=e=>(e.y||0)+(e.height||0),X6e=e=>e.startAngle||0,Y6e=e=>e.endAngle||0,K6e=e=>e.padAngle||0,Z6e=e=>e.innerRadius||0,J6e=e=>e.outerRadius||0,Q6e=e=>e.cornerRadius||0,eze=e=>a$(e.cornerRadiusTopLeft,e.cornerRadius)||0,tze=e=>a$(e.cornerRadiusTopRight,e.cornerRadius)||0,nze=e=>a$(e.cornerRadiusBottomRight,e.cornerRadius)||0,rze=e=>a$(e.cornerRadiusBottomLeft,e.cornerRadius)||0,ize=e=>a$(e.size,64),sze=e=>e.size||1,yD=e=>e.defined!==!1,oze=e=>M6e(e.shape||"circle"),aze=vLe().startAngle(X6e).endAngle(Y6e).padAngle(K6e).innerRadius(Z6e).outerRadius(J6e).cornerRadius(Q6e),uze=hoe().x(u$).y1(l$).y0(q6e).defined(yD),lze=hoe().y(l$).x1(u$).x0(H6e).defined(yD),cze=foe().x(u$).y(l$).defined(yD),fze=j6e().x(u$).y(l$).width(V6e).height(G6e).cornerRadius(eze,tze,nze,rze),hze=$Le().type(oze).size(ize),dze=W6e().x(u$).y(l$).defined(yD).size(sze);function Hz(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function pze(e,t){return aze.context(e)(t)}function gze(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?lze:uze).curve(Mae(r,n.orient,n.tension)).context(e)(t)}function mze(e,t){const n=t[0],r=n.interpolate||"linear";return cze.curve(Mae(r,n.orient,n.tension)).context(e)(t)}function ly(e,t,n,r){return fze.context(e)(t,n,r)}function yze(e,t){return(t.mark.shape||t.shape).context(e)(t)}function bze(e,t){return hze.context(e)(t)}function xze(e,t){return dze.context(e)(t)}var vze=1;function qz(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+vze++),o=i.clipping[s]||(i.clipping[s]={id:s});return ZI(r)?o.path=r(null):Hz(n)?o.path=ly(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function Ks(e){this.clear(),e&&this.union(e)}Ks.prototype={clone(){return new Ks(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*r-u*i+l,u*r+a*i+c,a*r-u*o+l,u*r+a*o+c,a*s-u*i+l,u*s+a*i+c,a*s-u*o+l,u*s+a*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function Xz(e){this.mark=e,this.bounds=this.bounds||new Ks}function Bae(e){Xz.call(this,e),this.items=this.items||[]}Ns(Bae,Xz);function zae(e){this._pending=0,this._loader=e||Loe()}function KH(e){e._pending+=1}function ub(e){e._pending-=1}zae.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return KH(t),t._loader.sanitize(e,{context:"href"}).then(n=>(ub(t),n)).catch(()=>(ub(t),null))},loadImage(e){const t=this,n=Coe();return KH(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,o=Dl(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>ub(t),s.onerror=()=>ub(t),s.src=i,s}).catch(r=>(ub(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}n(!1)})}};function Ih(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?wze(t,r):0))}return e}function wze(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const $ze=nu-1e-8;let bD,KS,ZS,Pd,YM,JS,KM,ZM;const Qc=(e,t)=>bD.add(e,t),QS=(e,t)=>Qc(KS=e,ZS=t),ZH=e=>Qc(e,bD.y1),JH=e=>Qc(bD.x1,e),Sd=(e,t)=>YM*e+KM*t,kd=(e,t)=>JS*e+ZM*t,Z3=(e,t)=>Qc(Sd(e,t),kd(e,t)),J3=(e,t)=>QS(Sd(e,t),kd(e,t));function xD(e,t){return bD=e,t?(Pd=t*Jf,YM=ZM=Math.cos(Pd),JS=Math.sin(Pd),KM=-JS):(YM=ZM=1,Pd=JS=KM=0),Cze}const Cze={beginPath(){},closePath(){},moveTo:J3,lineTo:J3,rect(e,t,n,r){Pd?(Z3(e+n,t),Z3(e+n,t+r),Z3(e,t+r),J3(e,t)):(Qc(e+n,t+r),QS(e,t))},quadraticCurveTo(e,t,n,r){const i=Sd(e,t),s=kd(e,t),o=Sd(n,r),a=kd(n,r);QH(KS,i,o,ZH),QH(ZS,s,a,JH),QS(o,a)},bezierCurveTo(e,t,n,r,i,s){const o=Sd(e,t),a=kd(e,t),u=Sd(n,r),l=kd(n,r),c=Sd(i,s),f=kd(i,s);eq(KS,o,u,c,ZH),eq(ZS,a,l,f,JH),QS(c,f)},arc(e,t,n,r,i,s){if(r+=Pd,i+=Pd,KS=n*Math.cos(i)+e,ZS=n*Math.sin(i)+t,Math.abs(i-r)>$ze)Qc(e-n,t-n),Qc(e+n,t+n);else{const o=l=>Qc(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(o(r),o(i),i!==r)if(r=r%nu,r<0&&(r+=nu),i=i%nu,i<0&&(i+=nu),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=nu,a=r-r%Cd,u=0;u<4&&a>i;++u,a-=Cd)o(a);else for(a=r-r%Cd+Cd,u=0;u<4&&a<i;++u,a=a+Cd)o(a)}}};function QH(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function eq(e,t,n,r,i){const s=r-e+3*t-3*n,o=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(s)>N6e?(c=o*o+a*s,c>=0&&(c=Math.sqrt(c),u=(-o+c)/s,l=(-o-c)/s)):u=.5*a/o,0<u&&u<1&&i(tq(u,e,t,n,r)),0<l&&l<1&&i(tq(l,e,t,n,r))}function tq(e,t,n,r,i){const s=1-e,o=s*s,a=e*e;return o*s*t+3*o*e*n+3*s*a*r+a*e*i}var $f=($f=xc(1,1))?$f.getContext("2d"):null;const JM=new Ks;function Uae(e){return function(t,n){if(!$f)return!0;e($f,t),JM.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=JM;for(let a=i;a<=o;++a)for(let u=r;u<=s;++u)if($f.isPointInPath(u,a))return!0;return!1}}function jae(e,t){return t.contains(e.x||0,e.y||0)}function Wae(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(JM.set(n,r,n+i,r+s))}function Sze(e,t){const n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:r;return Vb(t,n,r,i,s)}function Vb(e,t,n,r,i){const{x1:s,y1:o,x2:a,y2:u}=e,l=r-t,c=i-n;let f=0,h=1,d,p,g,m;for(m=0;m<4;++m){if(m===0&&(d=-l,p=-(s-t)),m===1&&(d=l,p=a-t),m===2&&(d=-c,p=-(o-n)),m===3&&(d=c,p=u-n),Math.abs(d)<1e-10&&p<0)return!1;if(g=p/d,d<0){if(g>h)return!1;g>f&&(f=g)}else if(d>0){if(g<f)return!1;g<h&&(h=g)}}return!0}function f0(e,t){e.globalCompositeOperation=t.blend||"source-over"}function qo(e,t){return e??t}function nq(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function kze(e,t,n){const r=n.width(),i=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+qo(t.x1,.5)*r,n.y1+qo(t.y1,.5)*i,Math.max(r,i)*qo(t.r1,0),n.x1+qo(t.x2,.5)*r,n.y1+qo(t.y2,.5)*i,Math.max(r,i)*qo(t.r2,.5));else{const o=qo(t.x1,0),a=qo(t.y1,0),u=qo(t.x2,1),l=qo(t.y2,0);if(o===u||a===l||r===i)s=e.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+u*r,n.y1+l*i);else{const c=xc(Math.ceil(r),Math.ceil(i)),f=c.getContext("2d");return f.scale(r,i),f.fillStyle=nq(f.createLinearGradient(o,a,u,l),t.stops),f.fillRect(0,0,r,i),e.createPattern(c,"no-repeat")}}return nq(s,t.stops)}function Vae(e,t,n){return Gz(n)?kze(e,n,t.bounds):n}function yE(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=Vae(e,t,t.fill),!0):!1}var Eze=[];function h0(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return r<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=Vae(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||Eze),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function Aze(e,t){return e.zindex-t.zindex||e.index-t.index}function Gae(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,s;for(i=0,s=t.length;i<s;++i)r=t[i],r.index=i,r.zindex&&n.push(r);return e.zdirty=!1,e.zitems=n.sort(Aze)}function Nu(e,t){var n=e.items,r,i;if(!n||!n.length)return;const s=Gae(e);if(s&&s.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||t(n[r]);n=s}for(r=0,i=n.length;r<i;++r)t(n[r])}function QM(e,t){var n=e.items,r,i;if(!n||!n.length)return null;const s=Gae(e);for(s&&s.length&&(n=s),i=n.length;--i>=0;)if(r=t(n[i]))return r;if(n===s){for(n=e.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=t(n[i])))return r}return null}function Yz(e){return function(t,n,r){Nu(n,i=>{(!r||r.intersects(i.bounds))&&Hae(e,t,i,i)})}}function _ze(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&Hae(e,t,n.items[0],n.items)}}function Hae(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(f0(t,n),n.fill&&yE(t,n,i)&&t.fill(),n.stroke&&h0(t,n,i)&&t.stroke()))}function vD(e){return e=e||noe,function(t,n,r,i,s,o){return r*=t.pixelRatio,i*=t.pixelRatio,QM(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&e(t,a,r,i,s,o))return a})}}function c$(e,t){return function(n,r,i,s){var o=Array.isArray(r)?r[0]:r,a=t??o.fill,u=o.stroke&&n.isPointInStroke,l,c;return u&&(l=o.strokeWidth,c=o.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,r)?!1:a&&n.isPointInPath(i,s)||u&&n.isPointInStroke(i,s)}}function Kz(e){return vD(c$(e))}function ep(e,t){return"translate("+e+","+t+")"}function Zz(e){return"rotate("+e+")"}function Tze(e,t){return"scale("+e+","+t+")"}function qae(e){return ep(e.x||0,e.y||0)}function Ize(e){return ep(e.x||0,e.y||0)+(e.angle?" "+Zz(e.angle):"")}function Dze(e){return ep(e.x||0,e.y||0)+(e.angle?" "+Zz(e.angle):"")+(e.scaleX||e.scaleY?" "+Tze(e.scaleX||1,e.scaleY||1):"")}function Jz(e,t,n){function r(o,a){o("transform",Ize(a)),o("d",t(null,a))}function i(o,a){return t(xD(o,a.angle),a),Ih(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,l=a.y||0,c=a.angle||0;o.translate(u,l),c&&o.rotate(c*=Jf),o.beginPath(),t(o,a),c&&o.rotate(-c),o.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:r,bound:i,draw:Yz(s),pick:Kz(s),isect:n||Uae(s)}}var Nze=Jz("arc",pze);function Fze(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,s=1/0,o,a;--i>=0;)e[i].defined!==!1&&(a=Math.abs(e[i][r]-n),a<s&&(s=a,o=e[i]));return o}function Oze(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,s,o;--r>=0;)if(e[r].defined!==!1&&(i=e[r].x-t[0],s=e[r].y-t[1],o=i*i+s*s,o<n))return e[r];return null}function Rze(e,t){for(var n=e.length,r,i,s;--n>=0;)if(e[n].defined!==!1&&(r=e[n].x-t[0],i=e[n].y-t[1],s=r*r+i*i,r=e[n].size||1,s<r*r))return e[n];return null}function Qz(e,t,n){function r(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function i(u,l){var c=l.items;return c.length===0?u:(t(xD(u),c),Ih(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const o=c$(s);function a(u,l,c,f,h,d){var p=l.items,g=l.bounds;return!p||!p.length||g&&!g.contains(h,d)?null:(c*=u.pixelRatio,f*=u.pixelRatio,o(u,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:r,bound:i,draw:_ze(s),pick:a,isect:jae,tip:n}}var Mze=Qz("area",gze,Fze);function Lze(e,t){var n=t.clip;e.save(),ZI(n)?(e.beginPath(),n(e),e.clip()):Xae(e,t.group)}function Xae(e,t){e.beginPath(),Hz(t)?ly(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Yae(e){const t=qo(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Pze(e,t){e("transform",qae(t))}function Kae(e,t){const n=Yae(t);e("d",ly(null,t,n,n))}function Bze(e,t){e("class","background"),e("aria-hidden",!0),Kae(e,t)}function zze(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Kae(e,t):e("d","")}function Uze(e,t,n){const r=t.clip?qz(n,t,t):null;e("clip-path",r)}function jze(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Ih(e,t),e.translate(t.x||0,t.y||0)}function Rv(e,t,n,r){const i=Yae(t);e.beginPath(),ly(e,t,(n||0)+i,(r||0)+i)}const Wze=c$(Rv),Vze=c$(Rv,!1),Gze=c$(Rv,!0);function Hze(e,t,n,r){Nu(t,i=>{const s=i.x||0,o=i.y||0,a=i.strokeForeground,u=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&u&&(Rv(e,i,s,o),f0(e,i),i.fill&&yE(e,i,u)&&e.fill(),i.stroke&&!a&&h0(e,i,u)&&e.stroke()),e.save(),e.translate(s,o),i.clip&&Xae(e,i),n&&n.translate(-s,-o),Nu(i,l=>{(l.marktype==="group"||r==null||r.includes(l.marktype))&&this.draw(e,l,n,r)}),n&&n.translate(s,o),e.restore(),a&&i.stroke&&u&&(Rv(e,i,s,o),f0(e,i),h0(e,i,u)&&e.stroke())})}function qze(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const o=n*e.pixelRatio,a=r*e.pixelRatio;return QM(t,u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,s))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(i<c||i>d||s<f||s>p))return;if(e.save(),e.translate(c,f),c=i-c,f=s-f,g&&Hz(u)&&!Gze(e,u,o,a))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&Vze(e,u,o,a)?(e.restore(),u):(l=QM(u,b=>Xze(b,c,f)?this.pick(b,n,r,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&Wze(e,u,o,a)&&(l=u),e.restore(),l||null)})}function Xze(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var Yze={type:"group",tag:"g",nested:!1,attr:Pze,bound:jze,draw:Hze,pick:qze,isect:Wae,content:Uze,background:Bze,foreground:zze},Mv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function e8(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function t8(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function n8(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function wD(e,t){return e==="center"?t/2:e==="right"?t:0}function $D(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function Kze(e,t,n){const r=e8(t,n),i=t8(t,r),s=n8(t,r),o=(t.x||0)-wD(t.align,i),a=(t.y||0)-$D(t.baseline,s),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",u,Mv["xmlns:xlink"],"xlink:href"),e("transform",ep(o,a)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function Zze(e,t){const n=t.image,r=t8(t,n),i=n8(t,n),s=(t.x||0)-wD(t.align,r),o=(t.y||0)-$D(t.baseline,i);return e.set(s,o,s+r,o+i)}function Jze(e,t,n){Nu(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=e8(r,this);let s=t8(r,i),o=n8(r,i);if(s===0||o===0)return;let a=(r.x||0)-wD(r.align,s),u=(r.y||0)-$D(r.baseline,o),l,c,f,h;r.aspect!==!1&&(c=i.width/i.height,f=r.width/r.height,c===c&&f===f&&c!==f&&(f<c?(h=s/c,u+=(o-h)/2,o=h):(h=o*c,a+=(s-h)/2,s=h))),(i.complete||i.toDataURL)&&(f0(e,r),e.globalAlpha=(l=r.opacity)!=null?l:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,a,u,s,o))})}var Qze={type:"image",tag:"image",nested:!1,attr:Kze,bound:Zze,draw:Jze,pick:vD(),isect:noe,get:e8,xOffset:wD,yOffset:$D},e8e=Qz("line",mze,Oze);function t8e(e,t){var n=t.scaleX||1,r=t.scaleY||1;(n!==1||r!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",Dze(t)),e("d",t.path)}function ek(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,o=t.scaleY||1,a=(t.angle||0)*Jf,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=Lae(n)).path=n),a&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(a),XM(e,u,0,0,s,o),e.rotate(-a),e.translate(-r,-i)):XM(e,u,r,i,s,o)}function n8e(e,t){return ek(xD(e,t.angle),t)?e.set(0,0,0,0):Ih(e,t,!0)}var r8e={type:"path",tag:"path",nested:!1,attr:t8e,bound:n8e,draw:Yz(ek),pick:Kz(ek),isect:Uae(ek)};function i8e(e,t){e("d",ly(null,t))}function s8e(e,t){var n,r;return Ih(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function rq(e,t){e.beginPath(),ly(e,t)}var o8e={type:"rect",tag:"path",nested:!1,attr:i8e,bound:s8e,draw:Yz(rq),pick:Kz(rq),isect:Wae};function a8e(e,t){e("transform",qae(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function u8e(e,t){var n,r;return Ih(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function Zae(e,t,n){var r,i,s,o;return t.stroke&&h0(e,t,n)?(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),!0):!1}function l8e(e,t,n){Nu(t,r=>{if(!(n&&!n.intersects(r.bounds))){var i=r.opacity==null?1:r.opacity;i&&Zae(e,r,i)&&(f0(e,r),e.stroke())}})}function c8e(e,t,n,r){return e.isPointInStroke?Zae(e,t,1)&&e.isPointInStroke(n,r):!1}var f8e={type:"rule",tag:"line",nested:!1,attr:a8e,bound:u8e,draw:l8e,pick:vD(c8e),isect:Sze},h8e=Jz("shape",yze),d8e=Jz("symbol",bze,jae);const iq=lLe();var tp={height:vc,measureWidth:r8,estimateWidth:bE,width:bE,canvas:Jae};Jae(!0);function Jae(e){tp.width=e&&$f?r8:bE}function bE(e,t){return Qae(Qf(e,t),vc(e))}function Qae(e,t){return~~(.8*e.length*t)}function r8(e,t){return vc(e)<=0||!(t=Qf(e,t))?0:eue(t,i8(e))}function eue(e,t){const n=`(${t}) ${e}`;let r=iq.get(n);return r===void 0&&($f.font=t,r=$f.measureText(e).width,iq.set(n,r)),r}function vc(e){return e.fontSize!=null?+e.fontSize||0:11}function Ap(e){return e.lineHeight!=null?e.lineHeight:vc(e)+2}function p8e(e){return Wu(e)?e.length>1?e:e[0]:e}function f$(e){return p8e(e.lineBreak&&e.text&&!Wu(e.text)?e.text.split(e.lineBreak):e.text)}function tue(e){const t=f$(e);return(Wu(t)?t.length-1:0)*Ap(e)}function Qf(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?m8e(e,n):n}function g8e(e){if(tp.width===r8){const t=i8(e);return n=>eue(n,t)}else if(tp.width===bE){const t=vc(e);return n=>Qae(n,t)}else return t=>tp.width(e,t)}function m8e(e,t){var n=+e.limit,r=g8e(e);if(r(t)<n)return t;var i=e.ellipsis||"…",s=e.dir==="rtl",o=0,a=t.length,u;if(n-=r(i),s){for(;o<a;)u=o+a>>>1,r(t.slice(u))>n?o=u+1:a=u;return i+t.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),r(t.slice(0,u))<n?o=u:a=u-1;return t.slice(0,o)+i}}function CD(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function i8(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+vc(e)+"px "+CD(e,t)}function s8(e){var t=e.baseline,n=vc(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Ap(e):t==="line-bottom"?.29*n-.5*Ap(e):0)}const y8e={left:"start",center:"middle",right:"end"},gx=new Ks;function SD(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;return r&&(i=(e.theta||0)-Cd,t+=r*Math.cos(i),n+=r*Math.sin(i)),gx.x1=t,gx.y1=n,gx}function b8e(e,t){var n=t.dx||0,r=(t.dy||0)+s8(t),i=SD(t),s=i.x1,o=i.y1,a=t.angle||0,u;e("text-anchor",y8e[t.align]||"start"),a?(u=ep(s,o)+" "+Zz(a),(n||r)&&(u+=" "+ep(n,r))):u=ep(s+n,o+r),e("transform",u)}function o8(e,t,n){var r=tp.height(t),i=t.align,s=SD(t),o=s.x1,a=s.y1,u=t.dx||0,l=(t.dy||0)+s8(t)-Math.round(.8*r),c=f$(t),f;if(Wu(c)?(r+=Ap(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,tp.width(t,d)),0)):f=tp.width(t,c),i==="center"?u-=f/2:i==="right"&&(u-=f),e.set(u+=o,l+=a,u+f,l+r),t.angle&&!n)e.rotate(t.angle*Jf,o,a);else if(n===2)return e.rotatedPoints(t.angle*Jf,o,a);return e}function x8e(e,t,n){Nu(t,r=>{var i=r.opacity==null?1:r.opacity,s,o,a,u,l,c,f;if(!(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=i8(r),e.textAlign=r.align||"left",s=SD(r),o=s.x1,a=s.y1,r.angle&&(e.save(),e.translate(o,a),e.rotate(r.angle*Jf),o=a=0),o+=r.dx||0,a+=(r.dy||0)+s8(r),c=f$(r),f0(e,r),Wu(c))for(l=Ap(r),u=0;u<c.length;++u)f=Qf(r,c[u]),r.fill&&yE(e,r,i)&&e.fillText(f,o,a),r.stroke&&h0(e,r,i)&&e.strokeText(f,o,a),a+=l;else f=Qf(r,c),r.fill&&yE(e,r,i)&&e.fillText(f,o,a),r.stroke&&h0(e,r,i)&&e.strokeText(f,o,a);r.angle&&e.restore()}})}function v8e(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=SD(t),a=o.x1,u=o.y1,l=o8(gx,t,1),c=-t.angle*Jf,f=Math.cos(c),h=Math.sin(c),d=f*i-h*s+(a-f*a+h*u),p=h*i+f*s+(u-h*a-f*u);return l.contains(d,p)}function w8e(e,t){const n=o8(gx,e,2);return Vb(t,n[0],n[1],n[2],n[3])||Vb(t,n[0],n[1],n[4],n[5])||Vb(t,n[4],n[5],n[6],n[7])||Vb(t,n[2],n[3],n[6],n[7])}var $8e={type:"text",tag:"text",nested:!1,attr:b8e,bound:o8,draw:x8e,pick:vD(v8e),isect:w8e},C8e=Qz("trail",xze,Rze),_p={arc:Nze,area:Mze,group:Yze,image:Qze,line:e8e,path:r8e,rect:o8e,rule:f8e,shape:h8e,symbol:d8e,text:$8e,trail:C8e};function Bd(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function nue(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function pr(e,t,n,r){var i=e.childNodes[t],s;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(s=i||null,i=Bd(e.ownerDocument,n,r),e.insertBefore(i,s)),i}function ia(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function rue(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function iue(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function S8e(e,t,n,r){var i=e&&e.mark,s,o;if(i&&(s=_p[i.marktype]).tip){for(o=iue(t,n),o[0]-=r[0],o[1]-=r[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=s.tip(i.items,o)}return e}function Tp(e,t){this._active=null,this._handlers={},this._loader=e||Loe(),this._tooltip=t||k8e}function k8e(e,t,n,r){e.element().setAttribute("title",r||"")}Tp.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=Bd(null,"a");for(const o in r)s.setAttribute(o,r[o]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=S8e(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),o=i.height();let a=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function Lo(e){this._el=null,this._bgcolor=null,this._loader=new zae(e)}Lo.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e,t){const n=this;return n._call=function(){n._render(e,t)},n._call(),n._call=null,n},_render(){},renderAsync(e,t){const n=this.render(e,t);return this._ready?this._ready.then(()=>n):Promise.resolve(n)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const E8e="keydown",A8e="keypress",_8e="keyup",sue="dragenter",tk="dragleave",oue="dragover",e4="pointerdown",T8e="pointerup",xE="pointermove",mx="pointerout",aue="pointerover",t4="mousedown",I8e="mouseup",uue="mousemove",n4="mouseout",lue="mouseover",vE="click",D8e="dblclick",N8e="wheel",cue="mousewheel",wE="touchstart",$E="touchmove",CE="touchend",F8e=[E8e,A8e,_8e,sue,tk,oue,e4,T8e,xE,mx,aue,t4,I8e,uue,n4,lue,vE,D8e,N8e,cue,wE,$E,CE],r4=xE,Lv=mx,i4=vE;function SE(e,t){Tp.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const O8e=e=>e===wE||e===$E||e===CE?[wE,$E,CE]:[e];function sq(e,t){O8e(t).forEach(n=>R8e(e,n))}function R8e(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?r=>e[t](r):r=>e.fire(t,r)))}function Gb(e,t,n){t.forEach(r=>e.fire(r,n))}function oq(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?Gb(this,e,r):((!i||!i.exit)&&Gb(this,n,r),this._active=s,Gb(this,t,r),Gb(this,e,r))}}function aq(e){return function(t){Gb(this,e,t),this._active=null}}Ns(SE,Tp,{initialize(e,t,n){return this._canvas=e&&nue(e,"canvas"),[vE,t4,e4,xE,mx,tk].forEach(r=>sq(this,r)),Tp.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:F8e,DOMMouseScroll(e){this.fire(cue,e)},pointermove:oq([xE,uue],[aue,lue],[mx,n4]),dragover:oq([oue],[sue],[tk]),pointerout:aq([mx,n4]),dragleave:aq([tk]),pointerdown(e){this._down=this._active,this.fire(e4,e)},mousedown(e){this._down=this._active,this.fire(t4,e)},click(e){this._down===this._active&&(this.fire(vE,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(wE,e,!0)},touchmove(e){this.fire($E,e,!0)},touchend(e){this.fire(CE,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===i4&&r&&r.href?this.handleHref(t,r,r.href):(e===r4||e===Lv)&&this.handleTooltip(t,r,e!==Lv),i)for(let s=0,o=i.length;s<o;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(sq(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=iue(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return _p[e.marktype].pick.call(this,s,e,t,n,r,i)}});function M8e(){return typeof window<"u"&&window.devicePixelRatio||1}function L8e(e,t,n,r,i,s){const o=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=o?M8e():i;e.width=t*u,e.height=n*u;for(const l in s)a[l]=s[l];return o&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*r[0],u*r[1]),e}function fue(e){Lo.call(this,e),this._options={},this._redraw=!1,this._dirty=new Ks,this._tempb=new Ks}const uq=Lo.prototype,P8e=(e,t,n)=>new Ks().set(0,0,t,n).translate(-e[0],-e[1]);function B8e(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}Ns(fue,Lo,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:xc(1,1,this._options.type),e&&this._canvas&&(ia(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),uq.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(uq.resize.call(this,e,t,n,r),this._canvas)L8e(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||Xl("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e,t){const n=this.context(),r=this._origin,i=this._width,s=this._height,o=this._dirty,a=P8e(r,i,s);n.save();const u=this._redraw||o.empty()?(this._redraw=!1,a.expand(1)):B8e(n,a.intersect(o),r);return this.clear(-r[0],-r[1],i,s),this.draw(n,e,u,t),n.restore(),o.clear(),this},draw(e,t,n,r){if(t.marktype!=="group"&&r!=null&&!r.includes(t.marktype))return;const i=_p[t.marktype];t.clip&&Lze(e,t),i.draw.call(this,e,t,n,r),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type!=="pdf"&&!i.externalContext&&s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});function z8e(e,t){Tp.call(this,e,t);const n=this;n._hrefHandler=s4(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=s4(n,(r,i)=>{n.handleTooltip(r,i,r.type!==Lv)})}const s4=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Ns(z8e,Tp,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(i4,this._hrefHandler),r.removeEventListener(r4,this._tooltipHandler),r.removeEventListener(Lv,this._tooltipHandler)),this._svg=r=e&&nue(e,"svg"),r&&(r.addEventListener(i4,this._hrefHandler),r.addEventListener(r4,this._tooltipHandler),r.addEventListener(Lv,this._tooltipHandler)),Tp.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const s={type:e,handler:t,listener:s4(this,t)};(r[n]||(r[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const hue="aria-hidden",a8="aria-label",u8="role",l8="aria-roledescription",due="graphics-object",c8="graphics-symbol",pue=(e,t,n)=>({[u8]:e,[l8]:t,[a8]:n||void 0}),U8e=ioe(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),lq={axis:{desc:"axis",caption:V8e},legend:{desc:"legend",caption:G8e},"title-text":{desc:"title",caption:e=>`Title text '${fq(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${fq(e)}'`}},cq={ariaRole:u8,ariaRoleDescription:l8,description:a8};function gue(e,t){const n=t.aria===!1;if(e(hue,n||void 0),n||t.description==null)for(const r in cq)e(cq[r],void 0);else{const r=t.mark.marktype;e(a8,t.description),e(u8,t.ariaRole||(r==="group"?due:c8)),e(l8,t.ariaRoleDescription||`${r} mark`)}}function mue(e){return e.aria===!1?{[hue]:!0}:U8e[e.role]?null:lq[e.role]?W8e(e,lq[e.role]):j8e(e)}function j8e(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(r=>r.description!=null&&r.aria!==!1);return pue(n?due:c8,`${t} mark container`,e.description)}function W8e(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return pue(t.role||c8,t.desc,n.description||r(n))}catch{return null}}function fq(e){return lz(e.text).join(" ")}function V8e(e){const t=e.datum,n=e.orient,r=t.title?yue(e):null,i=e.context,s=i.scales[t.scale].value,o=i.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${_ae(a)?"discrete":a} scale with ${Oae(o,s,e)}`}function G8e(e){const t=e.datum,n=t.title?yue(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),o=e.context,a=o.scales[i[s[0]]].value,u=o.dataflow.locale();return q8e(r)+(n?` titled '${n}'`:"")+` for ${H8e(s)} with ${Oae(u,a,e)}`}function yue(e){try{return lz(du(e.items).items[0].text).join(" ")}catch{return null}}function H8e(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+du(e)}function q8e(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const bue=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),X8e=e=>bue(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function xue(){let e="",t="",n="";const r=[],i=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,i()),r.push(u)},o=(u,l)=>(l!=null&&(t+=` ${u}="${X8e(l)}"`),a),a={open(u){s(u),t="<"+u;for(var l=arguments.length,c=new Array(l>1?l-1:0),f=1;f<l;f++)c[f-1]=arguments[f];for(const h of c)for(const d in h)o(d,h[d]);return a},close(){const u=r.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,i(),a},attr:o,text:u=>(n+=bue(u),a),toString:()=>e};return a}const Y8e=e=>vue(xue(),e)+"";function vue(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let i=0;i<r;++i)e.attr(n[i].name,n[i].value)}if(t.hasChildNodes()){const n=t.childNodes;for(const r of n)r.nodeType===3?e.text(r.nodeValue):vue(e,r)}return e.close()}const kE={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},EE={blend:"mix-blend-mode"},wue={fill:"none","stroke-miterlimit":10},lb=0,hq="http://www.w3.org/2000/xmlns/",Zn=Mv.xmlns;function $ue(e){Lo.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Q3=Lo.prototype;Ns($ue,Lo,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=pr(e,0,"svg",Zn),this._svg.setAttributeNS(hq,"xmlns",Zn),this._svg.setAttributeNS(hq,"xmlns:xlink",Mv["xmlns:xlink"]),this._svg.setAttribute("version",Mv.version),this._svg.setAttribute("class","marks"),ia(e,1),this._root=pr(this._svg,lb,"g",Zn),ef(this._root,wue),ia(this._svg,lb+1)),this.background(this._bgcolor),Q3.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Q3.background.apply(this,arguments)},resize(e,t,n,r){return Q3.resize.call(this,e,t,n,r),this._svg&&(ef(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=pr(e,lb,"rect",Zn),ef(n,{width:this._width,height:this._height,fill:t}));const r=Y8e(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e,t){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e,void 0,t),ia(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,o,a,u;for(o=0,a=e.length;o<a;++o)if(n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,s=_p[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,dq(n,t),r.items.forEach(l=>{l.dirty=t})),!r.zdirty){if(n.exit){s.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?r.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,dq(n,t)):this._update(s,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n,r){if(!this.isDirty(t))return t._svg;const i=this._svg,s=t.marktype,o=_p[s],a=t.interactive===!1?"none":null,u=o.tag==="g",l=pq(t,e,n,"g",i);if(s!=="group"&&r!=null&&!r.includes(s))return ia(l,0),t._svg;l.setAttribute("class",rue(t));const c=mue(t);for(const p in c)Ai(l,p,c[p]);u||Ai(l,"pointer-events",a),Ai(l,"clip-path",t.clip?qz(this,t,t.group):null);let f=null,h=0;const d=p=>{const g=this.isDirty(p),m=pq(p,l,f,o.tag,i);g&&(this._update(o,m,p),u&&J8e(this,m,p,r)),f=m,++h};return o.nested?t.items.length&&d(t.items[0]):Nu(t,d),ia(l,h),l},_update(e,t,n){zl=t,Qr=t.__values__,gue(yx,n),e.attr(yx,n,this);const r=e7e[e.type];r&&r.call(this,e,t,n),zl&&this.style(zl,n)},style(e,t){if(t!=null){for(const n in kE){let r=n==="font"?CD(t):t[n];if(r===Qr[n])continue;const i=kE[n];r==null?e.removeAttribute(i):(Gz(r)&&(r=Rae(r,this._defs.gradient,Cue())),e.setAttribute(i,r+"")),Qr[n]=r}for(const n in EE)nk(e,EE[n],t[n])}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=pr(e,lb+1,"defs",Zn)),r=K8e(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=pr(e,lb+1,"defs",Zn)),r=Z8e(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):ia(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function dq(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function K8e(e,t,n){let r,i,s;if(t.gradient==="radial"){let o=pr(e,n++,"pattern",Zn);ef(o,{id:mE+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=pr(o,0,"rect",Zn),ef(o,{width:1,height:1,fill:`url(${Cue()}#${t.id})`}),e=pr(e,n++,"radialGradient",Zn),ef(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=pr(e,n++,"linearGradient",Zn),ef(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)s=pr(e,r,"stop",Zn),s.setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return ia(e,r),n}function Z8e(e,t,n){let r;return e=pr(e,n,"clipPath",Zn),e.setAttribute("id",t.id),t.path?(r=pr(e,0,"path",Zn),r.setAttribute("d",t.path)):(r=pr(e,0,"rect",Zn),ef(r,{x:0,y:0,width:t.width,height:t.height})),ia(e,1),n+1}function J8e(e,t,n,r){t=t.lastChild.previousSibling;let i,s=0;Nu(n,o=>{i=e.mark(t,o,i,r),++s}),ia(t,1+s)}function pq(e,t,n,r,i){let s=e._svg,o;if(!s&&(o=t.ownerDocument,s=Bd(o,r,Zn),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},r==="g"))){const a=Bd(o,"path",Zn);s.appendChild(a),a.__data__=e;const u=Bd(o,"g",Zn);s.appendChild(u),u.__data__=e;const l=Bd(o,"path",Zn);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==i||Q8e(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function Q8e(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let zl=null,Qr=null;const e7e={group(e,t,n){const r=zl=t.childNodes[2];Qr=r.__values__,e.foreground(yx,n,this),Qr=t.__values__,zl=t.childNodes[1],e.content(yx,n,this);const i=zl=t.childNodes[0];e.background(yx,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==Qr.events&&(Ai(r,"pointer-events",s),Ai(i,"pointer-events",s),Qr.events=s),n.strokeForeground&&n.stroke){const o=n.fill;Ai(r,"display",null),this.style(i,n),Ai(i,"stroke",null),o&&(n.fill=null),Qr=r.__values__,this.style(r,n),o&&(n.fill=o),zl=null}else Ai(r,"display","none")},image(e,t,n){n.smooth===!1?(nk(t,"image-rendering","optimizeSpeed"),nk(t,"image-rendering","pixelated")):nk(t,"image-rendering",null)},text(e,t,n){const r=f$(n);let i,s,o,a;Wu(r)?(s=r.map(u=>Qf(n,u)),i=s.join(`
`),i!==Qr.text&&(ia(t,0),o=t.ownerDocument,a=Ap(n),s.forEach((u,l)=>{const c=Bd(o,"tspan",Zn);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),Qr.text=i)):(s=Qf(n,r),s!==Qr.text&&(t.textContent=s,Qr.text=s)),Ai(t,"font-family",CD(n)),Ai(t,"font-size",vc(n)+"px"),Ai(t,"font-style",n.fontStyle),Ai(t,"font-variant",n.fontVariant),Ai(t,"font-weight",n.fontWeight)}};function yx(e,t,n){t!==Qr[e]&&(n?t7e(zl,e,t,n):Ai(zl,e,t),Qr[e]=t)}function nk(e,t,n){n!==Qr[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Qr[t]=n)}function ef(e,t){for(const n in t)Ai(e,n,t[n])}function Ai(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function t7e(e,t,n,r){n!=null?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}function Cue(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function n7e(e){Lo.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Ns(n7e,Lo,{svg(){return this._text},_render(e){const t=xue();t.open("svg",JI({},Mv,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",wue,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=_p[t.marktype],r=n.tag,i=[gue,n.attr];e.open("g",{class:rue(t),"clip-path":t.clip?qz(this,t,t.group):null},mue(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&e.open("a",a),e.open(r,this.attr(t,o,i,r!=="g"?r:null)),r==="text"){const u=f$(o);if(Wu(u)){const l={x:0,dy:Ap(o)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(Qf(o,u[c])).close()}else e.text(Qf(o,u))}else if(r==="g"){const u=o.strokeForeground,l=o.fill,c=o.stroke;u&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),Nu(o,f=>this.mark(e,f)),e.close(),u&&c?(l&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),l&&(o.fill=l)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Nu(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(o,a,u,l)=>{i[l||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,t,this)):n(s,t,this),r&&r7e(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const i in t){const s=t[i],o=s.stops;s.gradient==="radial"?(e.open("pattern",{id:mE+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):e.open("linearGradient",{id:i,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)e.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();e.close()}for(const i in n){const s=n[i];e.open("clipPath",{id:i}),s.path?e.open("path",{d:s.path}).close():e.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),e.close()}e.close()}}});function r7e(e,t,n,r,i){let s;if(t==null||(r==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;r==="image"&&t.smooth===!1&&(s=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),r==="text"&&(e["font-family"]=CD(t),e["font-size"]=vc(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const o in kE){let a=t[o];const u=kE[o];a==="transparent"&&(u==="fill"||u==="stroke")||a!=null&&(Gz(a)&&(a=Rae(a,i.gradient,"")),e[u]=a)}for(const o in EE){const a=t[o];a!=null&&(s=s||[],s.push(`${EE[o]}: ${a};`))}return s&&(e.style=s.join(" ")),e}const eO={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function i7e(e){Lo.call(this,e),this._svgRenderer=new $ue(e),this._canvasRenderer=new fue(e)}const gq=Lo.prototype;Ns(i7e,Lo,{initialize(e,t,n,r,i){this._root_el=pr(e,0,"div");const s=pr(this._root_el,0,"div"),o=pr(this._root_el,1,"div");return this._root_el.style.position="relative",s.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.height="100%",o.style.width="100%",this._svgEl=o,this._canvasEl=s,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,t,n,r,i),this._svgRenderer.initialize(this._svgEl,t,n,r,i),gq.initialize.call(this,e,t,n,r,i)},dirty(e){return eO.svgMarkTypes.includes(e.mark.marktype)?this._svgRenderer.dirty(e):this._canvasRenderer.dirty(e),this},_render(e,t){const r=(t??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(i=>!eO.svgMarkTypes.includes(i));this._svgRenderer.render(e,eO.svgMarkTypes),this._canvasRenderer.render(e,r)},resize(e,t,n,r){return gq.resize.call(this,e,t,n,r),this._svgRenderer.resize(e,t,n,r),this._canvasRenderer.resize(e,t,n,r),this},background(e){return this._canvasRenderer.background(e),this}});function s7e(e,t){SE.call(this,e,t)}Ns(s7e,SE,{initialize(e,t,n){const r=pr(pr(e,0,"div"),0,"div");return SE.prototype.initialize.call(this,r,t,n)}});const tO=new Ks;function o7e(e){const t=e.clip;if(ZI(t))t(xD(tO.clear()));else if(t)tO.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(tO)}const d0="top",la="left",fa="right",eh="bottom",a7e="top-left",u7e="top-right",l7e="bottom-left",c7e="bottom-right",f8="start",o4="middle",Ti="end",f7e="x",h7e="y",kD="group",h8="axis",d8="title",d7e="frame",p7e="scope",p8="legend",Sue="row-header",kue="row-footer",Eue="row-title",Aue="column-header",_ue="column-footer",Tue="column-title",g7e="padding",m7e="symbol",Iue="fit",Due="fit-x",Nue="fit-y",y7e="pad",g8="none",GC="all",a4="each",m8="flush",tf="column",nf="row";function Fue(e){ee.call(this,null,e)}Ns(Fue,ee,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,s=_p[i],o=s.bound;let a=r.bounds,u;if(s.nested)r.items.length&&n.dirty(r.items[0]),a=HC(r,o),r.items.forEach(l=>{l.bounds.clear().union(a)});else if(i===kD||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),a.clear(),r.items.forEach(l=>a.union(HC(l,o))),r.role){case h8:case p8:case d8:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{a.union(HC(l,o))}),t.visit(t.MOD,l=>{u=u||a.alignsWith(l.bounds),n.dirty(l),a.union(HC(l,o))}),u&&(a.clear(),r.items.forEach(l=>a.union(l.bounds)));return o7e(r),t.modifies("bounds")}});function HC(e,t,n){return t(e.bounds.clear(),e,n)}const mq=":vega_identifier:";function y8(e){ee.call(this,0,e)}y8.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};Ns(y8,ee,{transform(e,t){const n=b7e(t.dataflow),r=e.as;let i=n.value;return t.visit(t.ADD,s=>s[r]=s[r]||++i),n.set(this.value=i),t}});function b7e(e){return e._signals[mq]||(e._signals[mq]=e.add(0))}function Oue(e){ee.call(this,null,e)}Ns(Oue,ee,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,x7e(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===kD?Bae:Xz;return t.visit(t.ADD,i=>r.call(i,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function x7e(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function Rue(e){ee.call(this,null,e)}const yq={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((r,i)=>!i||!Mue(n.bounds,r.bounds,t)?(n=r,1):r.opacity=0)}},Mue=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),bq=(e,t)=>{for(var n=1,r=e.length,i=e[0].bounds,s;n<r;i=s,++n)if(Mue(i,s=e[n].bounds,t))return!0},v7e=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},w7e=(e,t,n)=>{var r=e.range(),i=new Ks;return t===d0||t===eh?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),s=>i.encloses(s.bounds)},xq=e=>(e.forEach(t=>t.opacity=1),e),vq=(e,t)=>e.reflow(t.modified()).modifies("opacity");Ns(Rue,ee,{transform(e,t){const n=yq[e.method]||yq.parity,r=e.separation||0;let i=t.materialize(t.SOURCE).source,s,o;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(xq(i),t=vq(t,e)),t;if(i=i.filter(v7e),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),s=xq(i),t=vq(t,e),s.length>=3&&bq(s,r)){do s=n(s,r);while(s.length>=3&&bq(s,r));s.length<3&&!du(i).opacity&&(s.length>1&&(du(s).opacity=0),du(i).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(o=w7e(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(u=>{o(u)||(u.opacity=0)}));const a=s[0].mark.bounds.clear();return i.forEach(u=>{u.opacity&&a.union(u.bounds)}),t}});function Lue(e){ee.call(this,null,e)}Ns(Lue,ee,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const Zr=new Ks;function $m(e,t,n){return e[t]===n?0:(e[t]=n,1)}function $7e(e){var t=e.items[0].orient;return t===la||t===fa}function C7e(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function S7e(e,t,n,r){var i=t.items[0],s=i.datum,o=i.translate!=null?i.translate:.5,a=i.orient,u=C7e(s),l=i.range,c=i.offset,f=i.position,h=i.minExtent,d=i.maxExtent,p=s.title&&i.items[u[2]].items[0],g=i.titlePadding,m=i.bounds,y=p&&tue(p),b=0,v=0,x,w;switch(Zr.clear().union(m),m.clear(),(x=u[0])>-1&&m.union(i.items[x].bounds),(x=u[1])>-1&&m.union(i.items[x].bounds),a){case d0:b=f||0,v=-c,w=Math.max(h,Math.min(d,-m.y1)),m.add(0,-w).add(l,0),p&&qC(e,p,w,g,y,0,-1,m);break;case la:b=-c,v=f||0,w=Math.max(h,Math.min(d,-m.x1)),m.add(-w,0).add(0,l),p&&qC(e,p,w,g,y,1,-1,m);break;case fa:b=n+c,v=f||0,w=Math.max(h,Math.min(d,m.x2)),m.add(0,0).add(w,l),p&&qC(e,p,w,g,y,1,1,m);break;case eh:b=f||0,v=r+c,w=Math.max(h,Math.min(d,m.y2)),m.add(0,0).add(l,w),p&&qC(e,p,w,g,0,0,1,m);break;default:b=i.x,v=i.y}return Ih(m.translate(b,v),i),$m(i,"x",b+o)|$m(i,"y",v+o)&&(i.bounds=Zr,e.dirty(i),i.bounds=m,e.dirty(i)),i.mark.bounds.clear().union(m)}function qC(e,t,n,r,i,s,o,a){const u=t.bounds;if(t.auto){const l=o*(n+i+r);let c=0,f=0;e.dirty(t),s?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}a.union(u)}const wq=(e,t)=>Math.floor(Math.min(e,t)),$q=(e,t)=>Math.ceil(Math.max(e,t));function k7e(e){var t=e.items,n=t.length,r=0,i,s;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<n;++r)if(i=t[r],s=i.items,i.marktype===kD)switch(i.role){case h8:case p8:case d8:break;case Sue:o.rowheaders.push(...s);break;case kue:o.rowfooters.push(...s);break;case Aue:o.colheaders.push(...s);break;case _ue:o.colfooters.push(...s);break;case Eue:o.rowtitle=s[0];break;case Tue:o.coltitle=s[0];break;default:o.marks.push(...s)}return o}function E7e(e){return new Ks().set(0,0,e.width||0,e.height||0)}function A7e(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function dn(e,t,n){const r=uz(e)?e[t]:e;return r??(n!==void 0?n:0)}function Cq(e){return e<0?Math.ceil(-e):0}function Pue(e,t,n){var r=!n.nodirty,i=n.bounds===m8?E7e:A7e,s=Zr.set(0,0,0,0),o=dn(n.align,tf),a=dn(n.align,nf),u=dn(n.padding,tf),l=dn(n.padding,nf),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),h=t.length,d=Array(h),p=Array(c),g=0,m=Array(h),y=Array(f),b=0,v=Array(h),x=Array(h),w=Array(h),C,$,S,k,E,A,F,_,I,T,O;for($=0;$<c;++$)p[$]=0;for($=0;$<f;++$)y[$]=0;for($=0;$<h;++$)A=t[$],E=w[$]=i(A),A.x=A.x||0,v[$]=0,A.y=A.y||0,x[$]=0,S=$%c,k=~~($/c),g=Math.max(g,F=Math.ceil(E.x2)),b=Math.max(b,_=Math.ceil(E.y2)),p[S]=Math.max(p[S],F),y[k]=Math.max(y[k],_),d[$]=u+Cq(E.x1),m[$]=l+Cq(E.y1),r&&e.dirty(t[$]);for($=0;$<h;++$)$%c===0&&(d[$]=0),$<c&&(m[$]=0);if(o===a4)for(S=1;S<c;++S){for(O=0,$=S;$<h;$+=c)O<d[$]&&(O=d[$]);for($=S;$<h;$+=c)d[$]=O+p[S-1]}else if(o===GC){for(O=0,$=0;$<h;++$)$%c&&O<d[$]&&(O=d[$]);for($=0;$<h;++$)$%c&&(d[$]=O+g)}else for(o=!1,S=1;S<c;++S)for($=S;$<h;$+=c)d[$]+=p[S-1];if(a===a4)for(k=1;k<f;++k){for(O=0,$=k*c,C=$+c;$<C;++$)O<m[$]&&(O=m[$]);for($=k*c;$<C;++$)m[$]=O+y[k-1]}else if(a===GC){for(O=0,$=c;$<h;++$)O<m[$]&&(O=m[$]);for($=c;$<h;++$)m[$]=O+b}else for(a=!1,k=1;k<f;++k)for($=k*c,C=$+c;$<C;++$)m[$]+=y[k-1];for(I=0,$=0;$<h;++$)I=d[$]+($%c?I:0),v[$]+=I-t[$].x;for(S=0;S<c;++S)for(T=0,$=S;$<h;$+=c)T+=m[$],x[$]+=T-t[$].y;if(o&&dn(n.center,tf)&&f>1)for($=0;$<h;++$)E=o===GC?g:p[$%c],I=E-w[$].x2-t[$].x-v[$],I>0&&(v[$]+=I/2);if(a&&dn(n.center,nf)&&c!==1)for($=0;$<h;++$)E=a===GC?b:y[~~($/c)],T=E-w[$].y2-t[$].y-x[$],T>0&&(x[$]+=T/2);for($=0;$<h;++$)s.union(w[$].translate(v[$],x[$]));switch(I=dn(n.anchor,f7e),T=dn(n.anchor,h7e),dn(n.anchor,tf)){case Ti:I-=s.width();break;case o4:I-=s.width()/2}switch(dn(n.anchor,nf)){case Ti:T-=s.height();break;case o4:T-=s.height()/2}for(I=Math.round(I),T=Math.round(T),s.clear(),$=0;$<h;++$)t[$].mark.bounds.clear();for($=0;$<h;++$)A=t[$],A.x+=v[$]+=I,A.y+=x[$]+=T,s.union(A.mark.bounds.union(A.bounds.translate(v[$],x[$]))),r&&e.dirty(A);return s}function _7e(e,t,n){var r=k7e(t),i=r.marks,s=n.bounds===m8?T7e:I7e,o=n.offset,a=n.columns||i.length,u=a<=0?1:Math.ceil(i.length/a),l=u*a,c,f,h,d,p,g,m;const y=Pue(e,i,n);y.empty()&&y.set(0,0,0,0),r.rowheaders&&(g=dn(n.headerBand,nf,null),c=XC(e,r.rowheaders,i,a,u,-dn(o,"rowHeader"),wq,0,s,"x1",0,a,1,g)),r.colheaders&&(g=dn(n.headerBand,tf,null),f=XC(e,r.colheaders,i,a,a,-dn(o,"columnHeader"),wq,1,s,"y1",0,1,a,g)),r.rowfooters&&(g=dn(n.footerBand,nf,null),h=XC(e,r.rowfooters,i,a,u,dn(o,"rowFooter"),$q,0,s,"x2",a-1,a,1,g)),r.colfooters&&(g=dn(n.footerBand,tf,null),d=XC(e,r.colfooters,i,a,a,dn(o,"columnFooter"),$q,1,s,"y2",l-a,1,a,g)),r.rowtitle&&(p=dn(n.titleAnchor,nf),m=dn(o,"rowTitle"),m=p===Ti?h+m:c-m,g=dn(n.titleBand,nf,.5),Sq(e,r.rowtitle,m,0,y,g)),r.coltitle&&(p=dn(n.titleAnchor,tf),m=dn(o,"columnTitle"),m=p===Ti?d+m:f-m,g=dn(n.titleBand,tf,.5),Sq(e,r.coltitle,m,1,y,g))}function T7e(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function I7e(e,t){return e.bounds[t]}function XC(e,t,n,r,i,s,o,a,u,l,c,f,h,d){var p=n.length,g=0,m=0,y,b,v,x,w,C,$,S,k;if(!p)return g;for(y=c;y<p;y+=f)n[y]&&(g=o(g,u(n[y],l)));if(!t.length)return g;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),g+=s,b=0,x=t.length;b<x;++b)e.dirty(t[b]),t[b].mark.bounds.clear();for(y=c,b=0,x=t.length;b<x;++b,y+=f){for(C=t[b],w=C.mark.bounds,v=y;v>=0&&($=n[v])==null;v-=h);a?(S=d==null?$.x:Math.round($.bounds.x1+d*$.bounds.width()),k=g):(S=g,k=d==null?$.y:Math.round($.bounds.y1+d*$.bounds.height())),w.union(C.bounds.translate(S-(C.x||0),k-(C.y||0))),C.x=S,C.y=k,e.dirty(C),m=o(m,w[l])}return m}function Sq(e,t,n,r,i,s){if(t){e.dirty(t);var o=n,a=n;r?o=Math.round(i.x1+s*i.width()):a=Math.round(i.y1+s*i.height()),t.bounds.translate(o-(t.x||0),a-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=a,e.dirty(t)}}function D7e(e,t){const n=e[t]||{};return(r,i)=>n[r]!=null?n[r]:e[r]!=null?e[r]:i}function N7e(e,t){let n=-1/0;return e.forEach(r=>{r.offset!=null&&(n=Math.max(n,r.offset))}),n>-1/0?n:t}function F7e(e,t,n,r,i,s,o){const a=D7e(n,t),u=N7e(e,a("offset",0)),l=a("anchor",f8),c=l===Ti?1:l===o4?.5:0,f={align:a4,bounds:a("bounds",m8),columns:a("direction")==="vertical"?1:e.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(t){case la:f.anchor={x:Math.floor(r.x1)-u,column:Ti,y:c*(o||r.height()+2*r.y1),row:l};break;case fa:f.anchor={x:Math.ceil(r.x2)+u,y:c*(o||r.height()+2*r.y1),row:l};break;case d0:f.anchor={y:Math.floor(i.y1)-u,row:Ti,x:c*(s||i.width()+2*i.x1),column:l};break;case eh:f.anchor={y:Math.ceil(i.y2)+u,x:c*(s||i.width()+2*i.x1),column:l};break;case a7e:f.anchor={x:u,y:u};break;case u7e:f.anchor={x:s-u,y:u,column:Ti};break;case l7e:f.anchor={x:u,y:o-u,row:Ti};break;case c7e:f.anchor={x:s-u,y:o-u,column:Ti,row:Ti};break}return f}function O7e(e,t){var n=t.items[0],r=n.datum,i=n.orient,s=n.bounds,o=n.x,a=n.y,u,l;return n._bounds?n._bounds.clear().union(s):n._bounds=s.clone(),s.clear(),M7e(e,n,n.items[0].items[0]),s=R7e(n,s),u=2*n.padding,l=2*n.padding,s.empty()||(u=Math.ceil(s.width()+u),l=Math.ceil(s.height()+l)),r.type===m7e&&L7e(n.items[0].items[0].items[0].items),i!==g8&&(n.x=o=0,n.y=a=0),n.width=u,n.height=l,Ih(s.set(o,a,o+u,a+l),n),n.mark.bounds.clear().union(s),n}function R7e(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function M7e(e,t,n){var r=t.padding,i=r-n.x,s=r-n.y;if(!t.datum.title)(i||s)&&cb(e,n,i,s);else{var o=t.items[1].items[0],a=o.anchor,u=t.titlePadding||0,l=r-o.x,c=r-o.y;switch(o.orient){case la:i+=Math.ceil(o.bounds.width())+u;break;case fa:case eh:break;default:s+=o.bounds.height()+u}switch((i||s)&&cb(e,n,i,s),o.orient){case la:c+=rm(t,n,o,a,1,1);break;case fa:l+=rm(t,n,o,Ti,0,0)+u,c+=rm(t,n,o,a,1,1);break;case eh:l+=rm(t,n,o,a,0,0),c+=rm(t,n,o,Ti,-1,0,1)+u;break;default:l+=rm(t,n,o,a,0,0)}(l||c)&&cb(e,o,l,c),(l=Math.round(o.bounds.x1-r))<0&&(cb(e,n,-l,0),cb(e,o,-l,0))}}function rm(e,t,n,r,i,s,o){const a=e.datum.type!=="symbol",u=n.datum.vgrad,l=a&&(s||!u)&&!o?t.items[0]:t,c=l.bounds[i?"y2":"x2"]-e.padding,f=u&&s?c:0,h=u&&s?0:c,d=i<=0?0:tue(n);return Math.round(r===f8?f:r===Ti?h-d:.5*(c-d))}function cb(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function L7e(e){const t=e.reduce((n,r)=>(n[r.column]=Math.max(r.bounds.x2-r.x,n[r.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function P7e(e,t,n,r,i){var s=t.items[0],o=s.frame,a=s.orient,u=s.anchor,l=s.offset,c=s.padding,f=s.items[0].items[0],h=s.items[1]&&s.items[1].items[0],d=a===la||a===fa?r:n,p=0,g=0,m=0,y=0,b=0,v;if(o!==kD?a===la?(p=i.y2,d=i.y1):a===fa?(p=i.y1,d=i.y2):(p=i.x1,d=i.x2):a===la&&(p=r,d=0),v=u===f8?p:u===Ti?d:(p+d)/2,h&&h.text){switch(a){case d0:case eh:b=f.bounds.height()+c;break;case la:y=f.bounds.width()+c;break;case fa:y=-f.bounds.width()-c;break}Zr.clear().union(h.bounds),Zr.translate(y-(h.x||0),b-(h.y||0)),$m(h,"x",y)|$m(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(Zr),h.mark.bounds.clear().union(Zr),e.dirty(h)),Zr.clear().union(h.bounds)}else Zr.clear();switch(Zr.union(f.bounds),a){case d0:g=v,m=i.y1-Zr.height()-l;break;case la:g=i.x1-Zr.width()-l,m=v;break;case fa:g=i.x2+Zr.width()+l,m=v;break;case eh:g=v,m=i.y2+l;break;default:g=s.x,m=s.y}return $m(s,"x",g)|$m(s,"y",m)&&(Zr.translate(g,m),e.dirty(s),s.bounds.clear().union(Zr),t.bounds.clear().union(Zr),e.dirty(s)),s.bounds}function Bue(e){ee.call(this,null,e)}Ns(Bue,ee,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(r=>{e.layout&&_7e(n,r,e.layout),z7e(n,r,e)}),B7e(e.mark.group)?t.reflow():t}});function B7e(e){return e&&e.mark.role!=="legend-entry"}function z7e(e,t,n){var r=t.items,i=Math.max(0,t.width||0),s=Math.max(0,t.height||0),o=new Ks().set(0,0,i,s),a=o.clone(),u=o.clone(),l=[],c,f,h,d,p,g;for(p=0,g=r.length;p<g;++p)switch(f=r[p],f.role){case h8:d=$7e(f)?a:u,d.union(S7e(e,f,i,s));break;case d8:c=f;break;case p8:l.push(O7e(e,f));break;case d7e:case p7e:case Sue:case kue:case Eue:case Aue:case _ue:case Tue:a.union(f.bounds),u.union(f.bounds);break;default:o.union(f.bounds)}if(l.length){const m={};l.forEach(y=>{h=y.orient||fa,h!==g8&&(m[h]||(m[h]=[])).push(y)});for(const y in m){const b=m[y];Pue(e,b,F7e(b,y,n.legends,a,u,i,s))}l.forEach(y=>{const b=y.bounds;if(b.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=b,e.dirty(y)),n.autosize&&(n.autosize.type===Iue||n.autosize.type===Due||n.autosize.type===Nue))switch(y.orient){case la:case fa:o.add(b.x1,0).add(b.x2,0);break;case d0:case eh:o.add(0,b.y1).add(0,b.y2)}else o.union(b)})}o.union(a).union(u),c&&o.union(P7e(e,c,i,s,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),U7e(e,t,o,n)}function U7e(e,t,n,r){const i=r.autosize||{},s=i.type;if(e._autosize<1||!s)return;let o=e._width,a=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),d=Math.max(0,Math.ceil(n.y2-c));if(i.contains===g7e){const p=e.padding();o-=p.left+p.right,a-=p.top+p.bottom}s===g8?(l=0,f=0,u=o,c=a):s===Iue?(u=Math.max(0,o-l-h),c=Math.max(0,a-f-d)):s===Due?(u=Math.max(0,o-l-h),a=c+f+d):s===Nue?(o=u+l+h,c=Math.max(0,a-f-d)):s===y7e&&(o=u+l+h,a=c+f+d),e._resizeView(o,a,u,c,[l,f],i.resize)}const j7e=Object.freeze(Object.defineProperty({__proto__:null,bound:Fue,identifier:y8,mark:Oue,overlap:Rue,render:Lue,viewlayout:Bue},Symbol.toStringTag,{value:"Module"}));function Gu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Dh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const u4=Symbol("implicit");function b8(){var e=new Map,t=[],n=[],r=u4;function i(s){var o=s+"",a=e.get(o);if(!a){if(r!==u4)return r;e.set(o,a=t.push(s))}return n[(a-1)%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Map;for(const o of s){const a=o+"";e.has(a)||e.set(a,t.push(o))}return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return b8(t,n).unknown(r)},Gu.apply(i,arguments),i}function zue(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function Uue(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return zue((n-r/t)*t,o,i,s,a)}}function jue(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return zue((n-r/t)*t,i,s,o,a)}}const ED=e=>()=>e;function Wue(e,t){return function(n){return e+n*t}}function W7e(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function AD(e,t){var n=t-e;return n?Wue(e,n>180||n<-180?n-360*Math.round(n/360):n):ED(isNaN(e)?t:e)}function V7e(e){return(e=+e)==1?br:function(t,n){return n-t?W7e(t,n,e):ED(isNaN(t)?n:t)}}function br(e,t){var n=t-e;return n?Wue(e,n):ED(isNaN(e)?t:e)}const l4=function e(t){var n=V7e(t);function r(i,s){var o=n((i=ws(i)).r,(s=ws(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=br(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function Vue(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=ws(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var G7e=Vue(Uue),H7e=Vue(jue);function x8(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function Gue(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function q7e(e,t){return(Gue(t)?x8:Hue)(e,t)}function Hue(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Nh(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function que(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function sa(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Xue(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Nh(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var c4=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nO=new RegExp(c4.source,"g");function X7e(e){return function(){return e}}function Y7e(e){return function(t){return e(t)+""}}function Yue(e,t){var n=c4.lastIndex=nO.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=c4.exec(e))&&(i=nO.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:sa(r,i)})),n=nO.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?Y7e(u[0].x):X7e(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Nh(e,t){var n=typeof t,r;return t==null||n==="boolean"?ED(t):(n==="number"?sa:n==="string"?(r=oc(t))?(t=r,l4):Yue:t instanceof oc?l4:t instanceof Date?que:Gue(t)?x8:Array.isArray(t)?Hue:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Xue:sa)(e,t)}function K7e(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function Z7e(e,t){var n=AD(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function h$(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var kq=180/Math.PI,f4={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Kue(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*kq,skewX:Math.atan(u)*kq,scaleX:o,scaleY:a}}var YC;function J7e(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?f4:Kue(t.a,t.b,t.c,t.d,t.e,t.f)}function Q7e(e){return e==null||(YC||(YC=document.createElementNS("http://www.w3.org/2000/svg","g")),YC.setAttribute("transform",e),!(e=YC.transform.baseVal.consolidate()))?f4:(e=e.matrix,Kue(e.a,e.b,e.c,e.d,e.e,e.f))}function Zue(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:sa(l,f)},{i:g-2,x:sa(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:sa(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:sa(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:sa(l,f)},{i:g-2,x:sa(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var e9e=Zue(J7e,"px, ","px)","deg)"),t9e=Zue(Q7e,", ",")",")"),n9e=1e-12;function Eq(e){return((e=Math.exp(e))+1/e)/2}function r9e(e){return((e=Math.exp(e))-1/e)/2}function i9e(e){return((e=Math.exp(2*e))-1)/(e+1)}const s9e=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,g=d*d+p*p,m,y;if(g<n9e)y=Math.log(h/l)/t,m=function($){return[a+$*d,u+$*p,l*Math.exp(t*$*y)]};else{var b=Math.sqrt(g),v=(h*h-l*l+r*g)/(2*l*n*b),x=(h*h-l*l-r*g)/(2*h*n*b),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(x*x+1)-x);y=(C-w)/t,m=function($){var S=$*y,k=Eq(w),E=l/(n*b)*(k*i9e(t*S+w)-r9e(w));return[a+E*d,u+E*p,l*k/Eq(t*S+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function Jue(e){return function(t,n){var r=e((t=Xf(t)).h,(n=Xf(n)).h),i=br(t.s,n.s),s=br(t.l,n.l),o=br(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const o9e=Jue(AD);var a9e=Jue(br);function u9e(e,t){var n=br((e=Yf(e)).l,(t=Yf(t)).l),r=br(e.a,t.a),i=br(e.b,t.b),s=br(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function Que(e){return function(t,n){var r=e((t=Kf(t)).h,(n=Kf(n)).h),i=br(t.c,n.c),s=br(t.l,n.l),o=br(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const l9e=Que(AD);var c9e=Que(br);function ele(e){return function t(n){n=+n;function r(i,s){var o=e((i=Ep(i)).h,(s=Ep(s)).h),a=br(i.s,s.s),u=br(i.l,s.l),l=br(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const f9e=ele(AD);var h9e=ele(br);function v8(e,t){t===void 0&&(t=e,e=Nh);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function d9e(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const p9e=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Nh,interpolateArray:q7e,interpolateBasis:Uue,interpolateBasisClosed:jue,interpolateCubehelix:f9e,interpolateCubehelixLong:h9e,interpolateDate:que,interpolateDiscrete:K7e,interpolateHcl:l9e,interpolateHclLong:c9e,interpolateHsl:o9e,interpolateHslLong:a9e,interpolateHue:Z7e,interpolateLab:u9e,interpolateNumber:sa,interpolateNumberArray:x8,interpolateObject:Xue,interpolateRgb:l4,interpolateRgbBasis:G7e,interpolateRgbBasisClosed:H7e,interpolateRound:h$,interpolateString:Yue,interpolateTransformCss:e9e,interpolateTransformSvg:t9e,interpolateZoom:s9e,piecewise:v8,quantize:d9e},Symbol.toStringTag,{value:"Module"}));function g9e(e){return function(){return e}}function h4(e){return+e}var Aq=[0,1];function ds(e){return e}function d4(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:g9e(isNaN(t)?NaN:.5)}function m9e(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function y9e(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=d4(i,r),s=n(o,s)):(r=d4(r,i),s=n(s,o)),function(a){return s(r(a))}}function b9e(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=d4(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=jf(e,a,1,r)-1;return s[u](i[u](a))}}function d$(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function _D(){var e=Aq,t=Aq,n=Nh,r,i,s,o=ds,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==ds&&(o=m9e(e[0],e[h-1])),a=h>2?b9e:y9e,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),sa)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,h4),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=h$,c()},f.clamp=function(h){return arguments.length?(o=h?!0:ds,c()):o!==ds},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function tle(){return _D()(ds,ds)}function AE(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function p0(e){return e=AE(Math.abs(e)),e?e[1]:NaN}function x9e(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function v9e(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var w9e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ip(e){return new w8(e)}Ip.prototype=w8.prototype;function w8(e){if(!(t=w9e.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}w8.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $9e(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(r>0){if(!+e[n])break e;r=0}break}return r>0?e.slice(0,r)+e.slice(i+1):e}var nle;function C9e(e,t){var n=AE(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(nle=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+AE(e,Math.max(0,t+s-1))[0]}function _q(e,t){var n=AE(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Tq={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return _q(e*100,t)},r:_q,s:C9e,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Iq(e){return e}var Dq=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function rle(e){var t=e.grouping&&e.thousands?x9e(e.grouping,e.thousands):Iq,n=e.currency,r=e.decimal,i=e.numerals?v9e(e.numerals):Iq,s=e.percent||"%";function o(u){u=Ip(u);var l=u.fill,c=u.align,f=u.sign,h=u.symbol,d=u.zero,p=u.width,g=u.comma,m=u.precision,y=u.trim,b=u.type;b==="n"?(g=!0,b="g"):Tq[b]||(m==null&&(m=12),y=!0,b="g"),(d||l==="0"&&c==="=")&&(d=!0,l="0",c="=");var v=h==="$"?n[0]:h==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",x=h==="$"?n[1]:/[%p]/.test(b)?s:"",w=Tq[b],C=/[defgprs%]/.test(b);m=m==null?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m));function $(S){var k=v,E=x,A,F,_;if(b==="c")E=w(S)+E,S="";else{S=+S;var I=S<0;if(S=w(Math.abs(S),m),y&&(S=$9e(S)),I&&+S==0&&(I=!1),k=(I?f==="("?f:"-":f==="-"||f==="("?"":f)+k,E=(b==="s"?Dq[8+nle/3]:"")+E+(I&&f==="("?")":""),C){for(A=-1,F=S.length;++A<F;)if(_=S.charCodeAt(A),48>_||_>57){E=(_===46?r+S.slice(A+1):S.slice(A))+E,S=S.slice(0,A);break}}}g&&!d&&(S=t(S,1/0));var T=k.length+S.length+E.length,O=T<p?new Array(p-T+1).join(l):"";switch(g&&d&&(S=t(O+S,O.length?p-E.length:1/0),O=""),c){case"<":S=k+S+E+O;break;case"=":S=k+O+S+E;break;case"^":S=O.slice(0,T=O.length>>1)+k+S+E+O.slice(T);break;default:S=O+k+S+E;break}return i(S)}return $.toString=function(){return u+""},$}function a(u,l){var c=o((u=Ip(u),u.type="f",u)),f=Math.max(-8,Math.min(8,Math.floor(p0(l)/3)))*3,h=Math.pow(10,-f),d=Dq[8+f/3];return function(p){return c(h*p)+d}}return{format:o,formatPrefix:a}}var KC,cy,TD;ile({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function ile(e){return KC=rle(e),cy=KC.format,TD=KC.formatPrefix,KC}function $8(e){return Math.max(0,-p0(Math.abs(e)))}function C8(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(p0(t)/3)))*3-p0(Math.abs(e)))}function S8(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,p0(t)-p0(e))+1}const S9e=Object.freeze(Object.defineProperty({__proto__:null,get format(){return cy},formatDefaultLocale:ile,formatLocale:rle,get formatPrefix(){return TD},formatSpecifier:Ip,precisionFixed:$8,precisionPrefix:C8,precisionRound:S8},Symbol.toStringTag,{value:"Module"}));function sle(e,t,n,r){var i=Wf(e,t,n),s;switch(r=Ip(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=C8(i,o))&&(r.precision=s),TD(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=S8(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=$8(i))&&(r.precision=s-(r.type==="%")*2);break}}return cy(r)}function $g(e){var t=e.domain;return e.ticks=function(n){var r=t();return TM(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return sle(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=Lie(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function ole(){var e=tle();return e.copy=function(){return d$(e,ole())},Gu.apply(e,arguments),$g(e)}function ale(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,h4),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return ale(e).unknown(t)},e=arguments.length?Array.from(e,h4):[0,1],$g(n)}function ule(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function Nq(e){return Math.log(e)}function Fq(e){return Math.exp(e)}function k9e(e){return-Math.log(-e)}function E9e(e){return-Math.exp(-e)}function A9e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function _9e(e){return e===10?A9e:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function T9e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function Oq(e){return function(t){return-e(-t)}}function k8(e){var t=e(Nq,Fq),n=t.domain,r=10,i,s;function o(){return i=T9e(r),s=_9e(r),n()[0]<0?(i=Oq(i),s=Oq(s),e(k9e,E9e)):e(Nq,Fq),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=function(a){var u=n(),l=u[0],c=u[u.length-1],f;(f=c<l)&&(h=l,l=c,c=h);var h=i(l),d=i(c),p,g,m,y=a==null?10:+a,b=[];if(!(r%1)&&d-h<y){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(g=1,p=s(h);g<r;++g)if(m=p*g,!(m<l)){if(m>c)break;b.push(m)}}else for(;h<=d;++h)for(g=r-1,p=s(h);g>=1;--g)if(m=p*g,!(m<l)){if(m>c)break;b.push(m)}b.length*2<y&&(b=TM(l,c,y))}else b=TM(h,d,Math.min(d-h,y)).map(s);return f?b.reverse():b},t.tickFormat=function(a,u){if(u==null&&(u=r===10?".0e":","),typeof u!="function"&&(u=cy(u)),a===1/0)return u;a==null&&(a=10);var l=Math.max(1,r*a/t.ticks().length);return function(c){var f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=function(){return n(ule(n(),{floor:function(a){return s(Math.floor(i(a)))},ceil:function(a){return s(Math.ceil(i(a)))}}))},t}function lle(){var e=k8(_D()).domain([1,10]);return e.copy=function(){return d$(e,lle()).base(e.base())},Gu.apply(e,arguments),e}function Rq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Mq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function E8(e){var t=1,n=e(Rq(t),Mq(t));return n.constant=function(r){return arguments.length?e(Rq(t=+r),Mq(t)):t},$g(n)}function cle(){var e=E8(_D());return e.copy=function(){return d$(e,cle()).constant(e.constant())},Gu.apply(e,arguments)}function Lq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function I9e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function D9e(e){return e<0?-e*e:e*e}function A8(e){var t=e(ds,ds),n=1;function r(){return n===1?e(ds,ds):n===.5?e(I9e,D9e):e(Lq(n),Lq(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},$g(t)}function _8(){var e=A8(_D());return e.copy=function(){return d$(e,_8()).exponent(e.exponent())},Gu.apply(e,arguments),e}function N9e(){return _8.apply(null,arguments).exponent(.5)}function fle(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=Bie(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[jf(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(ey),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return fle().domain(e).range(t).unknown(r)},Gu.apply(s,arguments)}function hle(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[jf(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return hle().domain([e,t]).range(i).unknown(s)},Gu.apply($g(o),arguments)}function dle(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[jf(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return dle().domain(e).range(t).unknown(n)},Gu.apply(i,arguments)}function rO(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function iO(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function fb(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function ple(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=hb(i),c=db(i),f=hb(s),h=db(s),d=hb(o),p=db(o),g=hb(a),m=db(a),y=hb(u),b=db(u),v={a:L,A:M,b:P,B:G,c:null,d:Wq,e:Wq,f:tUe,g:fUe,G:dUe,H:J9e,I:Q9e,j:eUe,L:gle,m:nUe,M:rUe,p:H,q:Q,Q:Hq,s:qq,S:iUe,u:sUe,U:oUe,V:aUe,w:uUe,W:lUe,x:null,X:null,y:cUe,Y:hUe,Z:pUe,"%":Gq},x={a:te,A:ne,b:oe,B:he,c:null,d:Vq,e:Vq,f:bUe,g:_Ue,G:IUe,H:gUe,I:mUe,j:yUe,L:yle,m:xUe,M:vUe,p:we,q:Ae,Q:Hq,s:qq,S:wUe,u:$Ue,U:CUe,V:SUe,w:kUe,W:EUe,x:null,X:null,y:AUe,Y:TUe,Z:DUe,"%":Gq},w={a:E,A,b:F,B:_,c:I,d:Uq,e:Uq,f:X9e,g:zq,G:Bq,H:jq,I:jq,j:V9e,L:q9e,m:W9e,M:G9e,p:k,q:j9e,Q:K9e,s:Z9e,S:H9e,u:L9e,U:P9e,V:B9e,w:M9e,W:z9e,x:T,X:O,y:zq,Y:Bq,Z:U9e,"%":Y9e};v.x=C(n,v),v.X=C(r,v),v.c=C(t,v),x.x=C(n,x),x.X=C(r,x),x.c=C(t,x);function C(B,Y){return function(K){var R=[],Ce=-1,ce=0,Ee=B.length,Se,qe,bt;for(K instanceof Date||(K=new Date(+K));++Ce<Ee;)B.charCodeAt(Ce)===37&&(R.push(B.slice(ce,Ce)),(qe=Pq[Se=B.charAt(++Ce)])!=null?Se=B.charAt(++Ce):qe=Se==="e"?" ":"0",(bt=Y[Se])&&(Se=bt(K,qe)),R.push(Se),ce=Ce+1);return R.push(B.slice(ce,Ce)),R.join("")}}function $(B,Y){return function(K){var R=fb(1900,void 0,1),Ce=S(R,B,K+="",0),ce,Ee;if(Ce!=K.length)return null;if("Q"in R)return new Date(R.Q);if("s"in R)return new Date(R.s*1e3+("L"in R?R.L:0));if(Y&&!("Z"in R)&&(R.Z=0),"p"in R&&(R.H=R.H%12+R.p*12),R.m===void 0&&(R.m="q"in R?R.q:0),"V"in R){if(R.V<1||R.V>53)return null;"w"in R||(R.w=1),"Z"in R?(ce=iO(fb(R.y,0,1)),Ee=ce.getUTCDay(),ce=Ee>4||Ee===0?nE.ceil(ce):nE(ce),ce=vf.offset(ce,(R.V-1)*7),R.y=ce.getUTCFullYear(),R.m=ce.getUTCMonth(),R.d=ce.getUTCDate()+(R.w+6)%7):(ce=rO(fb(R.y,0,1)),Ee=ce.getDay(),ce=Ee>4||Ee===0?tE.ceil(ce):tE(ce),ce=xf.offset(ce,(R.V-1)*7),R.y=ce.getFullYear(),R.m=ce.getMonth(),R.d=ce.getDate()+(R.w+6)%7)}else("W"in R||"U"in R)&&("w"in R||(R.w="u"in R?R.u%7:"W"in R?1:0),Ee="Z"in R?iO(fb(R.y,0,1)).getUTCDay():rO(fb(R.y,0,1)).getDay(),R.m=0,R.d="W"in R?(R.w+6)%7+R.W*7-(Ee+5)%7:R.w+R.U*7-(Ee+6)%7);return"Z"in R?(R.H+=R.Z/100|0,R.M+=R.Z%100,iO(R)):rO(R)}}function S(B,Y,K,R){for(var Ce=0,ce=Y.length,Ee=K.length,Se,qe;Ce<ce;){if(R>=Ee)return-1;if(Se=Y.charCodeAt(Ce++),Se===37){if(Se=Y.charAt(Ce++),qe=w[Se in Pq?Y.charAt(Ce++):Se],!qe||(R=qe(B,K,R))<0)return-1}else if(Se!=K.charCodeAt(R++))return-1}return R}function k(B,Y,K){var R=l.exec(Y.slice(K));return R?(B.p=c.get(R[0].toLowerCase()),K+R[0].length):-1}function E(B,Y,K){var R=d.exec(Y.slice(K));return R?(B.w=p.get(R[0].toLowerCase()),K+R[0].length):-1}function A(B,Y,K){var R=f.exec(Y.slice(K));return R?(B.w=h.get(R[0].toLowerCase()),K+R[0].length):-1}function F(B,Y,K){var R=y.exec(Y.slice(K));return R?(B.m=b.get(R[0].toLowerCase()),K+R[0].length):-1}function _(B,Y,K){var R=g.exec(Y.slice(K));return R?(B.m=m.get(R[0].toLowerCase()),K+R[0].length):-1}function I(B,Y,K){return S(B,t,Y,K)}function T(B,Y,K){return S(B,n,Y,K)}function O(B,Y,K){return S(B,r,Y,K)}function L(B){return o[B.getDay()]}function M(B){return s[B.getDay()]}function P(B){return u[B.getMonth()]}function G(B){return a[B.getMonth()]}function H(B){return i[+(B.getHours()>=12)]}function Q(B){return 1+~~(B.getMonth()/3)}function te(B){return o[B.getUTCDay()]}function ne(B){return s[B.getUTCDay()]}function oe(B){return u[B.getUTCMonth()]}function he(B){return a[B.getUTCMonth()]}function we(B){return i[+(B.getUTCHours()>=12)]}function Ae(B){return 1+~~(B.getUTCMonth()/3)}return{format:function(B){var Y=C(B+="",v);return Y.toString=function(){return B},Y},parse:function(B){var Y=$(B+="",!1);return Y.toString=function(){return B},Y},utcFormat:function(B){var Y=C(B+="",x);return Y.toString=function(){return B},Y},utcParse:function(B){var Y=$(B+="",!0);return Y.toString=function(){return B},Y}}}var Pq={"-":"",_:" ",0:"0"},Or=/^\s*\d+/,F9e=/^%/,O9e=/[\\^$*+?|[\]().{}]/g;function It(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function R9e(e){return e.replace(O9e,"\\$&")}function hb(e){return new RegExp("^(?:"+e.map(R9e).join("|")+")","i")}function db(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function M9e(e,t,n){var r=Or.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function L9e(e,t,n){var r=Or.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function P9e(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function B9e(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function z9e(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Bq(e,t,n){var r=Or.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function zq(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function U9e(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function j9e(e,t,n){var r=Or.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function W9e(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Uq(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function V9e(e,t,n){var r=Or.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function jq(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function G9e(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function H9e(e,t,n){var r=Or.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function q9e(e,t,n){var r=Or.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function X9e(e,t,n){var r=Or.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Y9e(e,t,n){var r=F9e.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function K9e(e,t,n){var r=Or.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Z9e(e,t,n){var r=Or.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Wq(e,t){return It(e.getDate(),t,2)}function J9e(e,t){return It(e.getHours(),t,2)}function Q9e(e,t){return It(e.getHours()%12||12,t,2)}function eUe(e,t){return It(1+xf.count(Vf(e),e),t,3)}function gle(e,t){return It(e.getMilliseconds(),t,3)}function tUe(e,t){return gle(e,t)+"000"}function nUe(e,t){return It(e.getMonth()+1,t,2)}function rUe(e,t){return It(e.getMinutes(),t,2)}function iUe(e,t){return It(e.getSeconds(),t,2)}function sUe(e){var t=e.getDay();return t===0?7:t}function oUe(e,t){return It(ny.count(Vf(e)-1,e),t,2)}function mle(e){var t=e.getDay();return t>=4||t===0?n0(e):n0.ceil(e)}function aUe(e,t){return e=mle(e),It(n0.count(Vf(e),e)+(Vf(e).getDay()===4),t,2)}function uUe(e){return e.getDay()}function lUe(e,t){return It(tE.count(Vf(e)-1,e),t,2)}function cUe(e,t){return It(e.getFullYear()%100,t,2)}function fUe(e,t){return e=mle(e),It(e.getFullYear()%100,t,2)}function hUe(e,t){return It(e.getFullYear()%1e4,t,4)}function dUe(e,t){var n=e.getDay();return e=n>=4||n===0?n0(e):n0.ceil(e),It(e.getFullYear()%1e4,t,4)}function pUe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+It(t/60|0,"0",2)+It(t%60,"0",2)}function Vq(e,t){return It(e.getUTCDate(),t,2)}function gUe(e,t){return It(e.getUTCHours(),t,2)}function mUe(e,t){return It(e.getUTCHours()%12||12,t,2)}function yUe(e,t){return It(1+vf.count(Gf(e),e),t,3)}function yle(e,t){return It(e.getUTCMilliseconds(),t,3)}function bUe(e,t){return yle(e,t)+"000"}function xUe(e,t){return It(e.getUTCMonth()+1,t,2)}function vUe(e,t){return It(e.getUTCMinutes(),t,2)}function wUe(e,t){return It(e.getUTCSeconds(),t,2)}function $Ue(e){var t=e.getUTCDay();return t===0?7:t}function CUe(e,t){return It(ry.count(Gf(e)-1,e),t,2)}function ble(e){var t=e.getUTCDay();return t>=4||t===0?r0(e):r0.ceil(e)}function SUe(e,t){return e=ble(e),It(r0.count(Gf(e),e)+(Gf(e).getUTCDay()===4),t,2)}function kUe(e){return e.getUTCDay()}function EUe(e,t){return It(nE.count(Gf(e)-1,e),t,2)}function AUe(e,t){return It(e.getUTCFullYear()%100,t,2)}function _Ue(e,t){return e=ble(e),It(e.getUTCFullYear()%100,t,2)}function TUe(e,t){return It(e.getUTCFullYear()%1e4,t,4)}function IUe(e,t){var n=e.getUTCDay();return e=n>=4||n===0?r0(e):r0.ceil(e),It(e.getUTCFullYear()%1e4,t,4)}function DUe(){return"+0000"}function Gq(){return"%"}function Hq(e){return+e}function qq(e){return Math.floor(+e/1e3)}var im,ID,xle,DD,vle;NUe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function NUe(e){return im=ple(e),ID=im.format,xle=im.parse,DD=im.utcFormat,vle=im.utcParse,im}function FUe(e){return new Date(e)}function OUe(e){return e instanceof Date?+e:+new Date(+e)}function T8(e,t,n,r,i,s,o,a,u,l){var c=tle(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),v=l("%B"),x=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?g:s(C)<C?m:r(C)<C?i(C)<C?y:b:n(C)<C?v:x)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,OUe)):h().map(FUe)},c.ticks=function(C){var $=h();return e($[0],$[$.length-1],C??10)},c.tickFormat=function(C,$){return $==null?w:l($)},c.nice=function(C){var $=h();return(!C||typeof C.range!="function")&&(C=t($[0],$[$.length-1],C??10)),C?h(ule($,C)):c},c.copy=function(){return d$(c,T8(e,t,n,r,i,s,o,a,u,l))},c}function RUe(){return Gu.apply(T8(e4e,t4e,Vf,yv,ny,xf,T6,_6,Jc,ID).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function MUe(){return Gu.apply(T8(JMe,QMe,Gf,bv,ry,vf,N6,D6,Jc,DD).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function ND(){var e=0,t=1,n,r,i,s,o=ds,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(Nh),l.rangeRound=c(h$),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Fh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function I8(){var e=$g(ND()(ds));return e.copy=function(){return Fh(e,I8())},Dh.apply(e,arguments)}function wle(){var e=k8(ND()).domain([1,10]);return e.copy=function(){return Fh(e,wle()).base(e.base())},Dh.apply(e,arguments)}function $le(){var e=E8(ND());return e.copy=function(){return Fh(e,$le()).constant(e.constant())},Dh.apply(e,arguments)}function D8(){var e=A8(ND());return e.copy=function(){return Fh(e,D8()).exponent(e.exponent())},Dh.apply(e,arguments)}function LUe(){return D8.apply(null,arguments).exponent(.5)}function FD(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=ds,c,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+c(g))-s)*(r*g<r*s?a:u),l(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var y,b,v;return arguments.length?([y,b,v]=m,l=v8(g,[y,b,v]),d):[l(0),l(.5),l(1)]}}return d.range=p(Nh),d.rangeRound=p(h$),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return c=g,i=g(e),s=g(t),o=g(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function Cle(){var e=$g(FD()(ds));return e.copy=function(){return Fh(e,Cle())},Dh.apply(e,arguments)}function Sle(){var e=k8(FD()).domain([.1,1,10]);return e.copy=function(){return Fh(e,Sle()).base(e.base())},Dh.apply(e,arguments)}function kle(){var e=E8(FD());return e.copy=function(){return Fh(e,kle()).constant(e.constant())},Dh.apply(e,arguments)}function N8(){var e=A8(FD());return e.copy=function(){return Fh(e,N8()).exponent(e.exponent())},Dh.apply(e,arguments)}function PUe(){return N8.apply(null,arguments).exponent(.5)}function F8(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const BUe="identity",g0="linear",ac="log",p$="pow",g$="sqrt",OD="symlog",Dp="time",Np="utc",mu="sequential",fy="diverging",m0="quantile",RD="quantize",MD="threshold",O8="ordinal",p4="point",Ele="band",R8="bin-ordinal",cr="continuous",m$="discrete",y$="discretizing",Po="interpolating",M8="temporal";function zUe(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function UUe(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function L8(){const e=b8().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=F8(f,a,u);let g=r[h-0];i=(d-g)/(p||1),o&&(i=Math.floor(i)),g+=(d-g-i*(f-a))*l,s=i*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=Us(f).map(y=>g+i*y);return n(h?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let g=+f[0],m=+f[1],y,b,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<d[0]||g>r[1-h])))return y=Math.max(0,jf(d,g)-1),b=g===m?y:jf(d,m)-1,g-d[y]>s+1e-10&&++y,h&&(v=y,y=p-b,b=p-v),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return L8().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function Ale(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Ale(t())},e}function jUe(){return Ale(L8().paddingInner(1))}var WUe=Array.prototype.map;function VUe(e){return WUe.call(e,Lf)}const GUe=Array.prototype.slice;function _le(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(jf(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=VUe(r),n):e.slice()},n.range=function(r){return arguments.length?(t=GUe.call(r),n):t.slice()},n.tickFormat=function(r,i){return sle(e[0],qt(e),r??10,i)},n.copy=function(){return _le().domain(n.domain()).range(n.range())},n}const _E={};function HUe(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?zUe(s):s.invertExtent?UUe(s):void 0),s.type=e,s};return r.metadata=ic(Qe(n)),r}function Ft(e,t,n){return arguments.length>1?(_E[e]=HUe(e,t,n),this):Tle(e)?_E[e]:void 0}Ft(BUe,ale);Ft(g0,ole,cr);Ft(ac,lle,[cr,ac]);Ft(p$,_8,cr);Ft(g$,N9e,cr);Ft(OD,cle,cr);Ft(Dp,RUe,[cr,M8]);Ft(Np,MUe,[cr,M8]);Ft(mu,I8,[cr,Po]);Ft("".concat(mu,"-").concat(g0),I8,[cr,Po]);Ft("".concat(mu,"-").concat(ac),wle,[cr,Po,ac]);Ft("".concat(mu,"-").concat(p$),D8,[cr,Po]);Ft("".concat(mu,"-").concat(g$),LUe,[cr,Po]);Ft("".concat(mu,"-").concat(OD),$le,[cr,Po]);Ft("".concat(fy,"-").concat(g0),Cle,[cr,Po]);Ft("".concat(fy,"-").concat(ac),Sle,[cr,Po,ac]);Ft("".concat(fy,"-").concat(p$),N8,[cr,Po]);Ft("".concat(fy,"-").concat(g$),PUe,[cr,Po]);Ft("".concat(fy,"-").concat(OD),kle,[cr,Po]);Ft(m0,fle,[y$,m0]);Ft(RD,hle,y$);Ft(MD,dle,y$);Ft(R8,_le,[m$,y$]);Ft(O8,b8,m$);Ft(Ele,L8,m$);Ft(p4,jUe,m$);function Tle(e){return tt(_E,e)}function Cg(e,t){const n=_E[e];return n&&n.metadata[t]}function P8(e){return Cg(e,cr)}function y0(e){return Cg(e,m$)}function g4(e){return Cg(e,y$)}function Ile(e){return Cg(e,ac)}function qUe(e){return Cg(e,M8)}function Dle(e){return Cg(e,Po)}function Nle(e){return Cg(e,m0)}const XUe=["clamp","base","constant","exponent"];function Fle(e,t){const n=t[0],r=qt(t)-n;return function(i){return e(n+i*r)}}function LD(e,t,n){return v8(B8(t||"rgb",n),e)}function Ole(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Rle(e,t,n){const r=n-t;let i,s,o;return!r||!Number.isFinite(r)?_o(.5):(i=(s=e.type).indexOf("-"),s=i<0?s:s.slice(i+1),o=Ft(s)().domain([t,n]).range([0,1]),XUe.forEach(a=>e[a]?o[a](e[a]()):0),o)}function B8(e,t){const n=p9e[YUe(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function YUe(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const KUe={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},ZUe={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Mle(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function Lle(e,t){for(const n in e)z8(n,t(e[n]))}const Xq={};Lle(ZUe,Mle);Lle(KUe,e=>LD(Mle(e)));function z8(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(Xq[e]=t,this):Xq[e]}const rk="symbol",JUe="discrete",QUe="gradient",eje=e=>rt(e)?e.map(t=>String(t)):String(e),tje=(e,t)=>e[1]-t[1],nje=(e,t)=>t[1]-e[1];function U8(e,t,n){let r;return wp(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(OI(e.domain())/n||1)))),ht(t)&&(r=t.step,t=t.interval),hn(t)&&(t=e.type===Dp?iy(t):e.type==Np?sy(t):ae("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function Ple(e,t,n){let r=e.range(),i=r[0],s=qt(r),o=tje;if(i>s&&(r=s,s=i,i=r,o=nje),i=Math.floor(i),s=Math.ceil(s),t=t.map(a=>[a,e(a)]).filter(a=>i<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],qt(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function j8(e,t){return e.bins?Ple(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Ble(e,t,n,r,i,s){const o=t.type;let a=eje;if(o===Dp||i===Dp)a=e.timeFormat(r);else if(o===Np||i===Np)a=e.utcFormat(r);else if(Ile(o)){const u=e.formatFloat(r);if(s||t.bins)a=u;else{const l=zle(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,r)}else r&&(a=e.format(r));return a}function zle(e,t,n){const r=j8(e,t),i=e.base(),s=Math.log(i),o=Math.max(1,i*t/r.length),a=u=>{let l=u/Math.pow(i,Math.round(Math.log(u)/s));return l*i<i-.5&&(l*=i),l<=o};return n?r.filter(a):a}const m4={[m0]:"quantiles",[RD]:"thresholds",[MD]:"domain"},Ule={[m0]:"quantiles",[RD]:"domain"};function jle(e,t){return e.bins?sje(e.bins):e.type===ac?zle(e,t,!0):m4[e.type]?ije(e[m4[e.type]]()):j8(e,t)}function rje(e,t,n){const r=t[Ule[t.type]](),i=r.length;let s=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)s=Math.min(s,r[o]-r[o-1]);return e.formatSpan(0,s,3*10,n)}function ije(e){const t=[-1/0].concat(e);return t.max=1/0,t}function sje(e){const t=e.slice(0,-1);return t.max=qt(e),t}const oje=e=>m4[e.type]||e.bins;function Wle(e,t,n,r,i,s,o){const a=Ule[t.type]&&s!==Dp&&s!==Np?rje(e,t,i):Ble(e,t,n,i,s,o);return r===rk&&oje(t)?aje(a):r===JUe?uje(a):lje(a)}const aje=e=>(t,n,r)=>{const i=Yq(r[n+1],Yq(r.max,1/0)),s=Kq(t,e),o=Kq(i,e);return s&&o?s+" – "+o:o?"< "+o:"≥ "+s},Yq=(e,t)=>e??t,uje=e=>(t,n)=>n?e(t):null,lje=e=>t=>e(t),Kq=(e,t)=>Number.isFinite(e)?t(e):null;function cje(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+qt(t),s=i-r;if(e.type===MD){const o=n?s/n:.1;r-=o,i+=o,s=i-r}return o=>(o-r)/s}function fje(e,t,n,r){const i=r||t.type;return hn(n)&&qUe(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===Dp?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===Np?e.utcFormat("%A, %d %B %Y, %X UTC"):Wle(e,t,5,null,n,r,!0)}function Vle(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=fje(e,t,n.format,n.formatType);if(g4(t.type)){const s=jle(t).slice(1).map(i),o=s.length;return"".concat(o," boundar").concat(o===1?"y":"ies",": ").concat(s.join(", "))}else if(y0(t.type)){const s=t.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(o," value").concat(o===1?"":"s",": ").concat(a)}else{const s=t.domain();return"values from ".concat(i(s[0])," to ").concat(i(qt(s)))}}function Gle(e){ee.call(this,null,e)}ye(Gle,ee,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,a=U8(s,o,e.minstep),u=e.format||Ble(n,s,a,e.formatSpecifier,e.formatType,!!e.values),l=e.values?Ple(s,e.values,a):j8(s,a);return i&&(r.rem=i),i=l.map((c,f)=>Nt({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&i.length&&i.push(Nt({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}});function Hle(e){ee.call(this,null,e)}function hje(){return Nt({})}function dje(e){const t=Z1().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}ye(Hle,ee,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||hje,s=e.key||Le,o=this.value;return rt(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(s))&&ae("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=dje(s)),t.visit(t.ADD,a=>{const u=s(a);let l=o.get(u);l?l.exit?(o.empty--,r.add.push(l)):r.mod.push(l):(l=i(a),o.set(u,l),r.add.push(l)),l.datum=a,l.exit=!1}),t.visit(t.MOD,a=>{const u=s(a),l=o.get(u);l&&(l.datum=a,r.mod.push(l))}),t.visit(t.REM,a=>{const u=s(a),l=o.get(u);a===l.datum&&!l.exit&&(r.rem.push(l),l.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}});function qle(e){ee.call(this,null,e)}ye(qle,ee,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,s=t.encode;if(rt(s))if(n.changed()||s.every(f=>i[f]))s=s[0],n.encode=null;else return t.StopPropagation;var o=s==="enter",a=i.update||zc,u=i.enter||zc,l=i.exit||zc,c=(s&&!o?i[s]:a)||zc;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),a(f,e)}),n.modifies(u.output),n.modifies(a.output),c!==zc&&c!==a&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==zc&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),o||c!==zc){const f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,h=>{const d=u(h,e)||r;(c(h,e)||d)&&n.mod.push(h)}),n.mod.length&&n.modifies(u.output)):t.visit(f,h=>{(c(h,e)||r)&&n.mod.push(h)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function Xle(e){ee.call(this,[],e)}ye(Xle,ee,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.type||rk,o=e.scale,a=+e.limit,u=U8(o,e.count==null?5:e.count,e.minstep),l=!!e.values||s===rk,c=e.format||Wle(n,o,u,s,e.formatSpecifier,e.formatType,l),f=e.values||jle(o,u),h,d,p,g,m;return i&&(r.rem=i),s===rk?(a&&f.length>a?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),i=f.slice(0,a-1),m=!0):i=f,Pt(p=e.size)?(!e.values&&o(i[0])===0&&(i=i.slice(1)),g=i.reduce((y,b)=>Math.max(y,p(b,e)),0)):p=_o(g=p||8),i=i.map((y,b)=>Nt({index:b,label:c(y,b,i),value:y,offset:g,size:p(y,e)})),m&&(m=f[i.length],i.push(Nt({index:i.length,label:"…".concat(f.length-i.length," entries"),value:m,offset:g,size:p(m,e)})))):s===QUe?(h=o.domain(),d=Rle(o,h[0],qt(h)),f.length<3&&!e.values&&h[0]!==qt(h)&&(f=[h[0],qt(h)]),i=f.map((y,b)=>Nt({index:b,label:c(y,b,f),value:y,perc:d(y)}))):(p=f.length-1,d=cje(o),i=f.map((y,b)=>Nt({index:b,label:c(y,b,f),value:y,perc:b?d(y):0,perc2:b===p?1:d(f[b+1])}))),r.source=i,r.add=i,this.value=i,r}});const pje=e=>e.source.x,gje=e=>e.source.y,mje=e=>e.target.x,yje=e=>e.target.y;function W8(e){ee.call(this,{},e)}W8.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};ye(W8,ee,{transform(e,t){var n=e.sourceX||pje,r=e.sourceY||gje,i=e.targetX||mje,s=e.targetY||yje,o=e.as||"path",a=e.orient||"vertical",u=e.shape||"line",l=Zq.get(u+"-"+a)||Zq.get(u);return l||ae("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[o]=l(n(c),r(c),i(c),s(c))}),t.reflow(e.modified()).modifies(o)}});const Yle=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,bje=(e,t,n,r)=>Yle(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),Kle=(e,t,n,r)=>{var i=n-e,s=r-t,o=Math.sqrt(i*i+s*s)/2,a=180*Math.atan2(s,i)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+a+" 0 1 "+n+","+r},xje=(e,t,n,r)=>Kle(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),Zle=(e,t,n,r)=>{const i=n-e,s=r-t,o=.2*(i+s),a=.2*(s-i);return"M"+e+","+t+"C"+(e+o)+","+(t+a)+" "+(n+a)+","+(r-o)+" "+n+","+r},vje=(e,t,n,r)=>Zle(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),wje=(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,$je=(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,Cje=(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*s+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*o+","+t*a+"L"+r*o+","+r*a},Sje=(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},kje=(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},Eje=(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=(t+r)/2;return"M"+t*i+","+t*s+"C"+u*i+","+u*s+" "+u*o+","+u*a+" "+r*o+","+r*a},Zq=Z1({line:Yle,"line-radial":bje,arc:Kle,"arc-radial":xje,curve:Zle,"curve-radial":vje,"orthogonal-horizontal":wje,"orthogonal-vertical":$je,"orthogonal-radial":Cje,"diagonal-horizontal":Sje,"diagonal-vertical":kje,"diagonal-radial":Eje});function V8(e){ee.call(this,null,e)}V8.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};ye(V8,ee,{transform(e,t){var n=e.as||["startAngle","endAngle"],r=n[0],i=n[1],s=e.field||Y1,o=e.startAngle||0,a=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(s),c=l.length,f=o,h=(a-o)/jie(l),d=Us(c),p,g,m;for(e.sort&&d.sort((y,b)=>l[y]-l[b]),p=0;p<c;++p)m=l[d[p]],g=u[d[p]],g[r]=f,g[i]=f+=m*h;return this.value=l,t.reflow(e.modified()).modifies(n)}});const Aje=5;function _je(e){const t=e.type;return!e.bins&&(t===g0||t===p$||t===g$)}function Jle(e){return P8(e)&&e!==mu}const Tje=ic(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Qle(e){ee.call(this,null,e),this.modified(!0)}ye(Qle,ee,{transform(e,t){var n=t.dataflow,r=this.value,i=Ije(e);(!r||i!==r.type)&&(this.value=r=Ft(i)());for(i in e)if(!Tje[i]){if(i==="padding"&&Jle(r.type))continue;Pt(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return Mje(r,e,Rje(r,e,Nje(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Ije(e){var t=e.type,n="",r;return t===mu?mu+"-"+g0:(Dje(e)&&(r=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=r===2?mu+"-":r===3?fy+"-":""),(n+t||g0).toLowerCase())}function Dje(e){const t=e.type;return P8(t)&&t!==Dp&&t!==Np&&(e.scheme||e.range&&e.range.length&&e.range.every(hn))}function Nje(e,t,n){const r=Fje(e,t.domainRaw,n);if(r>-1)return r;var i=t.domain,s=e.type,o=t.zero||t.zero===void 0&&_je(e),a,u;if(!i)return 0;if(Jle(s)&&t.padding&&i[0]!==qt(i)&&(i=Oje(s,i,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(a=(i=i.slice()).length-1||1,o&&(i[0]>0&&(i[0]=0),i[a]<0&&(i[a]=0)),t.domainMin!=null&&(i[0]=t.domainMin),t.domainMax!=null&&(i[a]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>i[a]?a+1:u<i[0]?0:a;l!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),i.splice(l,0,u)}return e.domain(ece(s,i,n)),s===O8&&e.unknown(t.domainImplicit?u4:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&U8(e,t.nice)||null),i.length}function Fje(e,t,n){return t?(e.domain(ece(e.type,t,n)),t.length):-1}function Oje(e,t,n,r,i,s){var o=Math.abs(qt(n)-n[0]),a=o/(o-2*r),u=e===ac?Ore(t,null,a):e===g$?yM(t,null,a,.5):e===p$?yM(t,null,a,i||1):e===OD?Rre(t,null,a,s||1):Fre(t,null,a);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function ece(e,t,n){if(Ile(e)){var r=Math.abs(t.reduce((i,s)=>i+(s<0?-1:s>0?1:0),0));r!==t.length&&n.warn("Log scale domain includes zero: "+He(t))}return t}function Rje(e,t,n){let r=t.bins;if(r&&!rt(r)){const i=e.domain(),s=i[0],o=qt(i),a=r.step;let u=r.start==null?s:r.start,l=r.stop==null?o:r.stop;a||ae("Scale bins parameter missing step property."),u<s&&(u=a*Math.ceil(s/a)),l>o&&(l=a*Math.floor(o/a)),r=Us(u,l+a/2,a)}return r?e.bins=r:e.bins&&delete e.bins,e.type===R8&&(r?!t.domain&&!t.domainRaw&&(e.domain(r),n=r.length):e.bins=e.domain()),n}function Mje(e,t,n){var r=e.type,i=t.round||!1,s=t.range;if(t.rangeStep!=null)s=Lje(r,t,n);else if(t.scheme&&(s=Pje(r,t,n),Pt(s))){if(e.interpolator)return e.interpolator(s);ae("Scale type ".concat(r," does not support interpolating color schemes."))}if(s&&Dle(r))return e.interpolator(LD(y4(s,t.reverse),t.interpolate,t.interpolateGamma));s&&t.interpolate&&e.interpolate?e.interpolate(B8(t.interpolate,t.interpolateGamma)):Pt(e.round)?e.round(i):Pt(e.rangeRound)&&e.interpolate(i?h$:Nh),s&&e.range(y4(s,t.reverse))}function Lje(e,t,n){e!==Ele&&e!==p4&&ae("Only band and point scales support rangeStep.");var r=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===p4?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*F8(n,i,r)]}function Pje(e,t,n){var r=t.schemeExtent,i,s;return rt(t.scheme)?s=LD(t.scheme,t.interpolate,t.interpolateGamma):(i=t.scheme.toLowerCase(),s=z8(i),s||ae("Unrecognized scheme name: ".concat(t.scheme))),n=e===MD?n+1:e===R8?n-1:e===m0||e===RD?+t.schemeCount||Aje:n,Dle(e)?Jq(s,r,t.reverse):Pt(s)?Ole(Jq(s,r),n):e===O8?s:s.slice(0,n)}function Jq(e,t,n){return Pt(e)&&(t||n)?Fle(e,y4(t||[0,1],n)):e}function y4(e,t){return t?e.slice().reverse():e}function tce(e){ee.call(this,null,e)}ye(tce,ee,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(pg(e.sort)),this.modified(n),t}});const Qq="zero",nce="center",rce="normalize",ice=["y0","y1"];function G8(e){ee.call(this,null,e)}G8.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Qq,values:[Qq,nce,rce]},{name:"as",type:"string",array:!0,length:2,default:ice}]};ye(G8,ee,{transform(e,t){var n=e.as||ice,r=n[0],i=n[1],s=pg(e.sort),o=e.field||Y1,a=e.offset===nce?Bje:e.offset===rce?zje:Uje,u,l,c,f;for(u=jje(t.source,e.groupby,s,o),l=0,c=u.length,f=u.max;l<c;++l)a(u[l],f,o,r,i);return t.reflow(e.modified()).modifies(n)}});function Bje(e,t,n,r,i){for(var s=(t-e.sum)/2,o=e.length,a=0,u;a<o;++a)u=e[a],u[r]=s,u[i]=s+=Math.abs(n(u))}function zje(e,t,n,r,i){for(var s=1/e.sum,o=0,a=e.length,u=0,l=0,c;u<a;++u)c=e[u],c[r]=o,c[i]=o=s*(l+=Math.abs(n(c)))}function Uje(e,t,n,r,i){for(var s=0,o=0,a=e.length,u=0,l,c;u<a;++u)c=e[u],l=+n(c),l<0?(c[r]=o,c[i]=o+=l):(c[r]=s,c[i]=s+=l)}function jje(e,t,n,r){var i=[],s=g=>g(c),o,a,u,l,c,f,h,d,p;if(t==null)i.push(e.slice());else for(o={},a=0,u=e.length;a<u;++a)c=e[a],f=t.map(s),h=o[f],h||(o[f]=h=[],i.push(h)),h.push(c);for(f=0,p=0,l=i.length;f<l;++f){for(h=i[f],a=0,d=0,u=h.length;a<u;++a)d+=Math.abs(r(h[a]));h.sum=d,d>p&&(p=d),n&&h.sort(n)}return i.max=p,i}const Wje=Object.freeze(Object.defineProperty({__proto__:null,axisticks:Gle,datajoin:Hle,encode:qle,legendentries:Xle,linkpath:W8,pie:V8,scale:Qle,sortitems:tce,stack:G8},Symbol.toStringTag,{value:"Module"}));var ze=1e-6,TE=1e-12,ut=Math.PI,An=ut/2,IE=ut/4,Ui=ut*2,Fn=180/ut,lt=ut/180,$t=Math.abs,hy=Math.atan,Io=Math.atan2,je=Math.cos,ZC=Math.ceil,sce=Math.exp,b4=Math.hypot,DE=Math.log,sO=Math.pow,Be=Math.sin,mo=Math.sign||function(e){return e>0?1:e<0?-1:0},ji=Math.sqrt,H8=Math.tan;function oce(e){return e>1?0:e<-1?ut:Math.acos(e)}function $s(e){return e>1?An:e<-1?-An:Math.asin(e)}function Pr(){}function NE(e,t){e&&tX.hasOwnProperty(e.type)&&tX[e.type](e,t)}var eX={Feature:function(e,t){NE(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)NE(n[r].geometry,t)}},tX={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){x4(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)x4(n[r],t,0)},Polygon:function(e,t){nX(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)nX(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)NE(n[r],t)}};function x4(e,t,n){var r=-1,i=e.length-n,s;for(t.lineStart();++r<i;)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function nX(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)x4(e[n],t,1);t.polygonEnd()}function Nl(e,t){e&&eX.hasOwnProperty(e.type)?eX[e.type](e,t):NE(e,t)}var FE=new Li,OE=new Li,ace,uce,v4,w4,$4,Fu={point:Pr,lineStart:Pr,lineEnd:Pr,polygonStart:function(){FE=new Li,Fu.lineStart=Vje,Fu.lineEnd=Gje},polygonEnd:function(){var e=+FE;OE.add(e<0?Ui+e:e),this.lineStart=this.lineEnd=this.point=Pr},sphere:function(){OE.add(Ui)}};function Vje(){Fu.point=Hje}function Gje(){lce(ace,uce)}function Hje(e,t){Fu.point=lce,ace=e,uce=t,e*=lt,t*=lt,v4=e,w4=je(t=t/2+IE),$4=Be(t)}function lce(e,t){e*=lt,t*=lt,t=t/2+IE;var n=e-v4,r=n>=0?1:-1,i=r*n,s=je(t),o=Be(t),a=$4*o,u=w4*s+a*je(i),l=a*r*Be(i);FE.add(Io(l,u)),v4=e,w4=s,$4=o}function qje(e){return OE=new Li,Nl(e,Fu),OE*2}function RE(e){return[Io(e[1],e[0]),$s(e[2])]}function Fp(e){var t=e[0],n=e[1],r=je(n);return[r*je(t),r*Be(t),Be(n)]}function JC(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function b0(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function oO(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function QC(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function ME(e){var t=ji(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var vn,is,Sn,Ls,bd,cce,fce,Lm,bx,Vc,uc,$l={point:C4,lineStart:rX,lineEnd:iX,polygonStart:function(){$l.point=dce,$l.lineStart=Xje,$l.lineEnd=Yje,bx=new Li,Fu.polygonStart()},polygonEnd:function(){Fu.polygonEnd(),$l.point=C4,$l.lineStart=rX,$l.lineEnd=iX,FE<0?(vn=-(Sn=180),is=-(Ls=90)):bx>ze?Ls=90:bx<-ze&&(is=-90),uc[0]=vn,uc[1]=Sn},sphere:function(){vn=-(Sn=180),is=-(Ls=90)}};function C4(e,t){Vc.push(uc=[vn=e,Sn=e]),t<is&&(is=t),t>Ls&&(Ls=t)}function hce(e,t){var n=Fp([e*lt,t*lt]);if(Lm){var r=b0(Lm,n),i=[r[1],-r[0],0],s=b0(i,r);ME(s),s=RE(s);var o=e-bd,a=o>0?1:-1,u=s[0]*Fn*a,l,c=$t(o)>180;c^(a*bd<u&&u<a*e)?(l=s[1]*Fn,l>Ls&&(Ls=l)):(u=(u+360)%360-180,c^(a*bd<u&&u<a*e)?(l=-s[1]*Fn,l<is&&(is=l)):(t<is&&(is=t),t>Ls&&(Ls=t))),c?e<bd?Ms(vn,e)>Ms(vn,Sn)&&(Sn=e):Ms(e,Sn)>Ms(vn,Sn)&&(vn=e):Sn>=vn?(e<vn&&(vn=e),e>Sn&&(Sn=e)):e>bd?Ms(vn,e)>Ms(vn,Sn)&&(Sn=e):Ms(e,Sn)>Ms(vn,Sn)&&(vn=e)}else Vc.push(uc=[vn=e,Sn=e]);t<is&&(is=t),t>Ls&&(Ls=t),Lm=n,bd=e}function rX(){$l.point=hce}function iX(){uc[0]=vn,uc[1]=Sn,$l.point=C4,Lm=null}function dce(e,t){if(Lm){var n=e-bd;bx.add($t(n)>180?n+(n>0?360:-360):n)}else cce=e,fce=t;Fu.point(e,t),hce(e,t)}function Xje(){Fu.lineStart()}function Yje(){dce(cce,fce),Fu.lineEnd(),$t(bx)>ze&&(vn=-(Sn=180)),uc[0]=vn,uc[1]=Sn,Lm=null}function Ms(e,t){return(t-=e)<0?t+360:t}function Kje(e,t){return e[0]-t[0]}function sX(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function Zje(e){var t,n,r,i,s,o,a;if(Ls=Sn=-(vn=is=1/0),Vc=[],Nl(e,$l),n=Vc.length){for(Vc.sort(Kje),t=1,r=Vc[0],s=[r];t<n;++t)i=Vc[t],sX(r,i[0])||sX(r,i[1])?(Ms(r[0],i[1])>Ms(r[0],r[1])&&(r[1]=i[1]),Ms(i[0],r[1])>Ms(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,n=s.length-1,t=0,r=s[n];t<=n;r=i,++t)i=s[t],(a=Ms(r[1],i[0]))>o&&(o=a,vn=i[0],Sn=r[1])}return Vc=uc=null,vn===1/0||is===1/0?[[NaN,NaN],[NaN,NaN]]:[[vn,is],[Sn,Ls]]}var Hb,LE,PE,BE,zE,UE,jE,WE,S4,k4,E4,pce,gce,Ii,Di,Ni,ha={sphere:Pr,point:q8,lineStart:oX,lineEnd:aX,polygonStart:function(){ha.lineStart=eWe,ha.lineEnd=tWe},polygonEnd:function(){ha.lineStart=oX,ha.lineEnd=aX}};function q8(e,t){e*=lt,t*=lt;var n=je(t);b$(n*je(e),n*Be(e),Be(t))}function b$(e,t,n){++Hb,PE+=(e-PE)/Hb,BE+=(t-BE)/Hb,zE+=(n-zE)/Hb}function oX(){ha.point=Jje}function Jje(e,t){e*=lt,t*=lt;var n=je(t);Ii=n*je(e),Di=n*Be(e),Ni=Be(t),ha.point=Qje,b$(Ii,Di,Ni)}function Qje(e,t){e*=lt,t*=lt;var n=je(t),r=n*je(e),i=n*Be(e),s=Be(t),o=Io(ji((o=Di*s-Ni*i)*o+(o=Ni*r-Ii*s)*o+(o=Ii*i-Di*r)*o),Ii*r+Di*i+Ni*s);LE+=o,UE+=o*(Ii+(Ii=r)),jE+=o*(Di+(Di=i)),WE+=o*(Ni+(Ni=s)),b$(Ii,Di,Ni)}function aX(){ha.point=q8}function eWe(){ha.point=nWe}function tWe(){mce(pce,gce),ha.point=q8}function nWe(e,t){pce=e,gce=t,e*=lt,t*=lt,ha.point=mce;var n=je(t);Ii=n*je(e),Di=n*Be(e),Ni=Be(t),b$(Ii,Di,Ni)}function mce(e,t){e*=lt,t*=lt;var n=je(t),r=n*je(e),i=n*Be(e),s=Be(t),o=Di*s-Ni*i,a=Ni*r-Ii*s,u=Ii*i-Di*r,l=b4(o,a,u),c=$s(l),f=l&&-c/l;S4.add(f*o),k4.add(f*a),E4.add(f*u),LE+=c,UE+=c*(Ii+(Ii=r)),jE+=c*(Di+(Di=i)),WE+=c*(Ni+(Ni=s)),b$(Ii,Di,Ni)}function rWe(e){Hb=LE=PE=BE=zE=UE=jE=WE=0,S4=new Li,k4=new Li,E4=new Li,Nl(e,ha);var t=+S4,n=+k4,r=+E4,i=b4(t,n,r);return i<TE&&(t=UE,n=jE,r=WE,LE<ze&&(t=PE,n=BE,r=zE),i=b4(t,n,r),i<TE)?[NaN,NaN]:[Io(n,t)*Fn,$s(r/i)*Fn]}function A4(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function _4(e,t){return[$t(e)>ut?e+Math.round(-e/Ui)*Ui:e,t]}_4.invert=_4;function yce(e,t,n){return(e%=Ui)?t||n?A4(lX(e),cX(t,n)):lX(e):t||n?cX(t,n):_4}function uX(e){return function(t,n){return t+=e,[t>ut?t-Ui:t<-ut?t+Ui:t,n]}}function lX(e){var t=uX(e);return t.invert=uX(-e),t}function cX(e,t){var n=je(e),r=Be(e),i=je(t),s=Be(t);function o(a,u){var l=je(u),c=je(a)*l,f=Be(a)*l,h=Be(u),d=h*n+c*r;return[Io(f*i-d*s,c*n-h*r),$s(d*i+f*s)]}return o.invert=function(a,u){var l=je(u),c=je(a)*l,f=Be(a)*l,h=Be(u),d=h*i-f*s;return[Io(f*i+h*s,c*n+d*r),$s(d*n-c*r)]},o}function iWe(e){e=yce(e[0]*lt,e[1]*lt,e.length>2?e[2]*lt:0);function t(n){return n=e(n[0]*lt,n[1]*lt),n[0]*=Fn,n[1]*=Fn,n}return t.invert=function(n){return n=e.invert(n[0]*lt,n[1]*lt),n[0]*=Fn,n[1]*=Fn,n},t}function sWe(e,t,n,r,i,s){if(n){var o=je(t),a=Be(t),u=r*n;i==null?(i=t+r*Ui,s=t-u/2):(i=fX(o,i),s=fX(o,s),(r>0?i<s:i>s)&&(i+=r*Ui));for(var l,c=i;r>0?c>s:c<s;c-=u)l=RE([o,-a*je(c),-a*Be(c)]),e.point(l[0],l[1])}}function fX(e,t){t=Fp(t),t[0]-=e,ME(t);var n=oce(-t[1]);return((-t[2]<0?-n:n)+Ui-ze)%Ui}function bce(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:Pr,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function ik(e,t){return $t(e[0]-t[0])<ze&&$t(e[1]-t[1])<ze}function eS(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function xce(e,t,n,r,i){var s=[],o=[],a,u;if(e.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],y=p[g],b;if(ik(m,y)){if(!m[2]&&!y[2]){for(i.lineStart(),a=0;a<g;++a)i.point((m=p[a])[0],m[1]);i.lineEnd();return}y[0]+=2*ze}s.push(b=new eS(m,p,null,!0)),o.push(b.o=new eS(m,null,b,!1)),s.push(b=new eS(y,p,null,!1)),o.push(b.o=new eS(y,null,b,!0))}}),!!s.length){for(o.sort(t),hX(s),hX(o),a=0,u=o.length;a<u;++a)o[a].e=n=!n;for(var l=s[0],c,f;;){for(var h=l,d=!0;h.v;)if((h=h.n)===l)return;c=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,u=c.length;a<u;++a)i.point((f=c[a])[0],f[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(c=h.p.z,a=c.length-1;a>=0;--a)i.point((f=c[a])[0],f[1]);else r(h.x,h.p.x,-1,i);h=h.p}h=h.o,c=h.z,d=!d}while(!h.v);i.lineEnd()}}}function hX(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function aO(e){return $t(e[0])<=ut?e[0]:mo(e[0])*(($t(e[0])+ut)%Ui-ut)}function oWe(e,t){var n=aO(t),r=t[1],i=Be(r),s=[Be(n),-je(n),0],o=0,a=0,u=new Li;i===1?r=An+ze:i===-1&&(r=-An-ze);for(var l=0,c=e.length;l<c;++l)if(h=(f=e[l]).length)for(var f,h,d=f[h-1],p=aO(d),g=d[1]/2+IE,m=Be(g),y=je(g),b=0;b<h;++b,p=x,m=C,y=$,d=v){var v=f[b],x=aO(v),w=v[1]/2+IE,C=Be(w),$=je(w),S=x-p,k=S>=0?1:-1,E=k*S,A=E>ut,F=m*C;if(u.add(Io(F*k*Be(E),y*$+F*je(E))),o+=A?S+k*Ui:S,A^p>=n^x>=n){var _=b0(Fp(d),Fp(v));ME(_);var I=b0(s,_);ME(I);var T=(A^S>=0?-1:1)*$s(I[2]);(r>T||r===T&&(_[0]||_[1]))&&(a+=A^S>=0?1:-1)}}return(o<-ze||o<ze&&u<-TE)^a&1}function vce(e,t,n,r){return function(i){var s=t(i),o=bce(),a=t(o),u=!1,l,c,f,h={point:d,lineStart:g,lineEnd:m,polygonStart:function(){h.point=y,h.lineStart=b,h.lineEnd=v,c=[],l=[]},polygonEnd:function(){h.point=d,h.lineStart=g,h.lineEnd=m,c=Uie(c);var x=oWe(l,r);c.length?(u||(i.polygonStart(),u=!0),xce(c,uWe,x,n,i)):x&&(u||(i.polygonStart(),u=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),u&&(i.polygonEnd(),u=!1),c=l=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(x,w){e(x,w)&&i.point(x,w)}function p(x,w){s.point(x,w)}function g(){h.point=p,s.lineStart()}function m(){h.point=d,s.lineEnd()}function y(x,w){f.push([x,w]),a.point(x,w)}function b(){a.lineStart(),f=[]}function v(){y(f[0][0],f[0][1]),a.lineEnd();var x=a.clean(),w=o.result(),C,$=w.length,S,k,E;if(f.pop(),l.push(f),f=null,!!$){if(x&1){if(k=w[0],(S=k.length-1)>0){for(u||(i.polygonStart(),u=!0),i.lineStart(),C=0;C<S;++C)i.point((E=k[C])[0],E[1]);i.lineEnd()}return}$>1&&x&2&&w.push(w.pop().concat(w.shift())),c.push(w.filter(aWe))}}return h}}function aWe(e){return e.length>1}function uWe(e,t){return((e=e.x)[0]<0?e[1]-An-ze:An-e[1])-((t=t.x)[0]<0?t[1]-An-ze:An-t[1])}const dX=vce(function(){return!0},lWe,fWe,[-ut,-An]);function lWe(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var a=s>0?ut:-ut,u=$t(s-t);$t(u-ut)<ze?(e.point(t,n=(n+o)/2>0?An:-An),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),i=0):r!==a&&u>=ut&&($t(t-r)<ze&&(t-=r*ze),$t(s-a)<ze&&(s-=a*ze),n=cWe(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=s,n=o),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function cWe(e,t,n,r){var i,s,o=Be(e-n);return $t(o)>ze?hy((Be(t)*(s=je(r))*Be(n)-Be(r)*(i=je(t))*Be(e))/(i*s*o)):(t+r)/2}function fWe(e,t,n,r){var i;if(e==null)i=n*An,r.point(-ut,i),r.point(0,i),r.point(ut,i),r.point(ut,0),r.point(ut,-i),r.point(0,-i),r.point(-ut,-i),r.point(-ut,0),r.point(-ut,i);else if($t(e[0]-t[0])>ze){var s=e[0]<t[0]?ut:-ut;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function hWe(e){var t=je(e),n=6*lt,r=t>0,i=$t(t)>ze;function s(c,f,h,d){sWe(d,e,n,h,c,f)}function o(c,f){return je(c)*je(f)>t}function a(c){var f,h,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(m,y){var b=[m,y],v,x=o(m,y),w=r?x?0:l(m,y):x?l(m+(m<0?ut:-ut),y):0;if(!f&&(p=d=x)&&c.lineStart(),x!==d&&(v=u(f,b),(!v||ik(f,v)||ik(b,v))&&(b[2]=1)),x!==d)g=0,x?(c.lineStart(),v=u(b,f),c.point(v[0],v[1])):(v=u(f,b),c.point(v[0],v[1],2),c.lineEnd()),f=v;else if(i&&f&&r^x){var C;!(w&h)&&(C=u(b,f,!0))&&(g=0,r?(c.lineStart(),c.point(C[0][0],C[0][1]),c.point(C[1][0],C[1][1]),c.lineEnd()):(c.point(C[1][0],C[1][1]),c.lineEnd(),c.lineStart(),c.point(C[0][0],C[0][1],3)))}x&&(!f||!ik(f,b))&&c.point(b[0],b[1]),f=b,d=x,h=w},lineEnd:function(){d&&c.lineEnd(),f=null},clean:function(){return g|(p&&d)<<1}}}function u(c,f,h){var d=Fp(c),p=Fp(f),g=[1,0,0],m=b0(d,p),y=JC(m,m),b=m[0],v=y-b*b;if(!v)return!h&&c;var x=t*y/v,w=-t*b/v,C=b0(g,m),$=QC(g,x),S=QC(m,w);oO($,S);var k=C,E=JC($,k),A=JC(k,k),F=E*E-A*(JC($,$)-1);if(!(F<0)){var _=ji(F),I=QC(k,(-E-_)/A);if(oO(I,$),I=RE(I),!h)return I;var T=c[0],O=f[0],L=c[1],M=f[1],P;O<T&&(P=T,T=O,O=P);var G=O-T,H=$t(G-ut)<ze,Q=H||G<ze;if(!H&&M<L&&(P=L,L=M,M=P),Q?H?L+M>0^I[1]<($t(I[0]-T)<ze?L:M):L<=I[1]&&I[1]<=M:G>ut^(T<=I[0]&&I[0]<=O)){var te=QC(k,(-E+_)/A);return oO(te,$),[I,RE(te)]}}}function l(c,f){var h=r?e:ut-e,d=0;return c<-h?d|=1:c>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return vce(o,a,s,r?[0,-e]:[-ut,e-ut])}function dWe(e,t,n,r,i,s){var o=e[0],a=e[1],u=t[0],l=t[1],c=0,f=1,h=u-o,d=l-a,p;if(p=n-o,!(!h&&p>0)){if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=i-o,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}if(p=r-a,!(!d&&p>0)){if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=s-a,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*h,e[1]=a+c*d),f<1&&(t[0]=o+f*h,t[1]=a+f*d),!0}}}}}var qb=1e9,tS=-qb;function wce(e,t,n,r){function i(l,c){return e<=l&&l<=n&&t<=c&&c<=r}function s(l,c,f,h){var d=0,p=0;if(l==null||(d=o(l,f))!==(p=o(c,f))||u(l,c)<0^f>0)do h.point(d===0||d===3?e:n,d>1?r:t);while((d=(d+f+4)%4)!==p);else h.point(c[0],c[1])}function o(l,c){return $t(l[0]-e)<ze?c>0?0:3:$t(l[0]-n)<ze?c>0?2:1:$t(l[1]-t)<ze?c>0?1:0:c>0?3:2}function a(l,c){return u(l.x,c.x)}function u(l,c){var f=o(l,1),h=o(c,1);return f!==h?f-h:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=bce(),h,d,p,g,m,y,b,v,x,w,C,$={point:S,lineStart:F,lineEnd:_,polygonStart:E,polygonEnd:A};function S(T,O){i(T,O)&&c.point(T,O)}function k(){for(var T=0,O=0,L=d.length;O<L;++O)for(var M=d[O],P=1,G=M.length,H=M[0],Q,te,ne=H[0],oe=H[1];P<G;++P)Q=ne,te=oe,H=M[P],ne=H[0],oe=H[1],te<=r?oe>r&&(ne-Q)*(r-te)>(oe-te)*(e-Q)&&++T:oe<=r&&(ne-Q)*(r-te)<(oe-te)*(e-Q)&&--T;return T}function E(){c=f,h=[],d=[],C=!0}function A(){var T=k(),O=C&&T,L=(h=Uie(h)).length;(O||L)&&(l.polygonStart(),O&&(l.lineStart(),s(null,null,1,l),l.lineEnd()),L&&xce(h,a,T,s,l),l.polygonEnd()),c=l,h=d=p=null}function F(){$.point=I,d&&d.push(p=[]),w=!0,x=!1,b=v=NaN}function _(){h&&(I(g,m),y&&x&&f.rejoin(),h.push(f.result())),$.point=S,x&&c.lineEnd()}function I(T,O){var L=i(T,O);if(d&&p.push([T,O]),w)g=T,m=O,y=L,w=!1,L&&(c.lineStart(),c.point(T,O));else if(L&&x)c.point(T,O);else{var M=[b=Math.max(tS,Math.min(qb,b)),v=Math.max(tS,Math.min(qb,v))],P=[T=Math.max(tS,Math.min(qb,T)),O=Math.max(tS,Math.min(qb,O))];dWe(M,P,e,t,n,r)?(x||(c.lineStart(),c.point(M[0],M[1])),c.point(P[0],P[1]),L||c.lineEnd(),C=!1):L&&(c.lineStart(),c.point(T,O),C=!1)}b=T,v=O,x=L}return $}}function pX(e,t,n){var r=Us(e,t-ze,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function gX(e,t,n){var r=Us(e,t-ze,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function pWe(){var e,t,n,r,i,s,o,a,u=10,l=u,c=90,f=360,h,d,p,g,m=2.5;function y(){return{type:"MultiLineString",coordinates:b()}}function b(){return Us(ZC(r/c)*c,n,c).map(p).concat(Us(ZC(a/f)*f,o,f).map(g)).concat(Us(ZC(t/u)*u,e,u).filter(function(v){return $t(v%c)>ze}).map(h)).concat(Us(ZC(s/l)*l,i,l).filter(function(v){return $t(v%f)>ze}).map(d))}return y.lines=function(){return b().map(function(v){return{type:"LineString",coordinates:v}})},y.outline=function(){return{type:"Polygon",coordinates:[p(r).concat(g(o).slice(1),p(n).reverse().slice(1),g(a).reverse().slice(1))]}},y.extent=function(v){return arguments.length?y.extentMajor(v).extentMinor(v):y.extentMinor()},y.extentMajor=function(v){return arguments.length?(r=+v[0][0],n=+v[1][0],a=+v[0][1],o=+v[1][1],r>n&&(v=r,r=n,n=v),a>o&&(v=a,a=o,o=v),y.precision(m)):[[r,a],[n,o]]},y.extentMinor=function(v){return arguments.length?(t=+v[0][0],e=+v[1][0],s=+v[0][1],i=+v[1][1],t>e&&(v=t,t=e,e=v),s>i&&(v=s,s=i,i=v),y.precision(m)):[[t,s],[e,i]]},y.step=function(v){return arguments.length?y.stepMajor(v).stepMinor(v):y.stepMinor()},y.stepMajor=function(v){return arguments.length?(c=+v[0],f=+v[1],y):[c,f]},y.stepMinor=function(v){return arguments.length?(u=+v[0],l=+v[1],y):[u,l]},y.precision=function(v){return arguments.length?(m=+v,h=pX(s,i,90),d=gX(t,e,m),p=pX(a,o,90),g=gX(r,n,m),y):m},y.extentMajor([[-180,-90+ze],[180,90-ze]]).extentMinor([[-180,-80-ze],[180,80+ze]])}const Pv=e=>e;var uO=new Li,T4=new Li,$ce,Cce,I4,D4,Fl={point:Pr,lineStart:Pr,lineEnd:Pr,polygonStart:function(){Fl.lineStart=gWe,Fl.lineEnd=yWe},polygonEnd:function(){Fl.lineStart=Fl.lineEnd=Fl.point=Pr,uO.add($t(T4)),T4=new Li},result:function(){var e=uO/2;return uO=new Li,e}};function gWe(){Fl.point=mWe}function mWe(e,t){Fl.point=Sce,$ce=I4=e,Cce=D4=t}function Sce(e,t){T4.add(D4*e-I4*t),I4=e,D4=t}function yWe(){Sce($ce,Cce)}var x0=1/0,VE=x0,Bv=-x0,GE=Bv,HE={point:bWe,lineStart:Pr,lineEnd:Pr,polygonStart:Pr,polygonEnd:Pr,result:function(){var e=[[x0,VE],[Bv,GE]];return Bv=GE=-(VE=x0=1/0),e}};function bWe(e,t){e<x0&&(x0=e),e>Bv&&(Bv=e),t<VE&&(VE=t),t>GE&&(GE=t)}var N4=0,F4=0,Xb=0,qE=0,XE=0,Cm=0,O4=0,R4=0,Yb=0,kce,Ece,ru,iu,uo={point:Op,lineStart:mX,lineEnd:yX,polygonStart:function(){uo.lineStart=wWe,uo.lineEnd=$We},polygonEnd:function(){uo.point=Op,uo.lineStart=mX,uo.lineEnd=yX},result:function(){var e=Yb?[O4/Yb,R4/Yb]:Cm?[qE/Cm,XE/Cm]:Xb?[N4/Xb,F4/Xb]:[NaN,NaN];return N4=F4=Xb=qE=XE=Cm=O4=R4=Yb=0,e}};function Op(e,t){N4+=e,F4+=t,++Xb}function mX(){uo.point=xWe}function xWe(e,t){uo.point=vWe,Op(ru=e,iu=t)}function vWe(e,t){var n=e-ru,r=t-iu,i=ji(n*n+r*r);qE+=i*(ru+e)/2,XE+=i*(iu+t)/2,Cm+=i,Op(ru=e,iu=t)}function yX(){uo.point=Op}function wWe(){uo.point=CWe}function $We(){Ace(kce,Ece)}function CWe(e,t){uo.point=Ace,Op(kce=ru=e,Ece=iu=t)}function Ace(e,t){var n=e-ru,r=t-iu,i=ji(n*n+r*r);qE+=i*(ru+e)/2,XE+=i*(iu+t)/2,Cm+=i,i=iu*e-ru*t,O4+=i*(ru+e),R4+=i*(iu+t),Yb+=i*3,Op(ru=e,iu=t)}function _ce(e){this._context=e}_ce.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Ui);break}}},result:Pr};var M4=new Li,lO,Tce,Ice,Kb,Zb,zv={point:Pr,lineStart:function(){zv.point=SWe},lineEnd:function(){lO&&Dce(Tce,Ice),zv.point=Pr},polygonStart:function(){lO=!0},polygonEnd:function(){lO=null},result:function(){var e=+M4;return M4=new Li,e}};function SWe(e,t){zv.point=Dce,Tce=Kb=e,Ice=Zb=t}function Dce(e,t){Kb-=e,Zb-=t,M4.add(ji(Kb*Kb+Zb*Zb)),Kb=e,Zb=t}function Nce(){this._string=[]}Nce.prototype={_radius:4.5,_circle:bX(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=bX(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function bX(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Fce(e,t){var n=4.5,r,i;function s(o){return o&&(typeof n=="function"&&i.pointRadius(+n.apply(this,arguments)),Nl(o,r(i))),i.result()}return s.area=function(o){return Nl(o,r(Fl)),Fl.result()},s.measure=function(o){return Nl(o,r(zv)),zv.result()},s.bounds=function(o){return Nl(o,r(HE)),HE.result()},s.centroid=function(o){return Nl(o,r(uo)),uo.result()},s.projection=function(o){return arguments.length?(r=o==null?(e=null,Pv):(e=o).stream,s):e},s.context=function(o){return arguments.length?(i=o==null?(t=null,new Nce):new _ce(t=o),typeof n!="function"&&i.pointRadius(n),s):t},s.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(i.pointRadius(+o),+o),s):n},s.projection(e).context(t)}function PD(e){return function(t){var n=new L4;for(var r in e)n[r]=e[r];return n.stream=t,n}}function L4(){}L4.prototype={constructor:L4,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function X8(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),Nl(n,e.stream(HE)),t(HE.result()),r!=null&&e.clipExtent(r),e}function BD(e,t,n){return X8(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,u=+t[0][1]+(s-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([a,u])},n)}function Y8(e,t,n){return BD(e,[[0,0],t],n)}function K8(e,t,n){return X8(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];e.scale(150*s).translate([o,a])},n)}function Z8(e,t,n){return X8(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var xX=16,kWe=je(30*lt);function vX(e,t){return+t?AWe(e,t):EWe(e)}function EWe(e){return PD({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function AWe(e,t){function n(r,i,s,o,a,u,l,c,f,h,d,p,g,m){var y=l-r,b=c-i,v=y*y+b*b;if(v>4*t&&g--){var x=o+h,w=a+d,C=u+p,$=ji(x*x+w*w+C*C),S=$s(C/=$),k=$t($t(C)-1)<ze||$t(s-f)<ze?(s+f)/2:Io(w,x),E=e(k,S),A=E[0],F=E[1],_=A-r,I=F-i,T=b*_-y*I;(T*T/v>t||$t((y*_+b*I)/v-.5)>.3||o*h+a*d+u*p<kWe)&&(n(r,i,s,o,a,u,A,F,k,x/=$,w/=$,C,g,m),m.point(A,F),n(A,F,k,x,w,C,l,c,f,h,d,p,g,m))}}return function(r){var i,s,o,a,u,l,c,f,h,d,p,g,m={point:y,lineStart:b,lineEnd:x,polygonStart:function(){r.polygonStart(),m.lineStart=w},polygonEnd:function(){r.polygonEnd(),m.lineStart=b}};function y(S,k){S=e(S,k),r.point(S[0],S[1])}function b(){f=NaN,m.point=v,r.lineStart()}function v(S,k){var E=Fp([S,k]),A=e(S,k);n(f,h,c,d,p,g,f=A[0],h=A[1],c=S,d=E[0],p=E[1],g=E[2],xX,r),r.point(f,h)}function x(){m.point=y,r.lineEnd()}function w(){b(),m.point=C,m.lineEnd=$}function C(S,k){v(i=S,k),s=f,o=h,a=d,u=p,l=g,m.point=v}function $(){n(f,h,c,d,p,g,s,o,i,a,u,l,xX,r),m.lineEnd=x,x()}return m}}var _We=PD({point:function(e,t){this.stream.point(e*lt,t*lt)}});function TWe(e){return PD({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function IWe(e,t,n,r,i){function s(o,a){return o*=r,a*=i,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*r,(n-a)/e*i]},s}function wX(e,t,n,r,i,s){if(!s)return IWe(e,t,n,r,i);var o=je(s),a=Be(s),u=o*e,l=a*e,c=o/e,f=a/e,h=(a*n-o*t)/e,d=(a*t+o*n)/e;function p(g,m){return g*=r,m*=i,[u*g-l*m+t,n-l*g-u*m]}return p.invert=function(g,m){return[r*(c*g-f*m+h),i*(d-f*g-c*m)]},p}function Hu(e){return Oce(function(){return e})()}function Oce(e){var t,n=150,r=480,i=250,s=0,o=0,a=0,u=0,l=0,c,f=0,h=1,d=1,p=null,g=dX,m=null,y,b,v,x=Pv,w=.5,C,$,S,k,E;function A(T){return S(T[0]*lt,T[1]*lt)}function F(T){return T=S.invert(T[0],T[1]),T&&[T[0]*Fn,T[1]*Fn]}A.stream=function(T){return k&&E===T?k:k=_We(TWe(c)(g(C(x(E=T)))))},A.preclip=function(T){return arguments.length?(g=T,p=void 0,I()):g},A.postclip=function(T){return arguments.length?(x=T,m=y=b=v=null,I()):x},A.clipAngle=function(T){return arguments.length?(g=+T?hWe(p=T*lt):(p=null,dX),I()):p*Fn},A.clipExtent=function(T){return arguments.length?(x=T==null?(m=y=b=v=null,Pv):wce(m=+T[0][0],y=+T[0][1],b=+T[1][0],v=+T[1][1]),I()):m==null?null:[[m,y],[b,v]]},A.scale=function(T){return arguments.length?(n=+T,_()):n},A.translate=function(T){return arguments.length?(r=+T[0],i=+T[1],_()):[r,i]},A.center=function(T){return arguments.length?(s=T[0]%360*lt,o=T[1]%360*lt,_()):[s*Fn,o*Fn]},A.rotate=function(T){return arguments.length?(a=T[0]%360*lt,u=T[1]%360*lt,l=T.length>2?T[2]%360*lt:0,_()):[a*Fn,u*Fn,l*Fn]},A.angle=function(T){return arguments.length?(f=T%360*lt,_()):f*Fn},A.reflectX=function(T){return arguments.length?(h=T?-1:1,_()):h<0},A.reflectY=function(T){return arguments.length?(d=T?-1:1,_()):d<0},A.precision=function(T){return arguments.length?(C=vX($,w=T*T),I()):ji(w)},A.fitExtent=function(T,O){return BD(A,T,O)},A.fitSize=function(T,O){return Y8(A,T,O)},A.fitWidth=function(T,O){return K8(A,T,O)},A.fitHeight=function(T,O){return Z8(A,T,O)};function _(){var T=wX(n,0,0,h,d,f).apply(null,t(s,o)),O=wX(n,r-T[0],i-T[1],h,d,f);return c=yce(a,u,l),$=A4(t,O),S=A4(c,$),C=vX($,w),I()}function I(){return k=E=null,A}return function(){return t=e.apply(this,arguments),A.invert=t.invert&&F,_()}}function J8(e){var t=0,n=ut/3,r=Oce(e),i=r(t,n);return i.parallels=function(s){return arguments.length?r(t=s[0]*lt,n=s[1]*lt):[t*Fn,n*Fn]},i}function DWe(e){var t=je(e);function n(r,i){return[r*t,Be(i)/t]}return n.invert=function(r,i){return[r/t,$s(i*t)]},n}function NWe(e,t){var n=Be(e),r=(n+Be(t))/2;if($t(r)<ze)return DWe(e);var i=1+n*(2*r-n),s=ji(i)/r;function o(a,u){var l=ji(i-2*r*Be(u))/r;return[l*Be(a*=r),s-l*je(a)]}return o.invert=function(a,u){var l=s-u,c=Io(a,$t(l))*mo(l);return l*r<0&&(c-=ut*mo(a)*mo(l)),[c/r,$s((i-(a*a+l*l)*r*r)/(2*r))]},o}function YE(){return J8(NWe).scale(155.424).center([0,33.6442])}function Rce(){return YE().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function FWe(e){var t=e.length;return{point:function(n,r){for(var i=-1;++i<t;)e[i].point(n,r)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function OWe(){var e,t,n=Rce(),r,i=YE().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=YE().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,l={point:function(h,d){u=[h,d]}};function c(h){var d=h[0],p=h[1];return u=null,r.point(d,p),u||(s.point(d,p),u)||(a.point(d,p),u)}c.invert=function(h){var d=n.scale(),p=n.translate(),g=(h[0]-p[0])/d,m=(h[1]-p[1])/d;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?i:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(h)},c.stream=function(h){return e&&t===h?e:e=FWe([n.stream(t=h),i.stream(h),o.stream(h)])},c.precision=function(h){return arguments.length?(n.precision(h),i.precision(h),o.precision(h),f()):n.precision()},c.scale=function(h){return arguments.length?(n.scale(h),i.scale(h*.35),o.scale(h),c.translate(n.translate())):n.scale()},c.translate=function(h){if(!arguments.length)return n.translate();var d=n.scale(),p=+h[0],g=+h[1];return r=n.translate(h).clipExtent([[p-.455*d,g-.238*d],[p+.455*d,g+.238*d]]).stream(l),s=i.translate([p-.307*d,g+.201*d]).clipExtent([[p-.425*d+ze,g+.12*d+ze],[p-.214*d-ze,g+.234*d-ze]]).stream(l),a=o.translate([p-.205*d,g+.212*d]).clipExtent([[p-.214*d+ze,g+.166*d+ze],[p-.115*d-ze,g+.234*d-ze]]).stream(l),f()},c.fitExtent=function(h,d){return BD(c,h,d)},c.fitSize=function(h,d){return Y8(c,h,d)},c.fitWidth=function(h,d){return K8(c,h,d)},c.fitHeight=function(h,d){return Z8(c,h,d)};function f(){return e=t=null,c}return c.scale(1070)}function Mce(e){return function(t,n){var r=je(t),i=je(n),s=e(r*i);return s===1/0?[2,0]:[s*i*Be(t),s*Be(n)]}}function x$(e){return function(t,n){var r=ji(t*t+n*n),i=e(r),s=Be(i),o=je(i);return[Io(t*s,r*o),$s(r&&n*s/r)]}}var Lce=Mce(function(e){return ji(2/(1+e))});Lce.invert=x$(function(e){return 2*$s(e/2)});function RWe(){return Hu(Lce).scale(124.75).clipAngle(180-.001)}var Pce=Mce(function(e){return(e=oce(e))&&e/Be(e)});Pce.invert=x$(function(e){return e});function MWe(){return Hu(Pce).scale(79.4188).clipAngle(180-.001)}function zD(e,t){return[e,DE(H8((An+t)/2))]}zD.invert=function(e,t){return[e,2*hy(sce(t))-An]};function LWe(){return Bce(zD).scale(961/Ui)}function Bce(e){var t=Hu(e),n=t.center,r=t.scale,i=t.translate,s=t.clipExtent,o=null,a,u,l;t.scale=function(f){return arguments.length?(r(f),c()):r()},t.translate=function(f){return arguments.length?(i(f),c()):i()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=a=u=l=null:(o=+f[0][0],a=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):o==null?null:[[o,a],[u,l]]};function c(){var f=ut*r(),h=t(iWe(t.rotate()).invert([0,0]));return s(o==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===zD?[[Math.max(h[0]-f,o),a],[Math.min(h[0]+f,u),l]]:[[o,Math.max(h[1]-f,a)],[u,Math.min(h[1]+f,l)]])}return c()}function nS(e){return H8((An+e)/2)}function PWe(e,t){var n=je(e),r=e===t?Be(e):DE(n/je(t))/DE(nS(t)/nS(e)),i=n*sO(nS(e),r)/r;if(!r)return zD;function s(o,a){i>0?a<-An+ze&&(a=-An+ze):a>An-ze&&(a=An-ze);var u=i/sO(nS(a),r);return[u*Be(r*o),i-u*je(r*o)]}return s.invert=function(o,a){var u=i-a,l=mo(r)*ji(o*o+u*u),c=Io(o,$t(u))*mo(u);return u*r<0&&(c-=ut*mo(o)*mo(u)),[c/r,2*hy(sO(i/l,1/r))-An]},s}function BWe(){return J8(PWe).scale(109.5).parallels([30,30])}function KE(e,t){return[e,t]}KE.invert=KE;function zWe(){return Hu(KE).scale(152.63)}function UWe(e,t){var n=je(e),r=e===t?Be(e):(n-je(t))/(t-e),i=n/r+e;if($t(r)<ze)return KE;function s(o,a){var u=i-a,l=r*o;return[u*Be(l),i-u*je(l)]}return s.invert=function(o,a){var u=i-a,l=Io(o,$t(u))*mo(u);return u*r<0&&(l-=ut*mo(o)*mo(u)),[l/r,i-mo(r)*ji(o*o+u*u)]},s}function jWe(){return J8(UWe).scale(131.154).center([0,13.9389])}var xx=1.340264,vx=-.081106,wx=893e-6,$x=.003796,ZE=ji(3)/2,WWe=12;function zce(e,t){var n=$s(ZE*Be(t)),r=n*n,i=r*r*r;return[e*je(n)/(ZE*(xx+3*vx*r+i*(7*wx+9*$x*r))),n*(xx+vx*r+i*(wx+$x*r))]}zce.invert=function(e,t){for(var n=t,r=n*n,i=r*r*r,s=0,o,a,u;s<WWe&&(a=n*(xx+vx*r+i*(wx+$x*r))-t,u=xx+3*vx*r+i*(7*wx+9*$x*r),n-=o=a/u,r=n*n,i=r*r*r,!($t(o)<TE));++s);return[ZE*e*(xx+3*vx*r+i*(7*wx+9*$x*r))/je(n),$s(Be(n)/ZE)]};function VWe(){return Hu(zce).scale(177.158)}function Uce(e,t){var n=je(t),r=je(e)*n;return[n*Be(e)/r,Be(t)/r]}Uce.invert=x$(hy);function GWe(){return Hu(Uce).scale(144.049).clipAngle(60)}function HWe(){var e=1,t=0,n=0,r=1,i=1,s=0,o,a,u=null,l,c,f,h=1,d=1,p=PD({point:function(x,w){var C=v([x,w]);this.stream.point(C[0],C[1])}}),g=Pv,m,y;function b(){return h=e*r,d=e*i,m=y=null,v}function v(x){var w=x[0]*h,C=x[1]*d;if(s){var $=C*o-w*a;w=w*o+C*a,C=$}return[w+t,C+n]}return v.invert=function(x){var w=x[0]-t,C=x[1]-n;if(s){var $=C*o+w*a;w=w*o-C*a,C=$}return[w/h,C/d]},v.stream=function(x){return m&&y===x?m:m=p(g(y=x))},v.postclip=function(x){return arguments.length?(g=x,u=l=c=f=null,b()):g},v.clipExtent=function(x){return arguments.length?(g=x==null?(u=l=c=f=null,Pv):wce(u=+x[0][0],l=+x[0][1],c=+x[1][0],f=+x[1][1]),b()):u==null?null:[[u,l],[c,f]]},v.scale=function(x){return arguments.length?(e=+x,b()):e},v.translate=function(x){return arguments.length?(t=+x[0],n=+x[1],b()):[t,n]},v.angle=function(x){return arguments.length?(s=x%360*lt,a=Be(s),o=je(s),b()):s*Fn},v.reflectX=function(x){return arguments.length?(r=x?-1:1,b()):r<0},v.reflectY=function(x){return arguments.length?(i=x?-1:1,b()):i<0},v.fitExtent=function(x,w){return BD(v,x,w)},v.fitSize=function(x,w){return Y8(v,x,w)},v.fitWidth=function(x,w){return K8(v,x,w)},v.fitHeight=function(x,w){return Z8(v,x,w)},v}function jce(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),t*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}jce.invert=function(e,t){var n=t,r=25,i;do{var s=n*n,o=s*s;n-=i=(n*(1.007226+s*(.015085+o*(-.044475+.028874*s-.005916*o)))-t)/(1.007226+s*(.015085*3+o*(-.044475*7+.028874*9*s-.005916*11*o)))}while($t(i)>ze&&--r>0);return[e/(.8707+(s=n*n)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),n]};function qWe(){return Hu(jce).scale(175.295)}function Wce(e,t){return[je(t)*Be(e),Be(t)]}Wce.invert=x$($s);function XWe(){return Hu(Wce).scale(249.5).clipAngle(90+ze)}function Vce(e,t){var n=je(t),r=1+je(e)*n;return[n*Be(e)/r,Be(t)/r]}Vce.invert=x$(function(e){return 2*hy(e)});function YWe(){return Hu(Vce).scale(250).clipAngle(142)}function Gce(e,t){return[DE(H8((An+t)/2)),-e]}Gce.invert=function(e,t){return[-t,2*hy(sce(e))-An]};function KWe(){var e=Bce(Gce),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}var ZWe=Math.abs,P4=Math.cos,JE=Math.sin,JWe=1e-6,Hce=Math.PI,B4=Hce/2,$X=QWe(2);function CX(e){return e>1?B4:e<-1?-B4:Math.asin(e)}function QWe(e){return e>0?Math.sqrt(e):0}function eVe(e,t){var n=e*JE(t),r=30,i;do t-=i=(t+JE(t)-n)/(1+P4(t));while(ZWe(i)>JWe&&--r>0);return t/2}function tVe(e,t,n){function r(i,s){return[e*i*P4(s=eVe(n,s)),t*JE(s)]}return r.invert=function(i,s){return s=CX(s/t),[i/(e*P4(s)),CX((2*s+JE(2*s))/n)]},r}var nVe=tVe($X/B4,$X,Hce);function rVe(){return Hu(nVe).scale(169.529)}const iVe=Fce(),z4=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function sVe(e,t){return function n(){const r=t();return r.type=e,r.path=Fce().projection(r),r.copy=r.copy||function(){const i=n();return z4.forEach(s=>{r[s]&&i[s](r[s]())}),i.path.pointRadius(r.path.pointRadius()),i},r}}function Q8(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(QE[e]=sVe(e,t),this):QE[e]||null}function qce(e){return e&&e.path||iVe}const QE={albers:Rce,albersusa:OWe,azimuthalequalarea:RWe,azimuthalequidistant:MWe,conicconformal:BWe,conicequalarea:YE,conicequidistant:jWe,equalEarth:VWe,equirectangular:zWe,gnomonic:GWe,identity:HWe,mercator:LWe,mollweide:rVe,naturalEarth1:qWe,orthographic:XWe,stereographic:YWe,transversemercator:KWe};for(const e in QE)Q8(e,QE[e]);function oVe(){}const pl=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Xce(){var e=1,t=1,n=a;function r(u,l){return l.map(c=>i(u,c))}function i(u,l){var c=[],f=[];return s(u,l,h=>{n(h,u,l),aVe(h)>0?c.push([h]):f.push(h)}),f.forEach(h=>{for(var d=0,p=c.length,g;d<p;++d)if(uVe((g=c[d])[0],h)!==-1){g.push(h);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function s(u,l,c){var f=new Array,h=new Array,d,p,g,m,y,b;for(d=p=-1,m=u[0]>=l,pl[m<<1].forEach(v);++d<e-1;)g=m,m=u[d+1]>=l,pl[g|m<<1].forEach(v);for(pl[m<<0].forEach(v);++p<t-1;){for(d=-1,m=u[p*e+e]>=l,y=u[p*e]>=l,pl[m<<1|y<<2].forEach(v);++d<e-1;)g=m,m=u[p*e+e+d+1]>=l,b=y,y=u[p*e+d+1]>=l,pl[g|m<<1|y<<2|b<<3].forEach(v);pl[m|y<<3].forEach(v)}for(d=-1,y=u[p*e]>=l,pl[y<<2].forEach(v);++d<e-1;)b=y,y=u[p*e+d+1]>=l,pl[y<<2|b<<3].forEach(v);pl[y<<3].forEach(v);function v(x){var w=[x[0][0]+d,x[0][1]+p],C=[x[1][0]+d,x[1][1]+p],$=o(w),S=o(C),k,E;(k=h[$])?(E=f[S])?(delete h[k.end],delete f[E.start],k===E?(k.ring.push(C),c(k.ring)):f[k.start]=h[E.end]={start:k.start,end:E.end,ring:k.ring.concat(E.ring)}):(delete h[k.end],k.ring.push(C),h[k.end=S]=k):(k=f[S])?(E=h[$])?(delete f[k.start],delete h[E.end],k===E?(k.ring.push(C),c(k.ring)):f[E.start]=h[k.end]={start:E.start,end:k.end,ring:E.ring.concat(k.ring)}):(delete f[k.start],k.ring.unshift(w),f[k.start=$]=k):f[$]=h[S]={start:$,end:S,ring:[w,C]}}}function o(u){return u[0]*2+u[1]*(e+1)*4}function a(u,l,c){u.forEach(f=>{var h=f[0],d=f[1],p=h|0,g=d|0,m,y=l[g*e+p];h>0&&h<e&&p===h&&(m=l[g*e+p-1],f[0]=h+(c-m)/(y-m)-.5),d>0&&d<t&&g===d&&(m=l[(g-1)*e+p],f[1]=d+(c-m)/(y-m)-.5)})}return r.contour=i,r.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||ae("invalid size"),e=l,t=c,r},r.smooth=function(u){return arguments.length?(n=u?a:oVe,r):n===a},r}function aVe(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}function uVe(e,t){for(var n=-1,r=t.length,i;++n<r;)if(i=lVe(e,t[n]))return i;return 0}function lVe(e,t){for(var n=t[0],r=t[1],i=-1,s=0,o=e.length,a=o-1;s<o;a=s++){var u=e[s],l=u[0],c=u[1],f=e[a],h=f[0],d=f[1];if(cVe(u,f,t))return 0;c>r!=d>r&&n<(h-l)*(r-c)/(d-c)+l&&(i=-i)}return i}function cVe(e,t,n){var r;return fVe(e,t,n)&&hVe(e[r=+(e[0]===t[0])],n[r],t[r])}function fVe(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function hVe(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function Yce(e,t,n){return function(r){var i=Pf(r),s=n?Math.min(i[0],0):i[0],o=i[1],a=o-s,u=t?Wf(s,o,e):a/(e+1);return Us(s+u,o,u)}}function e7(e){ee.call(this,null,e)}e7.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};ye(e7,ee,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||Ao,s=Xce().smooth(e.smooth!==!1),o=e.thresholds||dVe(r,i,e),a=e.as===null?null:e.as||"contour",u=[];return r.forEach(l=>{const c=i(l),f=s.size([c.width,c.height])(c.values,rt(o)?o:o(c.values));pVe(f,c,l,e),f.forEach(h=>{u.push(UI(l,Nt(a!=null?{[a]:h}:h)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function dVe(e,t,n){const r=Yce(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?r:r(e.map(i=>Zd(t(i).values)))}function pVe(e,t,n,r){let i=r.scale||t.scale,s=r.translate||t.translate;if(Pt(i)&&(i=i(n,r)),Pt(s)&&(s=s(n,r)),(i===1||i==null)&&!s)return;const o=(wp(i)?i:i[0])||1,a=(wp(i)?i:i[1])||1,u=s&&s[0]||0,l=s&&s[1]||0;e.forEach(Kce(t,o,a,u,l))}function Kce(e,t,n,r,i){const s=e.x1||0,o=e.y1||0,a=t*n<0;function u(f){f.forEach(l)}function l(f){a&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-s)*t+r,f[1]=(f[1]-o)*n+i}return function(f){return f.coordinates.forEach(u),f}}function SX(e,t,n){const r=e>=0?e:h6(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function cO(e){return Pt(e)?e:_o(+e)}function Zce(){var e=u=>u[0],t=u=>u[1],n=Y1,r=[-1,-1],i=960,s=500,o=2;function a(u,l){const c=SX(r[0],u,e)>>o,f=SX(r[1],u,t)>>o,h=c?c+2:0,d=f?f+2:0,p=2*h+(i>>o),g=2*d+(s>>o),m=new Float32Array(p*g),y=new Float32Array(p*g);let b=m;u.forEach(x=>{const w=h+(+e(x)>>o),C=d+(+t(x)>>o);w>=0&&w<p&&C>=0&&C<g&&(m[w+C*p]+=+n(x))}),c>0&&f>0?(sm(p,g,m,y,c),om(p,g,y,m,f),sm(p,g,m,y,c),om(p,g,y,m,f),sm(p,g,m,y,c),om(p,g,y,m,f)):c>0?(sm(p,g,m,y,c),sm(p,g,y,m,c),sm(p,g,m,y,c),b=y):f>0&&(om(p,g,m,y,f),om(p,g,y,m,f),om(p,g,m,y,f),b=y);const v=l?Math.pow(2,-2*o):1/jie(b);for(let x=0,w=p*g;x<w;++x)b[x]*=v;return{values:b,scale:1<<o,width:p,height:g,x1:h,y1:d,x2:h+(i>>o),y2:d+(s>>o)}}return a.x=function(u){return arguments.length?(e=cO(u),a):e},a.y=function(u){return arguments.length?(t=cO(u),a):t},a.weight=function(u){return arguments.length?(n=cO(u),a):n},a.size=function(u){if(!arguments.length)return[i,s];var l=+u[0],c=+u[1];return l>=0&&c>=0||ae("invalid size"),i=l,s=c,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||ae("invalid cell size"),o=Math.floor(Math.log(u)/Math.LN2),a):1<<o},a.bandwidth=function(u){return arguments.length?(u=Qe(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&ae("invalid bandwidth"),r=u,a):r},a}function sm(e,t,n,r,i){const s=(i<<1)+1;for(let o=0;o<t;++o)for(let a=0,u=0;a<e+i;++a)a<e&&(u+=n[a+o*e]),a>=i&&(a>=s&&(u-=n[a-s+o*e]),r[a-i+o*e]=u/Math.min(a+1,e-1+s-a,s))}function om(e,t,n,r,i){const s=(i<<1)+1;for(let o=0;o<e;++o)for(let a=0,u=0;a<t+i;++a)a<t&&(u+=n[o+a*e]),a>=i&&(a>=s&&(u-=n[o+(a-s)*e]),r[o+(a-i)*e]=u/Math.min(a+1,t-1+s-a,s))}function t7(e){ee.call(this,null,e)}t7.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const gVe=["x","y","weight","size","cellSize","bandwidth"];function Jce(e,t){return gVe.forEach(n=>t[n]!=null?e[n](t[n]):0),e}ye(t7,ee,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=mVe(r,e.groupby),s=(e.groupby||[]).map(_n),o=Jce(Zce(),e),a=e.as||"grid",u=[];function l(c,f){for(let h=0;h<s.length;++h)c[s[h]]=f[h];return c}return u=i.map(c=>Nt(l({[a]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function mVe(e,t){var n=[],r=c=>c(a),i,s,o,a,u,l;if(t==null)n.push(e);else for(i={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(r),l=i[u],l||(i[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function n7(e){ee.call(this,null,e)}n7.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};ye(n7,ee,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=Xce().smooth(e.smooth!==!1),i=e.values,s=e.thresholds||Yce(e.count||10,e.nice,!!i),o=e.size,a,u;return i||(i=t.materialize(t.SOURCE).source,a=Jce(Zce(),e)(i,!0),u=Kce(a,a.scale||1,a.scale||1,0,0),o=[a.width,a.height],i=a.values),s=rt(s)?s:s(i),i=r.size(o)(i,s),u&&i.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(i||[]).map(Nt),n}});const U4="Feature",r7="FeatureCollection",yVe="MultiPoint";function i7(e){ee.call(this,null,e)}i7.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};ye(i7,ee,{transform(e,t){var n=this._features,r=this._points,i=e.fields,s=i&&i[0],o=i&&i[1],a=e.geojson||!i&&Ao,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(pi(a))||s&&t.modified(pi(s))||o&&t.modified(pi(o)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=r=[]),a&&t.visit(u,c=>n.push(a(c))),s&&o&&(t.visit(u,c=>{var f=s(c),h=o(c);f!=null&&h!=null&&(f=+f)===f&&(h=+h)===h&&r.push([f,h])}),n=n.concat({type:U4,geometry:{type:yVe,coordinates:r}})),this.value={type:r7,features:n}}});function s7(e){ee.call(this,null,e)}s7.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};ye(s7,ee,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Ao,s=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=qce(e.projection),n.materialize().reflow()):o=i===Ao||t.modified(i.fields)?n.ADD_MOD:n.ADD;const a=bVe(r,e.pointRadius);return n.visit(o,u=>u[s]=r(i(u))),r.pointRadius(a),n.modifies(s)}});function bVe(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function o7(e){ee.call(this,null,e)}o7.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};ye(o7,ee,{transform(e,t){var n=e.projection,r=e.fields[0],i=e.fields[1],s=e.as||["x","y"],o=s[0],a=s[1],u;function l(c){const f=n([r(c),i(c)]);f?(c[o]=f[0],c[a]=f[1]):(c[o]=void 0,c[a]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(r.fields)||t.modified(i.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(s)}});function a7(e){ee.call(this,null,e)}a7.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};ye(a7,ee,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",s=n.ADD;return(!r||e.modified())&&(this.value=r=xVe(qce(e.projection),e.field||Mf("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,o=>o[i]=r),n.modifies(i)}});function xVe(e,t,n){const r=n==null?i=>e(t(i)):i=>{var s=e.pointRadius(),o=e.pointRadius(n)(t(i));return e.pointRadius(s),o};return r.context=i=>(e.context(i),r),r}function u7(e){ee.call(this,[],e),this.generator=pWe()}u7.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};ye(u7,ee,{transform(e,t){var n=this.value,r=this.generator,i;if(!n.length||e.modified())for(const s in e)Pt(r[s])&&r[s](e[s]);return i=r(),n.length?t.mod.push(Tie(n[0],i)):t.add.push(Nt(i)),n[0]=i,t}});function l7(e){ee.call(this,null,e)}l7.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};ye(l7,ee,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||Ao,s=wVe(e.opacity,e),o=vVe(e.color,e),a=e.as||"image",u={$x:0,$y:0,$value:0,$max:r?Zd(n.map(l=>Zd(i(l).values))):0};return n.forEach(l=>{const c=i(l),f=pt({},l,u);r||(f.$max=Zd(c.values||[])),l[a]=$Ve(c,f,o.dep?o:_o(o(f)),s.dep?s:_o(s(f)))}),t.reflow(!0).modifies(a)}});function vVe(e,t){let n;return Pt(e)?(n=r=>ws(e(r,t)),n.dep=Qce(e)):n=_o(ws(e||"#888")),n}function wVe(e,t){let n;return Pt(e)?(n=r=>e(r,t),n.dep=Qce(e)):e?n=_o(e):(n=r=>r.$value/r.$max||0,n.dep=!0),n}function Qce(e){if(!Pt(e))return!1;const t=ic(pi(e));return t.$x||t.$y||t.$value||t.$max}function $Ve(e,t,n,r){const i=e.width,s=e.height,o=e.x1||0,a=e.y1||0,u=e.x2||i,l=e.y2||s,c=e.values,f=c?m=>c[m]:Yc,h=xc(u-o,l-a),d=h.getContext("2d"),p=d.getImageData(0,0,u-o,l-a),g=p.data;for(let m=a,y=0;m<l;++m){t.$y=m-a;for(let b=o,v=m*i;b<u;++b,y+=4){t.$x=b-o,t.$value=f(b+v);const x=n(t);g[y+0]=x.r,g[y+1]=x.g,g[y+2]=x.b,g[y+3]=~~(255*r(t))}}return d.putImageData(p,0,0),h}function efe(e){ee.call(this,null,e),this.modified(!0)}ye(efe,ee,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=SVe(e.type),z4.forEach(r=>{e[r]!=null&&kX(n,r,e[r])})):z4.forEach(r=>{e.modified(r)&&kX(n,r,e[r])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&CVe(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function CVe(e,t){const n=kVe(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function SVe(e){const t=Q8((e||"mercator").toLowerCase());return t||ae("Unrecognized projection type: "+e),t()}function kX(e,t,n){Pt(e[t])&&e[t](n)}function kVe(e){return e=Qe(e),e.length===1?e[0]:{type:r7,features:e.reduce((t,n)=>t.concat(EVe(n)),[])}}function EVe(e){return e.type===r7?e.features:Qe(e).filter(t=>t!=null).map(t=>t.type===U4?t:{type:U4,geometry:t})}const AVe=Object.freeze(Object.defineProperty({__proto__:null,contour:n7,geojson:i7,geopath:s7,geopoint:o7,geoshape:a7,graticule:u7,heatmap:l7,isocontour:e7,kde2d:t7,projection:efe},Symbol.toStringTag,{value:"Module"}));function _Ve(e,t){var n,r=1;e==null&&(e=0),t==null&&(t=0);function i(){var s,o=n.length,a,u=0,l=0;for(s=0;s<o;++s)a=n[s],u+=a.x,l+=a.y;for(u=(u/o-e)*r,l=(l/o-t)*r,s=0;s<o;++s)a=n[s],a.x-=u,a.y-=l}return i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(e=+s,i):e},i.y=function(s){return arguments.length?(t=+s,i):t},i.strength=function(s){return arguments.length?(r=+s,i):r},i}function TVe(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return tfe(this.cover(t,n),t,n,e)}function tfe(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s=e._root,o={data:r},a=e._x0,u=e._y0,l=e._x1,c=e._y1,f,h,d,p,g,m,y,b;if(!s)return e._root=o,e;for(;s.length;)if((g=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(h=(u+c)/2))?u=h:c=h,i=s,!(s=s[y=m<<1|g]))return i[y]=o,e;if(d=+e._x.call(null,s.data),p=+e._y.call(null,s.data),t===d&&n===p)return o.next=s,i?i[y]=o:e._root=o,e;do i=i?i[y]=new Array(4):e._root=new Array(4),(g=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(h=(u+c)/2))?u=h:c=h;while((y=m<<1|g)===(b=(p>=h)<<1|d>=f));return i[b]=s,i[y]=o,e}function IVe(e){var t,n,r=e.length,i,s,o=new Array(r),a=new Array(r),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(s=+this._y.call(null,t))||(o[n]=i,a[n]=s,i<u&&(u=i),i>c&&(c=i),s<l&&(l=s),s>f&&(f=s));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<r;++n)tfe(this,o[n],a[n],e[n]);return this}function DVe(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var o=i-n||1,a=this._root,u,l;n>e||e>=i||r>t||t>=s;)switch(l=(t<r)<<1|e<n,u=new Array(4),u[l]=a,a=u,o*=2,l){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function NVe(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function FVe(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Ri(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function OVe(e,t,n){var r,i=this._x0,s=this._y0,o,a,u,l,c=this._x1,f=this._y1,h=[],d=this._root,p,g;for(d&&h.push(new Ri(d,i,s,c,f)),n==null?n=1/0:(i=e-n,s=t-n,c=e+n,f=t+n,n*=n);p=h.pop();)if(!(!(d=p.node)||(o=p.x0)>c||(a=p.y0)>f||(u=p.x1)<i||(l=p.y1)<s))if(d.length){var m=(o+u)/2,y=(a+l)/2;h.push(new Ri(d[3],m,y,u,l),new Ri(d[2],o,y,m,l),new Ri(d[1],m,a,u,y),new Ri(d[0],o,a,m,y)),(g=(t>=y)<<1|e>=m)&&(p=h[h.length-1],h[h.length-1]=h[h.length-1-g],h[h.length-1-g]=p)}else{var b=e-+this._x.call(null,d.data),v=t-+this._y.call(null,d.data),x=b*b+v*v;if(x<n){var w=Math.sqrt(n=x);i=e-w,s=t-w,c=e+w,f=t+w,r=d.data}}return r}function RVe(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,r,i,s,o=this._x0,a=this._y0,u=this._x1,l=this._y1,c,f,h,d,p,g,m,y;if(!n)return this;if(n.length)for(;;){if((p=c>=(h=(o+u)/2))?o=h:u=h,(g=f>=(d=(a+l)/2))?a=d:l=d,t=n,!(n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(r=t,y=m)}for(;n.data!==e;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):t?(s?t[m]=s:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(r?r[y]=n:this._root=n),this):(this._root=s,this)}function MVe(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function LVe(){return this._root}function PVe(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function BVe(e){var t=[],n,r=this._root,i,s,o,a,u;for(r&&t.push(new Ri(r,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(r=n.node,s=n.x0,o=n.y0,a=n.x1,u=n.y1)&&r.length){var l=(s+a)/2,c=(o+u)/2;(i=r[3])&&t.push(new Ri(i,l,c,a,u)),(i=r[2])&&t.push(new Ri(i,s,c,l,u)),(i=r[1])&&t.push(new Ri(i,l,o,a,c)),(i=r[0])&&t.push(new Ri(i,s,o,l,c))}return this}function zVe(e){var t=[],n=[],r;for(this._root&&t.push(new Ri(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,u=r.x1,l=r.y1,c=(o+u)/2,f=(a+l)/2;(s=i[0])&&t.push(new Ri(s,o,a,c,f)),(s=i[1])&&t.push(new Ri(s,c,a,u,f)),(s=i[2])&&t.push(new Ri(s,o,f,c,l)),(s=i[3])&&t.push(new Ri(s,c,f,u,l))}n.push(r)}for(;r=n.pop();)e(r.node,r.x0,r.y0,r.x1,r.y1);return this}function UVe(e){return e[0]}function jVe(e){return arguments.length?(this._x=e,this):this._x}function WVe(e){return e[1]}function VVe(e){return arguments.length?(this._y=e,this):this._y}function c7(e,t,n){var r=new f7(t??UVe,n??WVe,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function f7(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function EX(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var Xi=c7.prototype=f7.prototype;Xi.copy=function(){var e=new f7(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=EX(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var i=0;i<4;++i)(r=t.source[i])&&(r.length?n.push({source:r,target:t.target[i]=new Array(4)}):t.target[i]=EX(r));return e};Xi.add=TVe;Xi.addAll=IVe;Xi.cover=DVe;Xi.data=NVe;Xi.extent=FVe;Xi.find=OVe;Xi.remove=RVe;Xi.removeAll=MVe;Xi.root=LVe;Xi.size=PVe;Xi.visit=BVe;Xi.visitAfter=zVe;Xi.x=jVe;Xi.y=VVe;function Mi(e){return function(){return e}}function rf(e){return(e()-.5)*1e-6}function GVe(e){return e.x+e.vx}function HVe(e){return e.y+e.vy}function qVe(e){var t,n,r,i=1,s=1;typeof e!="function"&&(e=Mi(e==null?1:+e));function o(){for(var l,c=t.length,f,h,d,p,g,m,y=0;y<s;++y)for(f=c7(t,GVe,HVe).visitAfter(a),l=0;l<c;++l)h=t[l],g=n[h.index],m=g*g,d=h.x+h.vx,p=h.y+h.vy,f.visit(b);function b(v,x,w,C,$){var S=v.data,k=v.r,E=g+k;if(S){if(S.index>h.index){var A=d-S.x-S.vx,F=p-S.y-S.vy,_=A*A+F*F;_<E*E&&(A===0&&(A=rf(r),_+=A*A),F===0&&(F=rf(r),_+=F*F),_=(E-(_=Math.sqrt(_)))/_*i,h.vx+=(A*=_)*(E=(k*=k)/(m+k)),h.vy+=(F*=_)*E,S.vx-=A*(E=1-E),S.vy-=F*E)}return}return x>d+E||C<d-E||w>p+E||$<p-E}}function a(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return o.initialize=function(l,c){t=l,r=c,u()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(i=+l,o):i},o.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Mi(+l),u(),o):e},o}function XVe(e){return e.index}function AX(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function YVe(e){var t=XVe,n=f,r,i=Mi(30),s,o,a,u,l,c=1;e==null&&(e=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function h(m){for(var y=0,b=e.length;y<c;++y)for(var v=0,x,w,C,$,S,k,E;v<b;++v)x=e[v],w=x.source,C=x.target,$=C.x+C.vx-w.x-w.vx||rf(l),S=C.y+C.vy-w.y-w.vy||rf(l),k=Math.sqrt($*$+S*S),k=(k-s[v])/k*m*r[v],$*=k,S*=k,C.vx-=$*(E=u[v]),C.vy-=S*E,w.vx+=$*(E=1-E),w.vy+=S*E}function d(){if(o){var m,y=o.length,b=e.length,v=new Map(o.map((w,C)=>[t(w,C,o),w])),x;for(m=0,a=new Array(y);m<b;++m)x=e[m],x.index=m,typeof x.source!="object"&&(x.source=AX(v,x.source)),typeof x.target!="object"&&(x.target=AX(v,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(m=0,u=new Array(b);m<b;++m)x=e[m],u[m]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);r=new Array(b),p(),s=new Array(b),g()}}function p(){if(o)for(var m=0,y=e.length;m<y;++m)r[m]=+n(e[m],m,e)}function g(){if(o)for(var m=0,y=e.length;m<y;++m)s[m]=+i(e[m],m,e)}return h.initialize=function(m,y){o=m,l=y,d()},h.links=function(m){return arguments.length?(e=m,d(),h):e},h.id=function(m){return arguments.length?(t=m,h):t},h.iterations=function(m){return arguments.length?(c=+m,h):c},h.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Mi(+m),p(),h):n},h.distance=function(m){return arguments.length?(i=typeof m=="function"?m:Mi(+m),g(),h):i},h}var KVe={value:()=>{}};function nfe(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new sk(n)}function sk(e){this._=e}function ZVe(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}sk.prototype=nfe.prototype={constructor:sk,on:function(e,t){var n=this._,r=ZVe(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=JVe(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=_X(n[i],e.name,t);else if(t==null)for(i in n)n[i]=_X(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new sk(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function JVe(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function _X(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=KVe,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var v0=0,Jb=0,pb=0,rfe=1e3,eA,Qb,tA=0,Rp=0,UD=0,Uv=typeof performance=="object"&&performance.now?performance:Date,ife=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function h7(){return Rp||(ife(QVe),Rp=Uv.now()+UD)}function QVe(){Rp=0}function nA(){this._call=this._time=this._next=null}nA.prototype=sfe.prototype={constructor:nA,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?h7():+n)+(t==null?0:+t),!this._next&&Qb!==this&&(Qb?Qb._next=this:eA=this,Qb=this),this._call=e,this._time=n,j4()},stop:function(){this._call&&(this._call=null,this._time=1/0,j4())}};function sfe(e,t,n){var r=new nA;return r.restart(e,t,n),r}function eGe(){h7(),++v0;for(var e=eA,t;e;)(t=Rp-e._time)>=0&&e._call.call(null,t),e=e._next;--v0}function TX(){Rp=(tA=Uv.now())+UD,v0=Jb=0;try{eGe()}finally{v0=0,nGe(),Rp=0}}function tGe(){var e=Uv.now(),t=e-tA;t>rfe&&(UD-=t,tA=e)}function nGe(){for(var e,t=eA,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:eA=n);Qb=e,j4(r)}function j4(e){if(!v0){Jb&&(Jb=clearTimeout(Jb));var t=e-Rp;t>24?(e<1/0&&(Jb=setTimeout(TX,e-Uv.now()-UD)),pb&&(pb=clearInterval(pb))):(pb||(tA=Uv.now(),pb=setInterval(tGe,rfe)),v0=1,ife(TX))}}function rGe(e,t,n){var r=new nA,i=t;return t==null?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(s,o,a){o=+o,a=a==null?h7():+a,r._restart(function u(l){l+=i,r._restart(u,i+=o,a),s(l)},o,a)},r.restart(e,t,n),r)}const iGe=1664525,sGe=1013904223,IX=4294967296;function oGe(){let e=1;return()=>(e=(iGe*e+sGe)%IX)/IX}function aGe(e){return e.x}function uGe(e){return e.y}var lGe=10,cGe=Math.PI*(3-Math.sqrt(5));function fGe(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,u=sfe(f),l=nfe("tick","end"),c=oGe();e==null&&(e=[]);function f(){h(),l.call("tick",t),n<r&&(u.stop(),l.call("end",t))}function h(g){var m,y=e.length,b;g===void 0&&(g=1);for(var v=0;v<g;++v)for(n+=(s-n)*i,a.forEach(function(x){x(n)}),m=0;m<y;++m)b=e[m],b.fx==null?b.x+=b.vx*=o:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=o:(b.y=b.fy,b.vy=0);return t}function d(){for(var g=0,m=e.length,y;g<m;++g){if(y=e[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var b=lGe*Math.sqrt(.5+g),v=g*cGe;y.x=b*Math.cos(v),y.y=b*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(e,c),g}return d(),t={tick:h,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(g){return arguments.length?(e=g,d(),a.forEach(p),t):e},alpha:function(g){return arguments.length?(n=+g,t):n},alphaMin:function(g){return arguments.length?(r=+g,t):r},alphaDecay:function(g){return arguments.length?(i=+g,t):+i},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(o=1-g,t):1-o},randomSource:function(g){return arguments.length?(c=g,a.forEach(p),t):c},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),t):a.get(g)},find:function(g,m,y){var b=0,v=e.length,x,w,C,$,S;for(y==null?y=1/0:y*=y,b=0;b<v;++b)$=e[b],x=g-$.x,w=m-$.y,C=x*x+w*w,C<y&&(S=$,y=C);return S},on:function(g,m){return arguments.length>1?(l.on(g,m),t):l.on(g)}}}function hGe(){var e,t,n,r,i=Mi(-30),s,o=1,a=1/0,u=.81;function l(d){var p,g=e.length,m=c7(e,aGe,uGe).visitAfter(f);for(r=d,p=0;p<g;++p)t=e[p],m.visit(h)}function c(){if(e){var d,p=e.length,g;for(s=new Array(p),d=0;d<p;++d)g=e[d],s[g.index]=+i(g,d,e)}}function f(d){var p=0,g,m,y=0,b,v,x;if(d.length){for(b=v=x=0;x<4;++x)(g=d[x])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,b+=m*g.x,v+=m*g.y);d.x=b/y,d.y=v/y}else{g=d,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}d.value=p}function h(d,p,g,m){if(!d.value)return!0;var y=d.x-t.x,b=d.y-t.y,v=m-p,x=y*y+b*b;if(v*v/u<x)return x<a&&(y===0&&(y=rf(n),x+=y*y),b===0&&(b=rf(n),x+=b*b),x<o&&(x=Math.sqrt(o*x)),t.vx+=y*d.value*r/x,t.vy+=b*d.value*r/x),!0;if(d.length||x>=a)return;(d.data!==t||d.next)&&(y===0&&(y=rf(n),x+=y*y),b===0&&(b=rf(n),x+=b*b),x<o&&(x=Math.sqrt(o*x)));do d.data!==t&&(v=s[d.data.index]*r/x,t.vx+=y*v,t.vy+=b*v);while(d=d.next)}return l.initialize=function(d,p){e=d,n=p,c()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:Mi(+d),c(),l):i},l.distanceMin=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.distanceMax=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.theta=function(d){return arguments.length?(u=d*d,l):Math.sqrt(u)},l}function dGe(e){var t=Mi(.1),n,r,i;typeof e!="function"&&(e=Mi(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(i[u]-c.x)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Mi(+a),o(),s):t},s.x=function(a){return arguments.length?(e=typeof a=="function"?a:Mi(+a),o(),s):e},s}function pGe(e){var t=Mi(.1),n,r,i;typeof e!="function"&&(e=Mi(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(i[u]-c.y)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Mi(+a),o(),s):t},s.y=function(a){return arguments.length?(e=typeof a=="function"?a:Mi(+a),o(),s):e},s}const DX={center:_Ve,collide:qVe,nbody:hGe,link:YVe,x:dGe,y:pGe},ex="forces",W4=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],gGe=["static","iterations"],ofe=["x","y","vx","vy"];function d7(e){ee.call(this,null,e)}d7.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:ofe}]};ye(d7,ee,{transform(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(W4),s=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&afe(n,e,0,t)):(this.value=n=yGe(t.source,e),n.on("tick",mGe(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(gGe)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let a=this._argops,u=0,l=a.length,c;u<l;++u)if(c=a[u],!(c.name!==ex||c.op._argval.force!=="link")){for(var r=c.op._argops,i=0,s=r.length,o;i<s;++i)if(r[i].name==="links"&&(o=r[i].op.source)){n.pulse(o,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(ofe)}});function mGe(e,t){return()=>e.touch(t).run()}function yGe(e,t){const n=fGe(e),r=n.stop,i=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,i()),n.stop=()=>(s=!0,r()),afe(n,t,!0).on("end",()=>s=!0)}function afe(e,t,n,r){var i=Qe(t.forces),s,o,a,u;for(s=0,o=W4.length;s<o;++s)a=W4[s],a!==ex&&t.modified(a)&&e[a](t[a]);for(s=0,o=i.length;s<o;++s)u=ex+s,a=n||t.modified(ex,s)?xGe(i[s]):r&&bGe(i[s],r)?e.force(u):null,a&&e.force(u,a);for(o=e.numForces||0;s<o;++s)e.force(ex+s,null);return e.numForces=i.length,e}function bGe(e,t){var n,r;for(n in e)if(Pt(r=e[n])&&t.modified(pi(r)))return 1;return 0}function xGe(e){var t,n;tt(DX,e.force)||ae("Unrecognized force: "+e.force),t=DX[e.force]();for(n in e)Pt(t[n])&&vGe(t[n],e[n],e);return t}function vGe(e,t,n){e(Pt(t)?r=>t(r,n):t)}const wGe=Object.freeze(Object.defineProperty({__proto__:null,force:d7},Symbol.toStringTag,{value:"Module"}));function $Ge(e,t){return e.parent===t.parent?1:2}function CGe(e){return e.reduce(SGe,0)/e.length}function SGe(e,t){return e+t.x}function kGe(e){return 1+e.reduce(EGe,0)}function EGe(e,t){return Math.max(e,t.y)}function AGe(e){for(var t;t=e.children;)e=t[0];return e}function _Ge(e){for(var t;t=e.children;)e=t[t.length-1];return e}function TGe(){var e=$Ge,t=1,n=1,r=!1;function i(s){var o,a=0;s.eachAfter(function(h){var d=h.children;d?(h.x=CGe(d),h.y=kGe(d)):(h.x=o?a+=e(h,o):0,h.y=0,o=h)});var u=AGe(s),l=_Ge(s),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return s.eachAfter(r?function(h){h.x=(h.x-s.x)*t,h.y=(s.y-h.y)*n}:function(h){h.x=(h.x-c)/(f-c)*t,h.y=(1-(s.y?h.y/s.y:1))*n})}return i.separation=function(s){return arguments.length?(e=s,i):e},i.size=function(s){return arguments.length?(r=!1,t=+s[0],n=+s[1],i):r?null:[t,n]},i.nodeSize=function(s){return arguments.length?(r=!0,t=+s[0],n=+s[1],i):r?[t,n]:null},i}function IGe(e){var t=0,n=e.children,r=n&&n.length;if(!r)t=1;else for(;--r>=0;)t+=n[r].value;e.value=t}function DGe(){return this.eachAfter(IGe)}function NGe(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this}function FGe(e,t){for(var n=this,r=[n],i,s,o=-1;n=r.pop();)if(e.call(t,n,++o,this),i=n.children)for(s=i.length-1;s>=0;--s)r.push(i[s]);return this}function OGe(e,t){for(var n=this,r=[n],i=[],s,o,a,u=-1;n=r.pop();)if(i.push(n),s=n.children)for(o=0,a=s.length;o<a;++o)r.push(s[o]);for(;n=i.pop();)e.call(t,n,++u,this);return this}function RGe(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r}function MGe(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})}function LGe(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function PGe(e){for(var t=this,n=BGe(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r}function BGe(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}function zGe(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function UGe(){return Array.from(this)}function jGe(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function WGe(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*VGe(){var e=this,t,n=[e],r,i,s;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,r=e.children)for(i=0,s=r.length;i<s;++i)n.push(r[i]);while(n.length)}function p7(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=qGe)):t===void 0&&(t=HGe);for(var n=new w0(e),r,i=[n],s,o,a,u;r=i.pop();)if((o=t(r.data))&&(u=(o=Array.from(o)).length))for(r.children=o,a=u-1;a>=0;--a)i.push(s=o[a]=new w0(o[a])),s.parent=r,s.depth=r.depth+1;return n.eachBefore(ufe)}function GGe(){return p7(this).eachBefore(XGe)}function HGe(e){return e.children}function qGe(e){return Array.isArray(e)?e[1]:null}function XGe(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function ufe(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function w0(e){this.data=e,this.depth=this.height=0,this.parent=null}w0.prototype=p7.prototype={constructor:w0,count:DGe,each:NGe,eachAfter:OGe,eachBefore:FGe,find:RGe,sum:MGe,sort:LGe,path:PGe,ancestors:zGe,descendants:UGe,leaves:jGe,links:WGe,copy:GGe,[Symbol.iterator]:VGe};function YGe(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function KGe(e){for(var t=e.length,n,r;t;)r=Math.random()*t--|0,n=e[t],e[t]=e[r],e[r]=n;return e}function ZGe(e){for(var t=0,n=(e=KGe(Array.from(e))).length,r=[],i,s;t<n;)i=e[t],s&&lfe(s,i)?++t:(s=QGe(r=JGe(r,i)),t=0);return s}function JGe(e,t){var n,r;if(fO(t,e))return[t];for(n=0;n<e.length;++n)if(rS(t,e[n])&&fO(tx(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(rS(tx(e[n],e[r]),t)&&rS(tx(e[n],t),e[r])&&rS(tx(e[r],t),e[n])&&fO(cfe(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function rS(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function lfe(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function fO(e,t){for(var n=0;n<t.length;++n)if(!lfe(e,t[n]))return!1;return!0}function QGe(e){switch(e.length){case 1:return eHe(e[0]);case 2:return tx(e[0],e[1]);case 3:return cfe(e[0],e[1],e[2])}}function eHe(e){return{x:e.x,y:e.y,r:e.r}}function tx(e,t){var n=e.x,r=e.y,i=e.r,s=t.x,o=t.y,a=t.r,u=s-n,l=o-r,c=a-i,f=Math.sqrt(u*u+l*l);return{x:(n+s+u/f*c)/2,y:(r+o+l/f*c)/2,r:(f+i+a)/2}}function cfe(e,t,n){var r=e.x,i=e.y,s=e.r,o=t.x,a=t.y,u=t.r,l=n.x,c=n.y,f=n.r,h=r-o,d=r-l,p=i-a,g=i-c,m=u-s,y=f-s,b=r*r+i*i-s*s,v=b-o*o-a*a+u*u,x=b-l*l-c*c+f*f,w=d*p-h*g,C=(p*x-g*v)/(w*2)-r,$=(g*m-p*y)/w,S=(d*v-h*x)/(w*2)-i,k=(h*y-d*m)/w,E=$*$+k*k-1,A=2*(s+C*$+S*k),F=C*C+S*S-s*s,_=-(E?(A+Math.sqrt(A*A-4*E*F))/(2*E):F/A);return{x:r+C+$*_,y:i+S+k*_,r:_}}function NX(e,t,n){var r=e.x-t.x,i,s,o=e.y-t.y,a,u,l=r*r+o*o;l?(s=t.r+n.r,s*=s,u=e.r+n.r,u*=u,s>u?(i=(l+u-s)/(2*l),a=Math.sqrt(Math.max(0,u/l-i*i)),n.x=e.x-i*r-a*o,n.y=e.y-i*o+a*r):(i=(l+s-u)/(2*l),a=Math.sqrt(Math.max(0,s/l-i*i)),n.x=t.x+i*r-a*o,n.y=t.y+i*o+a*r)):(n.x=t.x+n.r,n.y=t.y)}function FX(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function OX(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,s=(t.y*n.r+n.y*t.r)/r;return i*i+s*s}function iS(e){this._=e,this.next=null,this.previous=null}function tHe(e){if(!(i=(e=YGe(e)).length))return 0;var t,n,r,i,s,o,a,u,l,c,f;if(t=e[0],t.x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;NX(n,t,r=e[2]),t=new iS(t),n=new iS(n),r=new iS(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(a=3;a<i;++a){NX(t._,n._,r=e[a]),r=new iS(r),u=n.next,l=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(FX(u._,r._)){n=u,t.next=n,n.previous=t,--a;continue e}c+=u._.r,u=u.next}else{if(FX(l._,r._)){t=l,t.next=n,n.previous=t,--a;continue e}f+=l._.r,l=l.previous}while(u!==l.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,s=OX(t);(r=r.next)!==n;)(o=OX(r))<s&&(t=r,s=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=ZGe(t),a=0;a<i;++a)t=e[a],t.x-=r.x,t.y-=r.y;return r.r}function nHe(e){return e==null?null:rA(e)}function rA(e){if(typeof e!="function")throw new Error;return e}function Ed(){return 0}function ym(e){return function(){return e}}function rHe(e){return Math.sqrt(e.value)}function iHe(){var e=null,t=1,n=1,r=Ed;function i(s){return s.x=t/2,s.y=n/2,e?s.eachBefore(RX(e)).eachAfter(hO(r,.5)).eachBefore(MX(1)):s.eachBefore(RX(rHe)).eachAfter(hO(Ed,1)).eachAfter(hO(r,s.r/Math.min(t,n))).eachBefore(MX(Math.min(t,n)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(e=nHe(s),i):e},i.size=function(s){return arguments.length?(t=+s[0],n=+s[1],i):[t,n]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:ym(+s),i):r},i}function RX(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function hO(e,t){return function(n){if(r=n.children){var r,i,s=r.length,o=e(n)*t||0,a;if(o)for(i=0;i<s;++i)r[i].r+=o;if(a=tHe(r),o)for(i=0;i<s;++i)r[i].r-=o;n.r=a+o}}}function MX(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function ffe(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function v$(e,t,n,r,i){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(r-t)/e.value;++a<u;)o=s[a],o.y0=n,o.y1=i,o.x0=t,o.x1=t+=o.value*l}function sHe(){var e=1,t=1,n=0,r=!1;function i(o){var a=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/a,o.eachBefore(s(t,a)),r&&o.eachBefore(ffe),o}function s(o,a){return function(u){u.children&&v$(u,u.x0,o*(u.depth+1)/a,u.x1,o*(u.depth+2)/a);var l=u.x0,c=u.y0,f=u.x1-n,h=u.y1-n;f<l&&(l=f=(l+f)/2),h<c&&(c=h=(c+h)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=h}}return i.round=function(o){return arguments.length?(r=!!o,i):r},i.size=function(o){return arguments.length?(e=+o[0],t=+o[1],i):[e,t]},i.padding=function(o){return arguments.length?(n=+o,i):n},i}var oHe={depth:-1},LX={};function aHe(e){return e.id}function uHe(e){return e.parentId}function PX(){var e=aHe,t=uHe;function n(r){var i=Array.from(r),s=i.length,o,a,u,l,c,f,h,d=new Map;for(a=0;a<s;++a)o=i[a],c=i[a]=new w0(o),(f=e(o,a,r))!=null&&(f+="")&&(h=c.id=f,d.set(h,d.has(h)?LX:c)),(f=t(o,a,r))!=null&&(f+="")&&(c.parent=f);for(a=0;a<s;++a)if(c=i[a],f=c.parent){if(l=d.get(f),!l)throw new Error("missing: "+f);if(l===LX)throw new Error("ambiguous: "+f);l.children?l.children.push(c):l.children=[c],c.parent=l}else{if(u)throw new Error("multiple roots");u=c}if(!u)throw new Error("no root");if(u.parent=oHe,u.eachBefore(function(p){p.depth=p.parent.depth+1,--s}).eachBefore(ufe),u.parent=null,s>0)throw new Error("cycle");return u}return n.id=function(r){return arguments.length?(e=rA(r),n):e},n.parentId=function(r){return arguments.length?(t=rA(r),n):t},n}function lHe(e,t){return e.parent===t.parent?1:2}function dO(e){var t=e.children;return t?t[0]:e.t}function pO(e){var t=e.children;return t?t[t.length-1]:e.t}function cHe(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function fHe(e){for(var t=0,n=0,r=e.children,i=r.length,s;--i>=0;)s=r[i],s.z+=t,s.m+=t,t+=s.s+(n+=s.c)}function hHe(e,t,n){return e.a.parent===t.parent?e.a:n}function ok(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}ok.prototype=Object.create(w0.prototype);function dHe(e){for(var t=new ok(e,0),n,r=[t],i,s,o,a;n=r.pop();)if(s=n._.children)for(n.children=new Array(a=s.length),o=a-1;o>=0;--o)r.push(i=n.children[o]=new ok(s[o],o)),i.parent=n;return(t.parent=new ok(null,0)).children=[t],t}function pHe(){var e=lHe,t=1,n=1,r=null;function i(l){var c=dHe(l);if(c.eachAfter(s),c.parent.m=-c.z,c.eachBefore(o),r)l.eachBefore(u);else{var f=l,h=l,d=l;l.eachBefore(function(b){b.x<f.x&&(f=b),b.x>h.x&&(h=b),b.depth>d.depth&&(d=b)});var p=f===h?1:e(f,h)/2,g=p-f.x,m=t/(h.x+p+g),y=n/(d.depth||1);l.eachBefore(function(b){b.x=(b.x+g)*m,b.y=b.depth*y})}return l}function s(l){var c=l.children,f=l.parent.children,h=l.i?f[l.i-1]:null;if(c){fHe(l);var d=(c[0].z+c[c.length-1].z)/2;h?(l.z=h.z+e(l._,h._),l.m=l.z-d):l.z=d}else h&&(l.z=h.z+e(l._,h._));l.parent.A=a(l,h,l.parent.A||f[0])}function o(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,c,f){if(c){for(var h=l,d=l,p=c,g=h.parent.children[0],m=h.m,y=d.m,b=p.m,v=g.m,x;p=pO(p),h=dO(h),p&&h;)g=dO(g),d=pO(d),d.a=l,x=p.z+b-h.z-m+e(p._,h._),x>0&&(cHe(hHe(p,l,f),l,x),m+=x,y+=x),b+=p.m,m+=h.m,v+=g.m,y+=d.m;p&&!pO(d)&&(d.t=p,d.m+=b-y),h&&!dO(g)&&(g.t=h,g.m+=m-v,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return i.separation=function(l){return arguments.length?(e=l,i):e},i.size=function(l){return arguments.length?(r=!1,t=+l[0],n=+l[1],i):r?null:[t,n]},i.nodeSize=function(l){return arguments.length?(r=!0,t=+l[0],n=+l[1],i):r?[t,n]:null},i}function jD(e,t,n,r,i){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(i-n)/e.value;++a<u;)o=s[a],o.x0=t,o.x1=r,o.y0=n,o.y1=n+=o.value*l}var hfe=(1+Math.sqrt(5))/2;function dfe(e,t,n,r,i,s){for(var o=[],a=t.children,u,l,c=0,f=0,h=a.length,d,p,g=t.value,m,y,b,v,x,w,C;c<h;){d=i-n,p=s-r;do m=a[f++].value;while(!m&&f<h);for(y=b=m,w=Math.max(p/d,d/p)/(g*e),C=m*m*w,x=Math.max(b/C,C/y);f<h;++f){if(m+=l=a[f].value,l<y&&(y=l),l>b&&(b=l),C=m*m*w,v=Math.max(b/C,C/y),v>x){m-=l;break}x=v}o.push(u={value:m,dice:d<p,children:a.slice(c,f)}),u.dice?v$(u,n,r,i,g?r+=p*m/g:s):jD(u,n,r,g?n+=d*m/g:i,s),g-=m,c=f}return o}const pfe=function e(t){function n(r,i,s,o,a){dfe(t,r,i,s,o,a)}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(hfe);function gHe(){var e=pfe,t=!1,n=1,r=1,i=[0],s=Ed,o=Ed,a=Ed,u=Ed,l=Ed;function c(h){return h.x0=h.y0=0,h.x1=n,h.y1=r,h.eachBefore(f),i=[0],t&&h.eachBefore(ffe),h}function f(h){var d=i[h.depth],p=h.x0+d,g=h.y0+d,m=h.x1-d,y=h.y1-d;m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),h.x0=p,h.y0=g,h.x1=m,h.y1=y,h.children&&(d=i[h.depth+1]=s(h)/2,p+=l(h)-d,g+=o(h)-d,m-=a(h)-d,y-=u(h)-d,m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),e(h,p,g,m,y))}return c.round=function(h){return arguments.length?(t=!!h,c):t},c.size=function(h){return arguments.length?(n=+h[0],r=+h[1],c):[n,r]},c.tile=function(h){return arguments.length?(e=rA(h),c):e},c.padding=function(h){return arguments.length?c.paddingInner(h).paddingOuter(h):c.paddingInner()},c.paddingInner=function(h){return arguments.length?(s=typeof h=="function"?h:ym(+h),c):s},c.paddingOuter=function(h){return arguments.length?c.paddingTop(h).paddingRight(h).paddingBottom(h).paddingLeft(h):c.paddingTop()},c.paddingTop=function(h){return arguments.length?(o=typeof h=="function"?h:ym(+h),c):o},c.paddingRight=function(h){return arguments.length?(a=typeof h=="function"?h:ym(+h),c):a},c.paddingBottom=function(h){return arguments.length?(u=typeof h=="function"?h:ym(+h),c):u},c.paddingLeft=function(h){return arguments.length?(l=typeof h=="function"?h:ym(+h),c):l},c}function mHe(e,t,n,r,i){var s=e.children,o,a=s.length,u,l=new Array(a+1);for(l[0]=u=o=0;o<a;++o)l[o+1]=u+=s[o].value;c(0,a,e.value,t,n,r,i);function c(f,h,d,p,g,m,y){if(f>=h-1){var b=s[f];b.x0=p,b.y0=g,b.x1=m,b.y1=y;return}for(var v=l[f],x=d/2+v,w=f+1,C=h-1;w<C;){var $=w+C>>>1;l[$]<x?w=$+1:C=$}x-l[w-1]<l[w]-x&&f+1<w&&--w;var S=l[w]-v,k=d-S;if(m-p>y-g){var E=d?(p*k+m*S)/d:m;c(f,w,S,p,g,E,y),c(w,h,k,E,g,m,y)}else{var A=d?(g*k+y*S)/d:y;c(f,w,S,p,g,m,A),c(w,h,k,p,A,m,y)}}}function yHe(e,t,n,r,i){(e.depth&1?jD:v$)(e,t,n,r,i)}const bHe=function e(t){function n(r,i,s,o,a){if((u=r._squarify)&&u.ratio===t)for(var u,l,c,f,h=-1,d,p=u.length,g=r.value;++h<p;){for(l=u[h],c=l.children,f=l.value=0,d=c.length;f<d;++f)l.value+=c[f].value;l.dice?v$(l,i,s,o,g?s+=(a-s)*l.value/g:a):jD(l,i,s,g?i+=(o-i)*l.value/g:o,a),g-=l.value}else r._squarify=u=dfe(t,r,i,s,o,a),u.ratio=t}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(hfe);function V4(e,t,n){const r={};return e.each(i=>{const s=i.data;n(s)&&(r[t(s)]=i)}),e.lookup=r,e}function g7(e){ee.call(this,null,e)}g7.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const xHe=e=>e.values;ye(g7,ee,{transform(e,t){t.source||ae("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),s=this.value;return(!s||r||t.changed())&&(s&&s.each(o=>{o.children&&zI(o.data)&&i.rem.push(o.data)}),this.value=s=p7({values:Qe(e.keys).reduce((o,a)=>(o.key(a),o),vHe()).entries(i.source)},xHe),n&&s.each(o=>{o.children&&(o=Nt(o.data),i.add.push(o),i.source.push(o))}),V4(s,Le,Le)),i.source.root=s,i}});function vHe(){const e=[],t={entries:i=>r(n(i,0),0),key:i=>(e.push(i),t)};function n(i,s){if(s>=e.length)return i;const o=i.length,a=e[s++],u={},l={};let c=-1,f,h,d;for(;++c<o;)f=a(h=i[c])+"",(d=u[f])?d.push(h):u[f]=[h];for(f in u)l[f]=n(u[f],s);return l}function r(i,s){if(++s>e.length)return i;const o=[];for(const a in i)o.push({key:a,values:r(i[a],s)});return o}return t}function wc(e){ee.call(this,null,e)}const wHe=(e,t)=>e.parent===t.parent?1:2;ye(wc,ee,{transform(e,t){(!t.source||!t.source.root)&&ae(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,s=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(pg(e.sort,o=>o.data)),$He(n,this.params,e),n.separation&&n.separation(e.separation!==!1?wHe:Y1);try{this.value=n(i)}catch(o){ae(o)}return i.each(o=>CHe(o,r,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});function $He(e,t,n){for(let r,i=0,s=t.length;i<s;++i)r=t[i],r in n&&e[r](n[r])}function CHe(e,t,n){const r=e.data,i=t.length-1;for(let s=0;s<i;++s)r[n[s]]=e[t[s]];r[n[i]]=e.children?e.children.length:0}const G4=["x","y","r","depth","children"];function m7(e){wc.call(this,e)}m7.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:G4.length,default:G4}]};ye(m7,wc,{layout:iHe,params:["radius","size","padding"],fields:G4});const H4=["x0","y0","x1","y1","depth","children"];function y7(e){wc.call(this,e)}y7.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:H4.length,default:H4}]};ye(y7,wc,{layout:sHe,params:["size","round","padding"],fields:H4});function b7(e){ee.call(this,null,e)}b7.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};ye(b7,ee,{transform(e,t){t.source||ae("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),s=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?V4(PX().id(e.key).parentId(e.parentKey)(i.source),e.key,K1):V4(PX()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const BX={tidy:pHe,cluster:TGe},q4=["x","y","depth","children"];function x7(e){wc.call(this,e)}x7.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:q4.length,default:q4}]};ye(x7,wc,{layout(e){const t=e||"tidy";if(tt(BX,t))return BX[t]();ae("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:q4});function v7(e){ee.call(this,[],e)}v7.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};ye(v7,ee,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),s={};return r||ae("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,o=>s[Le(o)]=1),r.each(o=>{const a=o.data,u=o.parent&&o.parent.data;u&&s[Le(a)]&&s[Le(u)]&&i.add.push(Nt({source:u,target:a}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,o=>s[Le(o)]=1),n.forEach(o=>{(s[Le(o.source)]||s[Le(o.target)])&&i.mod.push(o)})),i}});const zX={binary:mHe,dice:v$,slice:jD,slicedice:yHe,squarify:pfe,resquarify:bHe},X4=["x0","y0","x1","y1","depth","children"];function w7(e){wc.call(this,e)}w7.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:X4.length,default:X4}]};ye(w7,wc,{layout(){const e=gHe();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{tt(zX,t)?e.tile(zX[t]):ae("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:X4});const SHe=Object.freeze(Object.defineProperty({__proto__:null,nest:g7,pack:m7,partition:y7,stratify:b7,tree:x7,treelinks:v7,treemap:w7},Symbol.toStringTag,{value:"Module"})),Y4=Math.PI,K4=2*Y4,xd=1e-6,kHe=K4-xd;function Z4(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Sg(){return new Z4}Z4.prototype=Sg.prototype={constructor:Z4,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var s=this._x1,o=this._y1,a=n-e,u=r-t,l=s-e,c=o-t,f=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>xd)if(!(Math.abs(c*a-u*l)>xd)||!i)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var h=n-s,d=r-o,p=a*a+u*u,g=h*h+d*d,m=Math.sqrt(p),y=Math.sqrt(f),b=i*Math.tan((Y4-Math.acos((p+f-g)/(2*m*y)))/2),v=b/y,x=b/m;Math.abs(v-1)>xd&&(this._+="L"+(e+v*l)+","+(t+v*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>l*d)+","+(this._x1=e+x*a)+","+(this._y1=t+x*u)}},arc:function(e,t,n,r,i,s){e=+e,t=+t,n=+n,s=!!s;var o=n*Math.cos(r),a=n*Math.sin(r),u=e+o,l=t+a,c=1^s,f=s?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>xd||Math.abs(this._y1-l)>xd)&&(this._+="L"+u+","+l),n&&(f<0&&(f=f%K4+K4),f>kHe?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-a)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):f>xd&&(this._+="A"+n+","+n+",0,"+ +(f>=Y4)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function Mt(e){return function(){return e}}var UX=Math.abs,Yr=Math.atan2,ed=Math.cos,EHe=Math.max,gO=Math.min,Ha=Math.sin,Sm=Math.sqrt,Jr=1e-12,$0=Math.PI,iA=$0/2,gfe=2*$0;function AHe(e){return e>1?0:e<-1?$0:Math.acos(e)}function jX(e){return e>=1?iA:e<=-1?-iA:Math.asin(e)}function _He(e){return e.innerRadius}function THe(e){return e.outerRadius}function IHe(e){return e.startAngle}function DHe(e){return e.endAngle}function NHe(e){return e&&e.padAngle}function FHe(e,t,n,r,i,s,o,a){var u=n-e,l=r-t,c=o-i,f=a-s,h=f*u-c*l;if(!(h*h<Jr))return h=(c*(t-s)-f*(e-i))/h,[e+h*u,t+h*l]}function sS(e,t,n,r,i,s,o){var a=e-n,u=t-r,l=(o?s:-s)/Sm(a*a+u*u),c=l*u,f=-l*a,h=e+c,d=t+f,p=n+c,g=r+f,m=(h+p)/2,y=(d+g)/2,b=p-h,v=g-d,x=b*b+v*v,w=i-s,C=h*g-p*d,$=(v<0?-1:1)*Sm(EHe(0,w*w*x-C*C)),S=(C*v-b*$)/x,k=(-C*b-v*$)/x,E=(C*v+b*$)/x,A=(-C*b+v*$)/x,F=S-m,_=k-y,I=E-m,T=A-y;return F*F+_*_>I*I+T*T&&(S=E,k=A),{cx:S,cy:k,x01:-c,y01:-f,x11:S*(i/w-1),y11:k*(i/w-1)}}function OHe(){var e=_He,t=THe,n=Mt(0),r=null,i=IHe,s=DHe,o=NHe,a=null;function u(){var l,c,f=+e.apply(this,arguments),h=+t.apply(this,arguments),d=i.apply(this,arguments)-iA,p=s.apply(this,arguments)-iA,g=UX(p-d),m=p>d;if(a||(a=l=Sg()),h<f&&(c=h,h=f,f=c),!(h>Jr))a.moveTo(0,0);else if(g>gfe-Jr)a.moveTo(h*ed(d),h*Ha(d)),a.arc(0,0,h,d,p,!m),f>Jr&&(a.moveTo(f*ed(p),f*Ha(p)),a.arc(0,0,f,p,d,m));else{var y=d,b=p,v=d,x=p,w=g,C=g,$=o.apply(this,arguments)/2,S=$>Jr&&(r?+r.apply(this,arguments):Sm(f*f+h*h)),k=gO(UX(h-f)/2,+n.apply(this,arguments)),E=k,A=k,F,_;if(S>Jr){var I=jX(S/f*Ha($)),T=jX(S/h*Ha($));(w-=I*2)>Jr?(I*=m?1:-1,v+=I,x-=I):(w=0,v=x=(d+p)/2),(C-=T*2)>Jr?(T*=m?1:-1,y+=T,b-=T):(C=0,y=b=(d+p)/2)}var O=h*ed(y),L=h*Ha(y),M=f*ed(x),P=f*Ha(x);if(k>Jr){var G=h*ed(b),H=h*Ha(b),Q=f*ed(v),te=f*Ha(v),ne;if(g<$0&&(ne=FHe(O,L,Q,te,G,H,M,P))){var oe=O-ne[0],he=L-ne[1],we=G-ne[0],Ae=H-ne[1],B=1/Ha(AHe((oe*we+he*Ae)/(Sm(oe*oe+he*he)*Sm(we*we+Ae*Ae)))/2),Y=Sm(ne[0]*ne[0]+ne[1]*ne[1]);E=gO(k,(f-Y)/(B-1)),A=gO(k,(h-Y)/(B+1))}}C>Jr?A>Jr?(F=sS(Q,te,O,L,h,A,m),_=sS(G,H,M,P,h,A,m),a.moveTo(F.cx+F.x01,F.cy+F.y01),A<k?a.arc(F.cx,F.cy,A,Yr(F.y01,F.x01),Yr(_.y01,_.x01),!m):(a.arc(F.cx,F.cy,A,Yr(F.y01,F.x01),Yr(F.y11,F.x11),!m),a.arc(0,0,h,Yr(F.cy+F.y11,F.cx+F.x11),Yr(_.cy+_.y11,_.cx+_.x11),!m),a.arc(_.cx,_.cy,A,Yr(_.y11,_.x11),Yr(_.y01,_.x01),!m))):(a.moveTo(O,L),a.arc(0,0,h,y,b,!m)):a.moveTo(O,L),!(f>Jr)||!(w>Jr)?a.lineTo(M,P):E>Jr?(F=sS(M,P,G,H,f,-E,m),_=sS(O,L,Q,te,f,-E,m),a.lineTo(F.cx+F.x01,F.cy+F.y01),E<k?a.arc(F.cx,F.cy,E,Yr(F.y01,F.x01),Yr(_.y01,_.x01),!m):(a.arc(F.cx,F.cy,E,Yr(F.y01,F.x01),Yr(F.y11,F.x11),!m),a.arc(0,0,f,Yr(F.cy+F.y11,F.cx+F.x11),Yr(_.cy+_.y11,_.cx+_.x11),m),a.arc(_.cx,_.cy,E,Yr(_.y11,_.x11),Yr(_.y01,_.x01),!m))):a.arc(0,0,f,x,v,m)}if(a.closePath(),l)return a=null,l+""||null}return u.centroid=function(){var l=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-$0/2;return[ed(c)*l,Ha(c)*l]},u.innerRadius=function(l){return arguments.length?(e=typeof l=="function"?l:Mt(+l),u):e},u.outerRadius=function(l){return arguments.length?(t=typeof l=="function"?l:Mt(+l),u):t},u.cornerRadius=function(l){return arguments.length?(n=typeof l=="function"?l:Mt(+l),u):n},u.padRadius=function(l){return arguments.length?(r=l==null?null:typeof l=="function"?l:Mt(+l),u):r},u.startAngle=function(l){return arguments.length?(i=typeof l=="function"?l:Mt(+l),u):i},u.endAngle=function(l){return arguments.length?(s=typeof l=="function"?l:Mt(+l),u):s},u.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:Mt(+l),u):o},u.context=function(l){return arguments.length?(a=l??null,u):a},u}function mfe(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function yfe(e){this._context=e}yfe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function $7(e){return new yfe(e)}function bfe(e){return e[0]}function xfe(e){return e[1]}function vfe(e,t){var n=Mt(!0),r=null,i=$7,s=null;e=typeof e=="function"?e:e===void 0?bfe:Mt(e),t=typeof t=="function"?t:t===void 0?xfe:Mt(t);function o(a){var u,l=(a=mfe(a)).length,c,f=!1,h;for(r==null&&(s=i(h=Sg())),u=0;u<=l;++u)!(u<l&&n(c=a[u],u,a))===f&&((f=!f)?s.lineStart():s.lineEnd()),f&&s.point(+e(c,u,a),+t(c,u,a));if(h)return s=null,h+""||null}return o.x=function(a){return arguments.length?(e=typeof a=="function"?a:Mt(+a),o):e},o.y=function(a){return arguments.length?(t=typeof a=="function"?a:Mt(+a),o):t},o.defined=function(a){return arguments.length?(n=typeof a=="function"?a:Mt(!!a),o):n},o.curve=function(a){return arguments.length?(i=a,r!=null&&(s=i(r)),o):i},o.context=function(a){return arguments.length?(a==null?r=s=null:s=i(r=a),o):r},o}function wfe(e,t,n){var r=null,i=Mt(!0),s=null,o=$7,a=null;e=typeof e=="function"?e:e===void 0?bfe:Mt(+e),t=typeof t=="function"?t:Mt(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?xfe:Mt(+n);function u(c){var f,h,d,p=(c=mfe(c)).length,g,m=!1,y,b=new Array(p),v=new Array(p);for(s==null&&(a=o(y=Sg())),f=0;f<=p;++f){if(!(f<p&&i(g=c[f],f,c))===m)if(m=!m)h=f,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),d=f-1;d>=h;--d)a.point(b[d],v[d]);a.lineEnd(),a.areaEnd()}m&&(b[f]=+e(g,f,c),v[f]=+t(g,f,c),a.point(r?+r(g,f,c):b[f],n?+n(g,f,c):v[f]))}if(y)return a=null,y+""||null}function l(){return vfe().defined(i).curve(o).context(s)}return u.x=function(c){return arguments.length?(e=typeof c=="function"?c:Mt(+c),r=null,u):e},u.x0=function(c){return arguments.length?(e=typeof c=="function"?c:Mt(+c),u):e},u.x1=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:Mt(+c),u):r},u.y=function(c){return arguments.length?(t=typeof c=="function"?c:Mt(+c),n=null,u):t},u.y0=function(c){return arguments.length?(t=typeof c=="function"?c:Mt(+c),u):t},u.y1=function(c){return arguments.length?(n=c==null?null:typeof c=="function"?c:Mt(+c),u):n},u.lineX0=u.lineY0=function(){return l().x(e).y(t)},u.lineY1=function(){return l().x(e).y(n)},u.lineX1=function(){return l().x(r).y(t)},u.defined=function(c){return arguments.length?(i=typeof c=="function"?c:Mt(!!c),u):i},u.curve=function(c){return arguments.length?(o=c,s!=null&&(a=o(s)),u):o},u.context=function(c){return arguments.length?(c==null?s=a=null:a=o(s=c),u):s},u}const RHe={draw:function(e,t){var n=Math.sqrt(t/$0);e.moveTo(n,0),e.arc(0,0,n,0,gfe)}};function MHe(e,t){var n=null;e=typeof e=="function"?e:Mt(e||RHe),t=typeof t=="function"?t:Mt(t===void 0?64:+t);function r(){var i;if(n||(n=i=Sg()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return r.type=function(i){return arguments.length?(e=typeof i=="function"?i:Mt(i),r):e},r.size=function(i){return arguments.length?(t=typeof i=="function"?i:Mt(+i),r):t},r.context=function(i){return arguments.length?(n=i??null,r):n},r}function th(){}function sA(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function WD(e){this._context=e}WD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:sA(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:sA(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function LHe(e){return new WD(e)}function $fe(e){this._context=e}$fe.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:sA(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function PHe(e){return new $fe(e)}function Cfe(e){this._context=e}Cfe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:sA(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function BHe(e){return new Cfe(e)}function Sfe(e,t){this._basis=new WD(e),this._beta=t}Sfe.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r=e[0],i=t[0],s=e[n]-r,o=t[n]-i,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(r+u*s),this._beta*t[a]+(1-this._beta)*(i+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const zHe=function e(t){function n(r){return t===1?new WD(r):new Sfe(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function oA(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function C7(e,t){this._context=e,this._k=(1-t)/6}C7.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:oA(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:oA(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const UHe=function e(t){function n(r){return new C7(r,t)}return n.tension=function(r){return e(+r)},n}(0);function S7(e,t){this._context=e,this._k=(1-t)/6}S7.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:oA(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const jHe=function e(t){function n(r){return new S7(r,t)}return n.tension=function(r){return e(+r)},n}(0);function k7(e,t){this._context=e,this._k=(1-t)/6}k7.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:oA(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const WHe=function e(t){function n(r){return new k7(r,t)}return n.tension=function(r){return e(+r)},n}(0);function E7(e,t,n){var r=e._x1,i=e._y1,s=e._x2,o=e._y2;if(e._l01_a>Jr){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>Jr){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,s,o,e._x2,e._y2)}function kfe(e,t){this._context=e,this._alpha=t}kfe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:E7(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const VHe=function e(t){function n(r){return t?new kfe(r,t):new C7(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Efe(e,t){this._context=e,this._alpha=t}Efe.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:E7(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const GHe=function e(t){function n(r){return t?new Efe(r,t):new S7(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Afe(e,t){this._context=e,this._alpha=t}Afe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:E7(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const HHe=function e(t){function n(r){return t?new Afe(r,t):new k7(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function _fe(e){this._context=e}_fe.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function qHe(e){return new _fe(e)}function WX(e){return e<0?-1:1}function VX(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(WX(s)+WX(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function GX(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function mO(e,t,n){var r=e._x0,i=e._y0,s=e._x1,o=e._y1,a=(s-r)/3;e._context.bezierCurveTo(r+a,i+a*t,s-a,o-a*n,s,o)}function aA(e){this._context=e}aA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:mO(this,this._t0,GX(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,mO(this,GX(this,n=VX(this,e,t)),n);break;default:mO(this,this._t0,n=VX(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function Tfe(e){this._context=new Ife(e)}(Tfe.prototype=Object.create(aA.prototype)).point=function(e,t){aA.prototype.point.call(this,t,e)};function Ife(e){this._context=e}Ife.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}};function XHe(e){return new aA(e)}function YHe(e){return new Tfe(e)}function Dfe(e){this._context=e}Dfe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=HX(e),i=HX(t),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function HX(e){var t,n=e.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,s[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/s[t-1],s[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/s[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/s[t];for(s[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}function KHe(e){return new Dfe(e)}function VD(e,t){this._context=e,this._t=t}VD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function ZHe(e){return new VD(e,.5)}function JHe(e){return new VD(e,0)}function QHe(e){return new VD(e,1)}var qX={},yO={},bO=34,gb=10,xO=13;function Nfe(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function eqe(e,t){var n=Nfe(e);return function(r,i){return t(n(r),i,e)}}function XX(e){var t=Object.create(null),n=[];return e.forEach(function(r){for(var i in r)i in t||n.push(t[i]=i)}),n}function es(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function tqe(e){return e<0?"-"+es(-e,6):e>9999?"+"+es(e,6):es(e,4)}function nqe(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":tqe(e.getUTCFullYear())+"-"+es(e.getUTCMonth()+1,2)+"-"+es(e.getUTCDate(),2)+(i?"T"+es(t,2)+":"+es(n,2)+":"+es(r,2)+"."+es(i,3)+"Z":r?"T"+es(t,2)+":"+es(n,2)+":"+es(r,2)+"Z":n||t?"T"+es(t,2)+":"+es(n,2)+"Z":"")}function rqe(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function r(f,h){var d,p,g=i(f,function(m,y){if(d)return d(m,y-1);p=m,d=h?eqe(m,h):Nfe(m)});return g.columns=p||[],g}function i(f,h){var d=[],p=f.length,g=0,m=0,y,b=p<=0,v=!1;f.charCodeAt(p-1)===gb&&--p,f.charCodeAt(p-1)===xO&&--p;function x(){if(b)return yO;if(v)return v=!1,qX;var C,$=g,S;if(f.charCodeAt($)===bO){for(;g++<p&&f.charCodeAt(g)!==bO||f.charCodeAt(++g)===bO;);return(C=g)>=p?b=!0:(S=f.charCodeAt(g++))===gb?v=!0:S===xO&&(v=!0,f.charCodeAt(g)===gb&&++g),f.slice($+1,C-1).replace(/""/g,'"')}for(;g<p;){if((S=f.charCodeAt(C=g++))===gb)v=!0;else if(S===xO)v=!0,f.charCodeAt(g)===gb&&++g;else if(S!==n)continue;return f.slice($,C)}return b=!0,f.slice($,p)}for(;(y=x())!==yO;){for(var w=[];y!==qX&&y!==yO;)w.push(y),y=x();h&&(w=h(w,m++))==null||d.push(w)}return d}function s(f,h){return f.map(function(d){return h.map(function(p){return c(d[p])}).join(e)})}function o(f,h){return h==null&&(h=XX(f)),[h.map(c).join(e)].concat(s(f,h)).join(`
`)}function a(f,h){return h==null&&(h=XX(f)),s(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?nqe(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function iqe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function uA(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function C0(e){return e=uA(Math.abs(e)),e?e[1]:NaN}function sqe(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function oqe(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var aqe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function jv(e){if(!(t=aqe.exec(e)))throw new Error("invalid format: "+e);var t;return new A7({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}jv.prototype=A7.prototype;function A7(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}A7.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function uqe(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Ffe;function lqe(e,t){var n=uA(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Ffe=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+uA(e,Math.max(0,t+s-1))[0]}function YX(e,t){var n=uA(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const KX={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:iqe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>YX(e*100,t),r:YX,s:lqe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function ZX(e){return e}var JX=Array.prototype.map,QX=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ofe(e){var t=e.grouping===void 0||e.thousands===void 0?ZX:sqe(JX.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?ZX:oqe(JX.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=jv(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,v=f.precision,x=f.trim,w=f.type;w==="n"?(b=!0,w="g"):KX[w]||(v===void 0&&(v=12),x=!0,w="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var C=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",$=g==="$"?r:/[%p]/.test(w)?o:"",S=KX[w],k=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function E(A){var F=C,_=$,I,T,O;if(w==="c")_=S(A)+_,A="";else{A=+A;var L=A<0||1/A<0;if(A=isNaN(A)?u:S(Math.abs(A),v),x&&(A=uqe(A)),L&&+A==0&&p!=="+"&&(L=!1),F=(L?p==="("?p:a:p==="-"||p==="("?"":p)+F,_=(w==="s"?QX[8+Ffe/3]:"")+_+(L&&p==="("?")":""),k){for(I=-1,T=A.length;++I<T;)if(O=A.charCodeAt(I),48>O||O>57){_=(O===46?i+A.slice(I+1):A.slice(I))+_,A=A.slice(0,I);break}}}b&&!m&&(A=t(A,1/0));var M=F.length+A.length+_.length,P=M<y?new Array(y-M+1).join(h):"";switch(b&&m&&(A=t(P+A,P.length?y-_.length:1/0),P=""),d){case"<":A=F+A+_+P;break;case"=":A=F+P+A+_;break;case"^":A=P.slice(0,M=P.length>>1)+F+A+_+P.slice(M);break;default:A=P+F+A+_;break}return s(A)}return E.toString=function(){return f+""},E}function c(f,h){var d=l((f=jv(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(C0(h)/3)))*3,g=Math.pow(10,-p),m=QX[8+p/3];return function(y){return d(g*y)+m}}return{format:l,formatPrefix:c}}var oS,Rfe,Mfe;cqe({thousands:",",grouping:[3],currency:["$",""]});function cqe(e){return oS=Ofe(e),Rfe=oS.format,Mfe=oS.formatPrefix,oS}function fqe(e){return Math.max(0,-C0(Math.abs(e)))}function hqe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(C0(t)/3)))*3-C0(Math.abs(e)))}function dqe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,C0(t)-C0(e))+1}function nx(e){const t={};return n=>t[n]||(t[n]=e(n))}function pqe(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=gqe(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function gqe(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function Lfe(e){const t=nx(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=jv(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return pqe(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=jv(o??",f");const a=Wf(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=hqe(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=dqe(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=fqe(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}let J4;Pfe();function Pfe(){return J4=Lfe({format:Rfe,formatPrefix:Mfe})}function Bfe(e){return Lfe(Ofe(e))}function lA(e){return arguments.length?J4=Bfe(e):J4}function eY(e,t,n){n=n||{},ht(n)||ae("Invalid time multi-format specifier: ".concat(n));const r=t(To),i=t(Ys),s=t(Xs),o=t(vs),a=t(Qn),u=t(mi),l=t(xs),c=t(Wr),f=e(n[Sa]||".%L"),h=e(n[To]||":%S"),d=e(n[Ys]||"%I:%M"),p=e(n[Xs]||"%I %p"),g=e(n[vs]||n[ai]||"%a %d"),m=e(n[Qn]||"%b %d"),y=e(n[mi]||"%B"),b=e(n[xs]||"%B"),v=e(n[Wr]||"%Y");return x=>(r(x)<x?f:i(x)<x?h:s(x)<x?d:o(x)<x?p:u(x)<x?a(x)<x?g:m:c(x)<x?l(x)<x?y:b:v)(x)}function zfe(e){const t=nx(e.format),n=nx(e.utcFormat);return{timeFormat:r=>hn(r)?t(r):eY(t,iy,r),utcFormat:r=>hn(r)?n(r):eY(n,sy,r),timeParse:nx(e.parse),utcParse:nx(e.utcParse)}}let Q4;Ufe();function Ufe(){return Q4=zfe({format:ID,parse:xle,utcFormat:DD,utcParse:vle})}function jfe(e){return zfe(ple(e))}function Wv(e){return arguments.length?Q4=jfe(e):Q4}const eL=(e,t)=>pt({},e,t);function Wfe(e,t){const n=e?Bfe(e):lA(),r=t?jfe(t):Wv();return eL(n,r)}function Vfe(e,t){const n=arguments.length;return n&&n!==2&&ae("defaultLocale expects either zero or two arguments."),n?eL(lA(e),Wv(t)):eL(lA(),Wv())}function mqe(){return Pfe(),Ufe(),Vfe()}const yqe=/^(data:|([A-Za-z]+:)?\/\/)/,bqe=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,xqe=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,tY="file://";function vqe(e,t){return n=>({options:n||{},sanitize:$qe,load:wqe,fileAccess:!!t,file:Cqe(t),http:kqe(e)})}async function wqe(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function $qe(e,t){t=pt({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=bqe.test(e.replace(xqe,""));(e==null||typeof e!="string"||!a)&&ae("Sanitize failure, invalid URI: "+He(e));const u=yqe.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(tY))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(tY.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function Cqe(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):Sqe}async function Sqe(){ae("No file system access.")}function kqe(e){return e?async function(t,n){const r=pt({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?Pt(s[i])?s[i]():s.text():ae(s.status+""+s.statusText)}:Eqe}async function Eqe(){ae("No HTTP fetch method available.")}const Aqe=e=>e!=null&&e===e,_qe=e=>e==="true"||e==="false"||e===!0||e===!1,Tqe=e=>!Number.isNaN(Date.parse(e)),Gfe=e=>!Number.isNaN(+e)&&!(e instanceof Date),Iqe=e=>Gfe(e)&&Number.isInteger(+e),tL={boolean:Vre,integer:Lf,number:Lf,date:Gre,string:Hre,unknown:Ao},aS=[_qe,Iqe,Gfe,Tqe],Dqe=["boolean","integer","number","date"];function Hfe(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=aS.length,i=aS.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&Aqe(u)&&!aS[a](u)&&(i[a]=0,++o,o===aS.length))return"string";return Dqe[i.reduce((s,o)=>s===0?o:s,0)-1]}function qfe(e,t){return t.reduce((n,r)=>(n[r]=Hfe(e,r),n),{})}function nY(e){const t=function(n,r){const i={delimiter:e};return _7(n,r?pt(r,i):i)};return t.responseType="text",t}function _7(e,t){return t.header&&(e=t.header.map(He).join(t.delimiter)+`
`+e),rqe(t.delimiter).parse(e+"")}_7.responseType="text";function Nqe(e){return typeof Buffer=="function"&&Pt(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function T7(e,t){const n=t&&t.property?Mf(t.property):Ao;return ht(e)&&!Nqe(e)?Fqe(n(e),t):n(JSON.parse(e))}T7.responseType="json";function Fqe(e,t){return!rt(e)&&zre(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const Oqe={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Xfe(e,t){let n,r,i,s;return e=T7(e,t),t&&t.feature?(n=Zre,i=t.feature):t&&t.mesh?(n=Qre,i=t.mesh,s=Oqe[t.filter]):ae("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,s):ae("Invalid TopoJSON object: "+i),r&&r.features||[r]}Xfe.responseType="json";const ak={dsv:_7,csv:nY(","),tsv:nY("	"),json:T7,topojson:Xfe};function I7(e,t){return arguments.length>1?(ak[e]=t,this):tt(ak,e)?ak[e]:null}function Rqe(e){const t=I7(e);return t&&t.responseType||"text"}function Mqe(e,t,n,r){t=t||{};const i=I7(t.type||"json");return i||ae("Unknown data format type: "+t.type),e=i(e,t),t.parse&&Lqe(e,t.parse,n,r),tt(e,"columns")&&delete e.columns,e}function Lqe(e,t,n,r){if(!e.length)return;const i=Wv();n=n||i.timeParse,r=r||i.utcParse;let s=e.columns||Object.keys(e[0]),o,a,u,l,c,f;t==="auto"&&(t=qfe(e,s)),s=Object.keys(t);const h=s.map(d=>{const p=t[d];let g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(g[0]==="utc"?r:n)(m);if(!tL[p])throw Error("Illegal format pattern: "+d+":"+p);return tL[p]});for(u=0,c=e.length,f=s.length;u<c;++u)for(o=e[u],l=0;l<f;++l)a=s[l],o[a]=h[l](o[a])}const D7=vqe(typeof fetch<"u"&&fetch,null);let Yfe=0;function Pqe(){Yfe=0}const cA="p_";function N7(e){return e&&e.gradient}function Kfe(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?cA:"";return i||(i=e.id="gradient_"+Yfe++,r==="radial"?(e.x1=qa(e.x1,.5),e.y1=qa(e.y1,.5),e.r1=qa(e.r1,0),e.x2=qa(e.x2,.5),e.y2=qa(e.y2,.5),e.r2=qa(e.r2,.5),s=cA):(e.x1=qa(e.x1,0),e.y1=qa(e.y1,0),e.x2=qa(e.x2,1),e.y2=qa(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function qa(e,t){return e??t}function Zfe(e,t){var n=[],r;return r={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(i,s){return n.push({offset:i,color:s}),r}}}const rY={basis:{curve:LHe},"basis-closed":{curve:PHe},"basis-open":{curve:BHe},bundle:{curve:zHe,tension:"beta",value:.85},cardinal:{curve:UHe,tension:"tension",value:0},"cardinal-open":{curve:WHe,tension:"tension",value:0},"cardinal-closed":{curve:jHe,tension:"tension",value:0},"catmull-rom":{curve:VHe,tension:"alpha",value:.5},"catmull-rom-closed":{curve:GHe,tension:"alpha",value:.5},"catmull-rom-open":{curve:HHe,tension:"alpha",value:.5},linear:{curve:$7},"linear-closed":{curve:qHe},monotone:{horizontal:YHe,vertical:XHe},natural:{curve:KHe},step:{curve:ZHe},"step-after":{curve:QHe},"step-before":{curve:JHe}};function F7(e,t,n){var r=tt(rY,e)&&rY[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const Bqe={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},mb=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function S0(e){const t=[];let n,r,i,s,o,a,u,l,c,f;const h=e.slice().replace(mb[0],"###$1").split(mb[1]).slice(1);for(u=0,c=h.length;u<c;++u){for(n=h[u],r=n.slice(1).trim().replace(mb[2],"$1###$2").replace(mb[3],"$1###$2").split(mb[4]),o=n.charAt(0),i=[o],l=0,f=r.length;l<f;++l)(s=+r[l])===s&&i.push(s);if(a=Bqe[o.toLowerCase()],i.length-1>a){const d=i.length;for(l=1,t.push([o].concat(i.slice(l,l+=a))),o=o==="M"?"L":o==="m"?"l":o;l<d;l+=a)t.push([o].concat(i.slice(l,l+a)))}else t.push(i)}return t}const nh=Math.PI/180,zqe=1e-14,Ad=Math.PI/2,su=Math.PI*2,am=Math.sqrt(3)/2;var vO={},wO={},Jfe=[].join;function Uqe(e,t,n,r,i,s,o,a,u){const l=Jfe.call(arguments);if(vO[l])return vO[l];const c=o*nh,f=Math.sin(c),h=Math.cos(c);n=Math.abs(n),r=Math.abs(r);const d=h*(a-e)*.5+f*(u-t)*.5,p=h*(u-t)*.5-f*(a-e)*.5;let g=d*d/(n*n)+p*p/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=h/n,y=f/n,b=-f/r,v=h/r,x=m*a+y*u,w=b*a+v*u,C=m*e+y*t,$=b*e+v*t;let k=1/((C-x)*(C-x)+($-w)*($-w))-.25;k<0&&(k=0);let E=Math.sqrt(k);s==i&&(E=-E);const A=.5*(x+C)-E*($-w),F=.5*(w+$)+E*(C-x),_=Math.atan2(w-F,x-A);let T=Math.atan2($-F,C-A)-_;T<0&&s===1?T+=su:T>0&&s===0&&(T-=su);const O=Math.ceil(Math.abs(T/(Ad+.001))),L=[];for(let M=0;M<O;++M){const P=_+M*T/O,G=_+(M+1)*T/O;L[M]=[A,F,P,G,n,r,f,h]}return vO[l]=L}function jqe(e){const t=Jfe.call(e);if(wO[t])return wO[t];var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7];const c=l*o,f=-u*a,h=u*o,d=l*a,p=Math.cos(i),g=Math.sin(i),m=Math.cos(s),y=Math.sin(s),b=.5*(s-i),v=Math.sin(b*.5),x=8/3*v*v/Math.sin(b),w=n+p-x*g,C=r+g+x*p,$=n+m,S=r+y,k=$+x*y,E=S-x*m;return wO[t]=[c*w+f*C,h*w+d*C,c*k+f*E,h*k+d*E,c*$+f*S,h*$+d*S]}const no=["l",0,0,0,0,0,0,0];function Wqe(e,t,n){const r=no[0]=e[0];if(r==="a"||r==="A")no[1]=t*e[1],no[2]=n*e[2],no[3]=e[3],no[4]=e[4],no[5]=e[5],no[6]=t*e[6],no[7]=n*e[7];else if(r==="h"||r==="H")no[1]=t*e[1];else if(r==="v"||r==="V")no[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)no[i]=(i%2==1?t:n)*e[i];return no}function Vv(e,t,n,r,i,s){var o,a=null,u=0,l=0,c=0,f=0,h,d,p,g;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var m=0,y=t.length;m<y;++m){switch(o=t[m],(i!==1||s!==1)&&(o=Wqe(o,i,s)),o[0]){case"l":u+=o[1],l+=o[2],e.lineTo(u+n,l+r);break;case"L":u=o[1],l=o[2],e.lineTo(u+n,l+r);break;case"h":u+=o[1],e.lineTo(u+n,l+r);break;case"H":u=o[1],e.lineTo(u+n,l+r);break;case"v":l+=o[1],e.lineTo(u+n,l+r);break;case"V":l=o[1],e.lineTo(u+n,l+r);break;case"m":u+=o[1],l+=o[2],e.moveTo(u+n,l+r);break;case"M":u=o[1],l=o[2],e.moveTo(u+n,l+r);break;case"c":h=u+o[5],d=l+o[6],c=u+o[3],f=l+o[4],e.bezierCurveTo(u+o[1]+n,l+o[2]+r,c+n,f+r,h+n,d+r),u=h,l=d;break;case"C":u=o[5],l=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,c+n,f+r,u+n,l+r);break;case"s":h=u+o[3],d=l+o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,u+o[1]+n,l+o[2]+r,h+n,d+r),c=u+o[1],f=l+o[2],u=h,l=d;break;case"S":h=o[3],d=o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"q":h=u+o[3],d=l+o[4],c=u+o[1],f=l+o[2],e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"Q":h=o[3],d=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"t":h=u+o[1],d=l+o[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-p,f=2*l-g):a[0]==="q"&&(c=2*u-c,f=2*l-f),p=c,g=f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d,c=u+o[1],f=l+o[2];break;case"T":h=o[1],d=o[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"a":iY(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+r]),u+=o[6],l+=o[7];break;case"A":iY(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),u=o[6],l=o[7];break;case"z":case"Z":e.closePath();break}a=o}}function iY(e,t,n,r){const i=Uqe(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const o=jqe(i[s]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const sY=.5773502691896257,oY={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,su)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n,i=r-n*sY,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n,i=r-n*sY;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Qfe(e){return tt(oY,e)?oY[e]:Vqe(e)}var $O={};function Vqe(e){if(!tt($O,e)){const t=S0(e);$O[e]={draw:function(n,r){Vv(n,t,0,0,Math.sqrt(r)/2)}}}return $O[e]}const Lc=.448084975506;function Gqe(e){return e.x}function Hqe(e){return e.y}function qqe(e){return e.width}function Xqe(e){return e.height}function gl(e){return typeof e=="function"?e:()=>+e}function uS(e,t,n){return Math.max(t,Math.min(e,n))}function ehe(){var e=Gqe,t=Hqe,n=qqe,r=Xqe,i=gl(0),s=i,o=i,a=i,u=null;function l(c,f,h){var d,p=f??+e.call(this,c),g=h??+t.call(this,c),m=+n.call(this,c),y=+r.call(this,c),b=Math.min(m,y)/2,v=uS(+i.call(this,c),0,b),x=uS(+s.call(this,c),0,b),w=uS(+o.call(this,c),0,b),C=uS(+a.call(this,c),0,b);if(u||(u=d=Sg()),v<=0&&x<=0&&w<=0&&C<=0)u.rect(p,g,m,y);else{var $=p+m,S=g+y;u.moveTo(p+v,g),u.lineTo($-x,g),u.bezierCurveTo($-Lc*x,g,$,g+Lc*x,$,g+x),u.lineTo($,S-C),u.bezierCurveTo($,S-Lc*C,$-Lc*C,S,$-C,S),u.lineTo(p+w,S),u.bezierCurveTo(p+Lc*w,S,p,S-Lc*w,p,S-w),u.lineTo(p,g+v),u.bezierCurveTo(p,g+Lc*v,p+Lc*v,g,p+v,g),u.closePath()}if(d)return u=null,d+""||null}return l.x=function(c){return arguments.length?(e=gl(c),l):e},l.y=function(c){return arguments.length?(t=gl(c),l):t},l.width=function(c){return arguments.length?(n=gl(c),l):n},l.height=function(c){return arguments.length?(r=gl(c),l):r},l.cornerRadius=function(c,f,h,d){return arguments.length?(i=gl(c),s=f!=null?gl(f):i,a=h!=null?gl(h):i,o=d!=null?gl(d):s,l):i},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function the(){var e,t,n,r,i=null,s,o,a,u;function l(f,h,d){const p=d/2;if(s){var g=a-h,m=f-o;if(g||m){var y=Math.sqrt(g*g+m*m),b=(g/=y)*u,v=(m/=y)*u,x=Math.atan2(m,g);i.moveTo(o-b,a-v),i.lineTo(f-g*p,h-m*p),i.arc(f,h,p,x-Math.PI,x),i.lineTo(o+b,a+v),i.arc(o,a,u,x,x+Math.PI)}else i.arc(f,h,p,0,su);i.closePath()}else s=1;o=f,a=h,u=p}function c(f){var h,d=f.length,p,g=!1,m;for(i==null&&(i=m=Sg()),h=0;h<=d;++h)!(h<d&&r(p=f[h],h,f))===g&&(g=!g)&&(s=0),g&&l(+e(p,h,f),+t(p,h,f),+n(p,h,f));if(m)return i=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(r=f,c):r},c.context=function(f){return arguments.length?(f==null?i=null:i=f,c):i},c}function w$(e,t){return e??t}const $$=e=>e.x||0,C$=e=>e.y||0,Yqe=e=>e.width||0,Kqe=e=>e.height||0,Zqe=e=>(e.x||0)+(e.width||0),Jqe=e=>(e.y||0)+(e.height||0),Qqe=e=>e.startAngle||0,eXe=e=>e.endAngle||0,tXe=e=>e.padAngle||0,nXe=e=>e.innerRadius||0,rXe=e=>e.outerRadius||0,iXe=e=>e.cornerRadius||0,sXe=e=>w$(e.cornerRadiusTopLeft,e.cornerRadius)||0,oXe=e=>w$(e.cornerRadiusTopRight,e.cornerRadius)||0,aXe=e=>w$(e.cornerRadiusBottomRight,e.cornerRadius)||0,uXe=e=>w$(e.cornerRadiusBottomLeft,e.cornerRadius)||0,lXe=e=>w$(e.size,64),cXe=e=>e.size||1,GD=e=>e.defined!==!1,fXe=e=>Qfe(e.shape||"circle"),hXe=OHe().startAngle(Qqe).endAngle(eXe).padAngle(tXe).innerRadius(nXe).outerRadius(rXe).cornerRadius(iXe),dXe=wfe().x($$).y1(C$).y0(Jqe).defined(GD),pXe=wfe().y(C$).x1($$).x0(Zqe).defined(GD),gXe=vfe().x($$).y(C$).defined(GD),mXe=ehe().x($$).y(C$).width(Yqe).height(Kqe).cornerRadius(sXe,oXe,aXe,uXe),yXe=MHe().type(fXe).size(lXe),bXe=the().x($$).y(C$).defined(GD).size(cXe);function O7(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function xXe(e,t){return hXe.context(e)(t)}function vXe(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?pXe:dXe).curve(F7(r,n.orient,n.tension)).context(e)(t)}function wXe(e,t){const n=t[0],r=n.interpolate||"linear";return gXe.curve(F7(r,n.orient,n.tension)).context(e)(t)}function dy(e,t,n,r){return mXe.context(e)(t,n,r)}function $Xe(e,t){return(t.mark.shape||t.shape).context(e)(t)}function CXe(e,t){return yXe.context(e)(t)}function SXe(e,t){return bXe.context(e)(t)}var nhe=1;function rhe(){nhe=1}function R7(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+nhe++),o=i.clipping[s]||(i.clipping[s]={id:s});return Pt(r)?o.path=r(null):O7(n)?o.path=dy(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function Wi(e){this.clear(),e&&this.union(e)}Wi.prototype={clone(){return new Wi(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*r-u*i+l,u*r+a*i+c,a*r-u*o+l,u*r+a*o+c,a*s-u*i+l,u*s+a*i+c,a*s-u*o+l,u*s+a*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function M7(e){this.mark=e,this.bounds=this.bounds||new Wi}function L7(e){M7.call(this,e),this.items=this.items||[]}ye(L7,M7);function P7(e){this._pending=0,this._loader=e||D7()}function aY(e){e._pending+=1}function yb(e){e._pending-=1}P7.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return aY(t),t._loader.sanitize(e,{context:"href"}).then(n=>(yb(t),n)).catch(()=>(yb(t),null))},loadImage(e){const t=this,n=Coe();return aY(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,o=tt(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>yb(t),s.onerror=()=>yb(t),s.src=i,s}).catch(r=>(yb(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}n(!1)})}};function kg(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?kXe(t,r):0))}return e}function kXe(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const EXe=su-1e-8;let HD,uk,lk,zd,nL,ck,rL,iL;const sf=(e,t)=>HD.add(e,t),fk=(e,t)=>sf(uk=e,lk=t),uY=e=>sf(e,HD.y1),lY=e=>sf(HD.x1,e),_d=(e,t)=>nL*e+rL*t,Td=(e,t)=>ck*e+iL*t,CO=(e,t)=>sf(_d(e,t),Td(e,t)),SO=(e,t)=>fk(_d(e,t),Td(e,t));function S$(e,t){return HD=e,t?(zd=t*nh,nL=iL=Math.cos(zd),ck=Math.sin(zd),rL=-ck):(nL=iL=1,zd=ck=rL=0),AXe}const AXe={beginPath(){},closePath(){},moveTo:SO,lineTo:SO,rect(e,t,n,r){zd?(CO(e+n,t),CO(e+n,t+r),CO(e,t+r),SO(e,t)):(sf(e+n,t+r),fk(e,t))},quadraticCurveTo(e,t,n,r){const i=_d(e,t),s=Td(e,t),o=_d(n,r),a=Td(n,r);cY(uk,i,o,uY),cY(lk,s,a,lY),fk(o,a)},bezierCurveTo(e,t,n,r,i,s){const o=_d(e,t),a=Td(e,t),u=_d(n,r),l=Td(n,r),c=_d(i,s),f=Td(i,s);fY(uk,o,u,c,uY),fY(lk,a,l,f,lY),fk(c,f)},arc(e,t,n,r,i,s){if(r+=zd,i+=zd,uk=n*Math.cos(i)+e,lk=n*Math.sin(i)+t,Math.abs(i-r)>EXe)sf(e-n,t-n),sf(e+n,t+n);else{const o=l=>sf(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(o(r),o(i),i!==r)if(r=r%su,r<0&&(r+=su),i=i%su,i<0&&(i+=su),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=su,a=r-r%Ad,u=0;u<4&&a>i;++u,a-=Ad)o(a);else for(a=r-r%Ad+Ad,u=0;u<4&&a<i;++u,a=a+Ad)o(a)}}};function cY(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function fY(e,t,n,r,i){const s=r-e+3*t-3*n,o=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(s)>zqe?(c=o*o+a*s,c>=0&&(c=Math.sqrt(c),u=(-o+c)/s,l=(-o-c)/s)):u=.5*a/o,0<u&&u<1&&i(hY(u,e,t,n,r)),0<l&&l<1&&i(hY(l,e,t,n,r))}function hY(e,t,n,r,i){const s=1-e,o=s*s,a=e*e;return o*s*t+3*o*e*n+3*s*a*r+a*e*i}var Cf=(Cf=xc(1,1))?Cf.getContext("2d"):null;const sL=new Wi;function B7(e){return function(t,n){if(!Cf)return!0;e(Cf,t),sL.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=sL;for(let a=i;a<=o;++a)for(let u=r;u<=s;++u)if(Cf.isPointInPath(u,a))return!0;return!1}}function z7(e,t){return t.contains(e.x||0,e.y||0)}function ihe(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(sL.set(n,r,n+i,r+s))}function she(e,t){const n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:r;return km(t,n,r,i,s)}function km(e,t,n,r,i){const{x1:s,y1:o,x2:a,y2:u}=e,l=r-t,c=i-n;let f=0,h=1,d,p,g,m;for(m=0;m<4;++m){if(m===0&&(d=-l,p=-(s-t)),m===1&&(d=l,p=a-t),m===2&&(d=-c,p=-(o-n)),m===3&&(d=c,p=u-n),Math.abs(d)<1e-10&&p<0)return!1;if(g=p/d,d<0){if(g>h)return!1;g>f&&(f=g)}else if(d>0){if(g<f)return!1;g<h&&(h=g)}}return!0}function k0(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Xo(e,t){return e??t}function dY(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function _Xe(e,t,n){const r=n.width(),i=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+Xo(t.x1,.5)*r,n.y1+Xo(t.y1,.5)*i,Math.max(r,i)*Xo(t.r1,0),n.x1+Xo(t.x2,.5)*r,n.y1+Xo(t.y2,.5)*i,Math.max(r,i)*Xo(t.r2,.5));else{const o=Xo(t.x1,0),a=Xo(t.y1,0),u=Xo(t.x2,1),l=Xo(t.y2,0);if(o===u||a===l||r===i)s=e.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+u*r,n.y1+l*i);else{const c=xc(Math.ceil(r),Math.ceil(i)),f=c.getContext("2d");return f.scale(r,i),f.fillStyle=dY(f.createLinearGradient(o,a,u,l),t.stops),f.fillRect(0,0,r,i),e.createPattern(c,"no-repeat")}}return dY(s,t.stops)}function ohe(e,t,n){return N7(n)?_Xe(e,n,t.bounds):n}function fA(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=ohe(e,t,t.fill),!0):!1}var TXe=[];function E0(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return r<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=ohe(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||TXe),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function IXe(e,t){return e.zindex-t.zindex||e.index-t.index}function U7(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,s;for(i=0,s=t.length;i<s;++i)r=t[i],r.index=i,r.zindex&&n.push(r);return e.zdirty=!1,e.zitems=n.sort(IXe)}function ka(e,t){var n=e.items,r,i;if(!n||!n.length)return;const s=U7(e);if(s&&s.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||t(n[r]);n=s}for(r=0,i=n.length;r<i;++r)t(n[r])}function hA(e,t){var n=e.items,r,i;if(!n||!n.length)return null;const s=U7(e);for(s&&s.length&&(n=s),i=n.length;--i>=0;)if(r=t(n[i]))return r;if(n===s){for(n=e.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=t(n[i])))return r}return null}function j7(e){return function(t,n,r){ka(n,i=>{(!r||r.intersects(i.bounds))&&ahe(e,t,i,i)})}}function DXe(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&ahe(e,t,n.items[0],n.items)}}function ahe(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(k0(t,n),n.fill&&fA(t,n,i)&&t.fill(),n.stroke&&E0(t,n,i)&&t.stroke()))}function qD(e){return e=e||K1,function(t,n,r,i,s,o){return r*=t.pixelRatio,i*=t.pixelRatio,hA(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&e(t,a,r,i,s,o))return a})}}function k$(e,t){return function(n,r,i,s){var o=Array.isArray(r)?r[0]:r,a=t??o.fill,u=o.stroke&&n.isPointInStroke,l,c;return u&&(l=o.strokeWidth,c=o.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,r)?!1:a&&n.isPointInPath(i,s)||u&&n.isPointInStroke(i,s)}}function W7(e){return qD(k$(e))}function np(e,t){return"translate("+e+","+t+")"}function V7(e){return"rotate("+e+")"}function NXe(e,t){return"scale("+e+","+t+")"}function uhe(e){return np(e.x||0,e.y||0)}function FXe(e){return np(e.x||0,e.y||0)+(e.angle?" "+V7(e.angle):"")}function OXe(e){return np(e.x||0,e.y||0)+(e.angle?" "+V7(e.angle):"")+(e.scaleX||e.scaleY?" "+NXe(e.scaleX||1,e.scaleY||1):"")}function G7(e,t,n){function r(o,a){o("transform",FXe(a)),o("d",t(null,a))}function i(o,a){return t(S$(o,a.angle),a),kg(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,l=a.y||0,c=a.angle||0;o.translate(u,l),c&&o.rotate(c*=nh),o.beginPath(),t(o,a),c&&o.rotate(-c),o.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:r,bound:i,draw:j7(s),pick:W7(s),isect:n||B7(s)}}var RXe=G7("arc",xXe);function MXe(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,s=1/0,o,a;--i>=0;)e[i].defined!==!1&&(a=Math.abs(e[i][r]-n),a<s&&(s=a,o=e[i]));return o}function LXe(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,s,o;--r>=0;)if(e[r].defined!==!1&&(i=e[r].x-t[0],s=e[r].y-t[1],o=i*i+s*s,o<n))return e[r];return null}function PXe(e,t){for(var n=e.length,r,i,s;--n>=0;)if(e[n].defined!==!1&&(r=e[n].x-t[0],i=e[n].y-t[1],s=r*r+i*i,r=e[n].size||1,s<r*r))return e[n];return null}function H7(e,t,n){function r(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function i(u,l){var c=l.items;return c.length===0?u:(t(S$(u),c),kg(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const o=k$(s);function a(u,l,c,f,h,d){var p=l.items,g=l.bounds;return!p||!p.length||g&&!g.contains(h,d)?null:(c*=u.pixelRatio,f*=u.pixelRatio,o(u,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:r,bound:i,draw:DXe(s),pick:a,isect:z7,tip:n}}var BXe=H7("area",vXe,MXe);function zXe(e,t){var n=t.clip;e.save(),Pt(n)?(e.beginPath(),n(e),e.clip()):lhe(e,t.group)}function lhe(e,t){e.beginPath(),O7(t)?dy(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function che(e){const t=Xo(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function UXe(e,t){e("transform",uhe(t))}function fhe(e,t){const n=che(t);e("d",dy(null,t,n,n))}function jXe(e,t){e("class","background"),e("aria-hidden",!0),fhe(e,t)}function WXe(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?fhe(e,t):e("d","")}function VXe(e,t,n){const r=t.clip?R7(n,t,t):null;e("clip-path",r)}function GXe(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),kg(e,t),e.translate(t.x||0,t.y||0)}function Gv(e,t,n,r){const i=che(t);e.beginPath(),dy(e,t,(n||0)+i,(r||0)+i)}const HXe=k$(Gv),qXe=k$(Gv,!1),XXe=k$(Gv,!0);function YXe(e,t,n){ka(t,r=>{const i=r.x||0,s=r.y||0,o=r.strokeForeground,a=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&a&&(Gv(e,r,i,s),k0(e,r),r.fill&&fA(e,r,a)&&e.fill(),r.stroke&&!o&&E0(e,r,a)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&lhe(e,r),n&&n.translate(-i,-s),ka(r,u=>{this.draw(e,u,n)}),n&&n.translate(i,s),e.restore(),o&&r.stroke&&a&&(Gv(e,r,i,s),k0(e,r),E0(e,r,a)&&e.stroke())})}function KXe(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const o=n*e.pixelRatio,a=r*e.pixelRatio;return hA(t,u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,s))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(i<c||i>d||s<f||s>p))return;if(e.save(),e.translate(c,f),c=i-c,f=s-f,g&&O7(u)&&!XXe(e,u,o,a))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&qXe(e,u,o,a)?(e.restore(),u):(l=hA(u,b=>ZXe(b,c,f)?this.pick(b,n,r,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&HXe(e,u,o,a)&&(l=u),e.restore(),l||null)})}function ZXe(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var JXe={type:"group",tag:"g",nested:!1,attr:UXe,bound:GXe,draw:YXe,pick:KXe,isect:ihe,content:VXe,background:jXe,foreground:WXe},Hv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function q7(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function X7(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function Y7(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function XD(e,t){return e==="center"?t/2:e==="right"?t:0}function YD(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function QXe(e,t,n){const r=q7(t,n),i=X7(t,r),s=Y7(t,r),o=(t.x||0)-XD(t.align,i),a=(t.y||0)-YD(t.baseline,s),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",u,Hv["xmlns:xlink"],"xlink:href"),e("transform",np(o,a)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function eYe(e,t){const n=t.image,r=X7(t,n),i=Y7(t,n),s=(t.x||0)-XD(t.align,r),o=(t.y||0)-YD(t.baseline,i);return e.set(s,o,s+r,o+i)}function tYe(e,t,n){ka(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=q7(r,this);let s=X7(r,i),o=Y7(r,i);if(s===0||o===0)return;let a=(r.x||0)-XD(r.align,s),u=(r.y||0)-YD(r.baseline,o),l,c,f,h;r.aspect!==!1&&(c=i.width/i.height,f=r.width/r.height,c===c&&f===f&&c!==f&&(f<c?(h=s/c,u+=(o-h)/2,o=h):(h=o*c,a+=(s-h)/2,s=h))),(i.complete||i.toDataURL)&&(k0(e,r),e.globalAlpha=(l=r.opacity)!=null?l:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,a,u,s,o))})}var nYe={type:"image",tag:"image",nested:!1,attr:QXe,bound:eYe,draw:tYe,pick:qD(),isect:K1,get:q7,xOffset:XD,yOffset:YD},rYe=H7("line",wXe,LXe);function iYe(e,t){var n=t.scaleX||1,r=t.scaleY||1;(n!==1||r!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",OXe(t)),e("d",t.path)}function hk(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,o=t.scaleY||1,a=(t.angle||0)*nh,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=S0(n)).path=n),a&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(a),Vv(e,u,0,0,s,o),e.rotate(-a),e.translate(-r,-i)):Vv(e,u,r,i,s,o)}function sYe(e,t){return hk(S$(e,t.angle),t)?e.set(0,0,0,0):kg(e,t,!0)}var oYe={type:"path",tag:"path",nested:!1,attr:iYe,bound:sYe,draw:j7(hk),pick:W7(hk),isect:B7(hk)};function aYe(e,t){e("d",dy(null,t))}function uYe(e,t){var n,r;return kg(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function pY(e,t){e.beginPath(),dy(e,t)}var lYe={type:"rect",tag:"path",nested:!1,attr:aYe,bound:uYe,draw:j7(pY),pick:W7(pY),isect:ihe};function cYe(e,t){e("transform",uhe(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function fYe(e,t){var n,r;return kg(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function hhe(e,t,n){var r,i,s,o;return t.stroke&&E0(e,t,n)?(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),!0):!1}function hYe(e,t,n){ka(t,r=>{if(!(n&&!n.intersects(r.bounds))){var i=r.opacity==null?1:r.opacity;i&&hhe(e,r,i)&&(k0(e,r),e.stroke())}})}function dYe(e,t,n,r){return e.isPointInStroke?hhe(e,t,1)&&e.isPointInStroke(n,r):!1}var pYe={type:"rule",tag:"line",nested:!1,attr:cYe,bound:fYe,draw:hYe,pick:qD(dYe),isect:she},gYe=G7("shape",$Xe),mYe=G7("symbol",CXe,z7);const gY=jre();var yu={height:qu,measureWidth:K7,estimateWidth:oL,width:oL,canvas:dhe};dhe(!0);function dhe(e){yu.width=e&&Cf?K7:oL}function oL(e,t){return phe(ih(e,t),qu(e))}function phe(e,t){return~~(.8*e.length*t)}function K7(e,t){return qu(e)<=0||!(t=ih(e,t))?0:ghe(t,KD(e))}function ghe(e,t){const n=`(${t}) ${e}`;let r=gY.get(n);return r===void 0&&(Cf.font=t,r=Cf.measureText(e).width,gY.set(n,r)),r}function qu(e){return e.fontSize!=null?+e.fontSize||0:11}function rh(e){return e.lineHeight!=null?e.lineHeight:qu(e)+2}function yYe(e){return rt(e)?e.length>1?e:e[0]:e}function E$(e){return yYe(e.lineBreak&&e.text&&!rt(e.text)?e.text.split(e.lineBreak):e.text)}function bYe(e){const t=E$(e);return(rt(t)?t.length-1:0)*rh(e)}function ih(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?vYe(e,n):n}function xYe(e){if(yu.width===K7){const t=KD(e);return n=>ghe(n,t)}else{const t=qu(e);return n=>phe(n,t)}}function vYe(e,t){var n=+e.limit,r=xYe(e);if(r(t)<n)return t;var i=e.ellipsis||"…",s=e.dir==="rtl",o=0,a=t.length,u;if(n-=r(i),s){for(;o<a;)u=o+a>>>1,r(t.slice(u))>n?o=u+1:a=u;return i+t.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),r(t.slice(0,u))<n?o=u:a=u-1;return t.slice(0,o)+i}}function A$(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function KD(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+qu(e)+"px "+A$(e,t)}function Z7(e){var t=e.baseline,n=qu(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*rh(e):t==="line-bottom"?.29*n-.5*rh(e):0)}const wYe={left:"start",center:"middle",right:"end"},Cx=new Wi;function ZD(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;return r&&(i=(e.theta||0)-Ad,t+=r*Math.cos(i),n+=r*Math.sin(i)),Cx.x1=t,Cx.y1=n,Cx}function $Ye(e,t){var n=t.dx||0,r=(t.dy||0)+Z7(t),i=ZD(t),s=i.x1,o=i.y1,a=t.angle||0,u;e("text-anchor",wYe[t.align]||"start"),a?(u=np(s,o)+" "+V7(a),(n||r)&&(u+=" "+np(n,r))):u=np(s+n,o+r),e("transform",u)}function J7(e,t,n){var r=yu.height(t),i=t.align,s=ZD(t),o=s.x1,a=s.y1,u=t.dx||0,l=(t.dy||0)+Z7(t)-Math.round(.8*r),c=E$(t),f;if(rt(c)?(r+=rh(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,yu.width(t,d)),0)):f=yu.width(t,c),i==="center"?u-=f/2:i==="right"&&(u-=f),e.set(u+=o,l+=a,u+f,l+r),t.angle&&!n)e.rotate(t.angle*nh,o,a);else if(n===2)return e.rotatedPoints(t.angle*nh,o,a);return e}function CYe(e,t,n){ka(t,r=>{var i=r.opacity==null?1:r.opacity,s,o,a,u,l,c,f;if(!(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=KD(r),e.textAlign=r.align||"left",s=ZD(r),o=s.x1,a=s.y1,r.angle&&(e.save(),e.translate(o,a),e.rotate(r.angle*nh),o=a=0),o+=r.dx||0,a+=(r.dy||0)+Z7(r),c=E$(r),k0(e,r),rt(c))for(l=rh(r),u=0;u<c.length;++u)f=ih(r,c[u]),r.fill&&fA(e,r,i)&&e.fillText(f,o,a),r.stroke&&E0(e,r,i)&&e.strokeText(f,o,a),a+=l;else f=ih(r,c),r.fill&&fA(e,r,i)&&e.fillText(f,o,a),r.stroke&&E0(e,r,i)&&e.strokeText(f,o,a);r.angle&&e.restore()}})}function SYe(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=ZD(t),a=o.x1,u=o.y1,l=J7(Cx,t,1),c=-t.angle*nh,f=Math.cos(c),h=Math.sin(c),d=f*i-h*s+(a-f*a+h*u),p=h*i+f*s+(u-h*a-f*u);return l.contains(d,p)}function kYe(e,t){const n=J7(Cx,e,2);return km(t,n[0],n[1],n[2],n[3])||km(t,n[0],n[1],n[4],n[5])||km(t,n[4],n[5],n[6],n[7])||km(t,n[2],n[3],n[6],n[7])}var EYe={type:"text",tag:"text",nested:!1,attr:$Ye,bound:J7,draw:CYe,pick:qD(SYe),isect:kYe},AYe=H7("trail",SXe,PXe),Do={arc:RXe,area:BXe,group:JXe,image:nYe,line:rYe,path:oYe,rect:lYe,rule:pYe,shape:gYe,symbol:mYe,text:EYe,trail:AYe};function aL(e,t,n){var r=Do[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new Wi),e,n)}var mY={mark:null};function mhe(e,t,n){var r=Do[e.marktype],i=r.bound,s=e.items,o=s&&s.length,a,u,l,c;if(r.nested)return o?l=s[0]:(mY.mark=e,l=mY),c=aL(l,i,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new Wi,o)for(a=0,u=s.length;a<u;++a)t.union(aL(s[a],i,n));return e.bounds=t}const _Ye=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function yhe(e,t){return JSON.stringify(e,_Ye,t)}function bhe(e){const t=typeof e=="string"?JSON.parse(e):e;return xhe(t)}function xhe(e){var t=e.marktype,n=e.items,r,i,s;if(n)for(i=0,s=n.length;i<s;++i)r=t?"mark":"group",n[i][r]=e,n[i].zindex&&(n[i][r].zdirty=!0),(t||r)==="group"&&xhe(n[i]);return t&&mhe(e),e}function Q7(e){arguments.length?this.root=bhe(e):(this.root=vhe({marktype:"group",name:"root",role:"frame"}),this.root.items=[new L7(this.root)])}Q7.prototype={toJSON(e){return yhe(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const r=vhe(e,t);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}};function vhe(e,t){const n={bounds:new Wi,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function of(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function e9(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function ss(e,t,n,r){var i=e.childNodes[t],s;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(s=i||null,i=of(e.ownerDocument,n,r),e.insertBefore(i,s)),i}function ca(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function whe(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function JD(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function TYe(e,t,n,r){var i=e&&e.mark,s,o;if(i&&(s=Do[i.marktype]).tip){for(o=JD(t,n),o[0]-=r[0],o[1]-=r[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=s.tip(i.items,o)}return e}function sh(e,t){this._active=null,this._handlers={},this._loader=e||D7(),this._tooltip=t||IYe}function IYe(e,t,n,r){e.element().setAttribute("title",r||"")}sh.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=of(null,"a");for(const o in r)s.setAttribute(o,r[o]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=TYe(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),o=i.height();let a=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function Xu(e){this._el=null,this._bgcolor=null,this._loader=new P7(e)}Xu.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const DYe="keydown",NYe="keypress",FYe="keyup",$he="dragenter",dk="dragleave",Che="dragover",uL="mousedown",OYe="mouseup",dA="mousemove",Sx="mouseout",She="mouseover",pA="click",RYe="dblclick",MYe="wheel",khe="mousewheel",gA="touchstart",mA="touchmove",yA="touchend",LYe=[DYe,NYe,FYe,$he,dk,Che,uL,OYe,dA,Sx,She,pA,RYe,MYe,khe,gA,mA,yA],lL=dA,qv=Sx,cL=pA;function _$(e,t){sh.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const PYe=e=>e===gA||e===mA||e===yA?[gA,mA,yA]:[e];function yY(e,t){PYe(t).forEach(n=>BYe(e,n))}function BYe(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?r=>e[t](r):r=>e.fire(t,r)))}function bY(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):((!i||!i.exit)&&this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function xY(e){return function(t){this.fire(e,t),this._active=null}}ye(_$,sh,{initialize(e,t,n){return this._canvas=e&&e9(e,"canvas"),[pA,uL,dA,Sx,dk].forEach(r=>yY(this,r)),sh.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:LYe,DOMMouseScroll(e){this.fire(khe,e)},mousemove:bY(dA,She,Sx),dragover:bY(Che,$he,dk),mouseout:xY(Sx),dragleave:xY(dk),mousedown(e){this._down=this._active,this.fire(uL,e)},click(e){this._down===this._active&&(this.fire(pA,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(gA,e,!0)},touchmove(e){this.fire(mA,e,!0)},touchend(e){this.fire(yA,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===cL&&r&&r.href?this.handleHref(t,r,r.href):(e===lL||e===qv)&&this.handleTooltip(t,r,e!==qv),i)for(let s=0,o=i.length;s<o;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(yY(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=JD(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return Do[e.marktype].pick.call(this,s,e,t,n,r,i)}});function zYe(){return typeof window<"u"&&window.devicePixelRatio||1}var UYe=zYe();function jYe(e,t,n,r,i,s){const o=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=o?UYe:i;e.width=t*u,e.height=n*u;for(const l in s)a[l]=s[l];return o&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*r[0],u*r[1]),e}function bA(e){Xu.call(this,e),this._options={},this._redraw=!1,this._dirty=new Wi,this._tempb=new Wi}const vY=Xu.prototype,WYe=(e,t,n)=>new Wi().set(0,0,t,n).translate(-e[0],-e[1]);function VYe(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}ye(bA,Xu,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:xc(1,1,this._options.type),e&&this._canvas&&(ca(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),vY.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(vY.resize.call(this,e,t,n,r),this._canvas)jYe(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||ae("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,o=WYe(n,r,i);t.save();const a=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):VYe(t,o.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,a),t.restore(),s.clear(),this},draw(e,t,n){const r=Do[t.marktype];t.clip&&zXe(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type!=="pdf"&&!i.externalContext&&s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});function t9(e,t){sh.call(this,e,t);const n=this;n._hrefHandler=fL(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=fL(n,(r,i)=>{n.handleTooltip(r,i,r.type!==qv)})}const fL=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};ye(t9,sh,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(cL,this._hrefHandler),r.removeEventListener(lL,this._tooltipHandler),r.removeEventListener(qv,this._tooltipHandler)),this._svg=r=e&&e9(e,"svg"),r&&(r.addEventListener(cL,this._hrefHandler),r.addEventListener(lL,this._tooltipHandler),r.addEventListener(qv,this._tooltipHandler)),sh.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const s={type:e,handler:t,listener:fL(this,t)};(r[n]||(r[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const Ehe="aria-hidden",n9="aria-label",r9="role",i9="aria-roledescription",Ahe="graphics-object",s9="graphics-symbol",_he=(e,t,n)=>({[r9]:e,[i9]:t,[n9]:n||void 0}),GYe=ic(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),wY={axis:{desc:"axis",caption:XYe},legend:{desc:"legend",caption:YYe},"title-text":{desc:"title",caption:e=>`Title text '${CY(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${CY(e)}'`}},$Y={ariaRole:r9,ariaRoleDescription:i9,description:n9};function The(e,t){const n=t.aria===!1;if(e(Ehe,n||void 0),n||t.description==null)for(const r in $Y)e($Y[r],void 0);else{const r=t.mark.marktype;e(n9,t.description),e(r9,t.ariaRole||(r==="group"?Ahe:s9)),e(i9,t.ariaRoleDescription||`${r} mark`)}}function Ihe(e){return e.aria===!1?{[Ehe]:!0}:GYe[e.role]?null:wY[e.role]?qYe(e,wY[e.role]):HYe(e)}function HYe(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(r=>r.description!=null&&r.aria!==!1);return _he(n?Ahe:s9,`${t} mark container`,e.description)}function qYe(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return _he(t.role||s9,t.desc,n.description||r(n))}catch{return null}}function CY(e){return Qe(e.text).join(" ")}function XYe(e){const t=e.datum,n=e.orient,r=t.title?Dhe(e):null,i=e.context,s=i.scales[t.scale].value,o=i.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${y0(a)?"discrete":a} scale with ${Vle(o,s,e)}`}function YYe(e){const t=e.datum,n=t.title?Dhe(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),o=e.context,a=o.scales[i[s[0]]].value,u=o.dataflow.locale();return ZYe(r)+(n?` titled '${n}'`:"")+` for ${KYe(s)} with ${Vle(u,a,e)}`}function Dhe(e){try{return Qe(qt(e.items).items[0].text).join(" ")}catch{return null}}function KYe(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+qt(e)}function ZYe(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const Nhe=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),JYe=e=>Nhe(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function o9(){let e="",t="",n="";const r=[],i=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,i()),r.push(u)},o=(u,l)=>(l!=null&&(t+=` ${u}="${JYe(l)}"`),a),a={open(u,...l){s(u),t="<"+u;for(const c of l)for(const f in c)o(f,c[f]);return a},close(){const u=r.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,i(),a},attr:o,text:u=>(n+=Nhe(u),a),toString:()=>e};return a}const Fhe=e=>Ohe(o9(),e)+"";function Ohe(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let i=0;i<r;++i)e.attr(n[i].name,n[i].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let i=0;i<r;i++){const s=n[i];s.nodeType===3?e.text(s.nodeValue):Ohe(e,s)}}return e.close()}const xA={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Rhe={fill:"none","stroke-miterlimit":10},bb=0,SY="http://www.w3.org/2000/xmlns/",Jn=Hv.xmlns;function a9(e){Xu.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const kO=Xu.prototype;ye(a9,Xu,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=ss(e,0,"svg",Jn),this._svg.setAttributeNS(SY,"xmlns",Jn),this._svg.setAttributeNS(SY,"xmlns:xlink",Hv["xmlns:xlink"]),this._svg.setAttribute("version",Hv.version),this._svg.setAttribute("class","marks"),ca(e,1),this._root=ss(this._svg,bb,"g",Jn),af(this._root,Rhe),ca(this._svg,bb+1)),this.background(this._bgcolor),kO.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),kO.background.apply(this,arguments)},resize(e,t,n,r){return kO.resize.call(this,e,t,n,r),this._svg&&(af(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=ss(e,bb,"rect",Jn),af(n,{width:this._width,height:this._height,fill:t}));const r=Fhe(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),ca(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,o,a,u;for(o=0,a=e.length;o<a;++o)if(n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,s=Do[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,kY(n,t),r.items.forEach(l=>{l.dirty=t})),!r.zdirty){if(n.exit){s.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?r.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,kY(n,t)):this._update(s,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=Do[t.marktype],s=t.interactive===!1?"none":null,o=i.tag==="g";let a=null,u=0;const l=EY(t,e,n,"g",r);l.setAttribute("class",whe(t));const c=Ihe(t);for(const h in c)_i(l,h,c[h]);o||_i(l,"pointer-events",s),_i(l,"clip-path",t.clip?R7(this,t,t.group):null);const f=h=>{const d=this.isDirty(h),p=EY(h,l,a,i.tag,r);d&&(this._update(i,p,h),o&&tKe(this,p,h)),a=p,++u};return i.nested?t.items.length&&f(t.items[0]):ka(t,f),ca(l,u),l},_update(e,t,n){Ul=t,ei=t.__values__,The(kx,n),e.attr(kx,n,this);const r=rKe[e.type];r&&r.call(this,e,t,n),Ul&&this.style(Ul,n)},style(e,t){if(t!=null)for(const n in xA){let r=n==="font"?A$(t):t[n];if(r===ei[n])continue;const i=xA[n];r==null?e.removeAttribute(i):(N7(r)&&(r=Kfe(r,this._defs.gradient,Mhe())),e.setAttribute(i,r+"")),ei[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=ss(e,bb+1,"defs",Jn)),r=QYe(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=ss(e,bb+1,"defs",Jn)),r=eKe(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):ca(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function kY(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function QYe(e,t,n){let r,i,s;if(t.gradient==="radial"){let o=ss(e,n++,"pattern",Jn);af(o,{id:cA+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=ss(o,0,"rect",Jn),af(o,{width:1,height:1,fill:`url(${Mhe()}#${t.id})`}),e=ss(e,n++,"radialGradient",Jn),af(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=ss(e,n++,"linearGradient",Jn),af(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)s=ss(e,r,"stop",Jn),s.setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return ca(e,r),n}function eKe(e,t,n){let r;return e=ss(e,n,"clipPath",Jn),e.setAttribute("id",t.id),t.path?(r=ss(e,0,"path",Jn),r.setAttribute("d",t.path)):(r=ss(e,0,"rect",Jn),af(r,{x:0,y:0,width:t.width,height:t.height})),ca(e,1),n+1}function tKe(e,t,n){t=t.lastChild.previousSibling;let r,i=0;ka(n,s=>{r=e.mark(t,s,r),++i}),ca(t,1+i)}function EY(e,t,n,r,i){let s=e._svg,o;if(!s&&(o=t.ownerDocument,s=of(o,r,Jn),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},r==="g"))){const a=of(o,"path",Jn);s.appendChild(a),a.__data__=e;const u=of(o,"g",Jn);s.appendChild(u),u.__data__=e;const l=of(o,"path",Jn);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==i||nKe(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function nKe(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Ul=null,ei=null;const rKe={group(e,t,n){const r=Ul=t.childNodes[2];ei=r.__values__,e.foreground(kx,n,this),ei=t.__values__,Ul=t.childNodes[1],e.content(kx,n,this);const i=Ul=t.childNodes[0];e.background(kx,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==ei.events&&(_i(r,"pointer-events",s),_i(i,"pointer-events",s),ei.events=s),n.strokeForeground&&n.stroke){const o=n.fill;_i(r,"display",null),this.style(i,n),_i(i,"stroke",null),o&&(n.fill=null),ei=r.__values__,this.style(r,n),o&&(n.fill=o),Ul=null}else _i(r,"display","none")},image(e,t,n){n.smooth===!1?(EO(t,"image-rendering","optimizeSpeed"),EO(t,"image-rendering","pixelated")):EO(t,"image-rendering",null)},text(e,t,n){const r=E$(n);let i,s,o,a;rt(r)?(s=r.map(u=>ih(n,u)),i=s.join(`
`),i!==ei.text&&(ca(t,0),o=t.ownerDocument,a=rh(n),s.forEach((u,l)=>{const c=of(o,"tspan",Jn);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),ei.text=i)):(s=ih(n,r),s!==ei.text&&(t.textContent=s,ei.text=s)),_i(t,"font-family",A$(n)),_i(t,"font-size",qu(n)+"px"),_i(t,"font-style",n.fontStyle),_i(t,"font-variant",n.fontVariant),_i(t,"font-weight",n.fontWeight)}};function kx(e,t,n){t!==ei[e]&&(n?iKe(Ul,e,t,n):_i(Ul,e,t),ei[e]=t)}function EO(e,t,n){n!==ei[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),ei[t]=n)}function af(e,t){for(const n in t)_i(e,n,t[n])}function _i(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function iKe(e,t,n,r){n!=null?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}function Mhe(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function u9(e){Xu.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}ye(u9,Xu,{svg(){return this._text},_render(e){const t=o9();t.open("svg",pt({},Hv,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Rhe,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Do[t.marktype],r=n.tag,i=[The,n.attr];e.open("g",{class:whe(t),"clip-path":t.clip?R7(this,t,t.group):null},Ihe(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&e.open("a",a),e.open(r,this.attr(t,o,i,r!=="g"?r:null)),r==="text"){const u=E$(o);if(rt(u)){const l={x:0,dy:rh(o)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(ih(o,u[c])).close()}else e.text(ih(o,u))}else if(r==="g"){const u=o.strokeForeground,l=o.fill,c=o.stroke;u&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),ka(o,f=>this.mark(e,f)),e.close(),u&&c?(l&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),l&&(o.fill=l)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):ka(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(o,a,u,l)=>{i[l||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,t,this)):n(s,t,this),r&&sKe(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const i in t){const s=t[i],o=s.stops;s.gradient==="radial"?(e.open("pattern",{id:cA+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):e.open("linearGradient",{id:i,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)e.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();e.close()}for(const i in n){const s=n[i];e.open("clipPath",{id:i}),s.path?e.open("path",{d:s.path}).close():e.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),e.close()}e.close()}}});function sKe(e,t,n,r,i){if(t==null||(r==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;r==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),r==="text"&&(e["font-family"]=A$(t),e["font-size"]=qu(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const s in xA){let o=t[s];const a=xA[s];o==="transparent"&&(a==="fill"||a==="stroke")||o!=null&&(N7(o)&&(o=Kfe(o,i.gradient,"")),e[a]=o)}return e}const Lhe="canvas",Phe="png",Bhe="svg",zhe="none",uf={Canvas:Lhe,PNG:Phe,SVG:Bhe,None:zhe},A0={};A0[Lhe]=A0[Phe]={renderer:bA,headless:bA,handler:_$};A0[Bhe]={renderer:a9,headless:u9,handler:t9};A0[zhe]={};function QD(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(A0[e]=t,this):A0[e]}function Uhe(e,t,n){const r=[],i=new Wi().union(t),s=e.marktype;return s?jhe(e,i,n,r):s==="group"?Whe(e,i,n,r):ae("Intersect scene must be mark node or group item.")}function jhe(e,t,n,r){if(oKe(e,t,n)){const i=e.items,s=e.marktype,o=i.length;let a=0;if(s==="group")for(;a<o;++a)Whe(i[a],t,n,r);else for(const u=Do[s].isect;a<o;++a){const l=i[a];Vhe(l,t,u)&&r.push(l)}}return r}function oKe(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function Whe(e,t,n,r){n&&n(e.mark)&&Vhe(e,t,Do.group.isect)&&r.push(e);const i=e.items,s=i&&i.length;if(s){const o=e.x||0,a=e.y||0;t.translate(-o,-a);for(let u=0;u<s;++u)jhe(i[u],t,n,r);t.translate(o,a)}return r}function Vhe(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}const AO=new Wi;function aKe(e){const t=e.clip;if(Pt(t))t(S$(AO.clear()));else if(t)AO.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(AO)}const uKe=1e-9;function l9(e,t,n){return e===t?!0:n==="path"?Ghe(e,t):e instanceof Date&&t instanceof Date?+e==+t:wp(e)&&wp(t)?Math.abs(e-t)<=uKe:!e||!t||!ht(e)&&!ht(t)?e==t:lKe(e,t)}function Ghe(e,t){return l9(S0(e),S0(t))}function lKe(e,t){var n=Object.keys(e),r=Object.keys(t),i,s;if(n.length!==r.length)return!1;for(n.sort(),r.sort(),s=n.length-1;s>=0;s--)if(n[s]!=r[s])return!1;for(s=n.length-1;s>=0;s--)if(i=n[s],!l9(e[i],t[i],i))return!1;return typeof e==typeof t}function cKe(){rhe(),Pqe()}const fKe=4278190080,hKe=268435456,dKe=.0625;function pKe(e,t){const n=e.bitmap();return(t||[]).forEach(r=>n.set(e(r.boundary[0]),e(r.boundary[3]))),[n,void 0]}function gKe(e,t,n,r){const i=e.width,s=e.height,o=n||r,a=xc(i,s).getContext("2d");t.forEach(m=>Hhe(a,m,o));const u=new Uint32Array(a.getImageData(0,0,i,s).data.buffer),l=e.bitmap(),c=o&&e.bitmap();let f,h,d,p,g;for(h=0;h<s;++h)for(f=0;f<i;++f)g=u[h*i+f]&fKe,g&&(d=e(f),p=e(h),r||l.set(d,p),o&&g^hKe&&c.set(d,p));return[l,c]}function Hhe(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;r==="group"?t.forEach(i=>{i.items.forEach(s=>Hhe(e,s.items,n))}):Do[r].draw(e,{items:n?t.map(mKe):t})}function mKe(e){const t=UI(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=dKe,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const ml=5,Ei=31,Xv=32,Gc=new Uint32Array(Xv+1),oa=new Uint32Array(Xv+1);oa[0]=0;Gc[0]=~oa[0];for(let e=1;e<=Xv;++e)oa[e]=oa[e-1]<<1|1,Gc[e]=~oa[e];function yKe(e,t){const n=new Uint32Array(~~((e*t+Xv)/Xv));function r(s,o){n[s]|=o}function i(s,o){n[s]&=o}return{array:n,get:(s,o)=>{const a=o*e+s;return n[a>>>ml]&1<<(a&Ei)},set:(s,o)=>{const a=o*e+s;r(a>>>ml,1<<(a&Ei))},clear:(s,o)=>{const a=o*e+s;i(a>>>ml,~(1<<(a&Ei)))},getRange:(s,o,a,u)=>{let l=u,c,f,h,d;for(;l>=o;--l)if(c=l*e+s,f=l*e+a,h=c>>>ml,d=f>>>ml,h===d){if(n[h]&Gc[c&Ei]&oa[(f&Ei)+1])return!0}else{if(n[h]&Gc[c&Ei]||n[d]&oa[(f&Ei)+1])return!0;for(let p=h+1;p<d;++p)if(n[p])return!0}return!1},setRange:(s,o,a,u)=>{let l,c,f,h,d;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>ml,h=c>>>ml,f===h)r(f,Gc[l&Ei]&oa[(c&Ei)+1]);else for(r(f,Gc[l&Ei]),r(h,oa[(c&Ei)+1]),d=f+1;d<h;++d)r(d,4294967295)},clearRange:(s,o,a,u)=>{let l,c,f,h,d;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>ml,h=c>>>ml,f===h)i(f,oa[l&Ei]|Gc[(c&Ei)+1]);else for(i(f,oa[l&Ei]),i(h,Gc[(c&Ei)+1]),d=f+1;d<h;++d)i(d,0)},outOfBounds:(s,o,a,u)=>s<0||o<0||u>=t||a>=e}}function bKe(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),s=~~((t+2*n+r)/r),o=a=>~~((a+n)/r);return o.invert=a=>a*r-n,o.bitmap=()=>yKe(i,s),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function xKe(e,t,n,r){const i=e.width,s=e.height;return function(o){const a=o.datum.datum.items[r].items,u=a.length,l=o.datum.fontSize,c=yu.width(o.datum,o.datum.text);let f=0,h,d,p,g,m,y,b;for(let v=0;v<u;++v)h=a[v].x,p=a[v].y,d=a[v].x2===void 0?h:a[v].x2,g=a[v].y2===void 0?p:a[v].y2,m=(h+d)/2,y=(p+g)/2,b=Math.abs(d-h+g-p),b>=f&&(f=b,o.x=m,o.y=y);return m=c/2,y=l/2,h=o.x-m,d=o.x+m,p=o.y-y,g=o.y+y,o.align="center",h<0&&d<=i?o.align="left":0<=h&&i<d&&(o.align="right"),o.baseline="middle",p<0&&g<=s?o.baseline="top":0<=p&&s<g&&(o.baseline="bottom"),!0}}function vA(e,t,n,r,i,s){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>s}function lf(e,t,n,r,i,s,o,a){const u=i*s/(r*2),l=e(t-u),c=e(t+u),f=e(n-(s=s/2)),h=e(n+s);return o.outOfBounds(l,f,c,h)||o.getRange(l,f,c,h)||a&&a.getRange(l,f,c,h)}function vKe(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1];function u(l,c,f,h,d){const p=e.invert(l),g=e.invert(c);let m=f,y=s,b;if(!vA(p,g,h,d,i,s)&&!lf(e,p,g,d,h,m,o,a)&&!lf(e,p,g,d,h,d,o,null)){for(;y-m>=1;)b=(m+y)/2,lf(e,p,g,d,h,b,o,a)?y=b:m=b;if(m>f)return[p,g,m,!0]}}return function(l){const c=l.datum.datum.items[r].items,f=c.length,h=l.datum.fontSize,d=yu.width(l.datum,l.datum.text);let p=n?h:0,g=!1,m=!1,y=0,b,v,x,w,C,$,S,k,E,A,F,_,I,T,O,L,M;for(let P=0;P<f;++P){for(b=c[P].x,x=c[P].y,v=c[P].x2===void 0?b:c[P].x2,w=c[P].y2===void 0?x:c[P].y2,b>v&&(M=b,b=v,v=M),x>w&&(M=x,x=w,w=M),E=e(b),F=e(v),A=~~((E+F)/2),_=e(x),T=e(w),I=~~((_+T)/2),S=A;S>=E;--S)for(k=I;k>=_;--k)L=u(S,k,p,d,h),L&&([l.x,l.y,p,g]=L);for(S=A;S<=F;++S)for(k=I;k<=T;++k)L=u(S,k,p,d,h),L&&([l.x,l.y,p,g]=L);!g&&!n&&(O=Math.abs(v-b+w-x),C=(b+v)/2,$=(x+w)/2,O>=y&&!vA(C,$,d,h,i,s)&&!lf(e,C,$,h,d,h,o,null)&&(y=O,l.x=C,l.y=$,m=!0))}return g||m?(C=d/2,$=h/2,o.setRange(e(l.x-C),e(l.y-$),e(l.x+C),e(l.y+$)),l.align="center",l.baseline="middle",!0):!1}}const wKe=[-1,-1,1,1],$Ke=[-1,1,-1,1];function CKe(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1],u=e.bitmap();return function(l){const c=l.datum.datum.items[r].items,f=c.length,h=l.datum.fontSize,d=yu.width(l.datum,l.datum.text),p=[];let g=n?h:0,m=!1,y=!1,b=0,v,x,w,C,$,S,k,E,A,F,_,I;for(let T=0;T<f;++T){for(v=c[T].x,w=c[T].y,x=c[T].x2===void 0?v:c[T].x2,C=c[T].y2===void 0?w:c[T].y2,p.push([e((v+x)/2),e((w+C)/2)]);p.length;)if([k,E]=p.pop(),!(o.get(k,E)||a.get(k,E)||u.get(k,E))){u.set(k,E);for(let O=0;O<4;++O)$=k+wKe[O],S=E+$Ke[O],u.outOfBounds($,S,$,S)||p.push([$,S]);if($=e.invert(k),S=e.invert(E),A=g,F=s,!vA($,S,d,h,i,s)&&!lf(e,$,S,h,d,A,o,a)&&!lf(e,$,S,h,d,h,o,null)){for(;F-A>=1;)_=(A+F)/2,lf(e,$,S,h,d,_,o,a)?F=_:A=_;A>g&&(l.x=$,l.y=S,g=A,m=!0)}}!m&&!n&&(I=Math.abs(x-v+C-w),$=(v+x)/2,S=(w+C)/2,I>=b&&!vA($,S,d,h,i,s)&&!lf(e,$,S,h,d,h,o,null)&&(b=I,l.x=$,l.y=S,y=!0))}return m||y?($=d/2,S=h/2,o.setRange(e(l.x-$),e(l.y-S),e(l.x+$),e(l.y+S)),l.align="center",l.baseline="middle",!0):!1}}const SKe=["right","center","left"],kKe=["bottom","middle","top"];function EKe(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1],u=r.length;return function(l){const c=l.boundary,f=l.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>i||c[3]>s)return!1;let h=0,d,p,g,m,y,b,v,x,w,C,$,S,k,E,A;for(let F=0;F<u;++F){if(d=(n[F]&3)-1,p=(n[F]>>>2&3)-1,g=d===0&&p===0||r[F]<0,m=d&&p?Math.SQRT1_2:1,y=r[F]<0?-1:1,b=c[1+d]+r[F]*d*m,$=c[4+p]+y*f*p/2+r[F]*p*m,x=$-f/2,w=$+f/2,S=e(b),E=e(x),A=e(w),!h)if(AY(S,S,E,A,o,a,b,b,x,w,c,g))h=yu.width(l.datum,l.datum.text);else continue;if(C=b+y*h*d/2,b=C-h/2,v=C+h/2,S=e(b),k=e(v),AY(S,k,E,A,o,a,b,v,x,w,c,g))return l.x=d?d*y<0?v:b:C,l.y=p?p*y<0?w:x:$,l.align=SKe[d*y+1],l.baseline=kKe[p*y+1],o.setRange(S,E,k,A),!0}return!1}}function AY(e,t,n,r,i,s,o,a,u,l,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&s?s.getRange(e,n,t,r)||!AKe(o,u,a,l,c):i.getRange(e,n,t,r)))}function AKe(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}const _O=0,TO=4,IO=8,DO=0,NO=1,FO=2,_Ke={"top-left":_O+DO,top:_O+NO,"top-right":_O+FO,left:TO+DO,middle:TO+NO,right:TO+FO,"bottom-left":IO+DO,bottom:IO+NO,"bottom-right":IO+FO},TKe={naive:xKe,"reduced-search":vKe,floodfill:CKe};function IKe(e,t,n,r,i,s,o,a,u,l,c){if(!e.length)return e;const f=Math.max(r.length,i.length),h=DKe(r,f),d=NKe(i,f),p=FKe(e[0].datum),g=p==="group"&&e[0].datum.items[u].marktype,m=g==="area",y=OKe(p,g,a,u),b=bKe(t[0],t[1],l),v=m&&c==="naive",x=e.map($=>({datum:$,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y($)}));let w;if(!v){n&&x.sort((S,k)=>n(S.datum,k.datum));let $=!1;for(let S=0;S<d.length&&!$;++S)$=d[S]===5||h[S]<0;p&&(o||m)&&(s=[e.map(S=>S.datum)].concat(s)),w=s.length?gKe(b,s,$,m):pKe(b,o&&x)}const C=m?TKe[c](b,w,o,u):EKe(b,w,d,h);return x.forEach($=>$.opacity=+C($)),x}function DKe(e,t){const n=new Float64Array(t),r=e.length;for(let i=0;i<r;++i)n[i]=e[i]||0;for(let i=r;i<t;++i)n[i]=n[r-1];return n}function NKe(e,t){const n=new Int8Array(t),r=e.length;for(let i=0;i<r;++i)n[i]|=_Ke[e[i]];for(let i=r;i<t;++i)n[i]=n[r-1];return n}function FKe(e){return e&&e.mark&&e.mark.marktype}function OKe(e,t,n,r){const i=s=>[s.x,s.x,s.x,s.y,s.y,s.y];return e?e==="line"||e==="area"?s=>i(s.datum):t==="line"?s=>{const o=s.datum.items[r].items;return i(o.length?o[n==="start"?0:o.length-1]:{x:NaN,y:NaN})}:s=>{const o=s.datum.bounds;return[o.x1,(o.x1+o.x2)/2,o.x2,o.y1,(o.y1+o.y2)/2,o.y2]}:i}const hL=["x","y","opacity","align","baseline"],qhe=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function c9(e){ee.call(this,null,e)}c9.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:qhe},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:hL.length,default:hL}]};ye(c9,ee,{transform(e,t){function n(s){const o=e[s];return Pt(o)&&t.modified(o.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&ae("Size parameter should be specified as a [width, height] array.");const i=e.as||hL;return IKe(t.materialize(t.SOURCE).source,e.size,e.sort,Qe(e.offset||1),Qe(e.anchor||qhe),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(s=>{const o=s.datum;o[i[0]]=s.x,o[i[1]]=s.y,o[i[2]]=s.opacity,o[i[3]]=s.align,o[i[4]]=s.baseline}),t.reflow(r).modifies(i)}});const RKe=Object.freeze(Object.defineProperty({__proto__:null,label:c9},Symbol.toStringTag,{value:"Module"}));function Xhe(e,t){var n=[],r=function(c){return c(a)},i,s,o,a,u,l;if(t==null)n.push(e);else for(i={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(r),l=i[u],l||(i[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function f9(e){ee.call(this,null,e)}f9.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};ye(f9,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Xhe(r,e.groupby),s=(e.groupby||[]).map(_n),o=s.length,a=e.as||[_n(e.x),_n(e.y)],u=[];i.forEach(l=>{tse(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let h=0;h<o;++h)f[s[h]]=l.dims[h];f[a[0]]=c[0],f[a[1]]=c[1],u.push(Nt(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const dL={linear:S6,log:Zie,exp:Jie,pow:Qie,quad:k6,poly:ese},MKe=(e,t)=>e==="poly"?t:e==="quad"?2:1;function h9(e){ee.call(this,null,e)}h9.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(dL)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};ye(h9,ee,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Xhe(r,e.groupby),s=(e.groupby||[]).map(_n),o=e.method||"linear",a=e.order||3,u=MKe(o,a),l=e.as||[_n(e.x),_n(e.y)],c=dL[o],f=[];let h=e.extent;tt(dL,o)||ae("Invalid regression method: "+o),h!=null&&o==="log"&&h[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),i.forEach(d=>{if(d.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=c(d,e.x,e.y,a);if(e.params){f.push(Nt({keys:d.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=h||Pf(d,e.x),y=b=>{const v={};for(let x=0;x<s.length;++x)v[s[x]]=d.dims[x];v[l[0]]=b[0],v[l[1]]=b[1],f.push(Nt(v))};o==="linear"?m.forEach(b=>y([b,g.predict(b)])):XI(g.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const LKe=Object.freeze(Object.defineProperty({__proto__:null,loess:f9,regression:h9},Symbol.toStringTag,{value:"Module"})),_Y=Math.pow(2,-52),lS=new Uint32Array(512);class wA{static from(t,n=jKe,r=WKe){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new wA(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=t.length>>1;let a=1/0,u=1/0,l=-1/0,c=-1/0;for(let E=0;E<o;E++){const A=t[2*E],F=t[2*E+1];A<a&&(a=A),F<u&&(u=F),A>l&&(l=A),F>c&&(c=F),this._ids[E]=E}const f=(a+l)/2,h=(u+c)/2;let d=1/0,p,g,m;for(let E=0;E<o;E++){const A=OO(f,h,t[2*E],t[2*E+1]);A<d&&(p=E,d=A)}const y=t[2*p],b=t[2*p+1];d=1/0;for(let E=0;E<o;E++){if(E===p)continue;const A=OO(y,b,t[2*E],t[2*E+1]);A<d&&A>0&&(g=E,d=A)}let v=t[2*g],x=t[2*g+1],w=1/0;for(let E=0;E<o;E++){if(E===p||E===g)continue;const A=zKe(y,b,v,x,t[2*E],t[2*E+1]);A<w&&(m=E,w=A)}let C=t[2*m],$=t[2*m+1];if(w===1/0){for(let F=0;F<o;F++)this._dists[F]=t[2*F]-t[0]||t[2*F+1]-t[1];Em(this._ids,this._dists,0,o-1);const E=new Uint32Array(o);let A=0;for(let F=0,_=-1/0;F<o;F++){const I=this._ids[F];this._dists[I]>_&&(E[A++]=I,_=this._dists[I])}this.hull=E.subarray(0,A),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(cS(y,b,v,x,C,$)){const E=g,A=v,F=x;g=m,v=C,x=$,m=E,C=A,$=F}const S=UKe(y,b,v,x,C,$);this._cx=S.x,this._cy=S.y;for(let E=0;E<o;E++)this._dists[E]=OO(t[2*E],t[2*E+1],S.x,S.y);Em(this._ids,this._dists,0,o-1),this._hullStart=p;let k=3;r[p]=n[m]=g,r[g]=n[p]=m,r[m]=n[g]=p,i[p]=0,i[g]=1,i[m]=2,s.fill(-1),s[this._hashKey(y,b)]=p,s[this._hashKey(v,x)]=g,s[this._hashKey(C,$)]=m,this.trianglesLen=0,this._addTriangle(p,g,m,-1,-1,-1);for(let E=0,A,F;E<this._ids.length;E++){const _=this._ids[E],I=t[2*_],T=t[2*_+1];if(E>0&&Math.abs(I-A)<=_Y&&Math.abs(T-F)<=_Y||(A=I,F=T,_===p||_===g||_===m))continue;let O=0;for(let H=0,Q=this._hashKey(I,T);H<this._hashSize&&(O=s[(Q+H)%this._hashSize],!(O!==-1&&O!==r[O]));H++);O=n[O];let L=O,M;for(;M=r[L],!cS(I,T,t[2*L],t[2*L+1],t[2*M],t[2*M+1]);)if(L=M,L===O){L=-1;break}if(L===-1)continue;let P=this._addTriangle(L,_,r[L],-1,-1,i[L]);i[_]=this._legalize(P+2),i[L]=P,k++;let G=r[L];for(;M=r[G],cS(I,T,t[2*G],t[2*G+1],t[2*M],t[2*M+1]);)P=this._addTriangle(G,_,M,i[_],-1,i[G]),i[_]=this._legalize(P+2),r[G]=G,k--,G=M;if(L===O)for(;M=n[L],cS(I,T,t[2*M],t[2*M+1],t[2*L],t[2*L+1]);)P=this._addTriangle(M,_,L,-1,i[L],i[M]),this._legalize(P+2),i[M]=P,r[L]=L,k--,L=M;this._hullStart=n[_]=L,r[L]=n[G]=_,r[_]=G,s[this._hashKey(I,T)]=_,s[this._hashKey(t[2*L],t[2*L+1])]=L}this.hull=new Uint32Array(k);for(let E=0,A=this._hullStart;E<k;E++)this.hull[E]=A,A=r[A];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(PKe(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[t],u=t-t%3;if(o=u+(t+2)%3,a===-1){if(s===0)break;t=lS[--s];continue}const l=a-a%3,c=u+(t+1)%3,f=l+(a+2)%3,h=n[o],d=n[t],p=n[c],g=n[f];if(BKe(i[2*h],i[2*h+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1],i[2*g],i[2*g+1])){n[t]=g,n[a]=h;const y=r[f];if(y===-1){let v=this._hullStart;do{if(this._hullTri[v]===f){this._hullTri[v]=t;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(t,y),this._link(a,r[o]),this._link(o,f);const b=l+(a+1)%3;s<lS.length&&(lS[s++]=b)}else{if(s===0)break;t=lS[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function PKe(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function OO(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function RO(e,t,n,r,i,s){const o=(r-t)*(i-e),a=(n-e)*(s-t);return Math.abs(o-a)>=33306690738754716e-32*Math.abs(o+a)?o-a:0}function cS(e,t,n,r,i,s){return(RO(i,s,e,t,n,r)||RO(e,t,n,r,i,s)||RO(n,r,i,s,e,t))<0}function BKe(e,t,n,r,i,s,o,a){const u=e-o,l=t-a,c=n-o,f=r-a,h=i-o,d=s-a,p=u*u+l*l,g=c*c+f*f,m=h*h+d*d;return u*(f*m-g*d)-l*(c*m-g*h)+p*(c*d-f*h)<0}function zKe(e,t,n,r,i,s){const o=n-e,a=r-t,u=i-e,l=s-t,c=o*o+a*a,f=u*u+l*l,h=.5/(o*l-a*u),d=(l*c-a*f)*h,p=(o*f-u*c)*h;return d*d+p*p}function UKe(e,t,n,r,i,s){const o=n-e,a=r-t,u=i-e,l=s-t,c=o*o+a*a,f=u*u+l*l,h=.5/(o*l-a*u),d=e+(l*c-a*f)*h,p=t+(o*f-u*c)*h;return{x:d,y:p}}function Em(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],o=t[s];let a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;xb(e,i,s),t[e[n]]>t[e[r]]&&xb(e,n,r),t[e[s]]>t[e[r]]&&xb(e,s,r),t[e[n]]>t[e[s]]&&xb(e,n,s);const a=e[s],u=t[a];for(;;){do s++;while(t[e[s]]<u);do o--;while(t[e[o]]>u);if(o<s)break;xb(e,s,o)}e[n+1]=e[o],e[o]=a,r-s+1>=o-n?(Em(e,t,s,r),Em(e,t,n,o-1)):(Em(e,t,n,o-1),Em(e,t,s,r))}}function xb(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function jKe(e){return e[0]}function WKe(e){return e[1]}const TY=1e-6;class Ud{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){t=+t,n=+n,r=+r;const i=t+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>TY||Math.abs(this._y1-s)>TY)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class pL{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}let VKe=class{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this,s=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let d=0,p=0,g=r.length,m,y;d<g;d+=3,p+=2){const b=r[d]*2,v=r[d+1]*2,x=r[d+2]*2,w=t[b],C=t[b+1],$=t[v],S=t[v+1],k=t[x],E=t[x+1],A=$-w,F=S-C,_=k-w,I=E-C,T=A*A+F*F,O=_*_+I*I,L=(A*I-F*_)*2;if(!L)m=(w+k)/2-1e8*I,y=(C+E)/2+1e8*_;else if(Math.abs(L)<1e-8)m=(w+k)/2,y=(C+E)/2;else{const M=1/L;m=w+(I*T-F*O)*M,y=C+(A*O-_*T)*M}s[p]=m,s[p+1]=y}let o=n[n.length-1],a,u=o*4,l,c=t[2*o],f,h=t[2*o+1];i.fill(0);for(let d=0;d<n.length;++d)o=n[d],a=u,l=c,f=h,u=o*4,c=t[2*o],h=t[2*o+1],i[a+2]=i[u]=f-h,i[a+3]=i[u+1]=c-l}render(t){const n=t==null?t=new Ud:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let c=0,f=r.length;c<f;++c){const h=r[c];if(h<c)continue;const d=Math.floor(c/3)*2,p=Math.floor(h/3)*2,g=o[d],m=o[d+1],y=o[p],b=o[p+1];this._renderSegment(g,m,y,b,t)}let u,l=s[s.length-1];for(let c=0;c<s.length;++c){u=l,l=s[c];const f=Math.floor(i[l]/3)*2,h=o[f],d=o[f+1],p=u*4,g=this._project(h,d,a[p+2],a[p+3]);g&&this._renderSegment(h,d,g[0],g[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Ud:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new Ud:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new pL;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let o;const a=this._regioncode(t,n),u=this._regioncode(r,i);a===0&&u===0?(s.moveTo(t,n),s.lineTo(r,i)):(o=this._clipSegment(t,n,r,i,a,u))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){e:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,u=i.length;a<u;a+=2)if(n[s]==i[a]&&n[s+1]==i[a+1]&&n[(s+2)%o]==i[(a+u-2)%u]&&n[(s+3)%o]==i[(a+u-1)%u]){yield r;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[t];if(o===-1)return null;const a=[];let u=o;do{const l=Math.floor(u/3);if(a.push(n[l*2],n[l*2+1]),u=u%3===2?u-2:u+1,s[u]!==t)break;u=i[u]}while(u!==o&&u!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=t*4;return r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n)}_clipFinite(t,n){const r=n.length;let i=null,s,o,a=n[r-2],u=n[r-1],l,c=this._regioncode(a,u),f,h;for(let d=0;d<r;d+=2)if(s=a,o=u,a=n[d],u=n[d+1],l=c,c=this._regioncode(a,u),l===0&&c===0)f=h,h=0,i?i.push(a,u):i=[a,u];else{let p,g,m,y,b;if(l===0){if((p=this._clipSegment(s,o,a,u,l,c))===null)continue;[g,m,y,b]=p}else{if((p=this._clipSegment(a,u,s,o,c,l))===null)continue;[y,b,g,m]=p,f=h,h=this._edgecode(g,m),f&&h&&this._edge(t,f,h,i,i.length),i?i.push(g,m):i=[g,m]}f=h,h=this._edgecode(y,b),f&&h&&this._edge(t,f,h,i,i.length),i?i.push(y,b):i=[y,b]}if(i)f=h,h=this._edgecode(i[0],i[1]),f&&h&&this._edge(t,f,h,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,n,r,i,s,o){for(;;){if(s===0&&o===0)return[t,n,r,i];if(s&o)return null;let a,u,l=s||o;l&8?(a=t+(r-t)*(this.ymax-n)/(i-n),u=this.ymax):l&4?(a=t+(r-t)*(this.ymin-n)/(i-n),u=this.ymin):l&2?(u=n+(i-n)*(this.xmax-t)/(r-t),a=this.xmax):(u=n+(i-n)*(this.xmin-t)/(r-t),a=this.xmin),s?(t=a,n=u,s=this._regioncode(t,n)):(r=a,i=u,o=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,o){let a=Array.from(n),u;if((u=this._project(a[0],a[1],r,i))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(u[0],u[1]),a=this._clipFinite(t,a))for(let l=0,c=a.length,f,h=this._edgecode(a[c-2],a[c-1]);l<c;l+=2)f=h,h=this._edgecode(a[l],a[l+1]),f&&h&&(l=this._edge(t,f,h,a,l),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(t,o,a)&&(i.splice(s,0,o,a),s+=2)}if(i.length>4)for(let o=0;o<i.length;o+=2){const a=(o+2)%i.length,u=(o+4)%i.length;(i[o]===i[a]&&i[a]===i[u]||i[o+1]===i[a+1]&&i[a+1]===i[u+1])&&(i.splice(a,2),o-=2)}return s}_project(t,n,r,i){let s=1/0,o,a,u;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(u=this.ymin,a=t+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(u=this.ymax,a=t+(s=o)*r)}if(r>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/r)<s&&(a=this.xmax,u=n+(s=o)*i)}else if(r<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/r)<s&&(a=this.xmin,u=n+(s=o)*i)}return[a,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}};const GKe=2*Math.PI,um=Math.pow;function HKe(e){return e[0]}function qKe(e){return e[1]}function XKe(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],s=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function YKe(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class d9{static from(t,n=HKe,r=qKe,i){return new d9("length"in t?KKe(t,n,r,i):Float64Array.from(ZKe(t,n,r,i)))}constructor(t){this._delaunator=new wA(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&XKe(t)){this.collinear=Int32Array.from({length:n.length/2},(h,d)=>d).sort((h,d)=>n[2*h]-n[2*d]||n[2*h+1]-n[2*d+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let h=0,d=n.length/2;h<d;++h){const p=YKe(n[2*h],n[2*h+1],f);n[2*h]=p[0],n[2*h+1]=p[1]}this._delaunator=new wA(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,l=r.length;u<l;++u){const c=s[u%3===2?u-2:u+1];(r[u]===-1||o[c]===-1)&&(o[c]=u)}for(let u=0,l=i.length;u<l;++u)a[i[u]]=u;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],o[i[0]]=1,i.length===2&&(o[i[1]]=0))}voronoi(t){return new VKe(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const f=a.indexOf(t);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=o[l],l=l%3===2?l-2:l+1,o[l]!==t)return;if(l=s[l],l===-1){const f=r[(i[t]+1)%r.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,r=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:u,points:l}=this;if(i[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=um(n-l[t*2],2)+um(r-l[t*2+1],2);const h=i[t];let d=h;do{let p=u[d];const g=um(n-l[p*2],2)+um(r-l[p*2+1],2);if(g<f&&(f=g,c=p),d=d%3===2?d-2:d+1,u[d]!==t)break;if(d=a[d],d===-1){if(d=s[(o[t]+1)%s.length],d!==p&&um(n-l[d*2],2)+um(r-l[d*2+1],2)<f)return d;break}}while(d!==h);return c}render(t){const n=t==null?t=new Ud:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const u=i[o];if(u<o)continue;const l=s[o]*2,c=s[u]*2;t.moveTo(r[l],r[l+1]),t.lineTo(r[c],r[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const r=t==null?t=new Ud:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],u=i[s+1];t.moveTo(a+n,u),t.arc(a,u,n,0,GKe)}return r&&r.value()}renderHull(t){const n=t==null?t=new Ud:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;t.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const u=2*r[a];t.lineTo(i[u],i[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new pL;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new Ud:void 0,{points:i,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,u=s[t+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[u],i[u+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new pL;return this.renderTriangle(t,n),n.value()}}function KKe(e,t,n,r){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=e[o];s[o*2]=t.call(r,a,o,e),s[o*2+1]=n.call(r,a,o,e)}return s}function*ZKe(e,t,n,r){let i=0;for(const s of e)yield t.call(r,s,i,e),yield n.call(r,s,i,e),++i}function p9(e){ee.call(this,null,e)}p9.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const JKe=[-1e5,-1e5,1e5,1e5];ye(p9,ee,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:JKe;const s=this.value=d9.from(r,e.x,e.y).voronoi(i);for(let o=0,a=r.length;o<a;++o){const u=s.cellPolygon(o);r[o][n]=u?QKe(u):null}return t.reflow(e.modified()).modifies(n)}});function QKe(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}const eZe=Object.freeze(Object.defineProperty({__proto__:null,voronoi:p9},Symbol.toStringTag,{value:"Module"}));function py(e,t,n){return e.fields=t||[],e.fname=n,e}function tZe(e){return e.length===1?nZe(e[0]):rZe(e)}const nZe=e=>function(t){return t[e]},rZe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function pk(e){throw Error(e)}function iZe(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||pk("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&pk("Access path missing closing bracket: "+e),r&&pk("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function sZe(e,t,n){const r=iZe(e);return e=r.length===1?r[0]:e,py((n&&n.get||tZe)(r),[e],t||e)}sZe("id");py(e=>e,[],"identity");py(()=>0,[],"zero");py(()=>1,[],"one");py(()=>!0,[],"true");py(()=>!1,[],"false");var oZe=Array.isArray;function aZe(e){return e[e.length-1]}function uZe(e){return e==null||e===""?null:+e}function lZe(e){return e!=null?oZe(e)?e:[e]:[]}function gL(e){return typeof e=="function"}function cZe(e){return gL(e)?e:()=>e}function fZe(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function hZe(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}function dZe(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),fZe(r,n)}function pZe(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Ex(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function gZe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function g9(e){let t,n,r;e.length!==2?(t=Ex,n=(a,u)=>Ex(e(a),u),r=(a,u)=>e(a)-u):(t=e===Ex||e===gZe?e:mZe,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function mZe(){return 0}function Yhe(e){return e===null?NaN:+e}const yZe=g9(Ex),Mp=yZe.right;g9(Yhe).center;const bZe=Math.sqrt(50),xZe=Math.sqrt(10),vZe=Math.sqrt(2);function $A(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=bZe?10:s>=xZe?5:s>=vZe?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?$A(e,t,n*2):[a,u,l]}function mL(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const r=t<e,[i,s,o]=r?$A(t,e,n):$A(e,t,n);if(!(s>=i))return[];const a=s-i+1,u=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)u[l]=(s-l)/-o;else for(let l=0;l<a;++l)u[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)u[l]=(i+l)/-o;else for(let l=0;l<a;++l)u[l]=(i+l)*o;return u}function yL(e,t,n){return t=+t,e=+e,n=+n,$A(e,t,n)[2]}function bL(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?yL(t,e,n):yL(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function wZe(e,t,n=Yhe){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function $Ze(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function Yu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Oh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const IY=Symbol("implicit");function m9(){var e=new Xk,t=[],n=[],r=IY;function i(s){let o=e.get(s);if(o===void 0){if(r!==IY)return r;e.set(s,o=t.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Xk;for(const o of s)e.has(o)||e.set(o,t.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return m9(t,n).unknown(r)},Yu.apply(i,arguments),i}function Khe(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function Zhe(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return Khe((n-r/t)*t,o,i,s,a)}}function Jhe(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return Khe((n-r/t)*t,i,s,o,a)}}const eN=e=>()=>e;function Qhe(e,t){return function(n){return e+n*t}}function CZe(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function tN(e,t){var n=t-e;return n?Qhe(e,n>180||n<-180?n-360*Math.round(n/360):n):eN(isNaN(e)?t:e)}function SZe(e){return(e=+e)==1?xr:function(t,n){return n-t?CZe(t,n,e):eN(isNaN(t)?n:t)}}function xr(e,t){var n=t-e;return n?Qhe(e,n):eN(isNaN(e)?t:e)}const xL=function e(t){var n=SZe(t);function r(i,s){var o=n((i=ws(i)).r,(s=ws(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=xr(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function ede(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=ws(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var kZe=ede(Zhe),EZe=ede(Jhe);function y9(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function tde(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function AZe(e,t){return(tde(t)?y9:nde)(e,t)}function nde(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Eg(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function rde(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function aa(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ide(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Eg(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var vL=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,MO=new RegExp(vL.source,"g");function _Ze(e){return function(){return e}}function TZe(e){return function(t){return e(t)+""}}function sde(e,t){var n=vL.lastIndex=MO.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=vL.exec(e))&&(i=MO.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:aa(r,i)})),n=MO.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?TZe(u[0].x):_Ze(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Eg(e,t){var n=typeof t,r;return t==null||n==="boolean"?eN(t):(n==="number"?aa:n==="string"?(r=oc(t))?(t=r,xL):sde:t instanceof oc?xL:t instanceof Date?rde:tde(t)?y9:Array.isArray(t)?nde:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?ide:aa)(e,t)}function IZe(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function DZe(e,t){var n=tN(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function nN(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var DY=180/Math.PI,wL={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ode(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*DY,skewX:Math.atan(u)*DY,scaleX:o,scaleY:a}}var fS;function NZe(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?wL:ode(t.a,t.b,t.c,t.d,t.e,t.f)}function FZe(e){return e==null||(fS||(fS=document.createElementNS("http://www.w3.org/2000/svg","g")),fS.setAttribute("transform",e),!(e=fS.transform.baseVal.consolidate()))?wL:(e=e.matrix,ode(e.a,e.b,e.c,e.d,e.e,e.f))}function ade(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:aa(l,f)},{i:g-2,x:aa(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:aa(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:aa(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:aa(l,f)},{i:g-2,x:aa(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var OZe=ade(NZe,"px, ","px)","deg)"),RZe=ade(FZe,", ",")",")"),MZe=1e-12;function NY(e){return((e=Math.exp(e))+1/e)/2}function LZe(e){return((e=Math.exp(e))-1/e)/2}function PZe(e){return((e=Math.exp(2*e))-1)/(e+1)}const BZe=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,g=d*d+p*p,m,y;if(g<MZe)y=Math.log(h/l)/t,m=function($){return[a+$*d,u+$*p,l*Math.exp(t*$*y)]};else{var b=Math.sqrt(g),v=(h*h-l*l+r*g)/(2*l*n*b),x=(h*h-l*l-r*g)/(2*h*n*b),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(x*x+1)-x);y=(C-w)/t,m=function($){var S=$*y,k=NY(w),E=l/(n*b)*(k*PZe(t*S+w)-LZe(w));return[a+E*d,u+E*p,l*k/NY(t*S+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function ude(e){return function(t,n){var r=e((t=Xf(t)).h,(n=Xf(n)).h),i=xr(t.s,n.s),s=xr(t.l,n.l),o=xr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const zZe=ude(tN);var UZe=ude(xr);function jZe(e,t){var n=xr((e=Yf(e)).l,(t=Yf(t)).l),r=xr(e.a,t.a),i=xr(e.b,t.b),s=xr(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function lde(e){return function(t,n){var r=e((t=Kf(t)).h,(n=Kf(n)).h),i=xr(t.c,n.c),s=xr(t.l,n.l),o=xr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const WZe=lde(tN);var VZe=lde(xr);function cde(e){return function t(n){n=+n;function r(i,s){var o=e((i=Ep(i)).h,(s=Ep(s)).h),a=xr(i.s,s.s),u=xr(i.l,s.l),l=xr(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const GZe=cde(tN);var HZe=cde(xr);function b9(e,t){t===void 0&&(t=e,e=Eg);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function qZe(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const XZe=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Eg,interpolateArray:AZe,interpolateBasis:Zhe,interpolateBasisClosed:Jhe,interpolateCubehelix:GZe,interpolateCubehelixLong:HZe,interpolateDate:rde,interpolateDiscrete:IZe,interpolateHcl:WZe,interpolateHclLong:VZe,interpolateHsl:zZe,interpolateHslLong:UZe,interpolateHue:DZe,interpolateLab:jZe,interpolateNumber:aa,interpolateNumberArray:y9,interpolateObject:ide,interpolateRgb:xL,interpolateRgbBasis:kZe,interpolateRgbBasisClosed:EZe,interpolateRound:nN,interpolateString:sde,interpolateTransformCss:OZe,interpolateTransformSvg:RZe,interpolateZoom:BZe,piecewise:b9,quantize:qZe},Symbol.toStringTag,{value:"Module"}));function YZe(e){return function(){return e}}function $L(e){return+e}var FY=[0,1];function ps(e){return e}function CL(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:YZe(isNaN(t)?NaN:.5)}function KZe(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function ZZe(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=CL(i,r),s=n(o,s)):(r=CL(r,i),s=n(s,o)),function(a){return s(r(a))}}function JZe(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=CL(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=Mp(e,a,1,r)-1;return s[u](i[u](a))}}function T$(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function rN(){var e=FY,t=FY,n=Eg,r,i,s,o=ps,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==ps&&(o=KZe(e[0],e[h-1])),a=h>2?JZe:ZZe,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),aa)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,$L),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=nN,c()},f.clamp=function(h){return arguments.length?(o=h?!0:ps,c()):o!==ps},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function fde(){return rN()(ps,ps)}function hde(e,t,n,r){var i=bL(e,t,n),s;switch(r=Ip(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=C8(i,o))&&(r.precision=s),TD(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=S8(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=$8(i))&&(r.precision=s-(r.type==="%")*2);break}}return cy(r)}function Ag(e){var t=e.domain;return e.ticks=function(n){var r=t();return mL(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return hde(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=yL(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function dde(){var e=fde();return e.copy=function(){return T$(e,dde())},Yu.apply(e,arguments),Ag(e)}function pde(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,$L),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return pde(e).unknown(t)},e=arguments.length?Array.from(e,$L):[0,1],Ag(n)}function gde(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function OY(e){return Math.log(e)}function RY(e){return Math.exp(e)}function QZe(e){return-Math.log(-e)}function eJe(e){return-Math.exp(-e)}function tJe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function nJe(e){return e===10?tJe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function rJe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function MY(e){return(t,n)=>-e(-t,n)}function x9(e){const t=e(OY,RY),n=t.domain;let r=10,i,s;function o(){return i=rJe(r),s=nJe(r),n()[0]<0?(i=MY(i),s=MY(s),e(QZe,eJe)):e(OY,RY),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let h=i(l),d=i(c),p,g;const m=a==null?10:+a;let y=[];if(!(r%1)&&d-h<m){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(p=1;p<r;++p)if(g=h<0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}}else for(;h<=d;++h)for(p=r-1;p>=1;--p)if(g=h>0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}y.length*2<m&&(y=mL(l,c,m))}else y=mL(h,d,Math.min(d-h,m)).map(s);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=r===10?"s":","),typeof u!="function"&&(!(r%1)&&(u=Ip(u)).precision==null&&(u.trim=!0),u=cy(u)),a===1/0)return u;const l=Math.max(1,r*a/t.ticks().length);return c=>{let f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=()=>n(gde(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),t}function mde(){const e=x9(rN()).domain([1,10]);return e.copy=()=>T$(e,mde()).base(e.base()),Yu.apply(e,arguments),e}function LY(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function PY(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function v9(e){var t=1,n=e(LY(t),PY(t));return n.constant=function(r){return arguments.length?e(LY(t=+r),PY(t)):t},Ag(n)}function yde(){var e=v9(rN());return e.copy=function(){return T$(e,yde()).constant(e.constant())},Yu.apply(e,arguments)}function BY(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function iJe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function sJe(e){return e<0?-e*e:e*e}function w9(e){var t=e(ps,ps),n=1;function r(){return n===1?e(ps,ps):n===.5?e(iJe,sJe):e(BY(n),BY(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},Ag(t)}function $9(){var e=w9(rN());return e.copy=function(){return T$(e,$9()).exponent(e.exponent())},Yu.apply(e,arguments),e}function oJe(){return $9.apply(null,arguments).exponent(.5)}function bde(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=wZe(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[Mp(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Ex),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return bde().domain(e).range(t).unknown(r)},Yu.apply(s,arguments)}function xde(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[Mp(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return xde().domain([e,t]).range(i).unknown(s)},Yu.apply(Ag(o),arguments)}function vde(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[Mp(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return vde().domain(e).range(t).unknown(n)},Yu.apply(i,arguments)}const LO=new Date,PO=new Date;function fr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>fr(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(LO.setTime(+s),PO.setTime(+o),e(LO),e(PO),Math.floor(n(LO,PO))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const _0=fr(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);_0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?fr(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):_0);_0.range;const jl=1e3,yo=jl*60,Wl=yo*60,lc=Wl*24,C9=lc*7,zY=lc*30,BO=lc*365,Vl=fr(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*jl)},(e,t)=>(t-e)/jl,e=>e.getUTCSeconds());Vl.range;const iN=fr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jl)},(e,t)=>{e.setTime(+e+t*yo)},(e,t)=>(t-e)/yo,e=>e.getMinutes());iN.range;const sN=fr(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*yo)},(e,t)=>(t-e)/yo,e=>e.getUTCMinutes());sN.range;const oN=fr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jl-e.getMinutes()*yo)},(e,t)=>{e.setTime(+e+t*Wl)},(e,t)=>(t-e)/Wl,e=>e.getHours());oN.range;const aN=fr(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Wl)},(e,t)=>(t-e)/Wl,e=>e.getUTCHours());aN.range;const Pm=fr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*yo)/lc,e=>e.getDate()-1);Pm.range;const Ax=fr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/lc,e=>e.getUTCDate()-1);Ax.range;const wde=fr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/lc,e=>Math.floor(e/lc));wde.range;function _g(e){return fr(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*yo)/C9)}const uN=_g(0),aJe=_g(1),uJe=_g(2),lJe=_g(3),cJe=_g(4),fJe=_g(5),hJe=_g(6);uN.range;aJe.range;uJe.range;lJe.range;cJe.range;fJe.range;hJe.range;function Tg(e){return fr(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/C9)}const lN=Tg(0),dJe=Tg(1),pJe=Tg(2),gJe=Tg(3),mJe=Tg(4),yJe=Tg(5),bJe=Tg(6);lN.range;dJe.range;pJe.range;gJe.range;mJe.range;yJe.range;bJe.range;const Yv=fr(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Yv.range;const Kv=fr(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Kv.range;const I$=fr(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());I$.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:fr(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});I$.range;const D$=fr(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());D$.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:fr(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});D$.range;function $de(e,t,n,r,i,s){const o=[[Vl,1,jl],[Vl,5,5*jl],[Vl,15,15*jl],[Vl,30,30*jl],[s,1,yo],[s,5,5*yo],[s,15,15*yo],[s,30,30*yo],[i,1,Wl],[i,3,3*Wl],[i,6,6*Wl],[i,12,12*Wl],[r,1,lc],[r,2,2*lc],[n,1,C9],[t,1,zY],[t,3,3*zY],[e,1,BO]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=g9(([,,m])=>m).right(o,h);if(d===o.length)return e.every(bL(l/BO,c/BO,f));if(d===0)return _0.every(Math.max(bL(l,c,f),1));const[p,g]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(g)}return[a,u]}const[xJe,vJe]=$de(D$,Kv,lN,wde,aN,sN),[wJe,$Je]=$de(I$,Yv,uN,Pm,oN,iN);function CJe(e){return new Date(e)}function SJe(e){return e instanceof Date?+e:+new Date(+e)}function S9(e,t,n,r,i,s,o,a,u,l){var c=fde(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),v=l("%B"),x=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?g:s(C)<C?m:r(C)<C?i(C)<C?y:b:n(C)<C?v:x)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,SJe)):h().map(CJe)},c.ticks=function(C){var $=h();return e($[0],$[$.length-1],C??10)},c.tickFormat=function(C,$){return $==null?w:l($)},c.nice=function(C){var $=h();return(!C||typeof C.range!="function")&&(C=t($[0],$[$.length-1],C??10)),C?h(gde($,C)):c},c.copy=function(){return T$(c,S9(e,t,n,r,i,s,o,a,u,l))},c}function kJe(){return Yu.apply(S9(wJe,$Je,I$,Yv,uN,Pm,oN,iN,Vl,ID).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function EJe(){return Yu.apply(S9(xJe,vJe,D$,Kv,lN,Ax,aN,sN,Vl,DD).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function cN(){var e=0,t=1,n,r,i,s,o=ps,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(Eg),l.rangeRound=c(nN),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Rh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function k9(){var e=Ag(cN()(ps));return e.copy=function(){return Rh(e,k9())},Oh.apply(e,arguments)}function Cde(){var e=x9(cN()).domain([1,10]);return e.copy=function(){return Rh(e,Cde()).base(e.base())},Oh.apply(e,arguments)}function Sde(){var e=v9(cN());return e.copy=function(){return Rh(e,Sde()).constant(e.constant())},Oh.apply(e,arguments)}function E9(){var e=w9(cN());return e.copy=function(){return Rh(e,E9()).exponent(e.exponent())},Oh.apply(e,arguments)}function AJe(){return E9.apply(null,arguments).exponent(.5)}function fN(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=ps,c,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+c(g))-s)*(r*g<r*s?a:u),l(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var y,b,v;return arguments.length?([y,b,v]=m,l=b9(g,[y,b,v]),d):[l(0),l(.5),l(1)]}}return d.range=p(Eg),d.rangeRound=p(nN),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return c=g,i=g(e),s=g(t),o=g(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function kde(){var e=Ag(fN()(ps));return e.copy=function(){return Rh(e,kde())},Oh.apply(e,arguments)}function Ede(){var e=x9(fN()).domain([.1,1,10]);return e.copy=function(){return Rh(e,Ede()).base(e.base())},Oh.apply(e,arguments)}function Ade(){var e=v9(fN());return e.copy=function(){return Rh(e,Ade()).constant(e.constant())},Oh.apply(e,arguments)}function A9(){var e=w9(fN());return e.copy=function(){return Rh(e,A9()).exponent(e.exponent())},Oh.apply(e,arguments)}function _Je(){return A9.apply(null,arguments).exponent(.5)}const _9="year",T9="quarter",I9="month",D9="week",N9="date",F9="day",O9="dayofyear",R9="hours",M9="minutes",L9="seconds",P9="milliseconds",TJe=[_9,T9,I9,D9,N9,F9,O9,R9,M9,L9,P9];TJe.reduce((e,t,n)=>(e[t]=1+n,e),{});_9+"",T9+"",Yv.every(3),I9+"",D9+"",N9+"",F9+"",O9+"",R9+"",M9+"",L9+"",P9+"";_9+"",T9+"",Kv.every(3),I9+"",D9+"",N9+"",F9+"",O9+"",R9+"",M9+"",L9+"",P9+"";function IJe(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const DJe="identity",B9="linear",T0="log",z9="pow",U9="sqrt",j9="symlog",NJe="time",FJe="utc",gy="sequential",N$="diverging",UY="quantile",OJe="quantize",RJe="threshold",MJe="ordinal",LJe="point",PJe="band",BJe="bin-ordinal",Rr="continuous",hN="discrete",dN="discretizing",Oa="interpolating",_de="temporal";function zJe(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function UJe(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function W9(){const e=m9().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=IJe(f,a,u);let g=r[h-0];i=(d-g)/(p||1),o&&(i=Math.floor(i)),g+=(d-g-i*(f-a))*l,s=i*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=$Ze(f).map(y=>g+i*y);return n(h?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let g=+f[0],m=+f[1],y,b,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<d[0]||g>r[1-h])))return y=Math.max(0,Mp(d,g)-1),b=g===m?y:Mp(d,m)-1,g-d[y]>s+1e-10&&++y,h&&(v=y,y=p-b,b=p-v),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return W9().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function Tde(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Tde(t())},e}function jJe(){return Tde(W9().paddingInner(1))}var WJe=Array.prototype.map;function VJe(e){return WJe.call(e,uZe)}const GJe=Array.prototype.slice;function Ide(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(Mp(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=VJe(r),n):e.slice()},n.range=function(r){return arguments.length?(t=GJe.call(r),n):t.slice()},n.tickFormat=function(r,i){return hde(e[0],aZe(e),r??10,i)},n.copy=function(){return Ide().domain(n.domain()).range(n.range())},n}const SL=new Map,HJe=Symbol("vega_scale");function qJe(e){return e[HJe]=!0,e}function XJe(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?zJe(s):s.invertExtent?UJe(s):void 0),s.type=e,qJe(s)};return r.metadata=pZe(lZe(n)),r}function en(e,t,n){return arguments.length>1?(SL.set(e,XJe(e,t,n)),this):YJe(e)?SL.get(e):void 0}en(DJe,pde);en(B9,dde,Rr);en(T0,mde,[Rr,T0]);en(z9,$9,Rr);en(U9,oJe,Rr);en(j9,yde,Rr);en(NJe,kJe,[Rr,_de]);en(FJe,EJe,[Rr,_de]);en(gy,k9,[Rr,Oa]);en(`${gy}-${B9}`,k9,[Rr,Oa]);en(`${gy}-${T0}`,Cde,[Rr,Oa,T0]);en(`${gy}-${z9}`,E9,[Rr,Oa]);en(`${gy}-${U9}`,AJe,[Rr,Oa]);en(`${gy}-${j9}`,Sde,[Rr,Oa]);en(`${N$}-${B9}`,kde,[Rr,Oa]);en(`${N$}-${T0}`,Ede,[Rr,Oa,T0]);en(`${N$}-${z9}`,A9,[Rr,Oa]);en(`${N$}-${U9}`,_Je,[Rr,Oa]);en(`${N$}-${j9}`,Ade,[Rr,Oa]);en(UY,bde,[dN,UY]);en(OJe,xde,dN);en(RJe,vde,dN);en(BJe,Ide,[hN,dN]);en(MJe,m9,hN);en(PJe,W9,hN);en(LJe,jJe,hN);function YJe(e){return SL.has(e)}function KJe(e,t,n){return b9(ZJe(t||"rgb",n),e)}function ZJe(e,t){const n=XZe[JJe(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function JJe(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const QJe={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},eQe={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Dde(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function Nde(e,t){for(const n in e)tQe(n,t(e[n]))}const jY={};Nde(eQe,Dde);Nde(QJe,e=>KJe(Dde(e)));function tQe(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(jY[e]=t,this):jY[e]}var nQe=Math.random,zO=Math.PI/180,rx=64,gk=2048;function rQe(){var e=[256,256],t,n,r,i,s,o,a,u=Fde,l=[],c=Math.random,f={};f.layout=function(){for(var p=h(xc()),g=lQe((e[0]>>5)*e[1]),m=null,y=l.length,b=-1,v=[],x=l.map(C=>({text:t(C),font:n(C),style:i(C),weight:s(C),rotate:o(C),size:~~(r(C)+1e-14),padding:a(C),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:C})).sort((C,$)=>$.size-C.size);++b<y;){var w=x[b];w.x=e[0]*(c()+.5)>>1,w.y=e[1]*(c()+.5)>>1,iQe(p,w,x,b),w.hasText&&d(g,w,m)&&(v.push(w),m?oQe(m,w):m=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=e[0]>>1,w.y-=e[1]>>1)}return v};function h(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(rx<<5)/g,p.height=gk/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function d(p,g,m){for(var y=g.x,b=g.y,v=Math.sqrt(e[0]*e[0]+e[1]*e[1]),x=u(e),w=c()<.5?1:-1,C=-w,$,S,k;($=x(C+=w))&&(S=~~$[0],k=~~$[1],!(Math.min(Math.abs(S),Math.abs(k))>=v));)if(g.x=y+S,g.y=b+k,!(g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>e[0]||g.y+g.y1>e[1])&&(!m||!sQe(g,p,e[0]))&&(!m||aQe(g,m))){for(var E=g.sprite,A=g.width>>5,F=e[0]>>5,_=g.x-(A<<4),I=_&127,T=32-I,O=g.y1-g.y0,L=(g.y+g.y0)*F+(_>>5),M,P=0;P<O;P++){M=0;for(var G=0;G<=A;G++)p[L+G]|=M<<T|(G<A?(M=E[P*A+G])>>>I:0);L+=F}return g.sprite=null,!0}return!1}return f.words=function(p){return arguments.length?(l=p,f):l},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=td(p),f):n},f.fontStyle=function(p){return arguments.length?(i=td(p),f):i},f.fontWeight=function(p){return arguments.length?(s=td(p),f):s},f.rotate=function(p){return arguments.length?(o=td(p),f):o},f.text=function(p){return arguments.length?(t=td(p),f):t},f.spiral=function(p){return arguments.length?(u=cQe[p]||p,f):u},f.fontSize=function(p){return arguments.length?(r=td(p),f):r},f.padding=function(p){return arguments.length?(a=td(p),f):a},f.random=function(p){return arguments.length?(c=p,f):c},f}function iQe(e,t,n,r){if(!t.sprite){var i=e.context,s=e.ratio;i.clearRect(0,0,(rx<<5)/s,gk/s);var o=0,a=0,u=0,l=n.length,c,f,h,d,p;for(--r;++r<l;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,c=i.measureText(t.text+"m").width*s,h=t.size<<1,t.rotate){var g=Math.sin(t.rotate*zO),m=Math.cos(t.rotate*zO),y=c*m,b=c*g,v=h*m,x=h*g;c=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,h=~~Math.max(Math.abs(b+v),Math.abs(b-v))}else c=c+31>>5<<5;if(h>u&&(u=h),o+c>=rx<<5&&(o=0,a+=u,u=0),a+h>=gk)break;i.translate((o+(c>>1))/s,(a+(h>>1))/s),t.rotate&&i.rotate(t.rotate*zO),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=c,t.height=h,t.xoff=o,t.yoff=a,t.x1=c>>1,t.y1=h>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var w=i.getImageData(0,0,(rx<<5)/s,gk/s).data,C=[];--r>=0;)if(t=n[r],!!t.hasText){for(c=t.width,f=c>>5,h=t.y1-t.y0,d=0;d<h*f;d++)C[d]=0;if(o=t.xoff,o==null)return;a=t.yoff;var $=0,S=-1;for(p=0;p<h;p++){for(d=0;d<c;d++){var k=f*p+(d>>5),E=w[(a+p)*(rx<<5)+(o+d)<<2]?1<<31-d%32:0;C[k]|=E,$|=E}$?S=p:(t.y0++,h--,p--,a++)}t.y1=t.y0+S,t.sprite=C.slice(0,(t.y1-t.y0)*f)}}}function sQe(e,t,n){n>>=5;for(var r=e.sprite,i=e.width>>5,s=e.x-(i<<4),o=s&127,a=32-o,u=e.y1-e.y0,l=(e.y+e.y0)*n+(s>>5),c,f=0;f<u;f++){c=0;for(var h=0;h<=i;h++)if((c<<a|(h<i?(c=r[f*i+h])>>>o:0))&t[l+h])return!0;l+=n}return!1}function oQe(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function aQe(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function Fde(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function uQe(e){var t=4,n=t*e[0]/e[1],r=0,i=0;return function(s){var o=s<0?-1:1;switch(Math.sqrt(1+4*o*s)-o&3){case 0:r+=n;break;case 1:i+=t;break;case 2:r-=n;break;default:i-=t;break}return[r,i]}}function lQe(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function td(e){return typeof e=="function"?e:function(){return e}}var cQe={archimedean:Fde,rectangular:uQe};const Ode=["x","y","font","fontSize","fontStyle","fontWeight","angle"],fQe=["text","font","rotate","fontSize","fontStyle","fontWeight"];function V9(e){ee.call(this,rQe(),e)}V9.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Ode}]};dZe(V9,ee,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&pk("Wordcloud size dimensions must be non-zero.");function n(p){const g=e[p];return gL(g)&&t.modified(g.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||fQe.some(n)))return;const i=t.materialize(t.SOURCE).source,s=this.value,o=e.as||Ode;let a=e.fontSize||14,u;if(gL(a)?u=e.fontSizeRange:a=cZe(a),u){const p=a,g=en("sqrt")().domain(hZe(i,p)).range(u);a=m=>g(p(m))}i.forEach(p=>{p[o[0]]=NaN,p[o[1]]=NaN,p[o[3]]=0});const l=s.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(a).random(nQe).layout(),c=s.size(),f=c[0]>>1,h=c[1]>>1,d=l.length;for(let p=0,g,m;p<d;++p)g=l[p],m=g.datum,m[o[0]]=g.x+f,m[o[1]]=g.y+h,m[o[2]]=g.font,m[o[3]]=g.size,m[o[4]]=g.style,m[o[5]]=g.weight,m[o[6]]=g.rotate;return t.reflow(r).modifies(o)}});const hQe=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:V9},Symbol.toStringTag,{value:"Module"})),dQe=e=>new Uint8Array(e),pQe=e=>new Uint16Array(e),_x=e=>new Uint32Array(e);function gQe(){let e=8,t=[],n=_x(0),r=hS(0,e),i=hS(0,e);return{data:()=>t,seen:()=>n=mQe(n,t.length),add(s){for(let o=0,a=t.length,u=s.length,l;o<u;++o)l=s[o],l._index=a++,t.push(l)},remove(s,o){const a=t.length,u=Array(a-s),l=t;let c,f,h;for(f=0;!o[f]&&f<a;++f)u[f]=t[f],l[f]=f;for(h=f;f<a;++f)c=t[f],o[f]?l[f]=-1:(l[f]=h,r[h]=r[f],i[h]=i[f],u[h]=c,c._index=h++),r[f]=0;return t=u,l},size:()=>t.length,curr:()=>r,prev:()=>i,reset:s=>i[s]=r[s],all:()=>e<257?255:e<65537?65535:4294967295,set(s,o){r[s]|=o},clear(s,o){r[s]&=~o},resize(s,o){const a=r.length;(s>a||o>e)&&(e=Math.max(o,e),r=hS(s,e,r),i=hS(s,e))}}}function mQe(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function hS(e,t,n){const r=(t<257?dQe:t<65537?pQe:_x)(e);return n&&r.set(n),r}function WY(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(i,s){const o=this,a=o.bisect(o.range,i.value),u=i.index,l=a[0],c=a[1],f=u.length;let h;for(h=0;h<l;++h)s[u[h]]|=r;for(h=c;h<f;++h)s[u[h]]|=r;return o}}}function VY(){let e=_x(0),t=[],n=0;function r(a,u,l){if(!u.length)return[];const c=n,f=u.length,h=_x(f);let d=Array(f),p,g,m;for(m=0;m<f;++m)d[m]=a(u[m]),h[m]=m;if(d=yQe(d,h),c)p=t,g=e,t=Array(c+f),e=_x(c+f),bQe(l,p,g,c,d,h,f,t,e);else{if(l>0)for(m=0;m<f;++m)h[m]+=l;t=d,e=h}return n=c+f,{index:h,value:d}}function i(a,u){const l=n;let c,f,h;for(f=0;!u[e[f]]&&f<l;++f);for(h=f;f<l;++f)u[c=e[f]]||(e[h]=c,t[h]=t[f],++h);n=l-a}function s(a){for(let u=0,l=n;u<l;++u)e[u]=a[e[u]]}function o(a,u){let l;return u?l=u.length:(u=t,l=n),[SMe(u,a[0],0,l),jf(u,a[1],0,l)]}return{insert:r,remove:i,bisect:o,reindex:s,index:()=>e,size:()=>n}}function yQe(e,t){return e.sort.call(t,(n,r)=>{const i=e[n],s=e[r];return i<s?-1:i>s?1:0}),AMe(e,t)}function bQe(e,t,n,r,i,s,o,a,u){let l=0,c=0,f;for(f=0;l<r&&c<o;++f)t[l]<i[c]?(a[f]=t[l],u[f]=n[l++]):(a[f]=i[c],u[f]=s[c++]+e);for(;l<r;++l,++f)a[f]=t[l],u[f]=n[l];for(;c<o;++c,++f)a[f]=i[c],u[f]=s[c]+e}function G9(e){ee.call(this,gQe(),e),this._indices=null,this._dims=null}G9.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};ye(G9,ee,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(r=>t.modified(r.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},s=this._dims=[],o=r.length;let a=0,u,l;for(;a<o;++a)u=n[a].fname,l=i[u]||(i[u]=VY()),s.push(WY(l,a,r[a]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,s=this._indices,o=this._dims,a=this.value,u=a.curr(),l=a.prev(),c=a.all(),f=n.rem=n.add,h=n.mod,d=i.length,p={};let g,m,y,b,v,x,w,C,$;if(l.set(u),t.rem.length&&(v=this.remove(e,t,n)),t.add.length&&a.add(t.add),t.mod.length)for(x={},b=t.mod,w=0,C=b.length;w<C;++w)x[b[w]._index]=1;for(w=0;w<d;++w)$=r[w],(!o[w]||e.modified("fields",w)||t.modified($.fields))&&(y=$.fname,(g=p[y])||(s[y]=m=VY(),p[y]=g=m.insert($,t.source,0)),o[w]=WY(m,w,i[w]).onAdd(g,u));for(w=0,C=a.data().length;w<C;++w)v[w]||(l[w]!==u[w]?f.push(w):x[w]&&u[w]!==c&&h.push(w));return a.mask=(1<<d)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,s=this._dims,o=this._indices,a=e.fields,u={},l=n.add,c=i.size()+r.length,f=s.length;let h=i.size(),d,p,g;i.resize(c,f),i.add(r);const m=i.curr(),y=i.prev(),b=i.all();for(d=0;d<f;++d)p=a[d].fname,g=u[p]||(u[p]=o[p].insert(a[d],r,h)),s[d].onAdd(g,m);for(;h<c;++h)y[h]=b,m[h]!==b&&l.push(h)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),s=r.all(),o=e.mod;let a,u,l;for(a=0,u=o.length;a<u;++a)l=o[a]._index,i[l]!==s&&n.push(l)},remove(e,t,n){const r=this._indices,i=this.value,s=i.curr(),o=i.prev(),a=i.all(),u={},l=n.rem,c=t.rem;let f,h,d,p;for(f=0,h=c.length;f<h;++f)d=c[f]._index,u[d]=1,o[d]=p=s[d],s[d]=a,p!==a&&l.push(d);for(d in r)r[d].remove(h,u);return this.reindex(t,h,u),u},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const s=i.remove(t,n);for(const o in r)r[o].reindex(s)})},update(e,t,n){const r=this._dims,i=e.query,s=t.stamp,o=r.length;let a=0,u,l;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(u=l,++a);if(a===1)a=r[u].one,this.incrementOne(r[u],i[u],n.add,n.rem);else for(l=0,a=0;l<o;++l)e.modified("query",l)&&(a|=r[l].one,this.incrementAll(r[l],i[l],s,n.add),n.rem=n.add);return a},incrementAll(e,t,n,r){const i=this.value,s=i.seen(),o=i.curr(),a=i.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],h=c[1],d=l[0],p=l[1],g=e.one;let m,y,b;if(f<d)for(m=f,y=Math.min(d,h);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;else if(f>d)for(m=d,y=Math.min(f,p);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;if(h>p)for(m=Math.max(f,p),y=h;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;else if(h<p)for(m=Math.max(d,h),y=p;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value,s=i.curr(),o=e.index(),a=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=a[0],h=a[1],d=e.one;let p,g,m;if(l<f)for(p=l,g=Math.min(f,c);p<g;++p)m=o[p],s[m]^=d,n.push(m);else if(l>f)for(p=f,g=Math.min(l,h);p<g;++p)m=o[p],s[m]^=d,r.push(m);if(c>h)for(p=Math.max(l,h),g=c;p<g;++p)m=o[p],s[m]^=d,n.push(m);else if(c<h)for(p=Math.max(f,c),g=h;p<g;++p)m=o[p],s[m]^=d,r.push(m);e.range=t.slice()}});function H9(e){ee.call(this,null,e)}H9.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};ye(H9,ee,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(!(i&n))return t.StopPropagation;const s=t.fork(t.ALL),o=r.data(),a=r.curr(),u=r.prev(),l=c=>a[c]&n?null:o[c];return s.filter(s.MOD,l),i&i-1?(s.filter(s.ADD,c=>{const f=a[c]&n;return!f&&f^u[c]&n?o[c]:null}),s.filter(s.REM,c=>{const f=a[c]&n;return f&&!(f^(f^u[c]&n))?o[c]:null})):(s.filter(s.ADD,l),s.filter(s.REM,c=>(a[c]&n)===i?o[c]:null)),s.filter(s.SOURCE,c=>l(c._index))}});const xQe=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:G9,resolvefilter:H9},Symbol.toStringTag,{value:"Module"}));function my(e,t,n){return e.fields=t||[],e.fname=n,e}function vQe(e){return e.length===1?wQe(e[0]):$Qe(e)}const wQe=e=>function(t){return t[e]},$Qe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ci(e){throw Error(e)}function CQe(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||ci("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&ci("Access path missing closing bracket: "+e),r&&ci("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Rde(e,t,n){const r=CQe(e);return e=r.length===1?r[0]:e,my((n&&n.get||vQe)(r),[e],t||e)}Rde("id");const q9=my(e=>e,[],"identity");my(()=>0,[],"zero");my(()=>1,[],"one");const Mde=my(()=>!0,[],"true");my(()=>!1,[],"false");var cc=Array.isArray;function CA(e){return e===Object(e)}function oh(e){return e[e.length-1]}function X9(e){return e==null||e===""?null:+e}const Lde=e=>t=>e*Math.exp(t),Pde=e=>t=>Math.log(e*t),Bde=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),zde=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,SA=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function pN(e,t,n,r){const i=n(e[0]),s=n(oh(e)),o=(s-i)*t;return[r(i-o),r(s-o)]}function SQe(e,t){return pN(e,t,X9,q9)}function kQe(e,t){var n=Math.sign(e[0]);return pN(e,t,Pde(n),Lde(n))}function EQe(e,t,n){return pN(e,t,SA(n),SA(1/n))}function AQe(e,t,n){return pN(e,t,Bde(n),zde(n))}function gN(e,t,n,r,i){const s=r(e[0]),o=r(oh(e)),a=t!=null?r(t):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function _Qe(e,t,n){return gN(e,t,n,X9,q9)}function TQe(e,t,n){const r=Math.sign(e[0]);return gN(e,t,n,Pde(r),Lde(r))}function IQe(e,t,n,r){return gN(e,t,n,SA(r),SA(1/r))}function DQe(e,t,n,r){return gN(e,t,n,Bde(r),zde(r))}function NQe(e){return 1+~~(new Date(e).getMonth()/3)}function FQe(e){return 1+~~(new Date(e).getUTCMonth()/3)}function GY(e){return e!=null?cc(e)?e:[e]:[]}function OQe(e,t,n){let r=e[0],i=e[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-s),r+s]}function kA(e){return typeof e=="function"}function Y9(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function RQe(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}const MQe=Object.prototype.hasOwnProperty;function cf(e,t){return MQe.call(e,t)}function LQe(e,t,n,r,i,s){if(!n&&n!==0)return s;const o=+n;let a=e[0],u=oh(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=o?r:c<=o?i:s}function PQe(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function BQe(e){return typeof e=="boolean"}function Ude(e){return Object.prototype.toString.call(e)==="[object Date]"}function jde(e){return typeof e=="number"}function zQe(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function yy(e){return typeof e=="string"}function UQe(e,t){const n=e[0],r=oh(e),i=+t;return i?i===1?r:n+i*(r-n):n}function dS(e,t){let n="";for(;--t>=0;)n+=e;return n}function jQe(e,t,n,r){const i=n||" ",s=e+"",o=t-s.length;return o<=0?s:r==="left"?dS(i,o)+s:r==="center"?dS(i,~~(o/2))+s+dS(i,Math.ceil(o/2)):s+dS(i,o)}function WQe(e){return e&&oh(e)-e[0]||0}function Zv(e){return cc(e)?"["+e.map(Zv)+"]":CA(e)||yy(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function VQe(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const GQe=e=>jde(e)||Ude(e)?e:Date.parse(e);function HQe(e,t){return t=t||GQe,e==null||e===""?null:t(e)}function qQe(e){return e==null||e===""?null:e+""}function HY(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function XQe(e,t,n,r){const i=r??"…",s=e+"",o=s.length,a=Math.max(0,t-i.length);return o<=t?s:n==="left"?i+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i}const YQe="RawCode",I0="Literal",KQe="Property",ZQe="Identifier",JQe="ArrayExpression",QQe="BinaryExpression",Wde="CallExpression",eet="ConditionalExpression",tet="LogicalExpression",net="MemberExpression",ret="ObjectExpression",iet="UnaryExpression";function Ra(e){this.type=e}Ra.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=set(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function set(e){switch(e.type){case JQe:return e.elements;case QQe:case tet:return[e.left,e.right];case Wde:return[e.callee].concat(e.arguments);case eet:return[e.test,e.consequent,e.alternate];case net:return[e.object,e.property];case ret:return e.properties;case KQe:return[e.key,e.value];case iet:return[e.argument];case ZQe:case I0:case YQe:default:return[]}}var Ku,De,re,yi,Ut,mN=1,F$=2,Lp=3,Mh=4,yN=5,Ig=6,ts=7,O$=8,oet=9;Ku={};Ku[mN]="Boolean";Ku[F$]="<end>";Ku[Lp]="Identifier";Ku[Mh]="Keyword";Ku[yN]="Null";Ku[Ig]="Numeric";Ku[ts]="Punctuator";Ku[O$]="String";Ku[oet]="RegularExpression";var aet="ArrayExpression",uet="BinaryExpression",cet="CallExpression",fet="ConditionalExpression",Vde="Identifier",het="Literal",det="LogicalExpression",pet="MemberExpression",get="ObjectExpression",met="Property",yet="UnaryExpression",vr="Unexpected token %0",bet="Unexpected number",xet="Unexpected string",vet="Unexpected identifier",wet="Unexpected reserved word",$et="Unexpected end of input",kL="Invalid regular expression",UO="Invalid regular expression: missing /",Gde="Octal literals are not allowed in strict mode.",Cet="Duplicate data property in object literal not allowed in strict mode",Br="ILLEGAL",Jv="Disabled.",ket=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Eet=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function bN(e,t){if(!e)throw new Error("ASSERT: "+t)}function Cl(e){return e>=48&&e<=57}function K9(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Tx(e){return"01234567".indexOf(e)>=0}function Aet(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Qv(e){return e===10||e===13||e===8232||e===8233}function R$(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&ket.test(String.fromCharCode(e))}function EA(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&Eet.test(String.fromCharCode(e))}const _et={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Hde(){for(;re<yi;){const e=De.charCodeAt(re);if(Aet(e)||Qv(e))++re;else break}}function EL(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)re<yi&&K9(De[re])?(r=De[re++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):kt({},vr,Br);return String.fromCharCode(i)}function Tet(){var e,t,n,r;for(e=De[re],t=0,e==="}"&&kt({},vr,Br);re<yi&&(e=De[re++],!!K9(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&kt({},vr,Br),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function qde(){var e,t;for(e=De.charCodeAt(re++),t=String.fromCharCode(e),e===92&&(De.charCodeAt(re)!==117&&kt({},vr,Br),++re,e=EL("u"),(!e||e==="\\"||!R$(e.charCodeAt(0)))&&kt({},vr,Br),t=e);re<yi&&(e=De.charCodeAt(re),!!EA(e));)++re,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),De.charCodeAt(re)!==117&&kt({},vr,Br),++re,e=EL("u"),(!e||e==="\\"||!EA(e.charCodeAt(0)))&&kt({},vr,Br),t+=e);return t}function Iet(){var e,t;for(e=re++;re<yi;){if(t=De.charCodeAt(re),t===92)return re=e,qde();if(EA(t))++re;else break}return De.slice(e,re)}function Det(){var e,t,n;return e=re,t=De.charCodeAt(re)===92?qde():Iet(),t.length===1?n=Lp:_et.hasOwnProperty(t)?n=Mh:t==="null"?n=yN:t==="true"||t==="false"?n=mN:n=Lp,{type:n,value:t,start:e,end:re}}function jO(){var e=re,t=De.charCodeAt(re),n,r=De[re],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++re,{type:ts,value:String.fromCharCode(t),start:e,end:re};default:if(n=De.charCodeAt(re+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return re+=2,{type:ts,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:re};case 33:case 61:return re+=2,De.charCodeAt(re)===61&&++re,{type:ts,value:De.slice(e,re),start:e,end:re}}}if(o=De.substr(re,4),o===">>>=")return re+=4,{type:ts,value:o,start:e,end:re};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return re+=3,{type:ts,value:s,start:e,end:re};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return re+=2,{type:ts,value:i,start:e,end:re};if(i==="//"&&kt({},vr,Br),"<>=!+-*%&|^/".indexOf(r)>=0)return++re,{type:ts,value:r,start:e,end:re};kt({},vr,Br)}function Net(e){let t="";for(;re<yi&&K9(De[re]);)t+=De[re++];return t.length===0&&kt({},vr,Br),R$(De.charCodeAt(re))&&kt({},vr,Br),{type:Ig,value:parseInt("0x"+t,16),start:e,end:re}}function Fet(e){let t="0"+De[re++];for(;re<yi&&Tx(De[re]);)t+=De[re++];return(R$(De.charCodeAt(re))||Cl(De.charCodeAt(re)))&&kt({},vr,Br),{type:Ig,value:parseInt(t,8),octal:!0,start:e,end:re}}function qY(){var e,t,n;if(n=De[re],bN(Cl(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=re,e="",n!=="."){if(e=De[re++],n=De[re],e==="0"){if(n==="x"||n==="X")return++re,Net(t);if(Tx(n))return Fet(t);n&&Cl(n.charCodeAt(0))&&kt({},vr,Br)}for(;Cl(De.charCodeAt(re));)e+=De[re++];n=De[re]}if(n==="."){for(e+=De[re++];Cl(De.charCodeAt(re));)e+=De[re++];n=De[re]}if(n==="e"||n==="E")if(e+=De[re++],n=De[re],(n==="+"||n==="-")&&(e+=De[re++]),Cl(De.charCodeAt(re)))for(;Cl(De.charCodeAt(re));)e+=De[re++];else kt({},vr,Br);return R$(De.charCodeAt(re))&&kt({},vr,Br),{type:Ig,value:parseFloat(e),start:t,end:re}}function Oet(){var e="",t,n,r,i,s=!1;for(t=De[re],bN(t==="'"||t==='"',"String literal must starts with a quote"),n=re,++re;re<yi;)if(r=De[re++],r===t){t="";break}else if(r==="\\")if(r=De[re++],!r||!Qv(r.charCodeAt(0)))switch(r){case"u":case"x":De[re]==="{"?(++re,e+=Tet()):e+=EL(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Tx(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),re<yi&&Tx(De[re])&&(s=!0,i=i*8+"01234567".indexOf(De[re++]),"0123".indexOf(r)>=0&&re<yi&&Tx(De[re])&&(i=i*8+"01234567".indexOf(De[re++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&De[re]===`
`&&++re;else{if(Qv(r.charCodeAt(0)))break;e+=r}return t!==""&&kt({},vr,Br),{type:O$,value:e,octal:s,start:n,end:re}}function Ret(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";kt({},kL)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{kt({},kL)}try{return new RegExp(e,t)}catch{return null}}function Met(){var e,t,n,r,i;for(e=De[re],bN(e==="/","Regular expression literal must start with a slash"),t=De[re++],n=!1,r=!1;re<yi;)if(e=De[re++],t+=e,e==="\\")e=De[re++],Qv(e.charCodeAt(0))&&kt({},UO),t+=e;else if(Qv(e.charCodeAt(0)))kt({},UO);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||kt({},UO),i=t.substr(1,t.length-2),{value:i,literal:t}}function Let(){var e,t,n;for(t="",n="";re<yi&&(e=De[re],!!EA(e.charCodeAt(0)));)++re,e==="\\"&&re<yi?kt({},vr,Br):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&kt({},kL,n),{value:n,literal:t}}function Pet(){var e,t,n,r;return Ut=null,Hde(),e=re,t=Met(),n=Let(),r=Ret(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:re}}function Bet(e){return e.type===Lp||e.type===Mh||e.type===mN||e.type===yN}function Xde(){if(Hde(),re>=yi)return{type:F$,start:re,end:re};const e=De.charCodeAt(re);return R$(e)?Det():e===40||e===41||e===59?jO():e===39||e===34?Oet():e===46?Cl(De.charCodeAt(re+1))?qY():jO():Cl(e)?qY():jO()}function os(){const e=Ut;return re=e.end,Ut=Xde(),re=e.end,e}function Yde(){const e=re;Ut=Xde(),re=e}function zet(e){const t=new Ra(aet);return t.elements=e,t}function XY(e,t,n){const r=new Ra(e==="||"||e==="&&"?det:uet);return r.operator=e,r.left=t,r.right=n,r}function Uet(e,t){const n=new Ra(cet);return n.callee=e,n.arguments=t,n}function jet(e,t,n){const r=new Ra(fet);return r.test=e,r.consequent=t,r.alternate=n,r}function Z9(e){const t=new Ra(Vde);return t.name=e,t}function ix(e){const t=new Ra(het);return t.value=e.value,t.raw=De.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function YY(e,t,n){const r=new Ra(pet);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function Wet(e){const t=new Ra(get);return t.properties=e,t}function KY(e,t,n){const r=new Ra(met);return r.key=t,r.value=n,r.kind=e,r}function Vet(e,t){const n=new Ra(yet);return n.operator=e,n.argument=t,n.prefix=!0,n}function kt(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,o)=>(bN(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=re,n.description=i,n}function xN(e){e.type===F$&&kt(e,$et),e.type===Ig&&kt(e,bet),e.type===O$&&kt(e,xet),e.type===Lp&&kt(e,vet),e.type===Mh&&kt(e,wet),kt(e,vr,e.value)}function bi(e){const t=os();(t.type!==ts||t.value!==e)&&xN(t)}function an(e){return Ut.type===ts&&Ut.value===e}function WO(e){return Ut.type===Mh&&Ut.value===e}function Get(){const e=[];for(re=Ut.start,bi("[");!an("]");)an(",")?(os(),e.push(null)):(e.push(Pp()),an("]")||bi(","));return os(),zet(e)}function ZY(){re=Ut.start;const e=os();return e.type===O$||e.type===Ig?(e.octal&&kt(e,Gde),ix(e)):Z9(e.value)}function Het(){var e,t,n,r;if(re=Ut.start,e=Ut,e.type===Lp)return n=ZY(),bi(":"),r=Pp(),KY("init",n,r);if(e.type===F$||e.type===ts)xN(e);else return t=ZY(),bi(":"),r=Pp(),KY("init",t,r)}function qet(){var e=[],t,n,r,i={},s=String;for(re=Ut.start,bi("{");!an("}");)t=Het(),t.key.type===Vde?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?kt({},Cet):i[r]=!0,e.push(t),an("}")||bi(",");return bi("}"),Wet(e)}function Xet(){bi("(");const e=J9();return bi(")"),e}const Yet={if:1};function Ket(){var e,t,n;if(an("("))return Xet();if(an("["))return Get();if(an("{"))return qet();if(e=Ut.type,re=Ut.start,e===Lp||Yet[Ut.value])n=Z9(os().value);else if(e===O$||e===Ig)Ut.octal&&kt(Ut,Gde),n=ix(os());else{if(e===Mh)throw new Error(Jv);e===mN?(t=os(),t.value=t.value==="true",n=ix(t)):e===yN?(t=os(),t.value=null,n=ix(t)):an("/")||an("/=")?(n=ix(Pet()),Yde()):xN(os())}return n}function Zet(){const e=[];if(bi("("),!an(")"))for(;re<yi&&(e.push(Pp()),!an(")"));)bi(",");return bi(")"),e}function Jet(){re=Ut.start;const e=os();return Bet(e)||xN(e),Z9(e.value)}function Qet(){return bi("."),Jet()}function ett(){bi("[");const e=J9();return bi("]"),e}function ttt(){var e,t,n;for(e=Ket();;)if(an("."))n=Qet(),e=YY(".",e,n);else if(an("("))t=Zet(),e=Uet(e,t);else if(an("["))n=ett(),e=YY("[",e,n);else break;return e}function JY(){const e=ttt();if(Ut.type===ts&&(an("++")||an("--")))throw new Error(Jv);return e}function mk(){var e,t;if(Ut.type!==ts&&Ut.type!==Mh)t=JY();else{if(an("++")||an("--"))throw new Error(Jv);if(an("+")||an("-")||an("~")||an("!"))e=os(),t=mk(),t=Vet(e.value,t);else{if(WO("delete")||WO("void")||WO("typeof"))throw new Error(Jv);t=JY()}}return t}function QY(e){let t=0;if(e.type!==ts&&e.type!==Mh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function ntt(){var e,t,n,r,i,s,o,a,u,l;if(e=Ut,u=mk(),r=Ut,i=QY(r),i===0)return u;for(r.prec=i,os(),t=[e,Ut],o=mk(),s=[u,r,o];(i=QY(Ut))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=XY(a,u,o),s.push(n);r=os(),r.prec=i,s.push(r),t.push(Ut),n=mk(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=XY(s[l-1].value,s[l-2],n),l-=2;return n}function Pp(){var e,t,n;return e=ntt(),an("?")&&(os(),t=Pp(),bi(":"),n=Pp(),e=jet(e,t,n)),e}function J9(){const e=Pp();if(an(","))throw new Error(Jv);return e}function rtt(e){De=e,re=0,yi=De.length,Ut=null,Yde();const t=J9();if(Ut.type!==F$)throw new Error("Unexpect token after expression.");return t}var Kde={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Zde(e){function t(o,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(o,a,u){return l=>t(o,l,a,u)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&ci("Missing arguments to clamp function."),o.length>3&&ci("Too many arguments to clamp function.");const a=o.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&ci("Missing arguments to if function."),o.length>3&&ci("Too many arguments to if function.");const a=o.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function itt(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function stt(e){e=e||{};const t=e.allowed?HY(e.allowed):{},n=e.forbidden?HY(e.forbidden):{},r=e.constants||Kde,i=(e.functions||Zde)(f),s=e.globalvar,o=e.fieldvar,a=kA(s)?s:p=>`${s}["${p}"]`;let u={},l={},c=0;function f(p){if(yy(p))return p;const g=h[p.type];return g==null&&ci("Unsupported type: "+p.type),g(p)}const h={Literal:p=>p.raw,Identifier:p=>{const g=p.name;return c>0?g:cf(n,g)?ci("Illegal identifier: "+g):cf(r,g)?r[g]:cf(t,g)?g:(u[g]=1,a(g))},MemberExpression:p=>{const g=!p.computed,m=f(p.object);g&&(c+=1);const y=f(p.property);return m===o&&(l[itt(y)]=1),g&&(c-=1),m+(g?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&ci("Illegal callee type: "+p.callee.type);const g=p.callee.name,m=p.arguments,y=cf(i,g)&&i[g];return y||ci("Unrecognized function: "+g),kA(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const g=f(p.key);return c-=1,g+":"+f(p.value)}};function d(p){const g={code:f(p),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},g}return d.functions=i,d.constants=r,d}function VO(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function ott(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function att(e){let t,n,r;e.length!==2?(t=VO,n=(a,u)=>VO(e(a),u),r=(a,u)=>e(a)-u):(t=e===VO||e===ott?e:utt,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function utt(){return 0}function ltt(e,...t){e=new Yk(e),t=t.map(ctt);e:for(const n of e)for(const r of t)if(!r.has(n)){e.delete(n);continue e}return e}function ctt(e){return e instanceof Yk?e:new Yk(e)}function ftt(...e){const t=new Yk;for(const n of e)for(const r of n)t.add(r);return t}function by(e,t,n){return e.fields=t||[],e.fname=n,e}function htt(e){return e.length===1?dtt(e[0]):ptt(e)}const dtt=e=>function(t){return t[e]},ptt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function yk(e){throw Error(e)}function gtt(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||yk("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&yk("Access path missing closing bracket: "+e),r&&yk("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Q9(e,t,n){const r=gtt(e);return e=r.length===1?r[0]:e,by((n&&n.get||htt)(r),[e],t||e)}Q9("id");by(e=>e,[],"identity");by(()=>0,[],"zero");by(()=>1,[],"one");by(()=>!0,[],"true");by(()=>!1,[],"false");var AL=Array.isArray;function mtt(e){return e[e.length-1]}function jd(e){return e==null||e===""?null:+e}function eK(e){return e!=null?AL(e)?e:[e]:[]}function ytt(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const btt=Object.prototype.hasOwnProperty;function tK(e,t){return btt.call(e,t)}function pS(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function GO(e){return Object.prototype.toString.call(e)==="[object Date]"}const xtt="Literal";var Zu,vtt=1,wtt=2,$tt=3,Ctt=4,Stt=5,ktt=6,Ett=7,Att=8,_tt=9;Zu={};Zu[vtt]="Boolean";Zu[wtt]="<end>";Zu[$tt]="Identifier";Zu[Ctt]="Keyword";Zu[Stt]="Null";Zu[ktt]="Numeric";Zu[Ett]="Punctuator";Zu[Att]="String";Zu[_tt]="RegularExpression";const nK=Symbol("vega_selection_getter");function Jde(e){return(!e.getter||!e.getter[nK])&&(e.getter=Q9(e.field),e.getter[nK]=!0),e.getter}const eU="intersect",rK="union",Ttt="vlMulti",Itt="vlPoint",iK="or",Dtt="and",Za="_vgsid_",e2=Q9(Za),Ntt="E",Ftt="R",Ott="R-E",Rtt="R-LE",Mtt="R-RE",AA="index:unit";function sK(e,t){for(var n=t.fields,r=t.values,i=n.length,s=0,o,a;s<i;++s)if(a=n[s],o=Jde(a)(e),GO(o)&&(o=jd(o)),GO(r[s])&&(r[s]=jd(r[s])),AL(r[s])&&GO(r[s][0])&&(r[s]=r[s].map(jd)),a.type===Ntt){if(AL(r[s])?r[s].indexOf(o)<0:o!==r[s])return!1}else if(a.type===Ftt){if(!pS(o,r[s]))return!1}else if(a.type===Mtt){if(!pS(o,r[s],!0,!1))return!1}else if(a.type===Ott){if(!pS(o,r[s],!1,!1))return!1}else if(a.type===Rtt&&!pS(o,r[s],!1,!0))return!1;return!0}function Ltt(e,t,n){for(var r=this.context.data[e],i=r?r.values.value:[],s=r?r[AA]&&r[AA].value:void 0,o=n===eU,a=i.length,u=0,l,c,f,h,d;u<a;++u)if(l=i[u],s&&o){if(c=c||{},f=c[h=l.unit]||0,f===-1)continue;if(d=sK(t,l),c[h]=d?-1:++f,d&&s.size===1)return!0;if(!d&&f===s.get(h).count)return!1}else if(d=sK(t,l),o^d)return d;return a&&o}const Qde=att(e2),Ptt=Qde.left,Btt=Qde.right;function ztt(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],s=r?r[AA]&&r[AA].value:void 0,o=n===eU,a=e2(t),u=Ptt(i,a);if(u===i.length||e2(i[u])!==a)return!1;if(s&&o){if(s.size===1)return!0;if(Btt(i,a)-u<s.size)return!1}return!0}function Utt(e,t){return e.map(n=>ytt(t.fields?{values:t.fields.map(r=>Jde(r)(n.datum))}:{[Za]:e2(n.datum)},t))}function jtt(e,t,n,r){for(var i=this.context.data[e],s=i?i.values.value:[],o={},a={},u={},l,c,f,h,d,p,g,m,y,b,v=s.length,x=0,w,C;x<v;++x)if(l=s[x],h=l.unit,c=l.fields,f=l.values,c&&f){for(w=0,C=c.length;w<C;++w)d=c[w],g=o[d.field]||(o[d.field]={}),m=g[h]||(g[h]=[]),u[d.field]=y=d.type.charAt(0),b=HO[`${y}_union`],g[h]=b(m,eK(f[w]));n&&(m=a[h]||(a[h]=[]),m.push(eK(f).reduce(($,S,k)=>($[c[k].field]=S,$),{})))}else d=Za,p=e2(l),g=o[d]||(o[d]={}),m=g[h]||(g[h]=[]),m.push(p),n&&(m=a[h]||(a[h]=[]),m.push({[Za]:p}));if(t=t||rK,o[Za]?o[Za]=HO[`${Za}_${t}`](...Object.values(o[Za])):Object.keys(o).forEach($=>{o[$]=Object.keys(o[$]).map(S=>o[$][S]).reduce((S,k)=>S===void 0?k:HO[`${u[$]}_${t}`](S,k))}),s=Object.keys(a),n&&s.length){const $=r?Itt:Ttt;o[$]=t===rK?{[iK]:s.reduce((S,k)=>(S.push(...a[k]),S),[])}:{[Dtt]:s.map(S=>({[iK]:a[S]}))}}return o}var HO={[`${Za}_union`]:ftt,[`${Za}_intersect`]:ltt,E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=jd(t[0]),r=jd(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=jd(t[0]),r=jd(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};const Wtt=":",Vtt="@";function tU(e,t,n,r){t[0].type!==xtt&&yk("First argument to selection functions must be a string literal.");const i=t[0].value,s=t.length>=2&&mtt(t).value,o="unit",a=Vtt+o,u=Wtt+i;s===eU&&!tK(r,a)&&(r[a]=n.getData(i).indataRef(n,o)),tK(r,u)||(r[u]=n.getData(i).tuplesRef())}function epe(e){const t=this.context.data[e];return t?t.values.value:[]}function Gtt(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i&&i.count}function Htt(e,t){const n=this.context.dataflow,r=this.context.data[e],i=r.input;return n.pulse(i,n.changeset().remove(Mde).insert(t)),1}function qtt(e,t,n){if(e){const r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==void 0?n:e}const M$=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},Xtt=M$("format"),tpe=M$("timeFormat"),Ytt=M$("utcFormat"),Ktt=M$("timeParse"),Ztt=M$("utcParse"),gS=new Date(2e3,0,1);function vN(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(gS.setYear(2e3),gS.setMonth(e),gS.setDate(t),tpe.call(this,gS,n))}function Jtt(e){return vN.call(this,e,1,"%B")}function Qtt(e){return vN.call(this,e,1,"%b")}function ent(e){return vN.call(this,0,2+e,"%A")}function tnt(e){return vN.call(this,0,2+e,"%a")}const nnt=":",rnt="@",_L="%",npe="$";function nU(e,t,n,r){t[0].type!==I0&&ci("First argument to data functions must be a string literal.");const i=t[0].value,s=nnt+i;if(!cf(s,r))try{r[s]=n.getData(i).tuplesRef()}catch{}}function int(e,t,n,r){t[0].type!==I0&&ci("First argument to indata must be a string literal."),t[1].type!==I0&&ci("Second argument to indata must be a string literal.");const i=t[0].value,s=t[1].value,o=rnt+s;cf(o,r)||(r[o]=n.getData(i).indataRef(n,s))}function ms(e,t,n,r){if(t[0].type===I0)oK(n,r,t[0].value);else for(e in n.scales)oK(n,r,e)}function oK(e,t,n){const r=_L+n;if(!cf(t,r))try{t[r]=e.scaleRef(n)}catch{}}function $c(e,t){let n;return kA(e)?e:yy(e)?(n=t.scales[e])&&n.value:void 0}function snt(e,t,n){t.__bandwidth=i=>i&&i.bandwidth?i.bandwidth():0,n._bandwidth=ms,n._range=ms,n._scale=ms;const r=i=>"_["+(i.type===I0?Zv(_L+i.value):Zv(_L)+"+"+e(i))+"]";return{_bandwidth:i=>`this.__bandwidth(${r(i[0])})`,_range:i=>`${r(i[0])}.range()`,_scale:i=>`${r(i[0])}(${e(i[1])})`}}function rU(e,t){return function(n,r,i){if(n){const s=$c(n,(i||this).context);return s&&s.path[e](r)}else return t(r)}}const ont=rU("area",qje),ant=rU("bounds",Zje),unt=rU("centroid",rWe);function lnt(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function iU(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function cnt(){return iU(this.context.dataflow,"warn",arguments)}function fnt(){return iU(this.context.dataflow,"info",arguments)}function hnt(){return iU(this.context.dataflow,"debug",arguments)}function qO(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function TL(e){const t=ws(e),n=qO(t.r),r=qO(t.g),i=qO(t.b);return .2126*n+.7152*r+.0722*i}function dnt(e,t){const n=TL(e),r=TL(t),i=Math.max(n,r),s=Math.min(n,r);return(i+.05)/(s+.05)}function pnt(){const e=[].slice.call(arguments);return e.unshift({}),Y9(...e)}function rpe(e,t){return e===t||e!==e&&t!==t?!0:cc(e)?cc(t)&&e.length===t.length?gnt(e,t):!1:CA(e)&&CA(t)?ipe(e,t):!1}function gnt(e,t){for(let n=0,r=e.length;n<r;++n)if(!rpe(e[n],t[n]))return!1;return!0}function ipe(e,t){for(const n in e)if(!rpe(e[n],t[n]))return!1;return!0}function aK(e){return t=>ipe(e,t)}function mnt(e,t,n,r,i,s){const o=this.context.dataflow,a=this.context.data[e],u=a.input,l=o.stamp();let c=a.changes,f,h;if(o._trigger===!1||!(u.value.length||t||r))return 0;if((!c||c.stamp<l)&&(a.changes=c=o.changeset(),c.stamp=l,o.runAfter(()=>{a.modified=!0,o.pulse(u,c).run()},!0,1)),n&&(f=n===!0?Mde:cc(n)||zI(n)?n:aK(n),c.remove(f)),t&&c.insert(t),r&&(f=aK(r),u.value.some(f)?c.remove(f):c.insert(r)),i)for(h in s)c.modify(i,h,s[h]);return 1}function ynt(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)}function bnt(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const uK={};function xnt(e,t){const n=uK[t]||(uK[t]=Rde(t));return cc(e)?e.map(n):n(e)}function sU(e){return cc(e)||ArrayBuffer.isView(e)?e:null}function oU(e){return sU(e)||(yy(e)?e:null)}function vnt(e,...t){return sU(e).join(...t)}function wnt(e,...t){return oU(e).indexOf(...t)}function $nt(e,...t){return oU(e).lastIndexOf(...t)}function Cnt(e,...t){return oU(e).slice(...t)}function Snt(e,t,n){return kA(n)&&ci("Function argument passed to replace."),String(e).replace(t,n)}function knt(e){return sU(e).slice().reverse()}function Ent(e,t,n){return F8(e||0,t||0,n||0)}function Ant(e,t){const n=$c(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function _nt(e,t){const n=$c(e,(t||this).context);return n?n.copy():void 0}function Tnt(e,t){const n=$c(e,(t||this).context);return n?n.domain():[]}function Int(e,t,n){const r=$c(e,(n||this).context);return r?cc(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}function Dnt(e,t){const n=$c(e,(t||this).context);return n&&n.range?n.range():[]}function Nnt(e,t,n){const r=$c(e,(n||this).context);return r?r(t):void 0}function Fnt(e,t,n,r,i){e=$c(e,(i||this).context);const s=Zfe(t,n);let o=e.domain(),a=o[0],u=oh(o),l=q9;return u-a?l=Rle(e,a,u):e=(e.interpolator?Ft("sequential")().interpolator(e.interpolator()):Ft("linear")().interpolate(e.interpolate()).range(e.range())).domain([a=0,u=1]),e.ticks&&(o=e.ticks(+r||15),a!==o[0]&&o.unshift(a),u!==oh(o)&&o.push(u)),o.forEach(c=>s.stop(l(c),e(c))),s}function Ont(e,t,n){const r=$c(e,(n||this).context);return function(i){return r?r.path.context(i)(t):""}}function Rnt(e){let t=null;return function(n){return n?Vv(n,t=t||S0(e)):e}}const spe=e=>e.data;function ope(e,t){const n=epe.call(t,e);return n.root&&n.root.lookup||{}}function Mnt(e,t,n){const r=ope(e,this),i=r[t],s=r[n];return i&&s?i.path(s).map(spe):void 0}function Lnt(e,t){const n=ope(e,this)[t];return n?n.ancestors().map(spe):void 0}const ape=()=>typeof window<"u"&&window||null;function Pnt(){const e=ape();return e?e.screen:{}}function Bnt(){const e=ape();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function znt(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function Unt(e,t,n){if(!e)return[];const[r,i]=e,s=new Wi().set(r[0],r[1],i[0],i[1]),o=n||this.context.dataflow.scenegraph().root;return Uhe(o,s,jnt(t))}function jnt(e){let t=null;if(e){const n=GY(e.marktype),r=GY(e.markname);t=i=>(!n.length||n.some(s=>i.marktype===s))&&(!r.length||r.some(s=>i.name===s))}return t}const t2={random(){return Ca()},cumulativeNormal:GI,cumulativeLogNormal:b6,cumulativeUniform:$6,densityNormal:d6,densityLogNormal:y6,densityUniform:w6,quantileNormal:HI,quantileLogNormal:x6,quantileUniform:C6,sampleNormal:VI,sampleLogNormal:m6,sampleUniform:v6,isArray:cc,isBoolean:BQe,isDate:Ude,isDefined(e){return e!==void 0},isNumber:jde,isObject:CA,isRegExp:zQe,isString:yy,isTuple:zI,isValid(e){return e!=null&&e===e},toBoolean:VQe,toDate:HQe,toNumber:X9,toString:qQe,indexof:wnt,join:vnt,lastindexof:$nt,replace:Snt,reverse:knt,slice:Cnt,flush:LQe,lerp:UQe,merge:pnt,pad:jQe,peek:oh,pluck:xnt,span:WQe,inrange:PQe,truncate:XQe,rgb:ws,lab:Yf,hcl:Kf,hsl:Xf,luminance:TL,contrast:dnt,sequence:Us,format:Xtt,utcFormat:Ytt,utcParse:Ztt,utcOffset:$se,utcSequence:kse,timeFormat:tpe,timeParse:Ktt,timeOffset:wse,timeSequence:Sse,timeUnitSpecifier:cse,monthFormat:Jtt,monthAbbrevFormat:Qtt,dayFormat:ent,dayAbbrevFormat:tnt,quarter:NQe,utcquarter:FQe,week:hse,utcweek:gse,dayofyear:fse,utcdayofyear:pse,warn:cnt,info:fnt,debug:hnt,extent:RQe,inScope:lnt,intersect:Unt,clampRange:OQe,pinchDistance:ynt,pinchAngle:bnt,screen:Pnt,containerSize:znt,windowSize:Bnt,bandspace:Ent,setdata:Htt,pathShape:Rnt,panLinear:SQe,panLog:kQe,panPow:EQe,panSymlog:AQe,zoomLinear:_Qe,zoomLog:TQe,zoomPow:IQe,zoomSymlog:DQe,encode:qtt,modify:mnt},Wnt=["view","item","group","xy","x","y"],Vnt="event.vega.",upe="this.",aU={},lpe={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Zv(npe+e)}]`,functions:Gnt,constants:Kde,visitors:aU},IL=stt(lpe);function Gnt(e){const t=Zde(e);Wnt.forEach(n=>t[n]=Vnt+n);for(const n in t2)t[n]=upe+n;return Y9(t,snt(e,t2,aU)),t}function qn(e,t,n){return arguments.length===1?t2[e]:(t2[e]=t,n&&(aU[e]=n),IL&&(IL.functions[e]=upe+e),this)}qn("bandwidth",Ant,ms);qn("copy",_nt,ms);qn("domain",Tnt,ms);qn("range",Dnt,ms);qn("invert",Int,ms);qn("scale",Nnt,ms);qn("gradient",Fnt,ms);qn("geoArea",ont,ms);qn("geoBounds",ant,ms);qn("geoCentroid",unt,ms);qn("geoShape",Ont,ms);qn("indata",Gtt,int);qn("data",epe,nU);qn("treePath",Mnt,nU);qn("treeAncestors",Lnt,nU);qn("vlSelectionTest",Ltt,tU);qn("vlSelectionIdTest",ztt,tU);qn("vlSelectionResolve",jtt,tU);qn("vlSelectionTuples",Utt);function Ou(e,t){const n={};let r;try{e=yy(e)?e:Zv(e)+"",r=rtt(e)}catch{ci("Expression parse error: "+e)}r.visit(s=>{if(s.type!==Wde)return;const o=s.callee.name,a=lpe.visitors[o];a&&a(o,s.arguments,t,n)});const i=IL(r);return i.globals.forEach(s=>{const o=npe+s;!cf(n,o)&&t.getSignal(s)&&(n[o]=t.signalRef(s))}),{$expr:Y9({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}function Ju(e,t,n){return e.fields=t||[],e.fname=n,e}function Hnt(e){return e==null?null:e.fields}function cpe(e){return e.length===1?qnt(e[0]):Xnt(e)}const qnt=e=>function(t){return t[e]},Xnt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function rp(e){throw Error(e)}function fpe(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||rp("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&rp("Access path missing closing bracket: "+e),r&&rp("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function uU(e,t,n){const r=fpe(e);return e=r.length===1?r[0]:e,Ju((n&&n.get||cpe)(r),[e],t||e)}uU("id");Ju(e=>e,[],"identity");Ju(()=>0,[],"zero");Ju(()=>1,[],"one");const Ynt=Ju(()=>!0,[],"true");Ju(()=>!1,[],"false");var lU=Array.isArray;function cU(e){return e===Object(e)}function n2(e){return e!=null?lU(e)?e:[e]:[]}function Knt(e){return typeof e=="function"}const Znt="descending";function Jnt(e,t,n){n=n||{},t=n2(t)||[];const r=[],i=[],s={},o=n.comparator||Qnt;return n2(e).forEach((a,u)=>{a!=null&&(r.push(t[u]===Znt?-1:1),i.push(a=Knt(a)?a:uU(a,null,n)),(Hnt(a)||[]).forEach(l=>s[l]=1))}),i.length===0?null:Ju(o(i,r),Object.keys(s))}const hpe=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),Qnt=(e,t)=>e.length===1?ert(e[0],t[0]):trt(e,t,e.length),ert=(e,t)=>function(n,r){return hpe(e(n),e(r))*t},trt=(e,t,n)=>(t.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=e[a],o=hpe(s(r),s(i));return o*t[a]}),nrt=Object.prototype.hasOwnProperty;function rrt(e,t){return nrt.call(e,t)}function irt(e){return typeof e=="string"}function srt(e,t,n){e&&(e=t?n2(e).map(a=>a.replace(/\\(.)/g,"$1")):n2(e));const r=e&&e.length,i=n&&n.get||cpe,s=a=>i(t?[a]:fpe(a));let o;if(!r)o=function(){return""};else if(r===1){const a=s(e[0]);o=function(u){return""+a(u)}}else{const a=e.map(s);o=function(u){let l=""+a[0](u),c=0;for(;++c<r;)l+="|"+a[c](u);return l}}return Ju(o,e,"key")}function DL(e){return lU(e)?"["+e.map(DL)+"]":cU(e)||irt(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function dpe(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function ort(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(r=>t.parseOperator(r)),n.forEach(r=>t.parseOperatorParameters(r)),(e.streams||[]).forEach(r=>t.parseStream(r)),(e.updates||[]).forEach(r=>t.parseUpdate(r)),t.resolve()}const art=dpe(["rule"]),lK=dpe(["group","image","rect"]);function urt(e,t){let n="";return art[t]||(e.x2&&(e.x?(lK[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(lK[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function fU(e){return(e+"").toLowerCase()}function lrt(e){return fU(e)==="operator"}function crt(e){return fU(e)==="collect"}function vb(e,t,n){n.endsWith(";")||(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}function frt(e,t,n,r){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${r}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${r} : `}var hrt={operator:(e,t)=>vb(e,["_"],t.code),parameter:(e,t)=>vb(e,["datum","_"],t.code),event:(e,t)=>vb(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return vb(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const o="o["+DL(s)+"]";i+=`$=${r[s].code};if(${o}!==$)${o}=$,m=1;`}return i+=urt(r,n),i+="return m;",vb(e,["item","_"],i)},codegen:{get(e){const t=`[${e.map(DL).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const r=(s,o)=>{const a=t[o];let u,l;return s.path?(u=`a${s.path}`,l=`b${s.path}`):((n=n||{})["f"+o]=s,u=`this.f${o}(a)`,l=`this.f${o}(b)`),frt(u,l,-a,a)},i=Function("a","b","var u, v; return "+e.map(r).join("")+"0;");return n?i.bind(n):i}}};function drt(e){const t=this;lrt(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function prt(e){const t=this;if(e.params){const n=t.get(e.id);n||rp("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function grt(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=lU(i)?i.map(s=>cK(s,n,t)):cK(i,n,t)}return t}function cK(e,t,n){if(!e||!cU(e))return e;for(let r=0,i=fK.length,s;r<i;++r)if(s=fK[r],rrt(e,s.key))return s.parse(e,t,n);return e}var fK=[{key:"$ref",parse:mrt},{key:"$key",parse:brt},{key:"$expr",parse:yrt},{key:"$field",parse:xrt},{key:"$encode",parse:wrt},{key:"$compare",parse:vrt},{key:"$context",parse:$rt},{key:"$subflow",parse:Crt},{key:"$tupleid",parse:Srt}];function mrt(e,t){return t.get(e.$ref)||rp("Operator not defined: "+e.$ref)}function yrt(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code;return t.fn[r]||(t.fn[r]=Ju(t.parameterExpression(e.$expr),e.$fields))}function brt(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=srt(e.$key,e.$flat,t.expr.codegen))}function xrt(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=uU(e.$field,e.$name,t.expr.codegen))}function vrt(e,t){const n="c:"+e.$compare+"_"+e.$order,r=n2(e.$compare).map(i=>i&&i.$tupleid?Le:i);return t.fn[n]||(t.fn[n]=Jnt(r,e.$order,t.expr.codegen))}function wrt(e,t){const n=e.$encode,r={};for(const i in n){const s=n[i];r[i]=Ju(t.encodeExpression(s.$expr),s.$fields),r[i].output=s.$output}return r}function $rt(e,t){return t}function Crt(e,t){const n=e.$subflow;return function(r,i,s){const o=t.fork().parse(n),a=o.get(n.operators[0].id),u=o.signals.parent;return u&&u.set(s),a.detachSubflow=()=>t.detach(o),a}}function Srt(){return Le}function krt(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,r=e.stream!=null?t.get(e.stream):void 0,i;e.source?r=t.events(e.source,e.type,n):e.merge&&(i=e.merge.map(s=>t.get(s)),r=i[0].merge.apply(i[0],i.slice(1))),e.between&&(i=e.between.map(s=>t.get(s)),r=r.between(i[0],i[1])),e.filter&&(r=r.filter(n)),e.throttle!=null&&(r=r.throttle(+e.throttle)),e.debounce!=null&&(r=r.debounce(+e.debounce)),r==null&&rp("Invalid stream definition: "+JSON.stringify(e)),e.consume&&r.consume(!0),t.stream(e,r)}function Ert(e){var t=this,n=cU(n=e.source)?n.$ref:n,r=t.get(n),i=null,s=e.update,o=void 0;r||rp("Source not defined: "+e.source),i=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),s&&s.$expr&&(s.$params&&(o=t.parseParameters(s.$params)),s=t.handlerExpression(s.$expr)),t.update(e,r,i,s,o)}const Art={skip:!0};function _rt(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(s=>{const o=t.signals[s];e.signals(s,o)&&(r[s]=o.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(s=>{const o=t.data[s];e.data(s,o)&&(i[s]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n}function Trt(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(s=>{n.update(t.signals[s],i[s],Art)}),Object.keys(r||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(Ynt).insert(r[s]))}),(e.subcontext||[]).forEach((s,o)=>{const a=t.subcontext[o];a&&a.setState(s)})}function ppe(e,t,n,r){return new gpe(e,t,n,r)}function gpe(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||hrt,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function hK(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}gpe.prototype=hK.prototype={fork(){const e=new hK(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),crt(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(r.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),r.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const o=n.data[s]||(n.data[s]={});e.data[s].forEach(a=>o[a]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[fU(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:ort,parseOperator:drt,parseOperatorParameters:prt,parseParameters:grt,parseStream:krt,parseUpdate:Ert,getState:_rt,setState:Trt};function Irt(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),mpe(t,e.description()))}function mpe(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function Drt(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const XO="default";function Nrt(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:XO,item:null}));e.on(e.events("view","mousemove"),t,(n,r)=>{const i=t.value,s=i?hn(i)?i:i.user:XO,o=r.item&&r.item.cursor||null;return i&&s===i.user&&o==i.item?i:{user:s,item:o}}),e.add(null,function(n){let r=n.cursor,i=this.value;return hn(r)||(i=r.item,r=r.user),NL(e,r&&r!==XO?r:i||r),i},{cursor:t})}function NL(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function _A(e,t){var n=e._runtime.data;return tt(n,t)||ae("Unrecognized data set: "+t),n[t]}function Frt(e,t){return arguments.length<2?_A(this,e).values.value:wN.call(this,e,gg().remove(K1).insert(t))}function wN(e,t){Iie(t)||ae("Second argument to changes must be a changeset.");const n=_A(this,e);return n.modified=!0,this.pulse(n.input,t)}function Ort(e,t){return wN.call(this,e,gg().insert(t))}function Rrt(e,t){return wN.call(this,e,gg().remove(t))}function ype(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function bpe(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function $N(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function Mrt(e){var t=$N(e),n=ype(e),r=bpe(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach(i=>{try{i(n,r)}catch(s){e.error(s)}})}function Lrt(e,t,n){var r=e._renderer,i=r&&r.canvas(),s,o,a;return i&&(a=$N(e),o=t.changedTouches?t.changedTouches[0]:t,s=JD(o,i),s[0]-=a[0],s[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=Prt(e,n,s),t}function Prt(e,t,n){const r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(o){var a=r,u;if(o){for(u=t;u;u=u.mark.group)if(u.mark.name===o){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function s(o){if(!o)return n;hn(o)&&(o=i(o));const a=n.slice();for(;o;)a[0]-=o.x||0,a[1]-=o.y||0,o=o.mark&&o.mark.group;return a}return{view:_o(e),item:_o(t||{}),group:i,xy:s,x:o=>s(o)[0],y:o=>s(o)[1]}}const dK="view",Brt="timer",zrt="window",Urt={trap:!1};function jrt(e){const t=pt({defaults:{}},e),n=(r,i)=>{i.forEach(s=>{rt(r[s])&&(r[s]=ic(r[s]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function xpe(e,t,n,r){e._eventListeners.push({type:n,sources:Qe(t),handler:r})}function Wrt(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return r===!1||i===!0?!1:r===!0||i===!1?!0:r?r[t]:i?!i[t]:e.preventDefault()}function mS(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return r===!1||ht(r)&&!r[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function Vrt(e,t,n){var r=this,i=new WI(n),s=function(l,c){r.runAsync(null,()=>{e===dK&&Wrt(r,t)&&l.preventDefault(),i.receive(Lrt(r,l,c))})},o;if(e===Brt)mS(r,"timer",t)&&r.timer(s,t);else if(e===dK)mS(r,"view",t)&&r.addEventListener(t,s,Urt);else if(e===zrt?mS(r,"window",t)&&typeof window<"u"&&(o=[window]):typeof document<"u"&&mS(r,"selector",t)&&(o=document.querySelectorAll(e)),!o)r.warn("Can not resolve event source: "+e);else{for(var a=0,u=o.length;a<u;++a)o[a].addEventListener(t,s);xpe(r,o,t,s)}return i}function pK(e){return e.item}function gK(e){return e.item.mark.source}function mK(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function Grt(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",pK),gK,mK(e)),this.on(this.events("view","mouseout",pK),gK,mK(t)),this}function Hrt(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,s;for(r=t.length;--r>=0;)t[r].stop();for(r=n.length;--r>=0;)for(s=n[r],i=s.sources.length;--i>=0;)s.sources[i].removeEventListener(s.type,s.handler);return e&&e.call(this,this._handler,null,null,null),this}function Vs(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const qrt="vega-bind",Xrt="vega-bind-name",Yrt="vega-bind-radio";function Krt(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:o=>{o!=e.signal(r.signal)&&e.runAsync(null,()=>{i.source=!0,e.signal(r.signal,o)})}},r.debounce&&(i.update=Lre(r.debounce,i.update))),(r.input==null&&r.element?Zrt:Qrt)(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(e.signal(r.signal))}),i.active=!0),i}function Zrt(e,t,n,r){const i=n.event||"input",s=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,s),xpe(r,t,i,s),e.set=o=>{t.value=o,t.dispatchEvent(Jrt(i))}}function Jrt(e){return typeof Event<"u"?new Event(e):{type:e}}function Qrt(e,t,n,r){const i=r.signal(n.signal),s=Vs("div",{class:qrt}),o=n.input==="radio"?s:s.appendChild(Vs("label"));o.appendChild(Vs("span",{class:Xrt},n.name||n.signal)),t.appendChild(s);let a=eit;switch(n.input){case"checkbox":a=tit;break;case"select":a=nit;break;case"radio":a=rit;break;case"range":a=iit;break}a(e,o,n,i)}function eit(e,t,n,r){const i=Vs("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=s=>i.value=s}function tit(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=Vs("input",i);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=o=>s.checked=!!o||null}function nit(e,t,n,r){const i=Vs("select",{name:n.signal}),s=n.labels||[];n.options.forEach((o,a)=>{const u={value:o};TA(o,r)&&(u.selected=!0),i.appendChild(Vs("option",u,(s[a]||o)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=o=>{for(let a=0,u=n.options.length;a<u;++a)if(TA(n.options[a],o)){i.selectedIndex=a;return}}}function rit(e,t,n,r){const i=Vs("span",{class:Yrt}),s=n.labels||[];t.appendChild(i),e.elements=n.options.map((o,a)=>{const u={type:"radio",name:n.signal,value:o};TA(o,r)&&(u.checked=!0);const l=Vs("input",u);l.addEventListener("change",()=>e.update(o));const c=Vs("label",{},(s[a]||o)+"");return c.prepend(l),i.appendChild(c),l}),e.set=o=>{const a=e.elements,u=a.length;for(let l=0;l<u;++l)TA(a[l].value,o)&&(a[l].checked=!0)}}function iit(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,o=n.step||Wf(s,i,100),a=Vs("input",{type:"range",name:n.signal,min:s,max:i,step:o});a.value=r;const u=Vs("span",{},+r);t.appendChild(a),t.appendChild(u);const l=()=>{u.textContent=a.value,e.update(+a.value)};a.addEventListener("input",l),a.addEventListener("change",l),e.elements=[a],e.set=c=>{a.value=c,u.textContent=c}}function TA(e,t){return e===t||e+""==t+""}function vpe(e,t,n,r,i,s){return t=t||new r(e.loader()),t.initialize(n,ype(e),bpe(e),$N(e),i,s).background(e.background())}function hU(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function sit(e,t,n,r){const i=new r(e.loader(),hU(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,$N(e),e);return t&&t.handlers().forEach(s=>{i.on(s.type,s.handler)}),i}function oit(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,s=QD(r);e=n._el=e?YO(n,e,!0):null,Irt(n),s||n.error("Unrecognized renderer type: "+r);const o=s.handler||_$,a=e?s.renderer:s.headless;return n._renderer=a?vpe(n,n._renderer,e,a):null,n._handler=sit(n,n._handler,e,o),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=YO(n,t,!0):e.appendChild(Vs("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&i!=="container"&&(u.element=YO(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{Krt(n,u.element||t,u)})),n}function YO(e,t,n){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.innerHTML=""}catch(r){t=null,e.error(r)}return t}const wb=e=>+e||0,ait=e=>({top:e,bottom:e,left:e,right:e});function yK(e){return ht(e)?{top:wb(e.top),bottom:wb(e.bottom),left:wb(e.left),right:wb(e.right)}:ait(wb(e))}async function dU(e,t,n,r){const i=QD(t),s=i&&i.headless;return s||ae("Unrecognized renderer type: "+t),await e.runAsync(),vpe(e,null,null,s,n,r).renderAsync(e._scenegraph.root)}async function uit(e,t){e!==uf.Canvas&&e!==uf.SVG&&e!==uf.PNG&&ae("Unrecognized image type: "+e);const n=await dU(this,e,t);return e===uf.SVG?lit(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function lit(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function cit(e,t){return(await dU(this,uf.Canvas,e,t)).canvas()}async function fit(e){return(await dU(this,uf.SVG,e)).svg()}function hit(e,t,n){return ppe(e,t0,t2,n).parse(t)}function dit(e){var t=this._runtime.scales;return tt(t,e)||ae("Unrecognized scale or projection: "+e),t[e].value}var wpe="width",$pe="height",pU="padding",bK={skip:!0};function Cpe(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===pU?r.left+r.right:0)}function Spe(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===pU?r.top+r.bottom:0)}function pit(e){var t=e._signals,n=t[wpe],r=t[$pe],i=t[pU];function s(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,a=>{e._width=a.size,e._viewWidth=Cpe(e,a.size),s()},{size:n}),e._resizeHeight=e.add(null,a=>{e._height=a.size,e._viewHeight=Spe(e,a.size),s()},{size:r});const o=e.add(null,s,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}function git(e,t,n,r,i,s){this.runAfter(o=>{let a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal(wpe,n,bK),o._resizeWidth.skip(!0)),o.height()!==r&&(a=1,o.signal($pe,r,bK),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==i[0]||o._origin[1]!==i[1])&&(o._resize=1,o._origin=i),a&&o.run("enter"),s&&o.runAfter(u=>u.resize())},!1,1)}function mit(e){return this._runtime.getState(e||{data:yit,signals:bit,recurse:!0})}function yit(e,t){return t.modified&&rt(t.input.value)&&e.indexOf("_:vega:_")}function bit(e,t){return!(e==="parent"||t instanceof t0.proxy)}function xit(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function vit(e,t){function n(r){e({timestamp:Date.now(),elapsed:r})}this._timers.push(rGe(n,t))}function wit(e,t,n,r){const i=e.element();i&&i.setAttribute("title",$it(r))}function $it(e){return e==null?"":rt(e)?kpe(e):ht(e)&&!FI(e)?Cit(e):e+""}function Cit(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(rt(n)?kpe(n):Epe(n))}).join(`
`)}function kpe(e){return"["+e.map(Epe).join(", ")+"]"}function Epe(e){return rt(e)?"[…]":ht(e)&&!FI(e)?"{…}":e}function Ape(e,t){const n=this;if(t=t||{},Om.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=pt({},e.locale,t.locale);n.locale(Wfe(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||uf.Canvas,n._scenegraph=new Q7;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||wit,n._redraw=!0,n._handler=new _$().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=jrt(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=hit(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:pt({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=Cpe(n,n._width),n._viewHeight=Spe(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,pit(n),Drt(n),Nrt(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function yS(e,t){return tt(e._signals,t)?e._signals[t]:ae("Unrecognized signal name: "+He(t))}function _pe(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function xK(e,t,n,r){let i=_pe(n,r);return i||(i=hU(e,()=>r(t,n.value)),i.handler=r,e.on(n,null,i)),e}function vK(e,t,n){const r=_pe(t,n);return r&&t._targets.remove(r),e}ye(Ape,Om,{async evaluate(e,t,n){if(await Om.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,Mrt(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&XS(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&mpe(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=yS(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",yK(e)):yK(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(QD(e)||ae("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Om.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(yS(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:git,addEventListener(e,t,n){let r=t;return n&&n.trap===!1||(r=hU(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),r=n.length,i,s;--r>=0;)if(s=n[r].type,i=n[r].handler,e===s&&(t===i||t===i.raw)){this._handler.off(s,i);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return xK(this,e,yS(this,e),t)},removeSignalListener(e,t){return vK(this,yS(this,e),t)},addDataListener(e,t){return xK(this,e,_A(this,e).values,t)},removeDataListener(e,t){return vK(this,_A(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=NL(this,null);this._globalCursor=!!e,t&&NL(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:vit,events:Vrt,finalize:Hrt,hover:Grt,data:Frt,change:wN,insert:Ort,remove:Rrt,scale:dit,initialize:oit,toImageURL:uit,toCanvas:cit,toSVG:fit,getState:mit,setState:xit});const Sit="view",IA="[",DA="]",Tpe="{",Ipe="}",kit=":",Dpe=",",Eit="@",Ait=">",_it=/[[\]{}]/,Tit={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let Npe,Fpe;function Iit(e,t,n){return Npe=t||Sit,Fpe=n||Tit,Ope(e.trim()).map(FL)}function Dit(e){return Fpe[e]}function Ix(e,t,n,r,i){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function Ope(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Ix(e,i,Dpe,IA+Tpe,DA+Ipe),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function FL(e){return e[0]==="["?Nit(e):Fit(e)}function Nit(e){const t=e.length;let n=1,r;if(n=Ix(e,n,DA,IA,DA),n===t)throw"Empty between selector: "+e;if(r=Ope(e.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==Ait)throw"Expected '>' after between selector: "+e;r=r.map(FL);const i=FL(e.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function Fit(e){const t={source:Npe},n=[];let r=[0,0],i=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===Ipe){if(a=e.lastIndexOf(Tpe),a>=0){try{r=Oit(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===Eit&&(i=++a),u=Ix(e,a,kit),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=Ix(e,a,IA),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=Ix(e,a,DA),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==IA)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||_it.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],i?t.markname=n[0].slice(1):Dit(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),r[0]&&(t.throttle=r[0]),r[1]&&(t.debounce=r[1]),t}function Oit(e){const t=e.split(Dpe);if(!e.length||t.length>2)throw e;return t.map(n=>{const r=+n;if(r!==r)throw e;return r})}function Rit(e){return ht(e)?e:{type:e||"pad"}}const $b=e=>+e||0,Mit=e=>({top:e,bottom:e,left:e,right:e});function Lit(e){return ht(e)?e.signal?e:{top:$b(e.top),bottom:$b(e.bottom),left:$b(e.left),right:$b(e.right)}:Mit($b(e))}const wr=e=>ht(e)&&!rt(e)?pt({},e):{value:e};function wK(e,t,n,r){return n!=null?(ht(n)&&!rt(n)||rt(n)&&n.length&&ht(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function Gr(e,t,n){for(const r in t)wK(e,r,t[r]);for(const r in n)wK(e,r,n[r],"update")}function xy(e,t,n){for(const r in t)n&&tt(n,r)||(e[r]=pt(e[r]||{},t[r]));return e}function bm(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const gU="mark",mU="frame",yU="scope",Pit="axis",Bit="axis-domain",zit="axis-grid",Uit="axis-label",jit="axis-tick",Wit="axis-title",Vit="legend",Git="legend-band",Hit="legend-entry",qit="legend-gradient",Rpe="legend-label",Xit="legend-symbol",Yit="legend-title",Kit="title",Zit="title-text",Jit="title-subtitle";function Qit(e,t,n,r,i){const s={},o={};let a,u,l,c;u="lineBreak",t==="text"&&i[u]!=null&&!bm(u,e)&&KO(s,u,i[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===mU?i.group:n===gU?pt({},i.mark,i[t]):null;for(u in c)l=bm(u,e)||(u==="fill"||u==="stroke")&&(bm("fill",e)||bm("stroke",e)),l||KO(s,u,c[u]);Qe(r).forEach(f=>{const h=i.style&&i.style[f];for(const d in h)bm(d,e)||KO(s,d,h[d])}),e=pt({},e);for(u in s)c=s[u],c.signal?(a=a||{})[u]=c:o[u]=c;return e.enter=pt(o,e.enter),a&&(e.update=pt(a,e.update)),e}function KO(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const Mpe=e=>hn(e)?He(e):e.signal?`(${e.signal})`:Lpe(e);function CN(e){if(e.gradient!=null)return tst(e);let t=e.signal?`(${e.signal})`:e.color?est(e.color):e.field!=null?Lpe(e.field):e.value!==void 0?He(e.value):void 0;return e.scale!=null&&(t=nst(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${bk(e.exponent)})`),e.mult!=null&&(t+=`*${bk(e.mult)}`),e.offset!=null&&(t+=`+${bk(e.offset)}`),e.round&&(t=`round(${t})`),t}const bS=(e,t,n,r)=>`(${e}(${[t,n,r].map(CN).join(",")})+'')`;function est(e){return e.c?bS("hcl",e.h,e.c,e.l):e.h||e.s?bS("hsl",e.h,e.s,e.l):e.l||e.a?bS("lab",e.l,e.a,e.b):e.r||e.g||e.b?bS("rgb",e.r,e.g,e.b):null}function tst(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:He(n));for(;t.length&&qt(t)==null;)t.pop();return t.unshift(Mpe(e.gradient)),`gradient(${t.join(",")})`}function bk(e){return ht(e)?"("+CN(e)+")":e}function Lpe(e){return Ppe(ht(e)?e:{datum:e})}function Ppe(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):ae("Invalid field reference: "+He(e));return e.signal||(r=hn(r)?AI(r).map(He).join("]["):Ppe(r)),t+"["+r+"]"}function nst(e,t){const n=Mpe(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+bk(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function rst(e){let t="";return e.forEach(n=>{const r=CN(n);t+=n.test?`(${n.test})?${r}:`:r}),qt(t)===":"&&(t+="null"),t}function Bpe(e,t,n,r,i,s){const o={};s=s||{},s.encoders={$encode:o},e=Qit(e,t,n,r,i.config);for(const a in e)o[a]=ist(e[a],t,s,i);return s}function ist(e,t,n,r){const i={},s={};for(const o in e)e[o]!=null&&(i[o]=ost(sst(e[o]),r,n,s));return{$expr:{marktype:t,channels:i},$fields:Object.keys(s),$output:Object.keys(e)}}function sst(e){return rt(e)?rst(e):CN(e)}function ost(e,t,n,r){const i=Ou(e,t);return i.$fields.forEach(s=>r[s]=1),pt(n,i.$params),i.$expr}const ast="outer",ust=["value","update","init","react","bind"];function $K(e,t){ae(e+' for "outer" push: '+He(t))}function zpe(e,t){const n=e.name;if(e.push===ast)t.signals[n]||$K("No prior signal definition",n),ust.forEach(r=>{e[r]!==void 0&&$K("Invalid property ",r)});else{const r=t.addSignal(n,e.value);e.react===!1&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function OL(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function SN(e,t,n,r){return new OL(e,t,n,r)}function NA(e,t){return SN("operator",e,t)}function Me(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function r2(e,t){return t?{$field:e,$name:t}:{$field:e}}const RL=r2("key");function CK(e,t){return{$compare:e,$order:t}}function lst(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const cst="ascending",fst="descending";function hst(e){return ht(e)?(e.order===fst?"-":"+")+kN(e.op,e.field):""}function kN(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const bU="scope",ML="view";function rr(e){return e&&e.signal}function dst(e){return e&&e.expr}function xk(e){if(rr(e))return!0;if(ht(e)){for(const t in e)if(xk(e[t]))return!0}return!1}function ea(e,t){return e??t}function ip(e){return e&&e.signal||e}const SK="timer";function i2(e,t){return(e.merge?gst:e.stream?mst:e.type?yst:ae("Invalid stream specification: "+He(e)))(e,t)}function pst(e){return e===bU?ML:e||ML}function gst(e,t){const n=e.merge.map(i=>i2(i,t)),r=xU({merge:n},e,t);return t.addStream(r).id}function mst(e,t){const n=i2(e.stream,t),r=xU({stream:n},e,t);return t.addStream(r).id}function yst(e,t){let n;e.type===SK?(n=t.event(SK,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(pst(e.source),e.type);const r=xU({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function xU(e,t,n){let r=t.between;return r&&(r.length!==2&&ae('Stream "between" parameter must have 2 entries: '+He(t)),e.between=[i2(r[0],n),i2(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(bst(t.marktype,t.markname,t.markrole)),t.source===bU&&r.push("inScope(event.item)"),r.length&&(e.filter=Ou("("+r.join(")&&(")+")",n).$expr),(r=t.throttle)!=null&&(e.throttle=+r),(r=t.debounce)!=null&&(e.debounce=+r),t.consume&&(e.consume=!0),e}function bst(e,t,n){const r="event.item";return r+(e&&e!=="*"?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}const xst={code:"_.$value",ast:{type:"Identifier",value:"value"}};function vst(e,t,n){const r=e.encode,i={target:n};let s=e.events,o=e.update,a=[];s||ae("Signal update missing events specification."),hn(s)&&(s=Iit(s,t.isSubscope()?bU:ML)),s=Qe(s).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[$st(a)]),s.length&&a.push(s.length>1?{merge:s}:s[0]),r!=null&&(o&&ae("Signal encode and update are mutually exclusive."),o="encode(item(),"+He(r)+")"),i.update=hn(o)?Ou(o,t):o.expr!=null?Ou(o.expr,t):o.value!=null?o.value:o.signal!=null?{$expr:xst,$params:{$value:t.signalRef(o.signal)}}:ae("Invalid signal update specification."),e.force&&(i.options={force:!0}),a.forEach(u=>t.addUpdate(pt(wst(u,t),i)))}function wst(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):i2(e,t)}}function $st(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function Cst(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?ae("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=Ou(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach(i=>vst(i,t,n.id))}const Xt=e=>(t,n,r)=>SN(e,n,t||void 0,r),Upe=Xt("aggregate"),Sst=Xt("axisticks"),jpe=Xt("bound"),Ma=Xt("collect"),kK=Xt("compare"),kst=Xt("datajoin"),Wpe=Xt("encode"),Est=Xt("expression"),Ast=Xt("facet"),_st=Xt("field"),Tst=Xt("key"),Ist=Xt("legendentries"),Dst=Xt("load"),Nst=Xt("mark"),Fst=Xt("multiextent"),Ost=Xt("multivalues"),Rst=Xt("overlap"),Mst=Xt("params"),Vpe=Xt("prefacet"),Lst=Xt("projection"),Pst=Xt("proxy"),Bst=Xt("relay"),Gpe=Xt("render"),zst=Xt("scale"),Dg=Xt("sieve"),Ust=Xt("sortitems"),Hpe=Xt("viewlayout"),jst=Xt("values");let Wst=0;const qpe={min:"min",max:"max",count:"sum"};function Vst(e,t){const n=e.type||"linear";Tle(n)||ae("Unrecognized scale type: "+He(n)),t.addScale(e.name,{type:n,domain:void 0})}function Gst(e,t){const n=t.getScale(e.name).params;let r;n.domain=Xpe(e.domain,e,t),e.range!=null&&(n.range=Kpe(e,t,n)),e.interpolate!=null&&tot(e.interpolate,n),e.nice!=null&&(n.nice=eot(e.nice)),e.bins!=null&&(n.bins=Qst(e.bins,t));for(r in e)tt(n,r)||r==="name"||(n[r]=bo(e[r],t))}function bo(e,t){return ht(e)?e.signal?t.signalRef(e.signal):ae("Unsupported object: "+He(e)):e}function vk(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>bo(n,t))}function EN(e){ae("Can not find data set: "+He(e))}function Xpe(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&ae("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(rt(e)?Hst:e.fields?Xst:qst)(e,t,n)}function Hst(e,t,n){return e.map(r=>bo(r,n))}function qst(e,t,n){const r=n.getData(e.data);return r||EN(e.data),y0(t.type)?r.valuesRef(n,e.field,Ype(e.sort,!1)):Nle(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function Xst(e,t,n){const r=e.data,i=e.fields.reduce((s,o)=>(o=hn(o)?{data:r,field:o}:rt(o)||o.signal?Yst(o,n):o,s.push(o),s),[]);return(y0(t.type)?Kst:Nle(t.type)?Zst:Jst)(e,n,i)}function Yst(e,t){const n="_:vega:_"+Wst++,r=Ma({});if(rt(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+He(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,Dg({})]),{data:n,field:"data"}}function Kst(e,t,n){const r=Ype(e.sort,!0);let i,s;const o=n.map(l=>{const c=t.getData(l.data);return c||EN(l.data),c.countsRef(t,l.field,r)}),a={groupby:RL,pulse:o};r&&(i=r.op||"count",s=r.field?kN(i,r.field):"count",a.ops=[qpe[i]],a.fields=[t.fieldRef(s)],a.as=[s]),i=t.add(Upe(a));const u=t.add(Ma({pulse:Me(i)}));return s=t.add(jst({field:RL,sort:t.sortRef(r),pulse:Me(u)})),Me(s)}function Ype(e,t){return e&&(!e.field&&!e.op?ht(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?ae("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!qpe[e.op]&&ae("Multiple domain scales can not be sorted using "+e.op)),e}function Zst(e,t,n){const r=n.map(i=>{const s=t.getData(i.data);return s||EN(i.data),s.domainRef(t,i.field)});return Me(t.add(Ost({values:r})))}function Jst(e,t,n){const r=n.map(i=>{const s=t.getData(i.data);return s||EN(i.data),s.extentRef(t,i.field)});return Me(t.add(Fst({extents:r})))}function Qst(e,t){return e.signal||rt(e)?vk(e,t):t.objectProperty(e)}function eot(e){return ht(e)?{interval:bo(e.interval),step:bo(e.step)}:bo(e)}function tot(e,t){t.interpolate=bo(e.type||e),e.gamma!=null&&(t.interpolateGamma=bo(e.gamma))}function Kpe(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(hn(i)){if(r&&tt(r,i))return e=pt({},e,{range:r[i]}),Kpe(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=y0(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:ae("Unrecognized scale range value: "+He(i))}else if(i.scheme){n.scheme=rt(i.scheme)?vk(i.scheme,t):bo(i.scheme,t),i.extent&&(n.schemeExtent=vk(i.extent,t)),i.count&&(n.schemeCount=bo(i.count,t));return}else if(i.step){n.rangeStep=bo(i.step,t);return}else{if(y0(e.type)&&!rt(i))return Xpe(i,e,t);rt(i)||ae("Unsupported range type: "+He(i))}return i.map(s=>(rt(s)?vk:bo)(s,t))}function not(e,t){const n=t.config.projection||{},r={};for(const i in e)i!=="name"&&(r[i]=LL(e[i],i,t));for(const i in n)r[i]==null&&(r[i]=LL(n[i],i,t));t.addProjection(e.name,r)}function LL(e,t,n){return rt(e)?e.map(r=>LL(r,t,n)):ht(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:ae("Unsupported parameter object: "+He(e)):e}const La="top",vy="left",wy="right",ah="bottom",Zpe="center",rot="vertical",iot="start",sot="middle",oot="end",PL="index",vU="label",aot="offset",D0="perc",uot="perc2",So="value",L$="guide-label",wU="guide-title",lot="group-title",cot="group-subtitle",EK="symbol",wk="gradient",BL="discrete",zL="size",fot="shape",hot="fill",dot="stroke",pot="strokeWidth",got="strokeDash",mot="opacity",$U=[zL,fot,hot,dot,pot,got,mot],P$={name:1,style:1,interactive:1},vt={value:0},ko={value:1},AN="group",Jpe="rect",CU="rule",yot="symbol",Ng="text";function s2(e){return e.type=AN,e.interactive=e.interactive||!1,e}function Fs(e,t){const n=(r,i)=>ea(e[r],ea(t[r],i));return n.isVertical=r=>rot===ea(e.direction,t.direction||(r?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>ea(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>ea(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>ea(e.columns,ea(t.columns,+n.isVertical(!0))),n}function Qpe(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function bot(e,t,n){const r=t.config.style[n];return r&&r[e]}function _N(e,t,n){return`item.anchor === '${iot}' ? ${e} : item.anchor === '${oot}' ? ${t} : ${n}`}const SU=_N(He(vy),He(wy),He(Zpe));function xot(e){const t=e("tickBand");let n=e("tickOffset"),r,i;return t?t.signal?(r={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${t.signal}) === 'extent'`},ht(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(r=1,i=!0,n=0):(r=.5,i=!1):(r=e("bandPosition"),i=e("tickExtra")),{extra:i,band:r,offset:n}}function ege(e,t){return t?e?ht(e)?Object.assign({},e,{offset:ege(e.offset,t)}):{value:e,offset:t}:t:e}function Zs(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=xy(e.encode,t,P$)):e.interactive=!1,e}function vot(e,t,n,r){const i=Fs(e,n),s=i.isVertical(),o=i.gradientThickness(),a=i.gradientLength();let u,l,c,f,h;s?(l=[0,1],c=[0,0],f=o,h=a):(l=[0,0],c=[1,0],f=a,h=o);const d={enter:u={opacity:vt,x:vt,y:vt,width:wr(f),height:wr(h)},update:pt({},u,{opacity:ko,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:vt}};return Gr(d,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),Zs({type:Jpe,role:qit,encode:d},r)}function wot(e,t,n,r,i){const s=Fs(e,n),o=s.isVertical(),a=s.gradientThickness(),u=s.gradientLength();let l,c,f,h,d="";o?(l="y",f="y2",c="x",h="width",d="1-"):(l="x",f="x2",c="y",h="height");const p={opacity:vt,fill:{scale:t,field:So}};p[l]={signal:d+"datum."+D0,mult:u},p[c]=vt,p[f]={signal:d+"datum."+uot,mult:u},p[h]=wr(a);const g={enter:p,update:pt({},p,{opacity:ko}),exit:{opacity:vt}};return Gr(g,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),Zs({type:Jpe,role:Git,key:So,from:i,encode:g},r)}const $ot=`datum.${D0}<=0?"${vy}":datum.${D0}>=1?"${wy}":"${Zpe}"`,Cot=`datum.${D0}<=0?"${ah}":datum.${D0}>=1?"${La}":"${sot}"`;function AK(e,t,n,r){const i=Fs(e,t),s=i.isVertical(),o=wr(i.gradientThickness()),a=i.gradientLength();let u=i("labelOverlap"),l,c,f,h,d="";const p={enter:l={opacity:vt},update:c={opacity:ko,text:{field:vU}},exit:{opacity:vt}};return Gr(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:ea(e.labelLimit,t.gradientLabelLimit)}),s?(l.align={value:"left"},l.baseline=c.baseline={signal:Cot},f="y",h="x",d="1-"):(l.align=c.align={signal:$ot},l.baseline={value:"top"},f="x",h="y"),l[f]=c[f]={signal:d+"datum."+D0,mult:a},l[h]=c[h]=o,o.offset=ea(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:i("labelSeparation"),method:u,order:"datum."+PL}:void 0,Zs({type:Ng,role:Rpe,style:L$,key:So,from:r,encode:p,overlap:u},n)}function Sot(e,t,n,r,i){const s=Fs(e,t),o=n.entries,a=!!(o&&o.interactive),u=o?o.name:void 0,l=s("clipHeight"),c=s("symbolOffset"),f={data:"value"},h=`(${i}) ? datum.${aot} : datum.${zL}`,d=l?wr(l):{field:zL},p=`datum.${PL}`,g=`max(1, ${i})`;let m,y,b,v,x;d.mult=.5,m={enter:y={opacity:vt,x:{signal:h,mult:.5,offset:c},y:d},update:b={opacity:ko,x:y.x,y:y.y},exit:{opacity:vt}};let w=null,C=null;e.fill||(w=t.symbolBaseFillColor,C=t.symbolBaseStrokeColor),Gr(m,{fill:s("symbolFillColor",w),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",C),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),$U.forEach(E=>{e[E]&&(b[E]=y[E]={scale:e[E],field:So})});const $=Zs({type:yot,role:Xit,key:So,from:f,clip:l?!0:void 0,encode:m},n.symbols),S=wr(c);S.offset=s("labelOffset"),m={enter:y={opacity:vt,x:{signal:h,offset:S},y:d},update:b={opacity:ko,text:{field:vU},x:y.x,y:y.y},exit:{opacity:vt}},Gr(m,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const k=Zs({type:Ng,role:Rpe,style:L$,key:So,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:vt,height:l?wr(l):vt,opacity:vt},exit:{opacity:vt},update:b={opacity:ko,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(v=`ceil(item.mark.items.length / ${g})`,b.row.signal=`${p}%${v}`,b.column.signal=`floor(${p} / ${v})`,x={field:["row",p]}):(b.row.signal=`floor(${p} / ${g})`,b.column.signal=`${p} % ${g}`,x={field:p}),b.column.signal=`(${i})?${b.column.signal}:${p}`,r={facet:{data:r,name:"value",groupby:PL}},s2({role:yU,from:r,encode:xy(m,o,P$),marks:[$,k],name:u,interactive:a,sort:x})}function kot(e,t){const n=Fs(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const kU='item.orient === "left"',EU='item.orient === "right"',TN=`(${kU} || ${EU})`,Eot=`datum.vgrad && ${TN}`,Aot=_N('"top"','"bottom"','"middle"'),_ot=_N('"right"','"left"','"center"'),Tot=`datum.vgrad && ${EU} ? (${_ot}) : (${TN} && !(datum.vgrad && ${kU})) ? "left" : ${SU}`,Iot=`item._anchor || (${TN} ? "middle" : "start")`,Dot=`${Eot} ? (${kU} ? -90 : 90) : 0`,Not=`${TN} ? (datum.vgrad ? (${EU} ? "bottom" : "top") : ${Aot}) : "top"`;function Fot(e,t,n,r){const i=Fs(e,t),s={enter:{opacity:vt},update:{opacity:ko,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:vt}};return Gr(s,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:Iot},angle:{signal:Dot},align:{signal:Tot},baseline:{signal:Not},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),Zs({type:Ng,role:Yit,style:wU,from:r,encode:s},n)}function Oot(e,t){let n;return ht(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+_K(e.path)+")":e.sphere&&(n="geoShape("+_K(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function _K(e){return ht(e)&&e.signal?e.signal:He(e)}function tge(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===AN?yU:t||gU}function Rot(e){return{marktype:e.type,name:e.name||void 0,role:e.role||tge(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function Mot(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function AU(e,t){const n=Fie(e.type);n||ae("Unrecognized transform type: "+He(e.type));const r=SN(n.type.toLowerCase(),null,nge(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function nge(e,t,n){const r={},i=e.params.length;for(let s=0;s<i;++s){const o=e.params[s];r[o.name]=Lot(o,t,n)}return r}function Lot(e,t,n){const r=e.type,i=t[e.name];if(r==="index")return Pot(e,t,n);if(i===void 0){e.required&&ae("Missing required "+He(t.type)+" parameter: "+He(e.name));return}else{if(r==="param")return Bot(e,t,n);if(r==="projection")return n.projectionRef(t[e.name])}return e.array&&!rr(i)?i.map(s=>TK(e,s,n)):TK(e,i,n)}function TK(e,t,n){const r=e.type;if(rr(t))return DK(r)?ae("Expression references can not be signals."):ZO(r)?n.fieldRef(t):NK(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||ZO(r);return i&&zot(t)?n.exprRef(t.expr,t.as):i&&Uot(t)?r2(t.field,t.as):DK(r)?Ou(t,n):jot(r)?Me(n.getData(t).values):ZO(r)?r2(t):NK(r)?n.compareRef(t):t}}function Pot(e,t,n){return hn(t.from)||ae('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function Bot(e,t,n){const r=t[e.name];return e.array?(rt(r)||ae("Expected an array of sub-parameters. Instead: "+He(r)),r.map(i=>IK(e,i,n))):IK(e,r,n)}function IK(e,t,n){const r=e.params.length;let i;for(let o=0;o<r;++o){i=e.params[o];for(const a in i.key)if(i.key[a]!==t[a]){i=null;break}if(i)break}i||ae("Unsupported parameter: "+He(t));const s=pt(nge(i,t,n),i.key);return Me(n.add(Mst(s)))}const zot=e=>e&&e.expr,Uot=e=>e&&e.field,jot=e=>e==="data",DK=e=>e==="expr",ZO=e=>e==="field",NK=e=>e==="compare";function Wot(e,t,n){let r,i,s,o,a;return e?(r=e.facet)&&(t||ae("Only group marks can be faceted."),r.field!=null?o=a=$k(r,n):(e.data?a=Me(n.getData(e.data).aggregate):(s=AU(pt({type:"aggregate",groupby:Qe(r.groupby)},r.aggregate),n),s.params.key=n.keyRef(r.groupby),s.params.pulse=$k(r,n),o=a=Me(n.add(s))),i=n.keyRef(r.groupby,!0))):o=Me(n.add(Ma(null,[{}]))),o||(o=$k(e,n)),{key:i,pulse:o,parent:a}}function $k(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Me(t.getData(e.data).output)}function Bp(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}Bp.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let s=t[0],o=null,a=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);a<n;++a)t[a].params.pulse=Me(t[a-1]),e.add(t[a]),t[a].type==="aggregate"&&(o=t[a]);return new Bp(e,s,i,r,o)};function rge(e){return hn(e)?e:null}function FK(e,t,n){const r=kN(n.op,n.field);let i;if(t.ops){for(let s=0,o=t.as.length;s<o;++s)if(t.as[s]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function Cb(e,t,n,r,i,s,o){const a=t[n]||(t[n]={}),u=hst(s);let l=rge(i),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=a[l]),!c){const h=s?{field:RL,pulse:t.countsRef(e,i,s)}:{field:e.fieldRef(i),pulse:Me(t.output)};u&&(h.sort=e.sortRef(s)),f=e.add(SN(r,void 0,h)),o&&(t.index[i]=f),c=Me(f),l!=null&&(a[l]=c)}return c}Bp.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),s=rge(t);let o,a,u;return s!=null&&(e=r.scope,o=i[s]),o?n&&n.field&&FK(e,o.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:Me(r.output)},n&&n.field&&FK(e,u,n),a=e.add(Upe(u)),o=e.add(Ma({pulse:Me(a)})),o={agg:a,ref:Me(o)},s!=null&&(i[s]=o)),o.ref},tuplesRef(){return Me(this.values)},extentRef(e,t){return Cb(e,this,"extent","extent",t,!1)},domainRef(e,t){return Cb(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Cb(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Cb(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Cb(e,this,"indata","tupleindex",t,!0,!0)}};function Vot(e,t,n){const r=e.from.facet,i=r.name,s=$k(r,t);let o;r.name||ae("Facet must have a name: "+He(r)),r.data||ae("Facet must reference a data set: "+He(r)),r.field?o=t.add(Vpe({field:t.fieldRef(r.field),pulse:s})):r.groupby?o=t.add(Ast({key:t.keyRef(r.groupby),group:Me(t.proxy(n.parent)),pulse:s})):ae("Facet must specify groupby or field: "+He(r));const a=t.fork(),u=a.add(Ma()),l=a.add(Dg({pulse:Me(u)}));a.addData(i,new Bp(a,u,u,l)),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(e).toRuntime()}}function Got(e,t,n){const r=t.add(Vpe({pulse:n.pulse})),i=t.fork();i.add(Dg()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}function ige(e,t,n){const r=e.remove,i=e.insert,s=e.toggle,o=e.modify,a=e.values,u=t.add(NA()),l="if("+e.trigger+',modify("'+n+'",'+[i,r,s,o,a].map(f=>f??"null").join(",")+"),0)",c=Ou(l,t);u.update=c.$expr,u.params=c.$params}function IN(e,t){const n=tge(e),r=e.type===AN,i=e.from&&e.from.facet,s=e.overlap;let o=e.layout||n===yU||n===mU,a,u,l,c,f,h,d;const p=n===gU||o||i,g=Wot(e.from,r,t);u=t.add(kst({key:g.key||(e.key?r2(e.key):void 0),pulse:g.pulse,clean:!r}));const m=Me(u);u=l=t.add(Ma({pulse:m})),u=t.add(Nst({markdef:Rot(e),interactive:Mot(e.interactive,t),clip:Oot(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Me(u)}));const y=Me(u);u=c=t.add(Wpe(Bpe(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(C=>{const $=AU(C,t),S=$.metadata;(S.generates||S.changes)&&ae("Mark transforms should not generate new data."),S.nomod||(c.params.mod=!0),$.params.pulse=Me(u),t.add(u=$)}),e.sort&&(u=t.add(Ust({sort:t.compareRef(e.sort),pulse:Me(u)})));const b=Me(u);(i||o)&&(o=t.add(Hpe({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),h=Me(o));const v=t.add(jpe({mark:y,pulse:h||b}));d=Me(v),r&&(p&&(a=t.operators,a.pop(),o&&a.pop()),t.pushState(b,h||d,m),i?Vot(e,t,g):p?Got(e,t,g):t.parse(e),t.popState(),p&&(o&&a.push(o),a.push(v))),s&&(d=Hot(s,d,t));const x=t.add(Gpe({pulse:d})),w=t.add(Dg({pulse:Me(x)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new Bp(t,l,x,w)),e.on&&e.on.forEach(C=>{(C.insert||C.remove||C.toggle)&&ae("Marks only support modify triggers."),ige(C,t,f)}))}function Hot(e,t,n){const r=e.method,i=e.bound,s=e.separation,o={separation:rr(s)?n.signalRef(s.signal):s,method:rr(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){const a=i.tolerance;o.boundTolerance=rr(a)?n.signalRef(a.signal):+a,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return Me(n.add(Rst(o)))}function qot(e,t){const n=t.config.legend,r=e.encode||{},i=Fs(e,n),s=r.legend||{},o=s.name||void 0,a=s.interactive,u=s.style,l={};let c=0,f,h,d;$U.forEach(v=>e[v]?(l[v]=e[v],c=c||e[v]):0),c||ae("Missing valid scale for legend.");const p=Xot(e,t.scaleType(c)),g={title:e.title!=null,scales:l,type:p,vgrad:p!=="symbol"&&i.isVertical()},m=Me(t.add(Ma(null,[g]))),y={enter:{x:{value:0},y:{value:0}}},b=Me(t.add(Ist(h={type:p,scale:t.scaleRef(c),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===wk?(d=[vot(e,c,n,r.gradient),AK(e,n,r.labels,b)],h.count=h.count||t.signalRef(`max(2,2*floor((${ip(i.gradientLength())})/100))`)):p===BL?d=[wot(e,c,n,r.gradient,b),AK(e,n,r.labels,b)]:(f=kot(e,n),d=[Sot(e,n,r,b,ip(f.columns))],h.size=Zot(e,t,d[0].marks)),d=[s2({role:Hit,from:m,encode:y,marks:d,layout:f,interactive:a})],g.title&&d.push(Fot(e,n,r.title,m)),IN(s2({role:Vit,from:m,encode:xy(Kot(i,e,n),s,P$),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:a,style:u}),t)}function Xot(e,t){let n=e.type||EK;return!e.type&&Yot(e)===1&&(e.fill||e.stroke)&&(n=P8(t)?wk:g4(t)?BL:EK),n!==wk?n:g4(t)?BL:wk}function Yot(e){return $U.reduce((t,n)=>t+(e[n]?1:0),0)}function Kot(e,t,n){const r={enter:{},update:{}};return Gr(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function Zot(e,t,n){const r=ip(OK("size",e,n)),i=ip(OK("strokeWidth",e,n)),s=ip(Jot(n[1].encode,t,L$));return Ou(`max(ceil(sqrt(${r})+${i}),${s})`,t)}function OK(e,t,n){return t[e]?`scale("${t[e]}",datum)`:Qpe(e,n[0].encode)}function Jot(e,t,n){return Qpe("fontSize",e)||bot("fontSize",t,n)}const Qot=`item.orient==="${vy}"?-90:item.orient==="${wy}"?90:0`;function eat(e,t){e=hn(e)?{text:e}:e;const n=Fs(e,t.config.title),r=e.encode||{},i=r.group||{},s=i.name||void 0,o=i.interactive,a=i.style,u=[],l={},c=Me(t.add(Ma(null,[l])));return u.push(rat(e,n,tat(e),c)),e.subtitle&&u.push(iat(e,n,r.subtitle,c)),IN(s2({role:Kit,from:c,encode:nat(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:o,style:a}),t)}function tat(e){const t=e.encode;return t&&t.title||pt({name:e.name,interactive:e.interactive,style:e.style},t)}function nat(e,t){const n={enter:{},update:{}};return Gr(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:SU},angle:{signal:Qot},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),xy(n,t,P$)}function rat(e,t,n,r){const i={value:0},s=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Gr(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Zs({type:Ng,role:Zit,style:lot,from:r,encode:o},n)}function iat(e,t,n,r){const i={value:0},s=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Gr(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Zs({type:Ng,role:Jit,style:cot,from:r,encode:o},n)}function sat(e,t){const n=[];e.transform&&e.transform.forEach(r=>{n.push(AU(r,t))}),e.on&&e.on.forEach(r=>{ige(r,t,e.name)}),t.addDataPipeline(e.name,oat(e,t,n))}function oat(e,t,n){const r=[];let i=null,s=!1,o=!1,a,u,l,c,f;for(e.values?rr(e.values)||xk(e.format)?(r.push(RK(t,e)),r.push(i=nd())):r.push(i=nd({$ingest:e.values,$format:e.format})):e.url?xk(e.url)||xk(e.format)?(r.push(RK(t,e)),r.push(i=nd())):r.push(i=nd({$request:e.url,$format:e.format})):e.source&&(i=a=Qe(e.source).map(h=>Me(t.getData(h).output)),r.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!i&&!f.source&&r.push(i=nd()),r.push(c),f.generates&&(o=!0),f.modifies&&!o&&(s=!0),f.source?i=c:f.changes&&(i=null);return a&&(l=a.length-1,r[0]=Bst({derive:s,pulse:l?a:a[0]}),(s||l)&&r.splice(1,0,nd())),i||r.push(nd()),r.push(Dg({})),r}function nd(e){const t=Ma({},e);return t.metadata={source:!0},t}function RK(e,t){return Dst({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const sge=e=>e===ah||e===La,DN=(e,t,n)=>rr(e)?cat(e.signal,t,n):e===vy||e===La?t:n,$r=(e,t,n)=>rr(e)?uat(e.signal,t,n):sge(e)?t:n,ya=(e,t,n)=>rr(e)?lat(e.signal,t,n):sge(e)?n:t,oge=(e,t,n)=>rr(e)?fat(e.signal,t,n):e===La?{value:t}:{value:n},aat=(e,t,n)=>rr(e)?hat(e.signal,t,n):e===wy?{value:t}:{value:n},uat=(e,t,n)=>age(`${e} === '${La}' || ${e} === '${ah}'`,t,n),lat=(e,t,n)=>age(`${e} !== '${La}' && ${e} !== '${ah}'`,t,n),cat=(e,t,n)=>_U(`${e} === '${vy}' || ${e} === '${La}'`,t,n),fat=(e,t,n)=>_U(`${e} === '${La}'`,t,n),hat=(e,t,n)=>_U(`${e} === '${wy}'`,t,n),age=(e,t,n)=>(t=t!=null?wr(t):t,n=n!=null?wr(n):n,MK(t)&&MK(n)?(t=t?t.signal||He(t.value):null,n=n?n.signal||He(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[pt({test:e},t)].concat(n||[])),MK=e=>e==null||Object.keys(e).length===1,_U=(e,t,n)=>({signal:`${e} ? (${Am(t)}) : (${Am(n)})`}),dat=(e,t,n,r,i)=>({signal:(r!=null?`${e} === '${vy}' ? (${Am(r)}) : `:"")+(n!=null?`${e} === '${ah}' ? (${Am(n)}) : `:"")+(i!=null?`${e} === '${wy}' ? (${Am(i)}) : `:"")+(t!=null?`${e} === '${La}' ? (${Am(t)}) : `:"")+"(null)"}),Am=e=>rr(e)?e.signal:e==null?null:He(e),pat=(e,t)=>t===0?0:rr(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Bm=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function lm(e,t,n,r){let i;if(t&&tt(t,e))return t[e];if(tt(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[wU][i]}else if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[L$][i]}return null}function LK(e){const t={};for(const n of e)if(n)for(const r in n)t[r]=1;return Object.keys(t)}function gat(e,t){var n=t.config,r=n.style,i=n.axis,s=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,a,u,l;if(rr(o)){const f=LK([n.axisX,n.axisY]),h=LK([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(l of f)a[l]=$r(o,lm(l,n.axisX,i,r),lm(l,n.axisY,i,r));u={};for(l of h)u[l]=dat(o.signal,lm(l,n.axisTop,i,r),lm(l,n.axisBottom,i,r),lm(l,n.axisLeft,i,r),lm(l,n.axisRight,i,r))}else a=o===La||o===ah?n.axisX:n.axisY,u=n["axis"+o[0].toUpperCase()+o.slice(1)];return a||u||s?pt({},i,a,u,s):i}function mat(e,t,n,r){const i=Fs(e,t),s=e.orient;let o,a;const u={enter:o={opacity:vt},update:a={opacity:ko},exit:{opacity:vt}};Gr(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const l=PK(e,0),c=PK(e,1);return o.x=a.x=$r(s,l,vt),o.x2=a.x2=$r(s,c),o.y=a.y=ya(s,l,vt),o.y2=a.y2=ya(s,c),Zs({type:CU,role:Bit,from:r,encode:u},n)}function PK(e,t){return{scale:e.scale,range:t}}function yat(e,t,n,r,i){const s=Fs(e,t),o=e.orient,a=e.gridScale,u=DN(o,1,-1),l=bat(e.offset,u);let c,f,h;const d={enter:c={opacity:vt},update:h={opacity:ko},exit:f={opacity:vt}};Gr(d,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:e.scale,field:So,band:i.band,extra:i.extra,offset:i.offset,round:s("tickRound")},g=$r(o,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:l}:{value:0,offset:l},y=a?{scale:a,range:1,mult:u,offset:l}:pt(g,{mult:u,offset:l});return c.x=h.x=$r(o,p,m),c.y=h.y=ya(o,p,m),c.x2=h.x2=ya(o,y),c.y2=h.y2=$r(o,y),f.x=$r(o,p),f.y=ya(o,p),Zs({type:CU,role:zit,key:So,from:r,encode:d},n)}function bat(e,t){if(t!==1)if(!ht(e))e=rr(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=pt({},e);for(;n.mult!=null;)if(ht(n.mult))n=n.mult=pt({},n.mult);else return n.mult=rr(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function xat(e,t,n,r,i,s){const o=Fs(e,t),a=e.orient,u=DN(a,-1,1);let l,c,f;const h={enter:l={opacity:vt},update:f={opacity:ko},exit:c={opacity:vt}};Gr(h,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const d=wr(i);d.mult=u;const p={scale:e.scale,field:So,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")};return f.y=l.y=$r(a,vt,p),f.y2=l.y2=$r(a,d),c.x=$r(a,p),f.x=l.x=ya(a,vt,p),f.x2=l.x2=ya(a,d),c.y=ya(a,p),Zs({type:CU,role:jit,key:So,from:r,encode:h},n)}function JO(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function vat(e,t,n,r,i,s){const o=Fs(e,t),a=e.orient,u=e.scale,l=DN(a,-1,1),c=ip(o("labelFlush")),f=ip(o("labelFlushOffset")),h=o("labelAlign"),d=o("labelBaseline");let p=c===0||!!c,g;const m=wr(i);m.mult=l,m.offset=wr(o("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:So,band:.5,offset:ege(s.offset,o("labelOffset"))},b=$r(a,p?JO(u,c,'"left"','"right"','"center"'):{value:"center"},aat(a,"left","right")),v=$r(a,oge(a,"bottom","top"),p?JO(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=JO(u,c,`-(${f})`,f,0);p=p&&f;const w={opacity:vt,x:$r(a,y,m),y:ya(a,y,m)},C={enter:w,update:g={opacity:ko,text:{field:vU},x:w.x,y:w.y,align:b,baseline:v},exit:{opacity:vt,x:w.x,y:w.y}};Gr(C,{dx:!h&&p?$r(a,x):null,dy:!d&&p?ya(a,x):null}),Gr(C,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:d});const $=o("labelBound");let S=o("labelOverlap");return S=S||$?{separation:o("labelSeparation"),method:S,order:"datum.index",bound:$?{scale:u,orient:a,tolerance:$}:null}:void 0,g.align!==b&&(g.align=Bm(g.align,b)),g.baseline!==v&&(g.baseline=Bm(g.baseline,v)),Zs({type:Ng,role:Uit,style:L$,key:So,from:r,encode:C,overlap:S},n)}function wat(e,t,n,r){const i=Fs(e,t),s=e.orient,o=DN(s,-1,1);let a,u;const l={enter:a={opacity:vt,anchor:wr(i("titleAnchor",null)),align:{signal:SU}},update:u=pt({},a,{opacity:ko,text:wr(e.title)}),exit:{opacity:vt}},c={signal:`lerp(range("${e.scale}"), ${_N(0,1,.5)})`};return u.x=$r(s,c),u.y=ya(s,c),a.angle=$r(s,vt,pat(o,90)),a.baseline=$r(s,oge(s,ah,La),{value:ah}),u.angle=a.angle,u.baseline=a.baseline,Gr(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),$at(i,s,l,n),l.update.align=Bm(l.update.align,a.align),l.update.angle=Bm(l.update.angle,a.angle),l.update.baseline=Bm(l.update.baseline,a.baseline),Zs({type:Ng,role:Wit,style:wU,from:r,encode:l},n)}function $at(e,t,n,r){const i=(a,u)=>a!=null?(n.update[u]=Bm(wr(a),n.update[u]),!1):!bm(u,r),s=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===s?wr(o):$r(t,wr(o),wr(s))}function Cat(e,t){const n=gat(e,t),r=e.encode||{},i=r.axis||{},s=i.name||void 0,o=i.interactive,a=i.style,u=Fs(e,n),l=xot(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=Me(t.add(Ma({},[c]))),h=Me(t.add(Sst({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),d=[];let p;return c.grid&&d.push(yat(e,n,r.grid,h,l)),c.ticks&&(p=u("tickSize"),d.push(xat(e,n,r.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,d.push(vat(e,n,r.labels,h,p,l))),c.domain&&d.push(mat(e,n,r.domain,f)),c.title&&d.push(wat(e,n,r.title,f)),IN(s2({role:Pit,from:f,encode:xy(Sat(u,e),i,P$),marks:d,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:o,style:a}),t)}function Sat(e,t){const n={enter:{},update:{}};return Gr(n,{orient:e("orient"),offset:e("offset")||0,position:ea(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function uge(e,t,n){const r=Qe(e.signals),i=Qe(e.scales);return n||r.forEach(s=>zpe(s,t)),Qe(e.projections).forEach(s=>not(s,t)),i.forEach(s=>Vst(s,t)),Qe(e.data).forEach(s=>sat(s,t)),i.forEach(s=>Gst(s,t)),(n||r).forEach(s=>Cst(s,t)),Qe(e.axes).forEach(s=>Cat(s,t)),Qe(e.marks).forEach(s=>IN(s,t)),Qe(e.legends).forEach(s=>qot(s,t)),e.title&&eat(e.title,t),t.parseLambdas(),t}const kat=e=>xy({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function Eat(e,t){const n=t.config,r=Me(t.root=t.add(NA())),i=Aat(e,n);i.forEach(l=>zpe(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(Ma()),o=t.add(Wpe(Bpe(kat(e.encode),AN,mU,e.style,t,{pulse:Me(s)}))),a=t.add(Hpe({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:Me(o)}));t.operators.pop(),t.pushState(Me(o),Me(a),null),uge(e,t,i),t.operators.push(a);let u=t.add(jpe({mark:r,pulse:Me(a)}));return u=t.add(Gpe({pulse:Me(u)})),u=t.add(Dg({pulse:Me(u)})),t.addData("root",new Bp(t,s,s,u)),t}function Sb(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Aat(e,t){const n=o=>ea(e[o],t[o]),r=[Sb("background",n("background")),Sb("autosize",Rit(n("autosize"))),Sb("padding",Lit(n("padding"))),Sb("width",n("width")||0),Sb("height",n("height")||0)],i=r.reduce((o,a)=>(o[a.name]=a,o),{}),s={};return Qe(e.signals).forEach(o=>{tt(i,o.name)?o=pt(i[o.name],o):r.push(o),s[o.name]=o}),Qe(t.signals).forEach(o=>{!tt(s,o.name)&&!tt(i,o.name)&&r.push(o)}),r}function lge(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function BK(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}lge.prototype=BK.prototype={parse(e){return uge(e,this)},fork(){return new BK(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof OL?Me(e):e;return this.add(Pst({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,i,s){let o,a;r&&(o=r.data||(r.data={}),a=o[i]||(o[i]=[]),a.push(s))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(Me(this.add(Dg({pulse:e})))),this._parent.push(t),this._lookup.push(n?Me(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return qt(this._parent)},encode(){return qt(this._encode)},lookup(){return qt(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(hn(e))return r2(e,t);e.signal||ae("Unsupported field reference: "+He(e));const n=e.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=Me(this.add(_st(i)))}return r},compareRef(e){let t=!1;const n=s=>rr(s)?(t=!0,this.signalRef(s.signal)):dst(s)?(t=!0,this.exprRef(s.expr)):s,r=Qe(e.field).map(n),i=Qe(e.order).map(n);return t?Me(this.add(kK({fields:r,orders:i}))):CK(r,i)},keyRef(e,t){let n=!1;const r=s=>rr(s)?(n=!0,Me(i[s.signal])):s,i=this.signals;return e=Qe(e).map(r),n?Me(this.add(Tst({fields:e,flat:t}))):lst(e,t)},sortRef(e){if(!e)return e;const t=kN(e.op,e.field),n=e.order||cst;return n.signal?Me(this.add(kK({fields:t,orders:this.signalRef(n.signal)}))):CK(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return tt(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&ae("Duplicate signal name: "+He(e));const n=t instanceof OL?t:this.add(NA(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||ae("Unrecognized signal name: "+He(e)),this.signals[e]},signalRef(e){return this.signals[e]?Me(this.signals[e]):(tt(this.lambdas,e)||(this.lambdas[e]=this.add(NA(null))),Me(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const r=e[t],i=Ou(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!ht(e)?e:this.signalRef(e.signal||TU(e))},exprRef(e,t){const n={expr:Ou(e,this)};return t&&(n.expr.$name=t),Me(this.add(Est(n)))},addBinding(e,t){this.bindings||ae("Nested signals do not support binding: "+He(e)),this.bindings.push(pt({signal:e},t))},addScaleProj(e,t){tt(this.scales,e)&&ae("Duplicate scale or projection name: "+He(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,zst(t))},addProjection(e,t){this.addScaleProj(e,Lst(t))},getScale(e){return this.scales[e]||ae("Unrecognized scale name: "+He(e)),this.scales[e]},scaleRef(e){return Me(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return tt(this.data,e)&&ae("Duplicate data set name: "+He(e)),this.data[e]=t},getData(e){return this.data[e]||ae("Undefined data set name: "+He(e)),this.data[e]},addDataPipeline(e,t){return tt(this.data,e)&&ae("Duplicate data set name: "+He(e)),this.addData(e,Bp.fromEntries(this,t))}};function TU(e){return(rt(e)?_at:Tat)(e)}function _at(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const i=e[r];n+=(r>0?",":"")+(ht(i)?i.signal||TU(i):He(i))}return n+"]"}function Tat(e){let t="{",n=0,r,i;for(r in e)i=e[r],t+=(++n>1?",":"")+He(r)+":"+(ht(i)?i.signal||TU(i):He(i));return t+"}"}function Iat(){const e="sans-serif",r="#4c78a8",i="#000",s="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:r},area:{fill:r},image:null,line:{stroke:r,strokeWidth:2},path:{stroke:r},rect:{fill:r},rule:{stroke:i},shape:{stroke:r},symbol:{fill:r,size:64},text:{fill:i,font:e,fontSize:11},trail:{fill:r,size:2},style:{"guide-label":{fill:i,font:e,fontSize:10},"guide-title":{fill:i,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:i,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:i,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:s,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:s,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:s,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Dat(e,t,n){return ht(e)||ae("Input Vega specification must be an object."),t=_I(Iat(),t,e.config),Eat(e,new lge(t,n)).toRuntime()}const Nat="RawCode",Fat="Literal",Oat="Property",Rat="Identifier",Mat="ArrayExpression",Lat="BinaryExpression",Pat="CallExpression",Bat="ConditionalExpression",zat="LogicalExpression",Uat="MemberExpression",jat="ObjectExpression",Wat="UnaryExpression";function Pa(e){this.type=e}Pa.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=Vat(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function Vat(e){switch(e.type){case Mat:return e.elements;case Lat:case zat:return[e.left,e.right];case Pat:return[e.callee].concat(e.arguments);case Bat:return[e.test,e.consequent,e.alternate];case Uat:return[e.object,e.property];case jat:return e.properties;case Oat:return[e.key,e.value];case Wat:return[e.argument];case Rat:case Fat:case Nat:default:return[]}}var Qu,Ne,ie,xi,jt,NN=1,B$=2,zp=3,Lh=4,FN=5,Fg=6,ns=7,z$=8,Gat=9;Qu={};Qu[NN]="Boolean";Qu[B$]="<end>";Qu[zp]="Identifier";Qu[Lh]="Keyword";Qu[FN]="Null";Qu[Fg]="Numeric";Qu[ns]="Punctuator";Qu[z$]="String";Qu[Gat]="RegularExpression";var Hat="ArrayExpression",qat="BinaryExpression",Xat="CallExpression",Yat="ConditionalExpression",cge="Identifier",Kat="Literal",Zat="LogicalExpression",Jat="MemberExpression",Qat="ObjectExpression",eut="Property",tut="UnaryExpression",Cr="Unexpected token %0",nut="Unexpected number",rut="Unexpected string",iut="Unexpected identifier",sut="Unexpected reserved word",out="Unexpected end of input",UL="Invalid regular expression",QO="Invalid regular expression: missing /",fge="Octal literals are not allowed in strict mode.",aut="Duplicate data property in object literal not allowed in strict mode",zr="ILLEGAL",o2="Disabled.",uut=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),lut=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function ON(e,t){if(!e)throw new Error("ASSERT: "+t)}function Sl(e){return e>=48&&e<=57}function IU(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Dx(e){return"01234567".indexOf(e)>=0}function cut(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function a2(e){return e===10||e===13||e===8232||e===8233}function U$(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&uut.test(String.fromCharCode(e))}function FA(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&lut.test(String.fromCharCode(e))}const fut={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function hge(){for(;ie<xi;){const e=Ne.charCodeAt(ie);if(cut(e)||a2(e))++ie;else break}}function jL(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)ie<xi&&IU(Ne[ie])?(r=Ne[ie++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):Et({},Cr,zr);return String.fromCharCode(i)}function hut(){var e,t,n,r;for(e=Ne[ie],t=0,e==="}"&&Et({},Cr,zr);ie<xi&&(e=Ne[ie++],!!IU(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Et({},Cr,zr),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function dge(){var e,t;for(e=Ne.charCodeAt(ie++),t=String.fromCharCode(e),e===92&&(Ne.charCodeAt(ie)!==117&&Et({},Cr,zr),++ie,e=jL("u"),(!e||e==="\\"||!U$(e.charCodeAt(0)))&&Et({},Cr,zr),t=e);ie<xi&&(e=Ne.charCodeAt(ie),!!FA(e));)++ie,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Ne.charCodeAt(ie)!==117&&Et({},Cr,zr),++ie,e=jL("u"),(!e||e==="\\"||!FA(e.charCodeAt(0)))&&Et({},Cr,zr),t+=e);return t}function dut(){var e,t;for(e=ie++;ie<xi;){if(t=Ne.charCodeAt(ie),t===92)return ie=e,dge();if(FA(t))++ie;else break}return Ne.slice(e,ie)}function put(){var e,t,n;return e=ie,t=Ne.charCodeAt(ie)===92?dge():dut(),t.length===1?n=zp:fut.hasOwnProperty(t)?n=Lh:t==="null"?n=FN:t==="true"||t==="false"?n=NN:n=zp,{type:n,value:t,start:e,end:ie}}function eR(){var e=ie,t=Ne.charCodeAt(ie),n,r=Ne[ie],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ie,{type:ns,value:String.fromCharCode(t),start:e,end:ie};default:if(n=Ne.charCodeAt(ie+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ie+=2,{type:ns,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:ie};case 33:case 61:return ie+=2,Ne.charCodeAt(ie)===61&&++ie,{type:ns,value:Ne.slice(e,ie),start:e,end:ie}}}if(o=Ne.substr(ie,4),o===">>>=")return ie+=4,{type:ns,value:o,start:e,end:ie};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return ie+=3,{type:ns,value:s,start:e,end:ie};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return ie+=2,{type:ns,value:i,start:e,end:ie};if(i==="//"&&Et({},Cr,zr),"<>=!+-*%&|^/".indexOf(r)>=0)return++ie,{type:ns,value:r,start:e,end:ie};Et({},Cr,zr)}function gut(e){let t="";for(;ie<xi&&IU(Ne[ie]);)t+=Ne[ie++];return t.length===0&&Et({},Cr,zr),U$(Ne.charCodeAt(ie))&&Et({},Cr,zr),{type:Fg,value:parseInt("0x"+t,16),start:e,end:ie}}function mut(e){let t="0"+Ne[ie++];for(;ie<xi&&Dx(Ne[ie]);)t+=Ne[ie++];return(U$(Ne.charCodeAt(ie))||Sl(Ne.charCodeAt(ie)))&&Et({},Cr,zr),{type:Fg,value:parseInt(t,8),octal:!0,start:e,end:ie}}function zK(){var e,t,n;if(n=Ne[ie],ON(Sl(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=ie,e="",n!=="."){if(e=Ne[ie++],n=Ne[ie],e==="0"){if(n==="x"||n==="X")return++ie,gut(t);if(Dx(n))return mut(t);n&&Sl(n.charCodeAt(0))&&Et({},Cr,zr)}for(;Sl(Ne.charCodeAt(ie));)e+=Ne[ie++];n=Ne[ie]}if(n==="."){for(e+=Ne[ie++];Sl(Ne.charCodeAt(ie));)e+=Ne[ie++];n=Ne[ie]}if(n==="e"||n==="E")if(e+=Ne[ie++],n=Ne[ie],(n==="+"||n==="-")&&(e+=Ne[ie++]),Sl(Ne.charCodeAt(ie)))for(;Sl(Ne.charCodeAt(ie));)e+=Ne[ie++];else Et({},Cr,zr);return U$(Ne.charCodeAt(ie))&&Et({},Cr,zr),{type:Fg,value:parseFloat(e),start:t,end:ie}}function yut(){var e="",t,n,r,i,s=!1;for(t=Ne[ie],ON(t==="'"||t==='"',"String literal must starts with a quote"),n=ie,++ie;ie<xi;)if(r=Ne[ie++],r===t){t="";break}else if(r==="\\")if(r=Ne[ie++],!r||!a2(r.charCodeAt(0)))switch(r){case"u":case"x":Ne[ie]==="{"?(++ie,e+=hut()):e+=jL(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Dx(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),ie<xi&&Dx(Ne[ie])&&(s=!0,i=i*8+"01234567".indexOf(Ne[ie++]),"0123".indexOf(r)>=0&&ie<xi&&Dx(Ne[ie])&&(i=i*8+"01234567".indexOf(Ne[ie++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&Ne[ie]===`
`&&++ie;else{if(a2(r.charCodeAt(0)))break;e+=r}return t!==""&&Et({},Cr,zr),{type:z$,value:e,octal:s,start:n,end:ie}}function but(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";Et({},UL)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Et({},UL)}try{return new RegExp(e,t)}catch{return null}}function xut(){var e,t,n,r,i;for(e=Ne[ie],ON(e==="/","Regular expression literal must start with a slash"),t=Ne[ie++],n=!1,r=!1;ie<xi;)if(e=Ne[ie++],t+=e,e==="\\")e=Ne[ie++],a2(e.charCodeAt(0))&&Et({},QO),t+=e;else if(a2(e.charCodeAt(0)))Et({},QO);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||Et({},QO),i=t.substr(1,t.length-2),{value:i,literal:t}}function vut(){var e,t,n;for(t="",n="";ie<xi&&(e=Ne[ie],!!FA(e.charCodeAt(0)));)++ie,e==="\\"&&ie<xi?Et({},Cr,zr):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Et({},UL,n),{value:n,literal:t}}function wut(){var e,t,n,r;return jt=null,hge(),e=ie,t=xut(),n=vut(),r=but(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:ie}}function $ut(e){return e.type===zp||e.type===Lh||e.type===NN||e.type===FN}function pge(){if(hge(),ie>=xi)return{type:B$,start:ie,end:ie};const e=Ne.charCodeAt(ie);return U$(e)?put():e===40||e===41||e===59?eR():e===39||e===34?yut():e===46?Sl(Ne.charCodeAt(ie+1))?zK():eR():Sl(e)?zK():eR()}function as(){const e=jt;return ie=e.end,jt=pge(),ie=e.end,e}function gge(){const e=ie;jt=pge(),ie=e}function Cut(e){const t=new Pa(Hat);return t.elements=e,t}function UK(e,t,n){const r=new Pa(e==="||"||e==="&&"?Zat:qat);return r.operator=e,r.left=t,r.right=n,r}function Sut(e,t){const n=new Pa(Xat);return n.callee=e,n.arguments=t,n}function kut(e,t,n){const r=new Pa(Yat);return r.test=e,r.consequent=t,r.alternate=n,r}function DU(e){const t=new Pa(cge);return t.name=e,t}function sx(e){const t=new Pa(Kat);return t.value=e.value,t.raw=Ne.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function jK(e,t,n){const r=new Pa(Jat);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function Eut(e){const t=new Pa(Qat);return t.properties=e,t}function WK(e,t,n){const r=new Pa(eut);return r.key=t,r.value=n,r.kind=e,r}function Aut(e,t){const n=new Pa(tut);return n.operator=e,n.argument=t,n.prefix=!0,n}function Et(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,o)=>(ON(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=ie,n.description=i,n}function RN(e){e.type===B$&&Et(e,out),e.type===Fg&&Et(e,nut),e.type===z$&&Et(e,rut),e.type===zp&&Et(e,iut),e.type===Lh&&Et(e,sut),Et(e,Cr,e.value)}function vi(e){const t=as();(t.type!==ns||t.value!==e)&&RN(t)}function un(e){return jt.type===ns&&jt.value===e}function tR(e){return jt.type===Lh&&jt.value===e}function _ut(){const e=[];for(ie=jt.start,vi("[");!un("]");)un(",")?(as(),e.push(null)):(e.push(Up()),un("]")||vi(","));return as(),Cut(e)}function VK(){ie=jt.start;const e=as();return e.type===z$||e.type===Fg?(e.octal&&Et(e,fge),sx(e)):DU(e.value)}function Tut(){var e,t,n,r;if(ie=jt.start,e=jt,e.type===zp)return n=VK(),vi(":"),r=Up(),WK("init",n,r);if(e.type===B$||e.type===ns)RN(e);else return t=VK(),vi(":"),r=Up(),WK("init",t,r)}function Iut(){var e=[],t,n,r,i={},s=String;for(ie=jt.start,vi("{");!un("}");)t=Tut(),t.key.type===cge?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?Et({},aut):i[r]=!0,e.push(t),un("}")||vi(",");return vi("}"),Eut(e)}function Dut(){vi("(");const e=NU();return vi(")"),e}const Nut={if:1};function Fut(){var e,t,n;if(un("("))return Dut();if(un("["))return _ut();if(un("{"))return Iut();if(e=jt.type,ie=jt.start,e===zp||Nut[jt.value])n=DU(as().value);else if(e===z$||e===Fg)jt.octal&&Et(jt,fge),n=sx(as());else{if(e===Lh)throw new Error(o2);e===NN?(t=as(),t.value=t.value==="true",n=sx(t)):e===FN?(t=as(),t.value=null,n=sx(t)):un("/")||un("/=")?(n=sx(wut()),gge()):RN(as())}return n}function Out(){const e=[];if(vi("("),!un(")"))for(;ie<xi&&(e.push(Up()),!un(")"));)vi(",");return vi(")"),e}function Rut(){ie=jt.start;const e=as();return $ut(e)||RN(e),DU(e.value)}function Mut(){return vi("."),Rut()}function Lut(){vi("[");const e=NU();return vi("]"),e}function Put(){var e,t,n;for(e=Fut();;)if(un("."))n=Mut(),e=jK(".",e,n);else if(un("("))t=Out(),e=Sut(e,t);else if(un("["))n=Lut(),e=jK("[",e,n);else break;return e}function GK(){const e=Put();if(jt.type===ns&&(un("++")||un("--")))throw new Error(o2);return e}function Ck(){var e,t;if(jt.type!==ns&&jt.type!==Lh)t=GK();else{if(un("++")||un("--"))throw new Error(o2);if(un("+")||un("-")||un("~")||un("!"))e=as(),t=Ck(),t=Aut(e.value,t);else{if(tR("delete")||tR("void")||tR("typeof"))throw new Error(o2);t=GK()}}return t}function HK(e){let t=0;if(e.type!==ns&&e.type!==Lh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function But(){var e,t,n,r,i,s,o,a,u,l;if(e=jt,u=Ck(),r=jt,i=HK(r),i===0)return u;for(r.prec=i,as(),t=[e,jt],o=Ck(),s=[u,r,o];(i=HK(jt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=UK(a,u,o),s.push(n);r=as(),r.prec=i,s.push(r),t.push(jt),n=Ck(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=UK(s[l-1].value,s[l-2],n),l-=2;return n}function Up(){var e,t,n;return e=But(),un("?")&&(as(),t=Up(),vi(":"),n=Up(),e=kut(e,t,n)),e}function NU(){const e=Up();if(un(","))throw new Error(o2);return e}function zut(e){Ne=e,ie=0,xi=Ne.length,jt=null,gge();const t=NU();if(jt.type!==B$)throw new Error("Unexpect token after expression.");return t}var Uut={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function jut(e){function t(o,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(o,a,u){return l=>t(o,l,a,u)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&ae("Missing arguments to clamp function."),o.length>3&&ae("Too many arguments to clamp function.");const a=o.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&ae("Missing arguments to if function."),o.length>3&&ae("Too many arguments to if function.");const a=o.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function Wut(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function Vut(e){e=e||{};const t=e.allowed?ic(e.allowed):{},n=e.forbidden?ic(e.forbidden):{},r=e.constants||Uut,i=(e.functions||jut)(f),s=e.globalvar,o=e.fieldvar,a=Pt(s)?s:p=>"".concat(s,'["').concat(p,'"]');let u={},l={},c=0;function f(p){if(hn(p))return p;const g=h[p.type];return g==null&&ae("Unsupported type: "+p.type),g(p)}const h={Literal:p=>p.raw,Identifier:p=>{const g=p.name;return c>0?g:tt(n,g)?ae("Illegal identifier: "+g):tt(r,g)?r[g]:tt(t,g)?g:(u[g]=1,a(g))},MemberExpression:p=>{const g=!p.computed,m=f(p.object);g&&(c+=1);const y=f(p.property);return m===o&&(l[Wut(y)]=1),g&&(c-=1),m+(g?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&ae("Illegal callee type: "+p.callee.type);const g=p.callee.name,m=p.arguments,y=tt(i,g)&&i[g];return y||ae("Unrecognized function: "+g),Pt(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const g=f(p.key);return c-=1,g+":"+f(p.value)}};function d(p){const g={code:f(p),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},g}return d.functions=i,d.constants=r,d}const Gut="view",OA="[",RA="]",mge="{",yge="}",Hut=":",bge=",",qut="@",Xut=">",Yut=/[[\]{}]/,Kut={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let xge,vge;function Og(e,t,n){return xge=t||Gut,vge=n||Kut,wge(e.trim()).map(WL)}function Zut(e){return vge[e]}function Nx(e,t,n,r,i){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function wge(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Nx(e,i,bge,OA+mge,RA+yge),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function WL(e){return e[0]==="["?Jut(e):Qut(e)}function Jut(e){const t=e.length;let n=1,r;if(n=Nx(e,n,RA,OA,RA),n===t)throw"Empty between selector: "+e;if(r=wge(e.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==Xut)throw"Expected '>' after between selector: "+e;r=r.map(WL);const i=WL(e.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function Qut(e){const t={source:xge},n=[];let r=[0,0],i=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===yge){if(a=e.lastIndexOf(mge),a>=0){try{r=elt(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===qut&&(i=++a),u=Nx(e,a,Hut),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=Nx(e,a,OA),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=Nx(e,a,RA),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==OA)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||Yut.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],i?t.markname=n[0].slice(1):Zut(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),r[0]&&(t.throttle=r[0]),r[1]&&(t.debounce=r[1]),t}function elt(e){const t=e.split(bge);if(!e.length||t.length>2)throw e;return t.map(n=>{const r=+n;if(r!==r)throw e;return r})}var tlt="vega",nlt="5.20.0",rlt="The Vega visualization grammar.",ilt=["vega","visualization","interaction","dataflow","library","data","d3"],slt="BSD-3-Clause",olt="UW Interactive Data Lab (http://idl.cs.washington.edu)",alt="build/vega-node.js",ult="build/vega.module.js",llt="build/vega.min.js",clt="build/vega.min.js",flt="index.d.ts",hlt="vega/vega",dlt={bundle:"rollup -c --config-bundle",prebuild:"rimraf build && rimraf build-es5",build:"rollup -c --config-core --config-bundle --config-ie",postbuild:"node schema-copy",pretest:"yarn build --config-test",test:"TZ=America/Los_Angeles tape 'test/**/*-test.js'",prepublishOnly:"yarn test && yarn build",postpublish:"./schema-deploy.sh"},plt={"vega-crossfilter":"~4.0.5","vega-dataflow":"~5.7.3","vega-encode":"~4.8.3","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-force":"~4.0.7","vega-format":"~1.0.4","vega-functions":"~5.12.0","vega-geo":"~4.3.8","vega-hierarchy":"~4.0.9","vega-label":"~1.0.0","vega-loader":"~4.4.0","vega-parser":"~6.1.3","vega-projection":"~1.4.5","vega-regression":"~1.0.9","vega-runtime":"~6.1.3","vega-scale":"~7.1.1","vega-scenegraph":"~4.9.4","vega-statistics":"~1.7.9","vega-time":"~2.0.4","vega-transforms":"~4.9.3","vega-typings":"~0.20.0","vega-util":"~1.16.1","vega-view":"~5.10.0","vega-view-transforms":"~4.5.8","vega-voronoi":"~4.1.5","vega-wordcloud":"~4.1.3"},glt={"vega-schema":"*"},mlt="f262105e75449760b0f35fda70e6b576a31d68a4",ylt={name:tlt,version:nlt,description:rlt,keywords:ilt,license:slt,author:olt,main:alt,module:ult,unpkg:llt,jsdelivr:clt,types:flt,repository:hlt,scripts:dlt,dependencies:plt,devDependencies:glt,gitHead:mlt};pt(t0,eLe,j7e,Wje,AVe,wGe,RKe,SHe,LKe,eZe,hQe,xQe);const blt=ylt.version,xlt=Object.freeze(Object.defineProperty({__proto__:null,Bounds:Wi,CanvasHandler:_$,CanvasRenderer:bA,DATE:vs,DAY:ai,DAYOFYEAR:Tu,Dataflow:Om,Debug:_re,Error:kre,EventStream:WI,Gradient:Zfe,GroupItem:L7,HOURS:Xs,Handler:sh,Info:Are,Item:M7,MILLISECONDS:Sa,MINUTES:Ys,MONTH:mi,Marks:Do,MultiPulse:u6,None:Sre,Operator:Zt,Parameters:jI,Pulse:bf,QUARTER:xs,RenderType:uf,Renderer:Xu,ResourceLoader:P7,SECONDS:To,SVGHandler:t9,SVGRenderer:a9,SVGStringRenderer:u9,Scenegraph:Q7,TIME_UNITS:O6,Transform:ee,View:Ape,WEEK:Qn,Warn:Ere,YEAR:Wr,accessor:Mo,accessorFields:pi,accessorName:_n,array:Qe,ascending:NI,bandwidthNRD:h6,bin:Vie,bootstrapCI:Gie,boundClip:aKe,boundContext:S$,boundItem:aL,boundMark:mhe,boundStroke:kg,changeset:gg,clampRange:HFe,codegenExpression:Vut,compare:Mre,constant:_o,cumulativeLogNormal:b6,cumulativeNormal:GI,cumulativeUniform:$6,dayofyear:fse,debounce:Lre,defaultLocale:Vfe,definition:Fie,densityLogNormal:y6,densityNormal:d6,densityUniform:w6,domChild:ss,domClear:ca,domCreate:of,domFind:e9,dotbin:Hie,error:ae,expressionFunction:qn,extend:pt,extent:Pf,extentIndex:Pre,falsy:zc,fastmap:Z1,field:Mf,flush:JFe,font:KD,fontFamily:A$,fontSize:qu,format:ak,formatLocale:lA,formats:I7,hasOwnProperty:tt,id:LFe,identity:Ao,inferType:Hfe,inferTypes:qfe,ingest:Nt,inherits:ye,inrange:QFe,interpolate:B8,interpolateColors:LD,interpolateRange:Fle,intersect:Uhe,intersectBoxLine:km,intersectPath:B7,intersectPoint:z7,intersectRule:she,isArray:rt,isBoolean:Bre,isDate:FI,isFunction:Pt,isIterable:zre,isNumber:wp,isObject:ht,isRegExp:e3e,isString:hn,isTuple:zI,key:Ure,lerp:t3e,lineHeight:rh,loader:D7,locale:Wfe,logger:PFe,lruCache:jre,markup:o9,merge:Wre,mergeConfig:_I,multiLineOffset:bYe,one:Y1,pad:r3e,panLinear:zFe,panLog:UFe,panPow:jFe,panSymlog:WFe,parse:Dat,parseExpression:zut,parseSelector:Og,pathCurves:F7,pathEqual:Ghe,pathParse:S0,pathRectangle:ehe,pathRender:Vv,pathSymbols:Qfe,pathTrail:the,peek:qt,point:JD,projection:Q8,quantileLogNormal:x6,quantileNormal:HI,quantileUniform:C6,quantiles:c6,quantizeInterpolator:Ole,quarter:VFe,quartiles:f6,get random(){return Ca},randomInteger:FMe,randomKDE:g6,randomLCG:NMe,randomLogNormal:Xie,randomMixture:Yie,randomNormal:p6,randomUniform:Kie,read:Mqe,regressionExp:Jie,regressionLinear:S6,regressionLoess:tse,regressionLog:Zie,regressionPoly:ese,regressionPow:Qie,regressionQuad:k6,renderModule:QD,repeat:Rb,resetDefaultLocale:mqe,resetSVGClipId:rhe,resetSVGDefIds:cKe,responseType:Rqe,runtimeContext:ppe,sampleCurve:XI,sampleLogNormal:m6,sampleNormal:VI,sampleUniform:v6,scale:Ft,sceneEqual:l9,sceneFromJSON:bhe,scenePickVisit:hA,sceneToJSON:yhe,sceneVisit:ka,sceneZOrder:U7,scheme:z8,serializeXML:Fhe,setRandom:IMe,span:OI,splitAccessPath:AI,stringValue:He,textMetrics:yu,timeBin:_se,timeFloor:bse,timeFormatLocale:Wv,timeInterval:iy,timeOffset:wse,timeSequence:Sse,timeUnitSpecifier:cse,timeUnits:R6,toBoolean:Vre,toDate:Gre,toNumber:Lf,toSet:ic,toString:Hre,transform:Oie,transforms:t0,truncate:s3e,truthy:K1,tupleid:Le,typeParsers:tL,utcFloor:xse,utcInterval:sy,utcOffset:$se,utcSequence:kse,utcdayofyear:pse,utcquarter:GFe,utcweek:gse,version:blt,visitArray:o3e,week:hse,writeConfig:TI,zero:Yc,zoomLinear:Fre,zoomLog:Ore,zoomPow:yM,zoomSymlog:Rre},Symbol.toStringTag,{value:"Module"})),vlt="vega-lite",wlt='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',$lt="4.13.1",Clt=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Slt="https://vega.github.io/vega-lite/",klt="Vega-Lite is a concise high-level language for interactive visualization.",Elt="build/vega-lite.js",Alt="build/vega-lite.min.js",_lt="build/vega-lite.min.js",Tlt="build/src/index",Ilt="build/src/index.d.ts",Dlt={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Nlt={test:"test"},Flt={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},Olt={type:"git",url:"https://github.com/vega/vega-lite.git"},Rlt="BSD-3-Clause",Mlt={url:"https://github.com/vega/vega-lite/issues"},Llt={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},Plt={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},Blt={vega:"^5.12.1"},zlt={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1},Ult={name:vlt,author:wlt,version:$lt,collaborators:Clt,homepage:Slt,description:klt,main:Elt,unpkg:Alt,jsdelivr:_lt,module:Tlt,types:Ilt,bin:Dlt,directories:Nlt,scripts:Flt,repository:Olt,license:Rlt,bugs:Mlt,devDependencies:Llt,dependencies:Plt,peerDependencies:Blt,jest:zlt};function $y(e,t,n){return e.fields=t||[],e.fname=n,e}function jlt(e){return e.length===1?Wlt(e[0]):Vlt(e)}const Wlt=e=>function(t){return t[e]},Vlt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function nR(e){throw Error(e)}function Rg(e){var t=[],n=null,r=0,i=e.length,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<i;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===n)l(),n=null,r=-1;else{if(n)continue;o===r&&u==='"'||o===r&&u==="'"?(o=a+1,n=u):u==="."&&!r?a>o?l():o=a+1:u==="["?(a>o&&l(),r=o=a+1):u==="]"&&(r||nR("Access path missing open bracket: "+e),r>0&&l(),r=0,o=a+1)}return r&&nR("Access path missing closing bracket: "+e),n&&nR("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Glt(e,t,n){const r=Rg(e);return e=r.length===1?r[0]:e,$y((n&&n.get||jlt)(r),[e],t||e)}var j$=[];Glt("id");var Hlt=$y(function(e){return e},j$,"identity");$y(function(){return 0},j$,"zero");$y(function(){return 1},j$,"one");$y(function(){return!0},j$,"true");$y(function(){return!1},j$,"false");function xS(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var qlt=0,Xlt=1,$ge=2,Ylt=3,Klt=4;function Zlt(e,t){var n=e||qlt;return{level:function(r){return arguments.length?(n=+r,this):n},error:function(){return n>=Xlt&&xS(t||"error","ERROR",arguments),this},warn:function(){return n>=$ge&&xS(t||"warn","WARN",arguments),this},info:function(){return n>=Ylt&&xS(t||"log","INFO",arguments),this},debug:function(){return n>=Klt&&xS(t||"log","DEBUG",arguments),this}}}const Ue=Array.isArray;function kr(e){return e===Object(e)}const qK=e=>e!=="__proto__";function Cge(...e){return e.reduce((t,n)=>{for(var r in n)if(r==="signals")t.signals=Jlt(t.signals,n.signals);else{var i=r==="legend"?{layout:1}:r==="style"?!0:null;FU(t,r,n[r],i)}return t},{})}function FU(e,t,n,r){if(qK(t)){var i,s;if(kr(n)&&!Ue(n)){s=kr(e[t])?e[t]:e[t]={};for(i in n)r&&(r===!0||r[i])?FU(s,i,n[i]):qK(i)&&(s[i]=n[i])}else e[t]=n}}function Jlt(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}function Ln(e){return e!=null?Ue(e)?e:[e]:[]}function Qlt(e){return typeof e=="function"}const ect=Object.prototype.hasOwnProperty;function Wd(e,t){return ect.call(e,t)}function W$(e){return typeof e=="boolean"}function Gn(e){return typeof e=="number"}function ct(e){return typeof e=="string"}function wt(e){return Ue(e)?"["+e.map(wt)+"]":kr(e)||ct(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Mg(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Pe(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Sge={exports:{}};(function(e){var t=function(){function n(h,d){return d!=null&&h instanceof d}var r;try{r=Map}catch{r=function(){}}var i;try{i=Set}catch{i=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(h,d,p,g,m){typeof d=="object"&&(p=d.depth,g=d.prototype,m=d.includeNonEnumerable,d=d.circular);var y=[],b=[],v=typeof Buffer<"u";typeof d>"u"&&(d=!0),typeof p>"u"&&(p=1/0);function x(w,C){if(w===null)return null;if(C===0)return w;var $,S;if(typeof w!="object")return w;if(n(w,r))$=new r;else if(n(w,i))$=new i;else if(n(w,s))$=new s(function(L,M){w.then(function(P){L(x(P,C-1))},function(P){M(x(P,C-1))})});else if(o.__isArray(w))$=[];else if(o.__isRegExp(w))$=new RegExp(w.source,f(w)),w.lastIndex&&($.lastIndex=w.lastIndex);else if(o.__isDate(w))$=new Date(w.getTime());else{if(v&&Buffer.isBuffer(w))return Buffer.allocUnsafe?$=Buffer.allocUnsafe(w.length):$=new Buffer(w.length),w.copy($),$;n(w,Error)?$=Object.create(w):typeof g>"u"?(S=Object.getPrototypeOf(w),$=Object.create(S)):($=Object.create(g),S=g)}if(d){var k=y.indexOf(w);if(k!=-1)return b[k];y.push(w),b.push($)}n(w,r)&&w.forEach(function(L,M){var P=x(M,C-1),G=x(L,C-1);$.set(P,G)}),n(w,i)&&w.forEach(function(L){var M=x(L,C-1);$.add(M)});for(var E in w){var A;S&&(A=Object.getOwnPropertyDescriptor(S,E)),!(A&&A.set==null)&&($[E]=x(w[E],C-1))}if(Object.getOwnPropertySymbols)for(var F=Object.getOwnPropertySymbols(w),E=0;E<F.length;E++){var _=F[E],I=Object.getOwnPropertyDescriptor(w,_);I&&!I.enumerable&&!m||($[_]=x(w[_],C-1),I.enumerable||Object.defineProperty($,_,{enumerable:!1}))}if(m)for(var T=Object.getOwnPropertyNames(w),E=0;E<T.length;E++){var O=T[E],I=Object.getOwnPropertyDescriptor(w,O);I&&I.enumerable||($[O]=x(w[O],C-1),Object.defineProperty($,O,{enumerable:!1}))}return $}return x(h,p)}o.clonePrototype=function(d){if(d===null)return null;var p=function(){};return p.prototype=d,new p};function a(h){return Object.prototype.toString.call(h)}o.__objToStr=a;function u(h){return typeof h=="object"&&a(h)==="[object Date]"}o.__isDate=u;function l(h){return typeof h=="object"&&a(h)==="[object Array]"}o.__isArray=l;function c(h){return typeof h=="object"&&a(h)==="[object RegExp]"}o.__isRegExp=c;function f(h){var d="";return h.global&&(d+="g"),h.ignoreCase&&(d+="i"),h.multiline&&(d+="m"),d}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(Sge);var tct=Sge.exports;const nct=F2(tct);var rct=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),r=s.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;i--!==0;){var o=s[i];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n};const ict=F2(rct);var sct=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,r=t.cmp&&function(s){return function(o){return function(a,u){var l={key:a,value:o[a]},c={key:u,value:o[u]};return s(l,c)}}}(t.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,u;if(Array.isArray(o)){for(u="[",a=0;a<o.length;a++)a&&(u+=","),u+=s(o[a])||"null";return u+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=i.push(o)-1,c=Object.keys(o).sort(r&&r(o));for(u="",a=0;a<c.length;a++){var f=c[a],h=s(o[f]);h&&(u&&(u+=","),u+=JSON.stringify(f)+":"+h)}return i.splice(l,1),"{"+u+"}"}}(e)};const u2=F2(sct);function OU(e){return!!e.or}function RU(e){return!!e.and}function MU(e){return!!e.not}function Sk(e,t){if(MU(e))Sk(e.not,t);else if(RU(e))for(const n of e.and)Sk(n,t);else if(OU(e))for(const n of e.or)Sk(n,t);else t(e)}function kk(e,t){return MU(e)?{not:kk(e.not,t)}:RU(e)?{and:e.and.map(n=>kk(n,t))}:OU(e)?{or:e.or.map(n=>kk(n,t))}:t(e)}const V$=ict,ft=nct;function l2(e,t){const n={};for(const r of t)Wd(e,r)&&(n[r]=e[r]);return n}function Yl(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>u2(e)).join(",")})`};const gn=u2;function St(e){if(Gn(e))return e;const t=ct(e)?e:u2(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);n=(n<<5)-n+i,n=n&n}return n}function XK(e){return e===!1||e===null}function We(e,t){return e.indexOf(t)>-1}function c2(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function kge(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function oct(e,...t){for(const n of t)act(e,n??{});return e}function act(e,t){for(const n of pe(t))FU(e,n,t[n],!0)}function ff(e,t){const n=[],r={};let i;for(const s of e)i=t(s),!(i in r)&&(r[i]=1,n.push(s));return n}function uct(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Ege(e,t){for(const n of e)if(t.has(n))return!0;return!1}function YK(e){const t=new Set;for(const n of e){const i=Rg(n).map((o,a)=>a===0?o:`[${o}]`),s=i.map((o,a)=>i.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Age(e,t){return e===void 0||t===void 0?!0:Ege(YK(e),YK(t))}function Jt(e){return pe(e).length===0}const pe=Object.keys,Sf=Object.values;function _ge(e){const t=[];for(const n in e)Wd(e,n)&&t.push({key:n,value:e[n]});return t}function MA(e){return e===!0||e===!1}function mn(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Fx(e,t){return MU(e)?"!("+Fx(e.not,t)+")":RU(e)?"("+e.and.map(n=>Fx(n,t)).join(") && (")+")":OU(e)?"("+e.or.map(n=>Fx(n,t)).join(") || (")+")":t(e)}function VL(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&VL(e[n],t)&&delete e[n],Jt(e)}function MN(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Tge(e,t="datum"){const n=Rg(e),r=[];for(let i=1;i<=n.length;i++){const s=`[${n.slice(0,i).map(wt).join("][")}]`;r.push(`${t}${s}`)}return r.join(" && ")}function lct(e,t="datum"){return`${t}[${wt(Rg(e).join("."))}]`}function cct(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function uh(e){return`${Rg(e).map(cct).join("\\.")}`}function N0(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Ige(e){return`${Rg(e).join(".")}`}function f2(e){return e?Rg(e).length:0}function Hn(...e){for(const t of e)if(t!==void 0)return t}let fct=42;function hct(e){const t=++fct;return e?String(e)+t:t}function dct(e){return pct(e)?e:`__${e}`}function pct(e){return e.indexOf("__")===0}function LA(e){if(e!==void 0)return(e%360+360)%360}function LU(e){return Gn(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const KK={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function PU(e){return e&&e.condition}const Dge=["domain","grid","labels","ticks","title"],gct={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Nge={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},mct=Object.assign(Object.assign({},Nge),{style:1,labelExpr:1,encoding:1});function ZK(e){return!!mct[e]}const Yi={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Fge=Yi.arc,LN=Yi.area,PN=Yi.bar,yct=Yi.image,BN=Yi.line,zN=Yi.point,bct=Yi.rect,PA=Yi.rule,Oge=Yi.text,BU=Yi.tick,xct=Yi.trail,zU=Yi.circle,UU=Yi.square,Rge=Yi.geoshape;function Lg(e){return We(["line","area","trail"],e)}function JK(e){return We(["rect","bar","image","arc"],e)}const Mge=pe(Yi);function Ru(e){return e.type}Mg(Mge);const vct=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],wct=["fill","fillOpacity"],$ct=[...vct,...wct],Cct={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},QK=pe(Cct),Sct={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},kct={color:"#4c78a8",invalid:"filter",timeUnitBand:1},Ect={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Lge=5,Act={binSpacing:1,continuousBandSize:Lge,timeUnitBandPosition:.5},_ct={binSpacing:0,continuousBandSize:Lge,timeUnitBandPosition:.5},Tct={thickness:1};function Ict(e){return Ru(e)?e.type:e}function Cc(e){return"mark"in e}class UN{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return Cc(t)?Ict(t.mark)===this.name:!1}}const Dct={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Nct={count:1,min:1,max:1};function lh(e){return!!e&&!!e.argmin}function Pg(e){return!!e&&!!e.argmax}function jU(e){return ct(e)&&!!Dct[e]}const Fct=["count","valid","missing","distinct"];function Pge(e){return ct(e)&&We(Fct,e)}function Oct(e){return ct(e)&&We(["min","max"],e)}const Rct=["count","sum","distinct","valid","missing"],Mct=["mean","average","median","q1","q3","min","max"],Lct=Mg(Mct),Kl="row",Zl="column",jN="facet",Cn="x",ir="y",Ba="x2",el="y2",tl="radius",Sc="radius2",za="theta",kc="theta2",nl="latitude",rl="longitude",Ua="latitude2",No="longitude2",Cs="color",il="fill",sl="stroke",Ss="shape",Ec="size",Bg="angle",Ac="opacity",Ph="fillOpacity",Bh="strokeOpacity",zh="strokeWidth",Uh="strokeDash",G$="text",H$="order",q$="detail",WN="key",jp="tooltip",VN="href",GN="url",HN="description",Pct={x:1,y:1,x2:1,y2:1},Bge={theta:1,theta2:1,radius:1,radius2:1};function zge(e){return e in Bge}const WU={longitude:1,longitude2:1,latitude:1,latitude2:1};function Bct(e){switch(e){case nl:return"y";case Ua:return"y2";case rl:return"x";case No:return"x2"}}function zct(e){return e in WU}const Uct=pe(WU),Uge=Object.assign(Object.assign(Object.assign(Object.assign({},Pct),Bge),WU),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function zm(e){return e===Cs||e===il||e===sl}const jge={row:1,column:1,facet:1},xo=pe(jge),VU=Object.assign(Object.assign({},Uge),jge),Wge=pe(VU),jct=Pe(VU,["order","detail","tooltip"]),Wct=Pe(jct,["row","column","facet"]);function Vct(e){return!!Wct[e]}function Vge(e){return!!VU[e]}const Gct=[Ba,el,Ua,No,kc,Sc];function Gge(e){return zg(e)!==e}function zg(e){switch(e){case Ba:return Cn;case el:return ir;case Ua:return nl;case No:return rl;case kc:return za;case Sc:return tl}return e}function ch(e){if(zge(e))switch(e){case za:return"startAngle";case kc:return"endAngle";case tl:return"outerRadius";case Sc:return"innerRadius"}return e}function ol(e){switch(e){case Cn:return Ba;case ir:return el;case nl:return Ua;case rl:return No;case za:return kc;case tl:return Sc}}function al(e){switch(e){case Cn:case Ba:return"width";case ir:case el:return"height"}}function Hct(e){switch(e){case Cn:return"xOffset";case ir:return"yOffset";case Ba:return"x2Offset";case el:return"y2Offset";case za:return"thetaOffset";case tl:return"radiusOffset";case kc:return"theta2Offset";case Sc:return"radius2Offset"}}const GU=Pe(Uge,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),qct=pe(GU),jh={x:1,y:1},Fo=pe(jh);function Mu(e){return e in jh}const HU={theta:1,radius:1},Xct=pe(HU);function qN(e){return e==="width"?Cn:ir}const Hge=Pe(GU,["text","tooltip","href","url","description","detail","key","order"]),Yct=pe(Hge);function Kct(e){return!!GU[e]}function Zct(e){switch(e){case Cs:case il:case sl:case Ec:case Ss:case Ac:case zh:case Uh:return!0;case Ph:case Bh:case Bg:return!1}}const qge=Object.assign(Object.assign(Object.assign({},jh),HU),Hge),XN=pe(qge);function Wh(e){return!!qge[e]}function Jct(e,t){return eft(e)[t]}const Xge={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Qct=Pe(Xge,["geoshape"]);function eft(e){switch(e){case Cs:case il:case sl:case HN:case q$:case WN:case jp:case VN:case H$:case Ac:case Ph:case Bh:case zh:case jN:case Kl:case Zl:return Xge;case Cn:case ir:case nl:case rl:return Qct;case Ba:case el:case Ua:case No:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Ec:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Uh:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Ss:return{point:"always",geoshape:"always"};case G$:return{text:"always"};case Bg:return{point:"always",square:"always",text:"always"};case GN:return{image:"always"};case za:return{text:"always",arc:"always"};case tl:return{text:"always",arc:"always"};case kc:case Sc:return{arc:"always"}}}function Ek(e){switch(e){case Cn:case ir:case za:case tl:case Ec:case Bg:case zh:case Ac:case Ph:case Bh:case Ba:case el:case kc:case Sc:return;case jN:case Kl:case Zl:case Ss:case Uh:case G$:case jp:case VN:case GN:case HN:return"discrete";case Cs:case il:case sl:return"flexible";case nl:case rl:case Ua:case No:case q$:case WN:case H$:return}}function Yge(e){return W$(e)&&(e=tF(e,void 0)),"bin"+pe(e).map(t=>YN(e[t])?mn(`_${t}_${Object.entries(e[t])}`):mn(`_${t}_${e[t]}`)).join("")}function sn(e){return e===!0||X$(e)&&!e.binned}function Fi(e){return e==="binned"||X$(e)&&e.binned===!0}function X$(e){return kr(e)}function YN(e){return e==null?void 0:e.selection}function eZ(e){switch(e){case Kl:case Zl:case Ec:case Cs:case il:case sl:case zh:case Ac:case Ph:case Bh:case Ss:return 6;case Uh:return 4;default:return 10}}function qU(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const tft='Autosize "fit" only works for single views and layered views.';function tZ(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function nZ(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function rZ(e){return e?`Dropping "fit-${e}" because spec has discrete ${al(e)}.`:'Dropping "fit" because spec has discrete size.'}function iZ(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function nft(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function rft(e){return`The "nearest" transform is not supported for ${e} marks.`}function Kge(e){return`Selection not supported for ${e} yet.`}function ift(e){return`Cannot find a selection named "${e}".`}const sft="Scale bindings are currently only supported for scales with unbinned, continuous domains.",oft="Legend bindings are only supported for selections over an individual field or encoding channel.";function aft(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function uft(e){return`Unknown repeated value "${e}".`}function sZ(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const lft="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function cft(e){return`Unrecognized parse "${e}".`}function oZ(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function fft(e){return`Ignoring an invalid transform: ${gn(e)}.`}const hft='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function aZ(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function dft(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function pft(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${gn(t)} is overridden by a child projection ${gn(n)}.`}const gft="Arc marks uses theta channel rather than angle, replacing angle with theta.";function mft(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${gn(n)}}.`}function Zge(e){return`Invalid field type "${e}".`}function yft(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function bft(e){return`Invalid aggregation operator "${e}".`}function xft(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function Jge(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function GL(e,t){return`Dropping ${gn(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const vft="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function KN(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function wft(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function $ft(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function Cft(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function rR(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function Sft(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function kft(e,t){return`Specified orient "${e}" overridden with "${t}".`}const Eft=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function Aft(e){return`Cannot use the scale property "${e}" with non-color channel.`}function _ft(e){return`Using unaggregated domain with raw field has no effect (${gn(e)}).`}function Tft(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Ift(e){return`Unaggregated domain is currently unsupported for log scale (${gn(e)}).`}function Dft(e){return`Cannot apply size to non-oriented mark "${e}".`}function Nft(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Fft(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Qge(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function eme(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Oft(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${gn(n)} and ${gn(r)}). Using ${gn(n)}.`}function Rft(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${gn(n)} and ${gn(r)}). Using the union of the two domains.`}function Mft(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Lft(e){return`Dropping sort property ${gn(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const uZ="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Pft="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Bft="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",zft="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Uft(e){return`Cannot stack "${e}" if there is already "${e}2".`}function jft(e){return`Cannot stack non-linear scale (${e}).`}function Wft(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function BA(e,t){return`Invalid ${e}: ${gn(t)}.`}function Vft(e){return`Dropping day from datetime ${gn(e)} as day cannot be combined with other units.`}function Gft(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Hft(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function qft(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Xft(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function lZ(e){return`1D error band does not support ${e}.`}function tme(e){return`Channel ${e} is required for "binned" bin.`}function Yft(e){return`Domain for ${e} is required for threshold scale.`}const nme=Zlt($ge);let F0=nme;function Kft(e){return F0=e,F0}function Zft(){return F0=nme,F0}function fe(...e){F0.warn(...e)}function Jft(...e){F0.debug(...e)}function Cy(e){if(e&&kr(e)){for(const t of YU)if(t in e)return!0}return!1}const rme=["january","february","march","april","may","june","july","august","september","october","november","december"],Qft=rme.map(e=>e.substr(0,3)),ime=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],eht=ime.map(e=>e.substr(0,3));function tht(e){if(LU(e)&&(e=+e),Gn(e))return e>4&&fe(BA("quarter",e)),e-1;throw new Error(BA("quarter",e))}function nht(e){if(LU(e)&&(e=+e),Gn(e))return e-1;{const t=e.toLowerCase(),n=rme.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=Qft.indexOf(r);if(i!==-1)return i;throw new Error(BA("month",e))}}function rht(e){if(LU(e)&&(e=+e),Gn(e))return e%7;{const t=e.toLowerCase(),n=ime.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=eht.indexOf(r);if(i!==-1)return i;throw new Error(BA("day",e))}}function XU(e,t){const n=[];if(t&&e.day!==void 0&&pe(e).length>1&&(fe(Vft(e)),e=ft(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const r=t?nht(e.month):e.month;n.push(r)}else if(e.quarter!==void 0){const r=t?tht(e.quarter):e.quarter;n.push(Gn(r)?r*3:r+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const r=t?rht(e.day):e.day;n.push(Gn(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=e[r];n.push(typeof i>"u"?0:i)}return n}function h2(e){const n=XU(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function iht(e){const n=XU(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function sht(e){const t=XU(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const sme={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},YU=pe(sme);function oht(e){return!!sme[e]}function KU(e){return e.startsWith("utc")}function aht(e){return e.substr(3)}const uht={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function ZU(e){const t=[];for(const n of YU)ome(e,n)&&t.push(n);return t}function ome(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function lht(e,t,{end:n}={end:!1}){const r=Tge(t),i=KU(e)?"utc":"";function s(u){return u==="quarter"?`(${i}quarter(${r})-1)`:`${i}${u}(${r})`}let o;const a={};for(const u of YU)ome(e,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),iht(a)}function ame(e){if(!e)return;const t=ZU(e);return`timeUnitSpecifier(${u2(t)}, ${u2(uht)})`}function cht(e,t,n){if(!e)return;const r=ame(e);return`${n||KU(e)?"utc":"time"}Format(${t}, ${r})`}function Vi(e){if(!e)return;let t;return ct(e)?t={unit:e}:kr(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),KU(t.unit)&&(t.utc=!0,t.unit=aht(t.unit)),t}function fht(e){const t=Vi(e),{utc:n}=t,r=Pe(t,["utc"]);return r.unit?(n?"utc":"")+pe(r).map(i=>mn(`${i==="unit"?"":`_${i}_`}${r[i]}`)).join(""):(n?"utc":"")+"timeunit"+pe(r).map(i=>mn(`_${i}_${r[i]}`)).join("")}function Xe(e){return e&&!!e.signal}function Vh(e){return!!e.step}function hht(e){return Ue(e)?!1:"fields"in e&&!("data"in e)}function dht(e){return Ue(e)?!1:"fields"in e&&"data"in e}function hf(e){return Ue(e)?!1:"field"in e&&"data"in e}const pht={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},ght=pe(pht),mht={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},iR=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function yht(e){return e==null?void 0:e.selection}function JU(e){return e&&!!e.field&&e.equal!==void 0}function ume(e){return e&&!!e.field&&e.lt!==void 0}function lme(e){return e&&!!e.field&&e.lte!==void 0}function cme(e){return e&&!!e.field&&e.gt!==void 0}function fme(e){return e&&!!e.field&&e.gte!==void 0}function QU(e){if(e&&e.field){if(Ue(e.range)&&e.range.length===2)return!0;if(Xe(e.range))return!0}return!1}function ej(e){return e&&!!e.field&&(Ue(e.oneOf)||Ue(e.in))}function bht(e){return e&&!!e.field&&e.valid!==void 0}function hme(e){return ej(e)||JU(e)||QU(e)||ume(e)||cme(e)||lme(e)||fme(e)}function Ya(e,t){return gj(e,{timeUnit:t,wrapTime:!0})}function xht(e,t){return e.map(n=>Ya(n,t))}function dme(e,t=!0){var n;const{field:r}=e,i=(n=Vi(e.timeUnit))===null||n===void 0?void 0:n.unit,s=i?"time("+lht(i,r)+")":me(e,{expr:"datum"});if(JU(e))return s+"==="+Ya(e.equal,i);if(ume(e)){const o=e.lt;return`${s}<${Ya(o,i)}`}else if(cme(e)){const o=e.gt;return`${s}>${Ya(o,i)}`}else if(lme(e)){const o=e.lte;return`${s}<=${Ya(o,i)}`}else if(fme(e)){const o=e.gte;return`${s}>=${Ya(o,i)}`}else{if(ej(e))return`indexof([${xht(e.oneOf,i).join(",")}], ${s}) !== -1`;if(bht(e))return tj(s,e.valid);if(QU(e)){const{range:o}=e,a=Xe(o)?{signal:`${o.signal}[0]`}:o[0],u=Xe(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&u!==null&&t)return"inrange("+s+", ["+Ya(a,i)+", "+Ya(u,i)+"])";const l=[];return a!==null&&l.push(`${s} >= ${Ya(a,i)}`),u!==null&&l.push(`${s} <= ${Ya(u,i)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function tj(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function vht(e){var t;return hme(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=Vi(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Sy={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Wp=Sy.quantitative,nj=Sy.ordinal,O0=Sy.temporal,rj=Sy.nominal,ky=Sy.geojson,wht=pe(Sy);function $ht(e){if(e)switch(e=e.toLowerCase(),e){case"q":case Wp:return"quantitative";case"t":case O0:return"temporal";case"o":case nj:return"ordinal";case"n":case rj:return"nominal";case ky:return"geojson"}}const Pn={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},HL={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},Cht=pe(HL);function Sht(e,t){const n=HL[e],r=HL[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const kht={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function cZ(e){return kht[e]}const pme=["linear","log","pow","sqrt","symlog","time","utc"],Eht=Mg(pme),Aht=["linear","log","pow","sqrt","symlog"],_ht=Mg(Aht);function Tht(e){return e in _ht}const Iht=["quantile","quantize","threshold"],Dht=Mg(Iht),Nht=pme.concat(["quantile","quantize","threshold","sequential","identity"]),Fht=Mg(Nht),Oht=["ordinal","bin-ordinal","point","band"],Rht=Mg(Oht);function ks(e){return e in Rht}function Oo(e){return e in Fht}function da(e){return e in Eht}function zA(e){return e in Dht}const Mht={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Lht(e){return!ct(e)&&!!e.name}function gme(e){return e==null?void 0:e.selection}function Pht(e){return e&&e.unionWith}const Bht={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},zht=Pe(Bht,["type","domain","range","scheme"]),Uht=pe(zht);jht();function mme(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!We(["point","band","identity"],e);case"bins":return!We(["point","band","identity","ordinal"],e);case"round":return da(e)||e==="band"||e==="point";case"padding":return da(e)||We(["point","band"],e);case"paddingOuter":case"align":return We(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return da(e);case"nice":return da(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Oo(e)&&!We(["log","time","utc","threshold","quantile"],e)}}function yme(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return zm(e)?void 0:Aft(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function bme(e,t){return We([nj,rj],t)?e===void 0||ks(e):t===O0?We([Pn.TIME,Pn.UTC,void 0],e):t===Wp?We([Pn.LOG,Pn.POW,Pn.SQRT,Pn.SYMLOG,Pn.QUANTILE,Pn.QUANTIZE,Pn.THRESHOLD,Pn.LINEAR,void 0],e):!0}function xme(e,t){if(!Wh(e))return!1;switch(e){case Cn:case ir:case za:case tl:return da(t)||We(["band","point"],t);case Ec:case zh:case Ac:case Ph:case Bh:case Bg:return da(t)||zA(t)||We(["band","point","ordinal"],t);case Cs:case il:case sl:return t!=="band";case Uh:return t==="ordinal"||zA(t);case Ss:return t==="ordinal"}}function jht(){var e;const t={};for(const n of Wge)for(const r of wht)for(const i of Cht){const s=Wht(n,r);xme(n,i)&&bme(i,r)&&(t[s]=(e=t[s])!==null&&e!==void 0?e:[],t[s].push(i))}return t}function Wht(e,t){return e+"_"+t}function ij(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:s}=e,o=wme(e);return ve(n)&&!Pge(n.aggregate)&&i&&da(i.get("type"))&&i.get("zero")===!1?vme({fieldDef:n,channel:t,markDef:r,ref:o,config:s}):o}function vme({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return Lg(n.type)||Lt("invalid",n,i)===null?r:[Vht(e,t),r]}function Vht(e,t){const n=sj(e,!0),i=zg(t)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function sj(e,t=!0){return tj(ct(e)?e:me(e,{expr:"datum"}),!t)}function Ght(e){const{datum:t}=e;return Cy(t)?h2(t):`${JSON.stringify(t)}`}function sp(e,t,n,r){const i={};if(t&&(i.scale=t),Gh(e)){const{datum:s}=e;Cy(s)?i.signal=h2(s):Xe(s)?i.signal=s.signal:i.value=s}else i.field=me(e,n);if(r){const{offset:s,band:o}=r;s&&(i.offset=s),o&&(i.band=o)}return i}function UA({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=me(t,{expr:o,suffix:i}),u=n!==void 0?me(n,{expr:o}):me(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const c=s===0?a:u;l.field=c}else{const c=`${s} * ${a} + ${1-s} * ${u}`;l.signal=`scale("${e}", ${c})`}return r&&(l.offset=r),l}function wme({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l,band:c}){var f;if(t){if(Ze(t)){if(Js(t)){c=c??K$({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:a,config:i,isMidPoint:!0});const{bin:d,timeUnit:p,type:g}=t;if(sn(d)||c&&p&&g===O0)return a&&a.impute?sp(t,s,{binSuffix:"mid"},{offset:u}):c?UA({scaleName:s,fieldOrDatumDef:t,band:c,offset:u}):sp(t,s,Z$(t,e)?{binSuffix:"range"}:{},{offset:u});if(Fi(d)){if(ve(n))return UA({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});fe(tme(e===Cn?Ba:el))}}const h=o==null?void 0:o.get("type");return sp(t,s,ks(h)?{binSuffix:"range"}:{},{offset:u,band:h==="band"?(f=c??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(fc(t)){const h=t.value,d=u?{offset:u}:{};return Object.assign(Object.assign({},Ox(e,h)),d)}}return Qlt(l)&&(l=l()),l&&Object.assign(Object.assign({},l),u?{offset:u}:{})}function Ox(e,t){return We(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:We(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:On(t)}function Vp(e){return e&&e!=="number"&&e!=="time"}function $me(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const Hht=" – ";function oj({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s}){var o,a;if(Vp(n))return aj({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:s});const u=Cme(e,r,i);if(nF(e)){const l=Xht(u,ve(e)?(o=Vi(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,hj(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===Pn.UTC);return l?{signal:l}:void 0}if(t=Eme(Hc(e),t,s),ve(e)&&sn(e.bin)){const l=me(e,{expr:r,binSuffix:"end"});return{signal:ZN(u,l,t,n,s)}}else return t||Hc(e)==="quantitative"?{signal:`${Ame(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function Cme(e,t,n){return ve(e)?n?`${me(e,{expr:t,suffix:"end"})}-${me(e,{expr:t,suffix:"start"})}`:me(e,{expr:t}):Ght(e)}function aj({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s,field:o}){if(o=o??Cme(e,r,i),ve(e)&&sn(e.bin)){const a=me(e,{expr:r,binSuffix:"end"});return{signal:ZN(o,a,t,n,s)}}return{signal:$me(n,o,t)}}function Sme(e,t,n,r,i,s){var o;if(!Vp(r)){if(nF(e)){const a=ve(e)?(o=Vi(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return qht(n,a,i,s)}return Eme(t,n,i)}}function kme(e,t,n){if(e&&(Xe(e)||e==="number"||e==="time"))return e;if(nF(t)&&n!=="time"&&n!=="utc")return"time"}function Eme(e,t,n){if(ct(t))return t;if(e===Wp)return n.numberFormat}function qht(e,t,n,r){return e||(t?{signal:ame(t)}:r?void 0:n.timeFormat)}function Ame(e,t){return`format(${e}, "${t||""}")`}function fZ(e,t,n,r){var i;return Vp(n)?$me(n,e,t):Ame(e,(i=ct(t)?t:void 0)!==null&&i!==void 0?i:r.numberFormat)}function ZN(e,t,n,r,i){const s=fZ(e,n,r,i),o=fZ(t,n,r,i);return`${tj(e,!1)} ? "null" : ${s} + "${Hht}" + ${o}`}function Xht(e,t,n,r,i){return!t||n?(n=ct(n)?n:r,`${i?"utc":"time"}Format(${e}, '${n}')`):cht(t,e,i)}const JN="min",Yht={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function hZ(e){return e in Yht}function _me(e){return!!e&&!!e.encoding}function bu(e){return!!e&&(e.op==="count"||!!e.field)}function Tme(e){return!!e&&Ue(e)}function Y$(e){return"row"in e||"column"in e}function uj(e){return!!e&&"header"in e}function QN(e){return"facet"in e}function Kht(e){return e.selection}function Zht(e){return e&&!ct(e)&&"repeat"in e}function dZ(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function Ime(e){return Js(e)&&"sort"in e}function K$({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:s,isMidPoint:o}){if(Ze(t)&&t.band!==void 0)return t.band;if(ve(t)){const{timeUnit:a,bin:u}=t;if(a&&!n)return o?Gp("timeUnitBandPosition",r,s):JK(r.type)?Gp("timeUnitBand",r,s):0;if(sn(u))return JK(r.type)&&!o?1:.5}if((i==null?void 0:i.fieldChannel)===e&&o)return .5}function lj(e,t,n,r,i,s){return sn(t.bin)||t.timeUnit&&Js(t)&&t.type==="temporal"?!!K$({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:s}):!1}function cj(e){return!!e&&"condition"in e}function eF(e){const t=e&&e.condition;return!!t&&!Ue(t)&&ve(t)}function fj(e){const t=e&&e.condition;return!!t&&!Ue(t)&&Ze(t)}function Jht(e){const t=e&&e.condition;return!!t&&(Ue(t)||fc(t))}function ve(e){return!!e&&(!!e.field||e.aggregate==="count")}function Hc(e){return e&&e.type}function Gh(e){return!!e&&"datum"in e}function uu(e){return Js(e)&&Ome(e)||qL(e)}function qL(e){return Gh(e)&&Gn(e.datum)}function Ze(e){return ve(e)||Gh(e)}function Js(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function fc(e){return e&&"value"in e&&"value"in e}function hj(e){return!!e&&("scale"in e||"sort"in e)}function dj(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Dme(e){return!!e&&"legend"in e}function Nme(e){return!!e&&("format"in e||"formatType"in e)}function Qht(e){return"op"in e}function me(e,t={}){var n,r,i;let s=e.field;const o=t.prefix;let a=t.suffix,u="";if(edt(e))s=dct("count");else{let l;if(!t.nofn)if(Qht(e))l=e.op;else{const{bin:c,aggregate:f,timeUnit:h}=e;sn(c)?(l=Yge(c),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")):f?Pg(f)?(u=`["${s}"]`,s=`argmax_${f.argmax}`):lh(f)?(u=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):h&&(l=fht(h),a=(!We(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Ige(s):t.expr?lct(s,t.expr)+u:uh(s)+u}function Fme(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return ve(e)&&!!e.bin;case"temporal":return!1}throw new Error(Zge(e.type))}function Ome(e){return!Fme(e)}function edt(e){return e.aggregate==="count"}function tdt(e,t){var n;const{field:r,bin:i,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(sn(i))return`${r} (binned)`;if(s){const a=(n=Vi(s))===null||n===void 0?void 0:n.unit;if(a)return`${r} (${ZU(a).join("-")})`}else if(o)return Pg(o)?`${r} for max ${o.argmax}`:lh(o)?`${r} for min ${o.argmin}`:`${MN(o)} of ${r}`;return r}function ndt(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(Pg(t))return`${i} for argmax(${t.argmax})`;if(lh(t))return`${i} for argmin(${t.argmin})`;const s=Vi(r),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||sn(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}const Rme=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return ndt(e);default:return tdt(e,t)}};let Mme=Rme;function Lme(e){Mme=e}function rdt(){Lme(Rme)}function op(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,s;const a=((i=pj(e))!==null&&i!==void 0?i:{}).title;if(!ve(e))return a;const u=e,l=r?Pme(u,t):void 0;return n?Hn(a,u.title,l):(s=a??u.title)!==null&&s!==void 0?s:l}function pj(e){if(dj(e)&&e.axis)return e.axis;if(Dme(e)&&e.legend)return e.legend;if(uj(e)&&e.header)return e.header}function Pme(e,t){return Mme(e,t)}function jA(e){var t;if(Nme(e)){const{format:n,formatType:r}=e;return{format:n,formatType:r}}else{const n=(t=pj(e))!==null&&t!==void 0?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function idt(e,t){if(e.timeUnit)return"temporal";if(sn(e.bin))return"quantitative";switch(Ek(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function Lu(e){if(ve(e))return e;if(eF(e))return e.condition}function er(e){if(Ze(e))return e;if(fj(e))return e.condition}function XL(e,t,n){if(ct(e)||Gn(e)||W$(e)){const r=ct(e)?"string":Gn(e)?"number":"boolean";return fe(mft(t,r,e)),{value:e}}return Ze(e)?WA(e,t,n):fj(e)?Object.assign(Object.assign({},e),{condition:WA(e.condition,t,n)}):e}function WA(e,t,n){if(Nme(e)){const{format:r,formatType:i}=e,s=Pe(e,["format","formatType"]);if(Vp(i)&&!n.customFormatTypes)return fe(aZ(t)),WA(s,t,n)}else{const r=dj(e)?"axis":Dme(e)?"legend":uj(e)?"header":null;if(r&&e[r]){const i=e[r],{format:s,formatType:o}=i,a=Pe(i,["format","formatType"]);if(Vp(o)&&!n.customFormatTypes)return fe(aZ(t)),WA(Object.assign(Object.assign({},e),{[r]:a}),t,n)}}return ve(e)?Bme(e,t):sdt(e)}function sdt(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Gn(n)?"quantitative":ct(n)?"nominal":Cy(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Bme(e,t){const{aggregate:n,timeUnit:r,bin:i,field:s}=e,o=Object.assign({},e);if(n&&!jU(n)&&!Pg(n)&&!lh(n)&&(fe(bft(n)),delete o.aggregate),r&&(o.timeUnit=Vi(r)),s&&(o.field=`${s}`),sn(i)&&(o.bin=tF(i,t)),Fi(i)&&!Mu(t)&&fe(`Channel ${t} should not be used with "binned" bin.`),Js(o)){const{type:a}=o,u=$ht(a);a!==u&&(o.type=u),a!=="quantitative"&&Pge(n)&&(fe(yft(a,n)),o.type="quantitative")}else if(!Gge(t)){const a=idt(o,t);fe(xft(t,a)),o.type=a}if(Js(o)){const{compatible:a,warning:u}=odt(o,t);a||fe(u)}if(Ime(o)&&ct(o.sort)){const{sort:a}=o;if(hZ(a))return Object.assign(Object.assign({},o),{sort:{encoding:a}});const u=a.substr(1);if(a.charAt(0)==="-"&&hZ(u))return Object.assign(Object.assign({},o),{sort:{encoding:u,order:"descending"}})}if(uj(o)){const{header:a}=o,{orient:u}=a,l=Pe(a,["orient"]);if(u)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},l),{labelOrient:a.labelOrient||u,titleOrient:a.titleOrient||u})})}return o}function tF(e,t){return W$(e)?{maxbins:eZ(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:eZ(t)}):e}const rd={compatible:!0};function odt(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Kl:case Zl:case jN:return Ome(e)?{compatible:!1,warning:$ft(t)}:rd;case Cn:case ir:case Cs:case il:case sl:case G$:case q$:case WN:case jp:case VN:case GN:case Bg:case za:case tl:case HN:return rd;case rl:case No:case nl:case Ua:return n!==Wp?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:rd;case Ac:case Ph:case Bh:case zh:case Ec:case kc:case Sc:case Ba:case el:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:rd;case Uh:return We(["ordinal","nominal"],e.type)?rd:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Ss:return We(["ordinal","nominal","geojson"],e.type)?rd:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case H$:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:rd}}function nF(e){const{formatType:t}=jA(e);return t==="time"||!t&&adt(e)}function adt(e){return e&&(e.type==="temporal"||ve(e)&&!!e.timeUnit)}function gj(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var s;const o=t&&((s=Vi(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",u;return Xe(e)?u=e.signal:Cy(e)?(a=!0,u=h2(e)):(ct(e)||Gn(e))&&a&&(u=`datetime(${JSON.stringify(e)})`,oht(o)&&(Gn(e)&&e<1e4||ct(e)&&isNaN(Date.parse(e)))&&(u=h2({[o]:e}))),u?r&&a?`time(${u})`:u:i?void 0:JSON.stringify(e)}function zme(e,t){const{type:n}=e;return t.map(r=>{const i=gj(r,{timeUnit:ve(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return i!==void 0?{signal:i}:r})}function Z$(e,t){return sn(e.bin)?Wh(t)&&We(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function Ume(e){const{anchor:t,frame:n,offset:r,orient:i,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:h}=e,d=Pe(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},d),s?{fill:s}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),h?{subtitlePadding:h}:{}),y=l2(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:y,nonMark:g,subtitle:m}}function qc(e){return ct(e)||Ue(e)&&ct(e[0])}function On(e){return Xe(e)?e:e!==void 0?{value:e}:void 0}function pZ(e){return Xe(e)?e.signal:wt(e.value)}function d2(e){return Xe(e)?e.signal:e==null?null:wt(e)}function udt(e,t,n){for(const r of n){const i=Gp(r,t.markDef,t.config);i!==void 0&&(e[r]=On(i))}return e}function jme(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Lt(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&t[i]!==void 0?t[i]:t[e]!==void 0?t[e]:s&&(!i||i===e)?void 0:Gp(e,t,n,r)}function Gp(e,t,n,{vgChannel:r}={}){return Hn(r?VA(e,t,n.style):void 0,VA(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function VA(e,t,n){return Wme(e,jme(t),n)}function Wme(e,t,n){t=Ln(t);let r;for(const i of t){const s=n[i];s&&s[e]!==void 0&&(r=s[e])}return r}function Vme(e,t){return Ln(e).reduce((n,r)=>{var i;return n.field.push(me(r,t)),n.order.push((i=r.sort)!==null&&i!==void 0?i:"ascending"),n},{field:[],order:[]})}function Gme(e,t){const n=[...e];return t.forEach(r=>{for(const i of n)if(V$(i,r))return;n.push(r)}),n}function Hme(e,t){return V$(e,t)||!t?e:e?[...Ln(e),...Ln(t)].join(", "):t}function qme(e,t){const n=e.value,r=t.value;if(n==null||r===null)return{explicit:e.explicit,value:null};if((qc(n)||Xe(n))&&(qc(r)||Xe(r)))return{explicit:e.explicit,value:Hme(n,r)};if(qc(n)||Xe(n))return{explicit:e.explicit,value:n};if(qc(r)||Xe(r))return{explicit:e.explicit,value:r};if(!qc(n)&&!Xe(n)&&!qc(r)&&!Xe(r))return{explicit:e.explicit,value:Gme(n,r)};throw new Error("It should never reach here")}function ap(e,t){const n=e&&e[t];return n?Ue(n)?c2(n,r=>!!r.field):ve(n)||eF(n):!1}function mj(e){return c2(Wge,t=>{if(ap(e,t)){const n=e[t];if(Ue(n))return c2(n,r=>!!r.aggregate);{const r=Lu(n);return r&&!!r.aggregate}}return!1})}function yj(e,t){const n=[],r=[],i=[],s=[],o={};return bj(e,(a,u)=>{if(ve(a)){const{field:l,aggregate:c,bin:f,timeUnit:h}=a,d=Pe(a,["field","aggregate","bin","timeUnit"]);if(c||h||f){const p=pj(a),g=p&&p.title;let m=me(a,{forAs:!0});const y=Object.assign(Object.assign(Object.assign({},g?[]:{title:op(a,t,{allowDisabling:!0})}),d),{field:m});if(c){let b;if(Pg(c)?(b="argmax",m=me({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${m}.${l}`):lh(c)?(b="argmin",m=me({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${m}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(b=c),b){const v={op:b,as:m};l&&(v.field=l),s.push(v)}}else if(n.push(m),Js(a)&&sn(f)){if(r.push({bin:f,field:l,as:m}),n.push(me(a,{binSuffix:"end"})),Z$(a,u)&&n.push(me(a,{binSuffix:"range"})),Mu(u)){const b={field:m+"_end"};o[u+"2"]=b}y.bin="binned",Gge(u)||(y.type=Wp)}else if(h){i.push({timeUnit:h,field:l,as:m});const b=Js(a)&&a.type!==O0&&"time";b&&(u===G$||u===jp?y.formatType=b:Kct(u)?y.legend=Object.assign({formatType:b},y.legend):Mu(u)&&(y.axis=Object.assign({formatType:b},y.axis)))}o[u]=y}else n.push(l),o[u]=e[u]}else o[u]=e[u]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:o}}function ldt(e,t,n){const r=Jct(t,n);if(r){if(r==="binned"){const i=e[t===Ba?Cn:ir];return!!(ve(i)&&ve(e[t])&&Fi(i.bin))}}else return!1;return!0}function cdt(e,t,n){const r=t.type;return pe(e).reduce((i,s)=>{if(!Vge(s))return fe(wft(s)),i;const o=e[s];if(s==="angle"&&r==="arc"&&!e.theta&&(fe(gft),s=za),!ldt(e,s,r))return fe(KN(s,r)),i;if(s===Ec&&r==="line"){const a=Lu(e[s]);if(a!=null&&a.aggregate)return fe(vft),i}if(s===Cs&&(t.filled?"fill"in e:"stroke"in e))return fe(Jge("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(s===q$||s===H$&&!Ue(o)&&!fc(o)||s===jp&&Ue(o))o&&(i[s]=Ln(o).reduce((a,u)=>(ve(u)?a.push(Bme(u,s)):fe(GL(u,s)),a),[]));else{if(s===jp&&o===null)i[s]=null;else if(!ve(o)&&!Gh(o)&&!fc(o)&&!cj(o)&&!Xe(o))return fe(GL(o,s)),i;i[s]=XL(o,s,n)}return i},{})}function fdt(e){const t=[];for(const n of pe(e))if(ap(e,n)){const r=e[n],i=Ln(r);for(const s of i)ve(s)?t.push(s):eF(s)&&t.push(s.condition)}return t}function bj(e,t,n){if(e)for(const r of pe(e)){const i=e[r];if(Ue(i))for(const s of i)t.call(n,s,r);else t.call(n,i,r)}}function Xme(e,t,n,r){return e?pe(e).reduce((i,s)=>{const o=e[s];return Ue(o)?o.reduce((a,u)=>t.call(r,a,u,s),i):t.call(r,i,o,s)},n):n}function Yme(e,t){return pe(t).reduce((n,r)=>{switch(r){case Cn:case ir:case VN:case HN:case GN:case Ba:case el:case za:case kc:case tl:case Sc:case nl:case rl:case Ua:case No:case G$:case Ss:case Bg:case jp:return n;case H$:if(e==="line"||e==="trail")return n;case q$:case WN:{const i=t[r];if(Ue(i)||ve(i))for(const s of Ln(i))s.aggregate||n.push(me(s,{}));return n}case Ec:if(e==="trail")return n;case Cs:case il:case sl:case Ac:case Ph:case Bh:case Uh:case zh:{const i=Lu(t[r]);return i&&!i.aggregate&&n.push(me(i,{})),n}}},[])}function hdt(e){const{tooltip:t}=e,n=Pe(e,["tooltip"]);if(!t)return{filteredEncoding:e};let r,i;if(Ue(t)){for(const s of t)s.aggregate?(r||(r=[]),r.push(s)):(i||(i=[]),i.push(s));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return Ue(i)&&i.length===1&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}function YL(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:s,titlePrefix:o})=>{const a=r?` of ${t.field}`:"";return{field:s+t.field,type:t.type,title:Xe(o)?{signal:o+`"${escape(a)}"`}:o+a}}),...fdt(n)]}}function Kme(e){const{axis:t,title:n,field:r}=e;return t&&t.title!==void 0?void 0:Hn(n,r)}function xj(e,t,n,r,i){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,aria:f,extraEncoding:h={}})=>{const d=Kme(n);return Zme(e,a,i,f,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},ct(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),h)})}}function Zme(e,t,n,r,i){const{clip:s,color:o,opacity:a}=e,u=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),s?{clip:s}:{}),o?{color:o}:{}),a?{opacity:a}:{}),Ru(i.mark)?i.mark:{type:i.mark}),{style:`${u}-${t}`}),W$(e[t])?{}:e[t]),r===!1?{aria:r}:{})})]:[]}function Jme(e,t,n){const{encoding:r}=e,i=t==="vertical"?"y":"x",s=r[i],o=r[i+"2"],a=r[i+"Error"],u=r[i+"Error2"];return{continuousAxisChannelDef:vS(s,n),continuousAxisChannelDef2:vS(o,n),continuousAxisChannelDefError:vS(a,n),continuousAxisChannelDefError2:vS(u,n),continuousAxis:i}}function vS(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=Pe(e,["aggregate"]);return n!==t&&fe(qft(n,t)),r}else return e}function Qme(e,t){const{mark:n,encoding:r}=e,{x:i,y:s}=r;if(uu(i)){if(uu(s)){const o=ve(i)&&i.aggregate,a=ve(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return Ru(n)&&n.orient?n.orient:"vertical"}return"horizontal"}else{if(uu(s))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}}const GA="boxplot",ddt=["box","median","outliers","rule","ticks"],pdt=new UN(GA,t0e);function e0e(e){return Gn(e)?"tukey":e}function t0e(e,{config:t}){var n,r;const{mark:i,encoding:s,selection:o,projection:a}=e,u=Pe(e,["mark","encoding","selection","projection"]),l=Ru(i)?i:{type:i};o&&fe(Kge("boxplot"));const c=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Lt("size",l,t),h=e0e(c),{transform:d,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:y,encodingWithoutContinuousAxis:b,ticksOrient:v,boxOrient:x,customTooltipWithoutAggregatedField:w}=gdt(e,c,t),{color:C,size:$}=b,S=Pe(b,["color","size"]),k=P=>xj(l,g,p,P,t.boxplot),E=k(S),A=k(b),F=k(Object.assign(Object.assign({},S),$?{size:$}:{})),_=YL([{fieldPrefix:h==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:h==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,b),I={type:"tick",color:"black",opacity:1,orient:v,invalid:null},T=h==="min-max"?_:YL([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,b),O=[...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:T}),...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:T}),...E({partName:"ticks",mark:I,positionPrefix:"lower_whisker",aria:!1,extraEncoding:T}),...E({partName:"ticks",mark:I,positionPrefix:"upper_whisker",aria:!1,extraEncoding:T})],L=[...h!=="tukey"?O:[],...A({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:_}),...F({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},kr(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:v,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:_})];let M;if(h!=="min-max"){const P=`datum["lower_box_${p.field}"]`,G=`datum["upper_box_${p.field}"]`,H=`(${G} - ${P})`,Q=`${P} - ${c} * ${H}`,te=`${G} + ${c} * ${H}`,ne=`datum["${p.field}"]`,oe={joinaggregate:n0e(p.field),groupby:m};let he;h==="tukey"&&(he={transform:[{filter:`(${Q} <= ${ne}) && (${ne} <= ${te})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...y],groupby:m}],layer:O});const we=Pe(S,["tooltip"]),{scale:Ae,axis:B}=p,Y=Kme(p),K=Zme(l,"outliers",t.boxplot,!0,{transform:[{filter:`(${ne} < ${Q}) || (${ne} > ${te})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},Y!==void 0?{title:Y}:{}),Ae!==void 0?{scale:Ae}:{}),B!==void 0?{axis:B}:{})},we),w?{tooltip:w}:{})})[0];K&&he?M={transform:[oe],layer:[K,he]}:K?(M=K,M.transform.unshift(oe)):he&&(M=he,M.transform.unshift(oe))}return M?Object.assign(Object.assign({},u),{layer:[M,{transform:d,layer:L}]}):Object.assign(Object.assign({},u),{transform:((r=u.transform)!==null&&r!==void 0?r:[]).concat(d),layer:L})}function n0e(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function gdt(e,t,n){const r=Qme(e,GA),{continuousAxisChannelDef:i,continuousAxis:s}=Jme(e,r,GA),o=i.field,a=e0e(t),u=[...n0e(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=s;c[f];const h=Pe(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=hdt(h),{bins:g,timeUnits:m,aggregate:y,groupby:b,encoding:v}=yj(p,n),x=r==="vertical"?"horizontal":"vertical",w=r;return{transform:[...g,...m,{aggregate:[...y,...u],groupby:b},...l],groupby:b,aggregate:y,continuousAxisChannelDef:i,continuousAxis:s,encodingWithoutContinuousAxis:v,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:d}}const vj="errorbar",mdt=["ticks","rule"],ydt=new UN(vj,r0e);function r0e(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:l}=i0e(e,vj,t),c=xj(a,i,r,s,t.errorbar),f={type:"tick",orient:o},h=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),h.length>1?{layer:h}:Object.assign({},h[0]))}function bdt(e,t){const{encoding:n}=e;if(xdt(n))return{orient:Qme(e,t),inputType:"raw"};const r=vdt(n),i=wdt(n),s=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(Ze(a)&&Ze(u))throw new Error(`${t} cannot have both x2 and y2`);if(Ze(a)){if(uu(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(Ze(u)){if(uu(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(Ze(u)&&!Ze(a))throw new Error(`${t} cannot have xError2 without xError`);if(Ze(c)&&!Ze(l))throw new Error(`${t} cannot have yError2 without yError`);if(Ze(a)&&Ze(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(Ze(a)){if(uu(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(Ze(l)){if(uu(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function xdt(e){return(Ze(e.x)||Ze(e.y))&&!Ze(e.x2)&&!Ze(e.y2)&&!Ze(e.xError)&&!Ze(e.xError2)&&!Ze(e.yError)&&!Ze(e.yError2)}function vdt(e){return Ze(e.x2)||Ze(e.y2)}function wdt(e){return Ze(e.xError)||Ze(e.xError2)||Ze(e.yError)||Ze(e.yError2)}function i0e(e,t,n){var r;const{mark:i,encoding:s,selection:o,projection:a}=e,u=Pe(e,["mark","encoding","selection","projection"]),l=Ru(i)?i:{type:i};o&&fe(Kge(t));const{orient:c,inputType:f}=bdt(e,t),{continuousAxisChannelDef:h,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=Jme(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:b,tooltipSummary:v,tooltipTitleWithFieldName:x}=$dt(l,h,d,p,g,f,t,n),w=s,C=m;w[C];const $=m==="x"?"x2":"y2";w[$];const S=m==="x"?"xError":"yError";w[S];const k=m==="x"?"xError2":"yError2";w[k];const E=Pe(w,[typeof C=="symbol"?C:C+"",typeof $=="symbol"?$:$+"",typeof S=="symbol"?S:S+"",typeof k=="symbol"?k:k+""]),{bins:A,timeUnits:F,aggregate:_,groupby:I,encoding:T}=yj(E,n),O=[..._,...y],L=f!=="raw"?[]:I,M=YL(v,h,T,x);return{transform:[...(r=u.transform)!==null&&r!==void 0?r:[],...A,...F,...O.length===0?[]:[{aggregate:O,groupby:L}],...b],groupby:L,continuousAxisChannelDef:h,continuousAxis:m,encodingWithoutContinuousAxis:T,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:M}}function $dt(e,t,n,r,i,s,o,a){let u=[],l=[];const c=t.field;let f,h=!1;if(s==="raw"){const d=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:d==="mean"?"stderr":"iqr";if(d==="median"!=(p==="iqr")&&fe(Hft(d,p,o)),p==="stderr"||p==="stdev")u=[{op:p,field:c,as:"extent_"+c},{op:d,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:MN(d)},{fieldPrefix:"upper_",titlePrefix:gZ(d,p,"+")},{fieldPrefix:"lower_",titlePrefix:gZ(d,p,"-")}],h=!0;else{e.center&&e.extent&&fe(Xft(e.extent,o));let g,m,y;p==="ci"?(g="mean",m="ci0",y="ci1"):(g="median",m="q1",y="q3"),u=[{op:m,field:c,as:"lower_"+c},{op:y,field:c,as:"upper_"+c},{op:g,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:op({field:c,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:op({field:c,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:op({field:c,aggregate:g,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&fe(Gft(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?l.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const d of l)f.push({fieldPrefix:d.as.substring(0,6),titlePrefix:N0(N0(d.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:h}}function gZ(e,t,n){return MN(e)+" "+n+" "+t}const wj="errorband",Cdt=["band","borders"],Sdt=new UN(wj,s0e);function s0e(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=i0e(e,wj,t),l=o,c=xj(l,i,r,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let h={type:f?"area":"rect"},d={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),d=Object.assign(Object.assign({},d),p)):l.interpolate?fe(lZ("interpolate")):l.tension&&fe(lZ("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const o0e={};function $j(e,t,n){const r=new UN(e,t);o0e[e]={normalizer:r,parts:n}}function kdt(){return pe(o0e)}$j(GA,t0e,ddt);$j(vj,r0e,mdt);$j(wj,s0e,Cdt);const Edt=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],a0e=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Adt={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},_dt={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Tdt={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},R0="_vgsid_",Idt={single:{on:"click",fields:[R0],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[R0],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Cj(e){return!!e&&(e==="legend"||!!e.legend)}function sR(e){return Cj(e)&&kr(e)}function Ddt(e){return rF(e)||kj(e)||Sj(e)}function Sj(e){return"concat"in e}function rF(e){return"vconcat"in e}function kj(e){return"hconcat"in e}function Pu(e){return kr(e)&&e.step!==void 0}function mZ(e){return e.view||e.width||e.height}const yZ=20,Ndt={align:1,bounds:1,center:1,columns:1,spacing:1},Fdt=pe(Ndt);function Odt(e,t,n){var r,i;const s=n[t],o={},{spacing:a,columns:u}=s;a!==void 0&&(o.spacing=a),u!==void 0&&(QN(e)&&!Y$(e.facet)||Sj(e))&&(o.columns=u),rF(e)&&(o.columns=1);for(const l of Fdt)if(e[l]!==void 0)if(l==="spacing"){const c=e[l];o[l]=Gn(c)?c:{row:(r=c.row)!==null&&r!==void 0?r:a,column:(i=c.column)!==null&&i!==void 0?i:a}}else o[l]=e[l];return o}function KL(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function HA(e,t){const n=p2(e,t);return Pu(n)?n.step:Ej}function p2(e,t){var n;const r=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return Hn(r,{step:e.step})}const Ej=20,Rdt={continuousWidth:200,continuousHeight:200,step:Ej},Mdt={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Rdt,mark:kct,arc:{},area:{},bar:Act,circle:{},geoshape:{},image:{},line:{},point:{},rect:_ct,rule:{color:"black"},square:{},text:{color:"black"},tick:Tct,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Mht,projection:{},legend:_dt,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Idt,style:{},title:{},facet:{spacing:yZ},concat:{spacing:yZ}},yl=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],bZ={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},xZ={blue:yl[0],orange:yl[1],red:yl[2],teal:yl[3],green:yl[4],yellow:yl[5],purple:yl[6],pink:yl[7],brown:yl[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Ldt(e={}){return{signals:[{name:"color",value:kr(e)?Object.assign(Object.assign({},xZ),e):xZ}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Pdt(e){return{signals:[{name:"fontSize",value:kr(e)?Object.assign(Object.assign({},bZ),e):bZ}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Bdt(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function u0e(e={}){const{color:t,font:n,fontSize:r}=e,i=Pe(e,["color","font","fontSize"]);return Cge({},Mdt,n?Bdt(n):{},t?Ldt(t):{},r?Pdt(r):{},i||{})}const zdt=["view",...Mge],Udt=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],jdt=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Sct);function Wdt(e){e=ft(e);for(const t of Udt)delete e[t];if(e.axis)for(const t in e.axis)PU(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Edt)delete e.legend[t];if(e.mark){for(const t of QK)delete e.mark[t];e.mark.tooltip&&kr(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of zdt){for(const r of QK)delete e[t][r];const n=jdt[t];if(n)for(const r of n)delete e[t][r];Gdt(e,t)}for(const t of kdt())delete e[t];Vdt(e);for(const t in e)kr(e[t])&&Jt(e[t])&&delete e[t];return Jt(e)?void 0:e}function Vdt(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=Ume(e.title);Jt(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Jt(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Jt(r)?delete e.title:e.title=r}function Gdt(e,t,n,r){const i=r?e[t][r]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},i),e.style[n??t]);Jt(s)||(e.style[n??t]=s),r||delete e[t]}function iF(e){return"layer"in e}function Hdt(e){return"repeat"in e}function qdt(e){return!Ue(e.repeat)&&e.repeat.layer}class l0e{map(t,n){return QN(t)?this.mapFacet(t,n):Hdt(t)?this.mapRepeat(t,n):kj(t)?this.mapHConcat(t,n):rF(t)?this.mapVConcat(t,n):Sj(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(iF(t))return this.mapLayer(t,n);if(Cc(t))return this.mapUnit(t,n);throw new Error(qU(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(r=>this.mapLayerOrUnit(r,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(r=>this.map(r,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(r=>this.map(r,n))})}mapConcat(t,n){const{concat:r}=t,i=Pe(t,["concat"]);return Object.assign(Object.assign({},i),{concat:r.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const Xdt={zero:1,center:1,normalize:1};function Ydt(e){return e in Xdt}const Kdt=new Set([Fge,PN,LN,PA,zN,zU,UU,BN,Oge,BU]),Zdt=new Set([PN,LN,Fge]);function vZ(e,t){var n,r;const i=t==="x"?"y":"radius",s=e[t],o=e[i];if(ve(s)&&ve(o))if(Hc(s)==="quantitative"&&Hc(o)==="quantitative"){if(s.stack)return t;if(o.stack)return i;const a=ve(s)&&!!s.aggregate,u=ve(o)&&!!o.aggregate;if(a!==u)return a?t:i;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,c=(r=o.scale)===null||r===void 0?void 0:r.type;if(l&&l!=="linear")return i;if(c&&c!=="linear")return t}}else{if(Hc(s)==="quantitative")return t;if(Hc(o)==="quantitative")return i}else{if(Hc(s)==="quantitative")return t;if(Hc(o)==="quantitative")return i}}function Jdt(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function c0e(e,t,n={}){const r=Ru(e)?e.type:e;if(!Kdt.has(r))return null;const i=vZ(t,"x")||vZ(t,"theta");if(!i)return null;const s=t[i],o=ve(s)?me(s,{}):void 0;let a=Jdt(i),u=t[a],l=ve(u)?me(u,{}):void 0;l===o&&(l=void 0,u=void 0,a=void 0);const c=qct.reduce((h,d)=>{if(d!=="tooltip"&&ap(t,d)){const p=t[d];for(const g of Ln(p)){const m=Lu(g);if(m.aggregate)continue;const y=me(m,{});(!y||y!==l)&&h.push({channel:d,fieldDef:m})}}return h},[]);let f;if(s.stack!==void 0?W$(s.stack)?f=s.stack?"zero":null:f=s.stack:c.length>0&&Zdt.has(r)&&(f="zero"),!f||!Ydt(f)||mj(t)&&c.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==Pn.LINEAR){if(n.disallowNonLinearStack)return null;fe(jft(s.scale.type))}return Ze(t[ol(i)])?(s.stack!==void 0&&fe(Uft(i)),null):(ve(s)&&s.aggregate&&!We(Rct,s.aggregate)&&fe(Wft(s.aggregate)),{groupbyChannel:u?a:void 0,groupbyField:l,fieldChannel:i,impute:s.impute===null?!1:Lg(r),stackBy:c,offset:f})}function Qdt(e){const t=Pe(e,["point","line"]);return pe(t).length>1?t:t.type}function ept(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:Yl(e[t],["point","line"])}));return e}function oR(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?kr(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?kr(t.point)?t.point:{}:void 0}function wZ(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class tpt{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(Cc(t)){const{mark:r,encoding:i}=t,s=Ru(r)?r:{type:r};switch(s.type){case"line":case"rule":case"trail":return!!oR(s,n[s.type],i);case"area":return!!oR(s,n[s.type],i)||!!wZ(s,n[s.type])}}return!1}run(t,n,r){const{config:i}=n,{selection:s,projection:o,encoding:a,mark:u}=t,l=Pe(t,["selection","projection","encoding","mark"]),c=Ru(u)?u:{type:u},f=oR(c,i[c.type],a),h=c.type==="area"&&wZ(c,i[c.type]),d=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:Qdt(Object.assign(Object.assign({},c.type==="area"&&c.opacity===void 0&&c.fillOpacity===void 0?{opacity:.7}:{}),c)),encoding:Yl(a,["shape"])})],p=c0e(c,a);let g=a;if(p){const{fieldChannel:m,offset:y}=p;g=Object.assign(Object.assign({},a),{[m]:Object.assign(Object.assign({},a[m]),y?{stack:y}:{})})}return h&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},l2(c,["clip","interpolate","tension","tooltip"])),h),encoding:g})),f&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},l2(c,["clip","tooltip"])),f),encoding:g})),r(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},n),{config:ept(i)}))}}class npt{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(Cc(t)&&t.encoding)for(const r of Fo){const i=t.encoding[r];if(i&&Ze(i)&&!((n=i==null?void 0:i.scale)===null||n===void 0)&&n.rangeStep)return!0}return!1}run(t){var n;const r={};let i=Object.assign({},t.encoding);for(const s of Fo){const o=al(s),a=i[s];if(a&&Ze(a)&&!((n=a==null?void 0:a.scale)===null||n===void 0)&&n.rangeStep){const{scale:u}=a,l=Pe(a,["scale"]),c=u,f=Pe(c,["rangeStep"]);r[o]={step:u.rangeStep},fe(Eft),i=Object.assign(Object.assign({},i),{[s]:Object.assign(Object.assign({},l),Jt(f)?{}:{scale:f})})}}return Object.assign(Object.assign(Object.assign({},r),t),{encoding:i})}}function rpt(e,t){return t?Y$(e)?h0e(e,t):f0e(e,t):e}function aR(e,t){return t?h0e(e,t):e}function ZL(e,t,n){const r=t[e];if(Zht(r)){if(r.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[r.repeat]});fe(uft(r.repeat));return}return t}function f0e(e,t){if(e=ZL("field",e,t),e!==void 0){if(e===null)return null;if(Ime(e)&&bu(e.sort)){const n=ZL("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function $Z(e,t){if(ve(e))return f0e(e,t);{const n=ZL("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function CZ(e,t){if(Ze(e)){const n=$Z(e,t);if(n)return n;if(cj(e))return{condition:e.condition}}else{if(fj(e)){const n=$Z(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):Pe(e,["condition"])}return e}}function h0e(e,t){const n={};for(const r in e)if(Wd(e,r)){const i=e[r];if(Ue(i))n[r]=i.map(s=>CZ(s,t)).filter(s=>s);else{const s=CZ(i,t);s!==void 0&&(n[r]=s)}}return n}class ipt{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Cc(t)){const{encoding:n,mark:r}=t;if(r==="line")for(const i of Gct){const s=zg(i),o=n[s];if(n[i]&&(ve(o)&&!Fi(o.bin)||Gh(o)))return!0}}return!1}run(t,n,r){const{encoding:i}=t;return fe(Sft(!!i.x2,!!i.y2)),r(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}class spt extends l0e{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[pdt,ydt,Sdt,new tpt,new ipt,new npt]}map(t,n){if(Cc(t)){const r=ap(t.encoding,Kl),i=ap(t.encoding,Zl),s=ap(t.encoding,jN);if(r||i||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:r,parentProjection:i}=n,s=Object.assign(Object.assign({},t),{encoding:aR(t.encoding,n.repeater)});if(r||i)return this.mapUnitWithParentEncodingOrProjection(s,n);const o=this.mapLayerOrUnit.bind(this);for(const a of this.nonFacetUnitNormalizers)if(a.hasMatchingType(s,n.config))return a.run(s,n,o);return s}mapRepeat(t,n){return qdt(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:r,spec:i}=t,s=Pe(t,["repeat","spec"]),{row:o,column:a,layer:u}=r,{repeater:l={},repeaterPrefix:c=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:u},spec:i}}),n):Object.assign(Object.assign({},s),{layer:u.map(f=>{const h=Object.assign(Object.assign({},l),{layer:f}),d=(i.name||"")+c+`child__layer_${mn(f)}`,p=this.mapLayerOrUnit(i,Object.assign(Object.assign({},n),{repeater:h,repeaterPrefix:d}));return p.name=d,p})})}mapNonLayerRepeat(t,n){var r;const{repeat:i,spec:s,data:o}=t,a=Pe(t,["repeat","spec","data"]);!Ue(i)&&t.columns&&(t=Yl(t,["columns"]),fe(sZ("repeat")));const u=[],{repeater:l={},repeaterPrefix:c=""}=n,f=!Ue(i)&&i.row||[l?l.row:null],h=!Ue(i)&&i.column||[l?l.column:null],d=Ue(i)&&i||[l?l.repeat:null];for(const g of d)for(const m of f)for(const y of h){const b={repeat:g,row:m,column:y,layer:l.layer},v=(s.name||"")+c+"child__"+(Ue(i)?`${mn(g)}`:(i.row?`row_${mn(m)}`:"")+(i.column?`column_${mn(y)}`:"")),x=this.map(s,Object.assign(Object.assign({},n),{repeater:b,repeaterPrefix:v}));x.name=v,u.push(Yl(x,["data"]))}const p=Ue(i)?t.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(r=s.data)!==null&&r!==void 0?r:o,align:"all"},a),{columns:p,concat:u})}mapFacet(t,n){const{facet:r}=t;return Y$(r)&&t.columns&&(t=Yl(t,["columns"]),fe(sZ("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:r,projection:i}=t,{parentEncoding:s,parentProjection:o,config:a}=n,u=kZ({parentProjection:o,projection:i}),l=SZ({parentEncoding:s,encoding:aR(r,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),u?{projection:u}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const r=t.encoding,{row:i,column:s,facet:o}=r,a=Pe(r,["row","column","facet"]),{mark:u,width:l,projection:c,height:f,view:h,selection:d,encoding:p}=t,g=Pe(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:y}=this.getFacetMappingAndLayout({row:i,column:s,facet:o},n),b=aR(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},g),y),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),h?{view:h}:{}),c?{projection:c}:{}),{mark:u,encoding:b}),d?{selection:d}:{})}),n)}getFacetMappingAndLayout(t,n){var r;const{row:i,column:s,facet:o}=t;if(i||s){o&&fe(Cft([...i?[Kl]:[],...s?[Zl]:[]]));const a={},u={};for(const l of[Kl,Zl]){const c=t[l];if(c){const f=Pe(c,["align","center","spacing","columns"]);a[l]=f;for(const h of["align","center","spacing"])c[h]!==void 0&&(u[h]=(r=u[h])!==null&&r!==void 0?r:{},u[h][l]=c[h])}}return{facetMapping:a,layout:u}}else{const{align:a,center:u,spacing:l,columns:c}=o,f=Pe(o,["align","center","spacing","columns"]);return{facetMapping:rpt(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),u?{center:u}:{}),l?{spacing:l}:{}),c?{columns:c}:{})}}}mapLayer(t,n){var{parentEncoding:r,parentProjection:i}=n,s=Pe(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,u=Pe(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:SZ({parentEncoding:r,encoding:o}),parentProjection:kZ({parentProjection:i,projection:a})});return super.mapLayer(u,l)}}function SZ(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const i=pe(t).reduce((s,o)=>(n[o]&&s.push(o),s),[]);i.length>0&&fe(dft(i))}const r=Object.assign(Object.assign({},t??{}),n??{});return Jt(r)?void 0:r}function kZ(e){const{parentProjection:t,projection:n}=e;return t&&n&&fe(pft({parentProjection:t,projection:n})),n??t}function d0e(e,t){t===void 0&&(t=u0e(e.config));const n=apt(e,t),{width:r,height:i}=e,s=upt(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const opt=new spt;function apt(e,t={}){return opt.map(e,{config:t})}function EZ(e){return ct(e)?{type:e}:e??{}}function upt(e,t,n){let{width:r,height:i}=t;const s=Cc(e)||iF(e),o={};s?r=="container"&&i=="container"?(o.type="fit",o.contains="padding"):r=="container"?(o.type="fit-x",o.contains="padding"):i=="container"&&(o.type="fit-y",o.contains="padding"):(r=="container"&&(fe(tZ("width")),r=void 0),i=="container"&&(fe(tZ("height")),i=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?EZ(n.autosize):{}),EZ(e.autosize));if(a.type==="fit"&&!s&&(fe(tft),a.type="pad"),r=="container"&&!(a.type=="fit"||a.type=="fit-x")&&fe(nZ("width")),i=="container"&&!(a.type=="fit"||a.type=="fit-y")&&fe(nZ("height")),!V$(a,{type:"pad"}))return a}function lpt(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function cpt(e){return e?`fit-${qN(e)}`:"fit"}const fpt=["background","padding"];function AZ(e){return fpt.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class _c{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new _c(ft(this.explicit),ft(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return Hn(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,r){return delete this[r?"implicit":"explicit"][t],this[r?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of pe(t.combine())){const r=t.getWithExplicit(n);this.setWithExplicit(n,r)}}}function Vd(e){return{explicit:!0,value:e}}function Rs(e){return{explicit:!1,value:e}}function p0e(e){return(t,n,r,i)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:sF(t,n,r,i)}}function sF(e,t,n,r){return e.explicit&&t.explicit&&fe(Oft(n,r,e.value,t.value)),e}function fh(e,t,n,r,i=sF){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:V$(e.value,t.value)?e:i(e,t,n,r)}class hpt extends _c{constructor(t={},n={},r=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=r}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function g2(e){return"url"in e}function qA(e){return"values"in e}function g0e(e){return"name"in e&&!g2(e)&&!qA(e)&&!up(e)}function up(e){return e&&(m0e(e)||y0e(e)||Aj(e))}function m0e(e){return"sequence"in e}function y0e(e){return"sphere"in e}function Aj(e){return"graticule"in e}const ri="main",XA="raw";function b0e(e){return"filter"in e}function dpt(e){return(e==null?void 0:e.stop)!==void 0}function ppt(e){return"lookup"in e}function gpt(e){return"data"in e}function mpt(e){return"selection"in e}function ypt(e){return"pivot"in e}function bpt(e){return"density"in e}function xpt(e){return"quantile"in e}function vpt(e){return"regression"in e}function wpt(e){return"loess"in e}function $pt(e){return"sample"in e}function Cpt(e){return"window"in e}function Spt(e){return"joinaggregate"in e}function kpt(e){return"flatten"in e}function Ept(e){return"calculate"in e}function Apt(e){return"bin"in e}function _pt(e){return"impute"in e}function Tpt(e){return"timeUnit"in e}function Ipt(e){return"aggregate"in e}function Dpt(e){return"stack"in e}function Npt(e){return"fold"in e}function Fpt(e){return e.map(t=>b0e(t)?{filter:kk(t.filter,vht)}:t)}function J$(e,t,n,r){const i=cj(t)&&t.condition,s=r(t);if(i){const a=Ln(i).map(u=>{const l=r(u),c=Kht(u)?V0e(e,u.selection):JA(e,u.test);return Object.assign({test:c},l)});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function _j(e,t="text"){const n=e.encoding[t];return J$(e,n,t,r=>oF(r,e.config))}function oF(e,t,n="datum"){if(e){if(fc(e))return On(e.value);if(Ze(e)){const{format:r,formatType:i}=jA(e);return oj({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function x0e(e,t={}){const{encoding:n,markDef:r,config:i,stack:s}=e,o=n.tooltip;if(Ue(o))return{tooltip:_Z({tooltip:o},s,i,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return J$(e,o,"tooltip",u=>{const l=oF(u,i,a);if(l)return l;if(u===null)return;let c=Lt("tooltip",r,i);if(c===!0&&(c={content:"encoding"}),ct(c))return{value:c};if(kr(c))return c.content==="encoding"?_Z(n,s,i,t):{signal:a}})}}function v0e(e,t,n,{reactiveGeom:r}={}){const i={},s=r?"datum.datum":"datum",o=[];function a(l,c){const f=zg(c),h=Js(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),d=Ln(op(h,n,{allowDisabling:!1})).join(", ");let p;if(Mu(c)){const g=c==="x"?"x2":"y2",m=Lu(e[g]);if(Fi(h.bin)&&m){const y=me(h,{expr:s}),b=me(m,{expr:s}),{format:v,formatType:x}=jA(h);p=ZN(y,b,v,x,n),i[g]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:y,formatType:b}=jA(h);p=oj({fieldOrDatumDef:h,format:y,formatType:b,expr:s,config:n,normalizeStack:!0}).signal}}p=p??oF(h,n,s).signal,o.push({channel:c,key:d,value:p})}bj(e,(l,c)=>{ve(l)?a(l,c):eF(l)&&a(l.condition,c)});const u={};for(const{channel:l,key:c,value:f}of o)!i[l]&&!u[c]&&(u[wt(c)]=f);return u}function _Z(e,t,n,{reactiveGeom:r}={}){const i=v0e(e,t,n,{reactiveGeom:r}),s=_ge(i).map(({key:o,value:a})=>`${o}: ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function Opt(e){const{markDef:t,config:n}=e,r=Lt("aria",t,n);return r===!1?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),Rpt(e)),Mpt(e))}function Rpt(e){const{mark:t,markDef:n,config:r}=e;if(r.aria===!1)return{};const i=Lt("ariaRoleDescription",n,r);return i!=null?{ariaRoleDescription:{value:i}}:t in mht?{}:{ariaRoleDescription:{value:t}}}function Mpt(e){const{encoding:t,markDef:n,config:r,stack:i}=e,s=t.description;if(s)return J$(e,s,"description",u=>oF(u,e.config));const o=Lt("description",n,r);if(o!=null)return{description:On(o)};if(r.aria===!1)return{};const a=v0e(t,i,r);if(!Jt(a))return{description:{signal:_ge(a).map(({key:u,value:l})=>`${u} + ": " + (${l})`).join(' + "; " + ')}}}function gr(e,t,n={}){const{markDef:r,encoding:i,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u=u??Lt(e,r,s,{vgChannel:o,ignoreVgConfig:!0}),u!==void 0&&(a=On(u)));const l=i[e];return J$(t,l,o??e,c=>wme({channel:e,channelDef:c,markDef:r,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function w0e(e,t={filled:void 0}){var n,r,i,s;const{markDef:o,encoding:a,config:u}=e,{type:l}=o,c=(n=t.filled)!==null&&n!==void 0?n:Lt("filled",o,u),f=We(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,h=(i=(r=Lt(c===!0?"color":void 0,o,u,{vgChannel:"fill"}))!==null&&r!==void 0?r:u.mark[c===!0&&"color"])!==null&&i!==void 0?i:f,d=(s=Lt(c===!1?"color":void 0,o,u,{vgChannel:"stroke"}))!==null&&s!==void 0?s:u.mark[c===!1&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},h?{fill:On(h)}:{}),d?{stroke:On(d)}:{});return o.color&&(c?o.fill:o.stroke)&&fe(Jge("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),gr("color",e,{vgChannel:p,defaultValue:c?h:d})),gr("fill",e,{defaultValue:a.fill?h:void 0})),gr("stroke",e,{defaultValue:a.stroke?d:void 0}))}function m2(e,t){const n=Hct(e),r=t[n];if(r)return r}function fi(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:s,markDef:o,config:a,stack:u}=t,l=s[e],c=s[ol(e)],f=t.scaleName(e),h=t.getScaleComponent(e),d=m2(e,o),p=Tj({model:t,defaultPos:n,channel:e,scaleName:f,scale:h}),g=!l&&Mu(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:Lpt({channel:e,channelDef:l,channel2Def:c,markDef:o,config:a,isMidPoint:i,scaleName:f,scale:h,stack:u,offset:d,defaultRef:p});return g?{[r||e]:g}:void 0}function Lpt(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:s,offset:o,markDef:a,config:u}=e;if(Ze(n)&&s&&t===s.fieldChannel){if(ve(n)){const l=K$({channel:t,fieldDef:n,isMidPoint:r,markDef:a,stack:s,config:u});if(l!==void 0)return UA({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:l,offset:o})}return sp(n,i,{suffix:"end"},{offset:o})}return ij(e)}function Tj({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:s,config:o}=e;return()=>{const a=zg(n),u=ch(n),l=Lt(n,s,o,{vgChannel:u});if(l!==void 0)return Ox(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const c=i.get("type");if(!We([Pn.LOG,Pn.TIME,Pn.UTC],c)){if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[al(n)];return Object.assign(Object.assign({},c),{mult:.5})}}}}const Ppt={left:"x",center:"xc",right:"x2"},Bpt={top:"y",middle:"yc",bottom:"y2"};function $0e(e,t,n,r="middle"){if(e==="radius"||e==="theta")return ch(e);const s=Lt(e==="x"?"align":"baseline",t,n);return e==="x"?Ppt[s||(r==="top"?"left":"center")]:Bpt[s||r]}function YA(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?C0e(e,t,{defaultPos:n,defaultPos2:r}):fi(e,t,{defaultPos:n})}function C0e(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=t,o=ol(e),a=al(e),u=zpt(t,r,o),l=u[a]?$0e(e,i,s):ch(e);return Object.assign(Object.assign({},fi(e,t,{defaultPos:n,vgChannel:l})),u)}function zpt(e,t,n){const{encoding:r,mark:i,markDef:s,stack:o,config:a}=e,u=zg(n),l=al(n),c=ch(n),f=r[u],h=e.scaleName(u),d=e.getScaleComponent(u),p=n in r||n in s?m2(n,e.markDef):m2(u,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const g=Upt({channel:n,channelDef:f,channel2Def:r[n],markDef:s,config:a,scaleName:h,scale:d,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[c]:g}:wS(n,s)||wS(n,{[n]:VA(n,s,a.style),[l]:VA(l,s,a.style)})||wS(n,a[i])||wS(n,a.mark)||{[c]:Tj({model:e,defaultPos:t,channel:n,scaleName:h,scale:d})()}}function Upt({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l}){return Ze(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?sp(t,s,{suffix:"start"},{offset:u}):ij({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:r,config:i,offset:u,defaultRef:l})}function wS(e,t){const n=al(e),r=ch(e);if(t[r]!==void 0)return{[r]:Ox(e,t[r])};if(t[e]!==void 0)return{[r]:Ox(e,t[e])};if(t[n])return{[n]:Ox(e,t[n])}}function hh(e,t,n){var r,i,s,o;const{config:a,encoding:u,markDef:l,stack:c}=e,f=ol(t),h=al(t),d=u[t],p=u[f],g=e.getScaleComponent(t),m=g?g.get("type"):void 0,y=e.scaleName(t),b=l.orient,v=(i=(r=u[h])!==null&&r!==void 0?r:u.size)!==null&&i!==void 0?i:Lt("size",l,a,{vgChannel:h}),x=n==="bar"&&(t==="x"?b==="vertical":b==="horizontal");if(ve(d)&&(sn(d.bin)||Fi(d.bin)||d.timeUnit&&!p)&&!v&&!ks(m)){const w=K$({channel:t,fieldDef:d,stack:c,markDef:l,config:a}),C=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],$=(o=C==null?void 0:C.get("translate"))!==null&&o!==void 0?o:.5;return Vpt({fieldDef:d,fieldDef2:p,channel:t,markDef:l,scaleName:y,band:w,axisTranslate:$,spacing:Mu(t)?Lt("binSpacing",l,a):void 0,reverse:g.get("reverse"),config:a})}else return(Ze(d)&&ks(m)||x)&&!p?Wpt(n,d,t,e):C0e(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function jpt(e,t,n,r,i,s){if(r){const u=r.get("type");if(u==="point"||u==="band"){if(i[e].discreteBandSize!==void 0)return{value:i[e].discreteBandSize};if(u===Pn.POINT){const l=r.get("range");return Vh(l)&&Gn(l.step)?{value:l.step-2}:{value:Ej-2}}else return{scale:n,band:s}}else return{value:i[e].continuousBandSize}}const o=HA(i.view,t),a=Hn(i[e].discreteBandSize,o-2);return a!==void 0?{value:a}:void 0}function Wpt(e,t,n,r){var i;const{markDef:s,encoding:o,config:a,stack:u}=r,l=s.orient,c=r.scaleName(n),f=r.getScaleComponent(n),h=al(n),d=ol(n),p=l==="horizontal"&&n==="y"||l==="vertical"&&n==="x",g=Lt(p?"size":h,s,a,{vgChannel:h});let m;(o.size||g!==void 0)&&(p?m=gr("size",r,{vgChannel:h,defaultValue:g}):fe(Dft(s.type)));const y=(i=Ze(t)?K$({channel:n,fieldDef:t,markDef:s,stack:u,config:a}):void 0)!==null&&i!==void 0?i:1;m=m||{[h]:jpt(e,h,c,f,a,y)};const b=(f==null?void 0:f.get("type"))!=="band"||!("band"in m[h]),v=$0e(n,s,a,b?"middle":"top"),x=m2(n,s),w=ij({channel:n,channelDef:t,markDef:s,config:a,scaleName:c,scale:f,stack:u,offset:x,defaultRef:Tj({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:b?.5:(1-y)/2});if(h)return Object.assign({[v]:w},m);{const C=ch(d),$=m[h],S=x?Object.assign(Object.assign({},$),{offset:x}):$;return{[v]:w,[C]:Ue(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:S})]:Object.assign(Object.assign({},w),{offset:S})}}}function kb(e,t,n,r,i){if(zge(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(Xe(n)){const o=d2(i);return{signal:`${n.signal} ? ${r-s}${o?"-"+o:""} : ${r+s}${o?"+"+o:""}`}}else{if(Xe(i)){const o=r+(n?-s:s);return{signal:`${o||""}${n?" - ":o?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-s:+i+s)}}function Vpt({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:s,spacing:o=0,axisTranslate:a,reverse:u,config:l}){const c=ol(n),f=ch(n),h=ch(c),d=m2(n,s);if(sn(e.bin)||e.timeUnit)return{[h]:TZ({channel:n,fieldDef:e,scaleName:i,markDef:s,band:(1-r)/2,offset:kb(c,o,u,a,d),config:l}),[f]:TZ({channel:n,fieldDef:e,scaleName:i,markDef:s,band:1-(1-r)/2,offset:kb(n,o,u,a,d),config:l})};if(Fi(e.bin)){const p=sp(e,i,{},{offset:kb(c,o,u,a,d)});if(ve(t))return{[h]:p,[f]:sp(t,i,{},{offset:kb(n,o,u,a,d)})};if(X$(e.bin)&&e.bin.step)return{[h]:p,[f]:{signal:`scale("${i}", ${me(e,{expr:"datum"})} + ${e.bin.step})`,offset:kb(n,o,u,a,d)}}}fe(tme(c))}function TZ({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:s,config:o}){const a=UA({scaleName:n,fieldOrDatumDef:t,band:i,offset:s});return vme({fieldDef:t,channel:e,markDef:r,ref:a,config:o})}const Gpt=new Set(["aria"]);function Bo(e,t){const{fill:n=void 0,stroke:r=void 0}=t.color==="include"?w0e(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Hpt(e.markDef,t)),IZ(e,"fill",n)),IZ(e,"stroke",r)),gr("opacity",e)),gr("fillOpacity",e)),gr("strokeOpacity",e)),gr("strokeWidth",e)),gr("strokeDash",e)),x0e(e)),_j(e,"href")),Opt(e))}function IZ(e,t,n){const{config:r,mark:i,markDef:s}=e;if(Lt("invalid",s,r)==="hide"&&n&&!Lg(i)){const a=qpt(e,{invalid:!0,channels:XN});if(a)return{[t]:[{test:a,value:null},...Ln(n)]}}return n?{[t]:n}:{}}function Hpt(e,t){return ght.reduce((n,r)=>(!Gpt.has(r)&&e[r]!==void 0&&t[r]!=="ignore"&&(n[r]=On(e[r])),n),{})}function qpt(e,{invalid:t=!1,channels:n}){const r=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&Oo(u)&&(s[l]=!0)}return s},{}),i=pe(r);if(i.length>0){const s=t?"||":"&&";return i.map(o=>sj(o,t)).join(` ${s} `)}}function Ij(e){const{config:t,markDef:n}=e;if(Lt("invalid",n,t)){const i=Xpt(e,{channels:Fo});if(i)return{defined:{signal:i}}}return{}}function Xpt(e,{invalid:t=!1,channels:n}){const r=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&Oo(u)&&(s[l]=!0)}return s},{}),i=pe(r);if(i.length>0){const s=t?"||":"&&";return i.map(o=>sj(o,t)).join(` ${s} `)}}function DZ(e,t){if(t!==void 0)return{[e]:On(t)}}const uR="voronoi",S0e={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(uR)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,s=e.mark;if(Lg(s))return fe(rft(s)),n;const o={name:e.getName(uR),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},x0e(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((l,c)=>{var f;const h=(f=l.name)!==null&&f!==void 0?f:"";h===e.component.mark[0].name?a=c:h.indexOf(uR)>=0&&(u=!0)}),u||n.splice(a+1,0,o),n}};class Yt{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.indexOf(t)>-1){console.warn("Attempt to add the same child twice.");return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class Pi extends Yt{constructor(t,n,r,i){super(t,n),this.type=r,this.refCounts=i,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${hct()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class xu extends Yt{constructor(t,n){super(t),this.formula=n}clone(){return new xu(null,ft(this.formula))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,o)=>{const{field:a,timeUnit:u}=s,l=En(n)?n.encoding[ol(o)]:void 0,c=En(n)&&lj(o,s,l,n.stack,n.markDef,n.config);if(u){const f=me(s,{forAs:!0});i[St({as:f,field:a,timeUnit:u})]=Object.assign({as:f,field:a,timeUnit:u},c?{band:!0}:{})}return i},{});return Jt(r)?null:new xu(t,r)}static makeFromTransform(t,n){const r=Object.assign({},n),{timeUnit:i}=r,s=Pe(r,["timeUnit"]),o=Vi(i),a=Object.assign(Object.assign({},s),{timeUnit:o});return new xu(t,{[St(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)(!this.formula[n]||t.formula[n].band)&&(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(Sf(this.formula).map(t=>t.as))}dependentFields(){return new Set(Sf(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${St(this.formula)}`}assemble(){const t=[];for(const n of Sf(this.formula)){const{field:r,as:i,timeUnit:s}=n,o=Vi(s),{unit:a,utc:u}=o,l=Pe(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:uh(r),type:"timeunit"},a?{units:ZU(a)}:{}),u?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return t}}const Q$="_tuple_fields";class Ypt{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const Kpt={has:()=>!0,parse:(e,t,n)=>{var r,i,s;const o=t.name,a=(r=t.project)!==null&&r!==void 0?r:t.project=new Ypt,u={},l={},c=new Set,f=(h,d)=>{const p=d==="visual"?h.channel:h.field;let g=mn(`${o}_${p}`);for(let m=1;c.has(g);m++)g=mn(`${o}_${p}_${m}`);return c.add(g),{[d]:g}};if(!n.fields&&!n.encodings){const h=e.config.selection[n.type];if(n.init)for(const d of Ln(n.init))for(const p of pe(d))Vct(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(fe('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=h.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=h.encodings,n.fields=h.fields}for(const h of(i=n.fields)!==null&&i!==void 0?i:[]){const d={type:"E",field:h};d.signals=Object.assign({},f(d,"data")),a.items.push(d),a.hasField[h]=d}for(const h of(s=n.encodings)!==null&&s!==void 0?s:[]){const d=e.fieldDef(h);if(d){let p=d.field;if(d.aggregate){fe(nft(h,d.aggregate));continue}else if(!p){fe(iZ(h));continue}if(d.timeUnit){p=e.vgField(h);const g={timeUnit:d.timeUnit,as:p,field:d.field};l[St(g)]=g}if(!u[p]){let g="E";if(t.type==="interval"){const y=e.getScaleComponent(h).get("type");Oo(y)&&(g="R")}else d.bin&&(g="R-RE");const m={field:p,channel:h,type:g};m.signals=Object.assign(Object.assign({},f(m,"data")),f(m,"visual")),a.items.push(u[p]=m),a.hasField[p]=a.hasChannel[h]=u[p]}}else fe(iZ(h))}if(n.init){const h=d=>a.items.map(p=>d[p.channel]!==void 0?d[p.channel]:d[p.field]);if(n.type==="interval")t.init=h(n.init);else{const d=Ln(n.init);t.init=d.map(h)}}Jt(l)||(a.timeUnit=new xu(null,l))},signals:(e,t,n)=>{const r=t.name+Q$;return n.filter(s=>s.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(s=>{const o=Pe(s,["signals","hasLegend"]);return o.field=uh(o.field),o})})}},k0e={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Cj(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,s=t.bind,o=t.init&&t.init[0],a=S0e.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((u,l)=>{var c,f;const h=mn(`${r}_${u.field}`);n.filter(p=>p.name===h).length||n.unshift(Object.assign(Object.assign({name:h},o?{init:M0(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${wt(u.field)}] : null`}]:[],bind:(f=(c=s[u.field])!==null&&c!==void 0?c:s[u.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.filter(l=>l.name===r+Bu)[0],o=r+Q$,a=i.items.map(l=>mn(`${r}_${l.field}`)),u=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},KA="_toggle",E0e={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+KA,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Bu,r=t.name+KA;return`${r} ? null : ${n}, `+(t.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${Jl(e)}}, `)+`${r} ? ${n} : null`}},Zpt={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=ct(n.clear)?Og(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(k0e.has(t))for(const r of t.project.items){const i=n.findIndex(s=>s.name===mn(`${t.name}_${r.field}`));i!==-1&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(i,s){i!==-1&&n[i].on&&n[i].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const i of t.project.items){const s=n.findIndex(o=>o.name===i.signals.visual);if(r(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===i.signals.data);r(o,"null")}}else{let i=n.findIndex(s=>s.name===t.name+Bu);r(i,"null"),E0e.has(t)&&(i=n.findIndex(s=>s.name===t.name+KA),r(i,"false"))}return n}},dh={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!Wh(i))continue;const s=e.getScaleComponent(i),o=s?s.get("type"):void 0;if(!s||!Oo(o)){fe(sft);continue}const a={selection:t.name,field:r.field};s.set("selectionExtent",a,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||QL(e)||r.length===0)return n;const i=n.filter(o=>o.name===t.name)[0];let s=i.update;if(s.indexOf(R0e)>=0)i.update=`{${r.map(o=>`${wt(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of r){const a=`${wt(o.field)}: ${o.signals.data}`;s.indexOf(a)<0&&(s=`${s.substring(0,s.length-1)}, ${a}}`)}i.update=s}return n.concat(r.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!QL(e))for(const r of t.scales){const i=n.filter(s=>s.name===r.signals.data)[0];i.push="outer",delete i.value,delete i.update}return n}};function JL(e,t){return`domain(${wt(e.scaleName(t))})`}function QL(e){var t;return e.parent&&Iy(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:QL(e.parent.parent))}const A0e={has:e=>{const t=e.resolve==="global"&&e.bind&&Cj(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==R0;return t&&!n&&fe(oft),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const u of t.events)u.filter=Ln((i=u.filter)!==null&&i!==void 0?i:[]),u.filter.indexOf(a)<0&&u.filter.push(a)}const s=sR(t.bind)?t.bind.legend:"click",o=ct(s)?Og(s,"view"):Ln(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=sR(t.bind)&&t.bind.legend,s=o=>a=>{const u=ft(a);return u.markname=o,u};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${mn(o.field)}_legend`,u=`${r}_${a}`;if(n.filter(c=>c.name===u).length===0){const c=i.merge.map(s(`${a}_symbols`)).concat(i.merge.map(s(`${a}_labels`))).concat(i.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.find(h=>h.name===r+Bu),o=r+Q$,a=i.items.filter(h=>h.hasLegend).map(h=>mn(`${r}_${mn(h.field)}_legend`)),l=`${a.map(h=>`${h} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(h=>({signal:h})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const c=n.find(h=>h.name===r+KA),f=sR(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function Jpt(e,t,n){var r;const i=(r=e.fieldDef(t))===null||r===void 0?void 0:r.field;Ug(e,s=>{var o,a;const u=(o=s.project.hasField[i])!==null&&o!==void 0?o:s.project.hasChannel[t];if(u&&A0e.has(s)){const l=(a=n.get("selections"))!==null&&a!==void 0?a:[];l.push(s.name),n.set("selections",l,!1),u.hasLegend=!0}})}const _0e="_translate_anchor",T0e="_translate_delta",Qpt={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const r=t.name,i=dh.has(t),s=r+_0e,{x:o,y:a}=t.project.hasChannel;let u=Og(t.translate,"scope");return i||(u=u.map(l=>(l.between[0].markname=r+Rx,l))),n.push({name:s,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(i?JL(e,Cn):`slice(${o.signals.visual})`):"")+(a!==void 0?", extent_y: "+(i?JL(e,ir):`slice(${a.signals.visual})`):"")+"}"}]},{name:r+T0e,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&NZ(e,t,o,"width",n),a!==void 0&&NZ(e,t,a,"height",n),n}};function NZ(e,t,n,r,i){var s;const o=t.name,a=o+_0e,u=o+T0e,l=n.channel,c=dh.has(t),f=i.filter(x=>x.name===n.signals[c?"data":"visual"])[0],h=e.getSizeSignalRef(r).signal,d=e.getScaleComponent(l),p=d.get("type"),g=c&&l===Cn?"-":"",m=`${a}.extent_${l}`,y=`${g}${u}.${l} / `+(c?`${h}`:`span(${m})`),v=`${c?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear"}(${m}, ${y}`+(c&&p==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";f.on.push({events:{signal:u},update:c?v:`clampRange(${v}, 0, ${h})`})}const I0e="_zoom_anchor",D0e="_zoom_delta",egt={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=dh.has(t),s=r+D0e,{x:o,y:a}=t.project.hasChannel,u=wt(e.scaleName(Cn)),l=wt(e.scaleName(ir));let c=Og(t.zoom,"scope");return i||(c=c.map(f=>(f.markname=r+Rx,f))),n.push({name:r+I0e,on:[{events:c,update:i?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&FZ(e,t,o,"width",n),a!==void 0&&FZ(e,t,a,"height",n),n}};function FZ(e,t,n,r,i){var s;const o=t.name,a=n.channel,u=dh.has(t),l=i.filter(b=>b.name===n.signals[u?"data":"visual"])[0],c=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(a),h=f.get("type"),d=u?JL(e,a):l.name,p=o+D0e,g=`${o}${I0e}.${a}`,y=`${u?h==="log"?"zoomLog":h==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${d}, ${g}, ${p}`+(u&&h==="pow"?`, ${(s=f.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";l.on.push({events:{signal:p},update:u?y:`clampRange(${y}, 0, ${c})`})}const tgt=[Kpt,E0e,dh,A0e,Qpt,egt,k0e,S0e,Zpt];function aF(e,t){for(const n of tgt)n.has(e)&&t(n)}function M0(e,t=!0,n=Hlt){if(Ue(e)){const r=e.map(i=>M0(i,t,n));return t?`[${r.join(", ")}]`:r}else if(Cy(e))return n(t?h2(e):sht(e));return t?n(JSON.stringify(e)):e}function ngt(e,t){return Ug(e,(n,r)=>{const i=n.name;let s=r.modifyExpr(e,n);t.push(...r.signals(e,n)),aF(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(s=o.modifyExpr(e,n,s))}),t.push({name:i+hgt,on:[{events:{signal:n.name+Bu},update:`modify(${wt(n.name+Hp)}, ${s})`}]})}),Dj(t)}function rgt(e,t){if(e.component.selection&&pe(e.component.selection).length){const n=wt(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Og("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Dj(t)}function igt(e,t){let n=!1;return Ug(e,(r,i)=>{const s=r.name,o=wt(s+Hp);if(t.filter(u=>u.name===s).length===0){const u=r.resolve==="global"?"union":r.resolve,l=r.type==="multi"?", true)":")";t.push({name:r.name,update:`${R0e}(${o}, ${wt(u)}${l}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),aF(r,u=>{u.topLevelSignals&&(t=u.topLevelSignals(e,r,t))})}),n&&t.filter(i=>i.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),Dj(t)}function sgt(e,t){const n=[...t];return Ug(e,r=>{const i={name:r.name+Hp};if(r.init){const o=r.project.items.map(u=>Pe(u,["signals"])),a=r.init.map(u=>M0(u,!1));i.values=r.type==="interval"?[{unit:Jl(e,{escape:!1}),fields:o,values:a}]:a.map(u=>({unit:Jl(e,{escape:!1}),fields:o,values:u}))}n.filter(o=>o.name===r.name+Hp).length||n.push(i)}),n}function N0e(e,t){return Ug(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,aF(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function ogt(e,t){for(const n of e.children)En(n)&&(t=N0e(n,t));return t}function agt(e,t){const n=t.selection,r=e.getSelectionComponent(n,mn(n));return{signal:G0e(r,t)}}function Dj(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const Rx="_brush",eP="_scale_trigger",ugt={signals:(e,t)=>{const n=t.name,r=n+Q$,i=dh.has(t),s=[],o=[],a=[];if(t.translate&&!i){const c=`!event.item || event.item.mark.name !== ${wt(n+Rx)}`;F0e(t,(f,h)=>{var d;const p=Ln((d=h.between[0].filter)!==null&&d!==void 0?d:h.between[0].filter=[]);return p.indexOf(c)<0&&p.push(c),f})}t.project.items.forEach((c,f)=>{const h=c.channel;if(h!==Cn&&h!==ir){fe("Interval selections only support x and y encoding channels.");return}const d=t.init?t.init[f]:null,p=lgt(e,t,c,d),g=c.signals.data,m=c.signals.visual,y=wt(e.scaleName(h)),b=e.getScaleComponent(h).get("type"),v=Oo(b)?"+":"";s.push(...p),o.push(g),a.push({scaleName:e.scaleName(h),expr:`(!isArray(${g}) || (${v}invert(${y}, ${m})[0] === ${v}${g}[0] && ${v}invert(${y}, ${m})[1] === ${v}${g}[1]))`})}),i||s.push({name:n+eP,value:{},on:[{events:a.map(c=>({scale:c.scaleName})),update:a.map(c=>c.expr).join(" && ")+` ? ${n+eP} : {}`}]});const u=t.init,l=`unit: ${Jl(e)}, fields: ${r}, values`;return s.concat(Object.assign(Object.assign({name:n+Bu},u?{init:`{${l}: ${M0(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${l}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Bu+", "+(t.resolve==="global"?"true":`{unit: ${Jl(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:s}=t.project.hasChannel,o=i&&i.signals.visual,a=s&&s.signals.visual,u=`data(${wt(t.name+Hp)})`;if(dh.has(t))return n;const l={x:i!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:i!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of pe(l))l[m]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${Jl(e)}`},l[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:h,cursor:d}=c,p=Pe(c,["fill","fillOpacity","cursor"]),g=pe(p).reduce((m,y)=>(m[y]=[{test:[i!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(b=>b).join(" && "),value:p[y]},{value:null}],m),{});return[{name:r+Rx+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:h}},update:l}},...n,{name:r+Rx,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},d?{cursor:{value:d}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),g)}}]}};function lgt(e,t,n,r){const i=n.channel,s=n.signals.visual,o=n.signals.data,a=dh.has(t),u=wt(e.scaleName(i)),l=e.getScaleComponent(i),c=l?l.get("type"):void 0,f=g=>`scale(${u}, ${g})`,h=e.getSizeSignalRef(i===Cn?"width":"height").signal,d=`${i}(unit)`,p=F0e(t,(g,m)=>[...g,{events:m.between[0],update:`[${d}, ${d}]`},{events:m,update:`[${s}[0], clamp(${d}, 0, ${h})]`}]);return p.push({events:{signal:t.name+eP},update:Oo(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},r?{init:M0(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:M0(r)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}function F0e(e,t){return e.events.reduce((n,r)=>r.between?t(n,r):(fe(`${r} is not an ordered event stream for interval selections.`),n),[])}function O0e(e,t){const n=t.name,r=n+Q$,i=t.project,s="(item().isVoronoi ? datum.datum : datum)",o=i.items.map(l=>{const c=e.fieldDef(l.channel);return c&&c.bin?`[${s}[${wt(e.vgField(l.channel,{}))}], ${s}[${wt(e.vgField(l.channel,{binSuffix:"end"}))}]]`:`${s}[${wt(l.field)}]`}).join(", "),a=`unit: ${Jl(e)}, fields: ${r}, values`,u=t.events;return[{name:n+Bu,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${o}]} : null`,force:!0}]:[]}]}const cgt={signals:O0e,modifyExpr:(e,t)=>t.name+Bu+", "+(t.resolve==="global"?"null":`{unit: ${Jl(e)}}`)},fgt={signals:O0e,modifyExpr:(e,t)=>t.name+Bu+", "+(t.resolve==="global"?"true":`{unit: ${Jl(e)}}`)},Hp="_store",Bu="_tuple",hgt="_modify",R0e="vlSelectionResolve",dgt={single:fgt,multi:cgt,interval:ugt};function Ug(e,t){const n=e.component.selection;if(n){for(const r of Sf(n))if(t(r,dgt[r.type])===!0)break}}function pgt(e){let t=e.parent;for(;t&&!xa(t);)t=t.parent;return t}function Jl(e,{escape:t}={escape:!0}){let n=t?wt(e.name):e.name;const r=pgt(e);if(r){const{facet:i}=r;for(const s of xo)i[s]&&(n+=` + '__facet_${s}_' + (facet[${wt(r.vgField(s))}])`)}return n}function Nj(e){let t=!1;return Ug(e,n=>{t=t||n.project.items.some(r=>r.field===R0)}),t}const ggt="RawCode",mgt="Literal",ygt="Property",bgt="Identifier",xgt="ArrayExpression",vgt="BinaryExpression",wgt="CallExpression",$gt="ConditionalExpression",Cgt="LogicalExpression",Sgt="MemberExpression",kgt="ObjectExpression",Egt="UnaryExpression";function ja(e){this.type=e}ja.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=Agt(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function Agt(e){switch(e.type){case xgt:return e.elements;case vgt:case Cgt:return[e.left,e.right];case wgt:return[e.callee].concat(e.arguments);case $gt:return[e.test,e.consequent,e.alternate];case Sgt:return[e.object,e.property];case kgt:return e.properties;case ygt:return[e.key,e.value];case Egt:return[e.argument];case bgt:case mgt:case ggt:default:return[]}}var ul,Fe,se,wi,Wt,uF=1,eC=2,qp=3,Hh=4,lF=5,jg=6,rs=7,tC=8,_gt=9;ul={};ul[uF]="Boolean";ul[eC]="<end>";ul[qp]="Identifier";ul[Hh]="Keyword";ul[lF]="Null";ul[jg]="Numeric";ul[rs]="Punctuator";ul[tC]="String";ul[_gt]="RegularExpression";var Tgt="ArrayExpression",Igt="BinaryExpression",Dgt="CallExpression",Ngt="ConditionalExpression",M0e="Identifier",Fgt="Literal",Ogt="LogicalExpression",Rgt="MemberExpression",Mgt="ObjectExpression",Lgt="Property",Pgt="UnaryExpression",Ur="Unexpected token %0",Bgt="Unexpected number",zgt="Unexpected string",Ugt="Unexpected identifier",jgt="Unexpected reserved word",Wgt="Unexpected end of input",tP="Invalid regular expression",lR="Invalid regular expression: missing /",L0e="Octal literals are not allowed in strict mode.",Vgt="Duplicate data property in object literal not allowed in strict mode",hi="ILLEGAL",y2="Disabled.",Ggt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Hgt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function cF(e,t){if(!e)throw new Error("ASSERT: "+t)}function kl(e){return e>=48&&e<=57}function Fj(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Mx(e){return"01234567".indexOf(e)>=0}function qgt(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function b2(e){return e===10||e===13||e===8232||e===8233}function nC(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&Ggt.test(String.fromCharCode(e))}function ZA(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&Hgt.test(String.fromCharCode(e))}var Xgt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function P0e(){for(var e;se<wi&&(e=Fe.charCodeAt(se),qgt(e)||b2(e));)++se}function nP(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)se<wi&&Fj(Fe[se])?(r=Fe[se++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):Dt({},Ur,hi);return String.fromCharCode(i)}function Ygt(){var e,t,n,r;for(e=Fe[se],t=0,e==="}"&&Dt({},Ur,hi);se<wi&&(e=Fe[se++],!!Fj(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Dt({},Ur,hi),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function B0e(){var e,t;for(e=Fe.charCodeAt(se++),t=String.fromCharCode(e),e===92&&(Fe.charCodeAt(se)!==117&&Dt({},Ur,hi),++se,e=nP("u"),(!e||e==="\\"||!nC(e.charCodeAt(0)))&&Dt({},Ur,hi),t=e);se<wi&&(e=Fe.charCodeAt(se),!!ZA(e));)++se,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Fe.charCodeAt(se)!==117&&Dt({},Ur,hi),++se,e=nP("u"),(!e||e==="\\"||!ZA(e.charCodeAt(0)))&&Dt({},Ur,hi),t+=e);return t}function Kgt(){var e,t;for(e=se++;se<wi;){if(t=Fe.charCodeAt(se),t===92)return se=e,B0e();if(ZA(t))++se;else break}return Fe.slice(e,se)}function Zgt(){var e,t,n;return e=se,t=Fe.charCodeAt(se)===92?B0e():Kgt(),t.length===1?n=qp:Xgt.hasOwnProperty(t)?n=Hh:t==="null"?n=lF:t==="true"||t==="false"?n=uF:n=qp,{type:n,value:t,start:e,end:se}}function cR(){var e=se,t=Fe.charCodeAt(se),n,r=Fe[se],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++se,{type:rs,value:String.fromCharCode(t),start:e,end:se};default:if(n=Fe.charCodeAt(se+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return se+=2,{type:rs,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:se};case 33:case 61:return se+=2,Fe.charCodeAt(se)===61&&++se,{type:rs,value:Fe.slice(e,se),start:e,end:se}}}if(o=Fe.substr(se,4),o===">>>=")return se+=4,{type:rs,value:o,start:e,end:se};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return se+=3,{type:rs,value:s,start:e,end:se};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return se+=2,{type:rs,value:i,start:e,end:se};if("<>=!+-*%&|^/".indexOf(r)>=0)return++se,{type:rs,value:r,start:e,end:se};Dt({},Ur,hi)}function Jgt(e){for(var t="";se<wi&&Fj(Fe[se]);)t+=Fe[se++];return t.length===0&&Dt({},Ur,hi),nC(Fe.charCodeAt(se))&&Dt({},Ur,hi),{type:jg,value:parseInt("0x"+t,16),start:e,end:se}}function Qgt(e){for(var t="0"+Fe[se++];se<wi&&Mx(Fe[se]);)t+=Fe[se++];return(nC(Fe.charCodeAt(se))||kl(Fe.charCodeAt(se)))&&Dt({},Ur,hi),{type:jg,value:parseInt(t,8),octal:!0,start:e,end:se}}function OZ(){var e,t,n;if(n=Fe[se],cF(kl(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=se,e="",n!=="."){if(e=Fe[se++],n=Fe[se],e==="0"){if(n==="x"||n==="X")return++se,Jgt(t);if(Mx(n))return Qgt(t);n&&kl(n.charCodeAt(0))&&Dt({},Ur,hi)}for(;kl(Fe.charCodeAt(se));)e+=Fe[se++];n=Fe[se]}if(n==="."){for(e+=Fe[se++];kl(Fe.charCodeAt(se));)e+=Fe[se++];n=Fe[se]}if(n==="e"||n==="E")if(e+=Fe[se++],n=Fe[se],(n==="+"||n==="-")&&(e+=Fe[se++]),kl(Fe.charCodeAt(se)))for(;kl(Fe.charCodeAt(se));)e+=Fe[se++];else Dt({},Ur,hi);return nC(Fe.charCodeAt(se))&&Dt({},Ur,hi),{type:jg,value:parseFloat(e),start:t,end:se}}function emt(){var e="",t,n,r,i,s=!1;for(t=Fe[se],cF(t==="'"||t==='"',"String literal must starts with a quote"),n=se,++se;se<wi;)if(r=Fe[se++],r===t){t="";break}else if(r==="\\")if(r=Fe[se++],!r||!b2(r.charCodeAt(0)))switch(r){case"u":case"x":Fe[se]==="{"?(++se,e+=Ygt()):e+=nP(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Mx(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),se<wi&&Mx(Fe[se])&&(s=!0,i=i*8+"01234567".indexOf(Fe[se++]),"0123".indexOf(r)>=0&&se<wi&&Mx(Fe[se])&&(i=i*8+"01234567".indexOf(Fe[se++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&Fe[se]===`
`&&++se;else{if(b2(r.charCodeAt(0)))break;e+=r}return t!==""&&Dt({},Ur,hi),{type:tC,value:e,octal:s,start:n,end:se}}function tmt(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(r,i){if(parseInt(i,16)<=1114111)return"x";Dt({},tP)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Dt({},tP)}try{return new RegExp(e,t)}catch{return null}}function nmt(){var e,t,n,r,i;for(e=Fe[se],cF(e==="/","Regular expression literal must start with a slash"),t=Fe[se++],n=!1,r=!1;se<wi;)if(e=Fe[se++],t+=e,e==="\\")e=Fe[se++],b2(e.charCodeAt(0))&&Dt({},lR),t+=e;else if(b2(e.charCodeAt(0)))Dt({},lR);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||Dt({},lR),i=t.substr(1,t.length-2),{value:i,literal:t}}function rmt(){var e,t,n;for(t="",n="";se<wi&&(e=Fe[se],!!ZA(e.charCodeAt(0)));)++se,e==="\\"&&se<wi?Dt({},Ur,hi):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Dt({},tP,n),{value:n,literal:t}}function imt(){var e,t,n,r;return Wt=null,P0e(),e=se,t=nmt(),n=rmt(),r=tmt(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:se}}function smt(e){return e.type===qp||e.type===Hh||e.type===uF||e.type===lF}function z0e(){var e;return P0e(),se>=wi?{type:eC,start:se,end:se}:(e=Fe.charCodeAt(se),nC(e)?Zgt():e===40||e===41||e===59?cR():e===39||e===34?emt():e===46?kl(Fe.charCodeAt(se+1))?OZ():cR():kl(e)?OZ():cR())}function us(){var e;return e=Wt,se=e.end,Wt=z0e(),se=e.end,e}function U0e(){var e;e=se,Wt=z0e(),se=e}function omt(e){var t=new ja(Tgt);return t.elements=e,t}function RZ(e,t,n){var r=new ja(e==="||"||e==="&&"?Ogt:Igt);return r.operator=e,r.left=t,r.right=n,r}function amt(e,t){var n=new ja(Dgt);return n.callee=e,n.arguments=t,n}function umt(e,t,n){var r=new ja(Ngt);return r.test=e,r.consequent=t,r.alternate=n,r}function Oj(e){var t=new ja(M0e);return t.name=e,t}function ox(e){var t=new ja(Fgt);return t.value=e.value,t.raw=Fe.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function MZ(e,t,n){var r=new ja(Rgt);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function lmt(e){var t=new ja(Mgt);return t.properties=e,t}function LZ(e,t,n){var r=new ja(Lgt);return r.key=t,r.value=n,r.kind=e,r}function cmt(e,t){var n=new ja(Pgt);return n.operator=e,n.argument=t,n.prefix=!0,n}function Dt(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(s,o){return cF(o<r.length,"Message reference must be in range"),r[o]});throw n=new Error(i),n.index=se,n.description=i,n}function fF(e){e.type===eC&&Dt(e,Wgt),e.type===jg&&Dt(e,Bgt),e.type===tC&&Dt(e,zgt),e.type===qp&&Dt(e,Ugt),e.type===Hh&&Dt(e,jgt),Dt(e,Ur,e.value)}function $i(e){var t=us();(t.type!==rs||t.value!==e)&&fF(t)}function ln(e){return Wt.type===rs&&Wt.value===e}function fR(e){return Wt.type===Hh&&Wt.value===e}function fmt(){var e=[];for(se=Wt.start,$i("[");!ln("]");)ln(",")?(us(),e.push(null)):(e.push(Xp()),ln("]")||$i(","));return us(),omt(e)}function PZ(){var e;return se=Wt.start,e=us(),e.type===tC||e.type===jg?(e.octal&&Dt(e,L0e),ox(e)):Oj(e.value)}function hmt(){var e,t,n,r;if(se=Wt.start,e=Wt,e.type===qp)return n=PZ(),$i(":"),r=Xp(),LZ("init",n,r);if(e.type===eC||e.type===rs)fF(e);else return t=PZ(),$i(":"),r=Xp(),LZ("init",t,r)}function dmt(){var e=[],t,n,r,i={},s=String;for(se=Wt.start,$i("{");!ln("}");)t=hmt(),t.key.type===M0e?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?Dt({},Vgt):i[r]=!0,e.push(t),ln("}")||$i(",");return $i("}"),lmt(e)}function pmt(){var e;return $i("("),e=Rj(),$i(")"),e}var gmt={if:1};function mmt(){var e,t,n;if(ln("("))return pmt();if(ln("["))return fmt();if(ln("{"))return dmt();if(e=Wt.type,se=Wt.start,e===qp||gmt[Wt.value])n=Oj(us().value);else if(e===tC||e===jg)Wt.octal&&Dt(Wt,L0e),n=ox(us());else{if(e===Hh)throw new Error(y2);e===uF?(t=us(),t.value=t.value==="true",n=ox(t)):e===lF?(t=us(),t.value=null,n=ox(t)):ln("/")||ln("/=")?(n=ox(imt()),U0e()):fF(us())}return n}function ymt(){var e=[];if($i("("),!ln(")"))for(;se<wi&&(e.push(Xp()),!ln(")"));)$i(",");return $i(")"),e}function bmt(){var e;return se=Wt.start,e=us(),smt(e)||fF(e),Oj(e.value)}function xmt(){return $i("."),bmt()}function vmt(){var e;return $i("["),e=Rj(),$i("]"),e}function wmt(){var e,t,n;for(e=mmt();;)if(ln("."))n=xmt(),e=MZ(".",e,n);else if(ln("("))t=ymt(),e=amt(e,t);else if(ln("["))n=vmt(),e=MZ("[",e,n);else break;return e}function BZ(){var e=wmt();if(Wt.type===rs&&(ln("++")||ln("--")))throw new Error(y2);return e}function Ak(){var e,t;if(Wt.type!==rs&&Wt.type!==Hh)t=BZ();else{if(ln("++")||ln("--"))throw new Error(y2);if(ln("+")||ln("-")||ln("~")||ln("!"))e=us(),t=Ak(),t=cmt(e.value,t);else{if(fR("delete")||fR("void")||fR("typeof"))throw new Error(y2);t=BZ()}}return t}function zZ(e){var t=0;if(e.type!==rs&&e.type!==Hh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function $mt(){var e,t,n,r,i,s,o,a,u,l;if(e=Wt,u=Ak(),r=Wt,i=zZ(r),i===0)return u;for(r.prec=i,us(),t=[e,Wt],o=Ak(),s=[u,r,o];(i=zZ(Wt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=RZ(a,u,o),s.push(n);r=us(),r.prec=i,s.push(r),t.push(Wt),n=Ak(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=RZ(s[l-1].value,s[l-2],n),l-=2;return n}function Xp(){var e,t,n;return e=$mt(),ln("?")&&(us(),t=Xp(),$i(":"),n=Xp(),e=umt(e,t,n)),e}function Rj(){var e=Xp();if(ln(","))throw new Error(y2);return e}function Cmt(e){Fe=e,se=0,wi=Fe.length,Wt=null,U0e();var t=Rj();if(Wt.type!==eC)throw new Error("Unexpect token after expression.");return t}function Ey(e,t,n){return e.fields=t||[],e.fname=n,e}function Smt(e){return e.length===1?kmt(e[0]):Emt(e)}const kmt=e=>function(t){return t[e]},Emt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function hR(e){throw Error(e)}function Amt(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||hR("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&hR("Access path missing closing bracket: "+e),r&&hR("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function _mt(e,t,n){const r=Amt(e);return e=r.length===1?r[0]:e,Ey((n&&n.get||Smt)(r),[e],t||e)}_mt("id");Ey(e=>e,[],"identity");Ey(()=>0,[],"zero");Ey(()=>1,[],"one");Ey(()=>!0,[],"true");Ey(()=>!1,[],"false");function rP(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...rP(e.object)),t.push(...rP(e.property))),t)}function j0e(e){return e.object.type==="MemberExpression"?j0e(e.object):e.object.name==="datum"}function W0e(e){const t=Cmt(e),n=new Set;return t.visit(r=>{r.type==="MemberExpression"&&j0e(r)&&n.add(rP(r).slice(1).join("."))}),n}class Ay extends Yt{constructor(t,n,r){super(t),this.model=n,this.filter=r,this.expr=JA(this.model,this.filter,this),this._dependentFields=W0e(this.expr)}clone(){return new Ay(null,this.model,ft(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Tmt(e,t){var n;const r={},i=e.config.selection;for(const s of pe(t??{})){const o=ft(t[s]),a=i[o.type],u=Pe(a,["fields","encodings"]);for(const f in u)f==="encodings"&&o.fields||f==="fields"&&o.encodings||(f==="mark"&&(o[f]=Object.assign(Object.assign({},u[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=u[f])!==null&&n!==void 0?n:o[f]));const l=mn(s),c=r[l]=Object.assign(Object.assign({},o),{name:l,events:ct(o.on)?Og(o.on,"scope"):ft(o.on)});aF(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[s])})}return r}function V0e(e,t,n,r="datum"){const i=[];function s(a){const u=mn(a),l=e.getSelectionComponent(u,a),c=wt(u+Hp);if(l.project.timeUnit){const f=n??e.component.data.raw,h=l.project.timeUnit.clone();f.parent?h.insertAsParentOf(f):f.parent=h}return l.empty!=="none"&&i.push(c),`vlSelectionTest(${c}, ${r}`+(l.resolve==="global"?")":`, ${wt(l.resolve)})`)}const o=Fx(t,s);return(i.length?"!("+i.map(a=>`length(data(${a}))`).join(" || ")+") || ":"")+`(${o})`}function G0e(e,t){const n=t.encoding;let r=t.field;if(!n&&!r)r=e.project.items[0].field,e.project.items.length>1&&fe(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${wt(r)}.`);else if(n&&!r){const i=e.project.items.filter(s=>s.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,fe((i.length?"Multiple ":"No ")+`matching ${wt(n)} encoding found for selection ${wt(t.selection)}. Using "field": ${wt(r)}.`)):r=i[0].field}return`${e.name}[${wt(r)}]`}function Imt(e,t){Ug(e,n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new Pi(new Ay(t,e,{selection:r}),i,"lookup",e.component.data.outputNodeRefCounts)})}function JA(e,t,n){return Fx(t,r=>ct(r)?r:yht(r)?V0e(e,r.selection,n):dme(r))}function Dmt(e,t){if(e)return Ue(e)&&!qc(e)?e.map(n=>Pme(n,t)).join(", "):e}function dR(e,t,n,r){var i,s,o;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=r}function ax(e,t,n,r={header:!1}){var i,s;const o=e.combine(),{disable:a,orient:u,scale:l,labelExpr:c,title:f,zindex:h}=o,d=Pe(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const p in d){const g=gct[p],m=d[p];if(g&&g!==t&&g!=="both")delete d[p];else if(PU(m)){const{condition:y}=m,b=Pe(m,["condition"]),v=Ln(y),x=KK[p];if(x){const{vgProp:w,part:C}=x,$=[...v.map(S=>{const{test:k}=S,E=Pe(S,["test"]);return Object.assign({test:JA(null,k)},E)}),b];dR(d,C,w,$),delete d[p]}else if(x===null){const w={signal:v.map(C=>{const{test:$}=C,S=Pe(C,["test"]);return`${JA(null,$)} ? ${pZ(S)} : `}).join("")+pZ(b)};d[p]=w}}else if(Xe(m)){const y=KK[p];if(y){const{vgProp:b,part:v}=y;dR(d,v,b,m),delete d[p]}}}if(t==="grid"){if(!d.grid)return;if(d.encode){const{grid:p}=d.encode;d.encode=Object.assign({},p?{grid:p}:{}),Jt(d.encode)&&delete d.encode}return Object.assign(Object.assign({scale:l,orient:u},d),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Hn(h,0)})}else{if(!r.header&&e.mainExtracted)return;if(c!==void 0){let g=c;!((s=(i=d.encode)===null||i===void 0?void 0:i.labels)===null||s===void 0)&&s.update&&Xe(d.encode.labels.update.text)&&(g=N0(c,"datum.label",d.encode.labels.update.text.signal)),dR(d,"labels","text",{signal:g})}if(d.labelAlign===null&&delete d.labelAlign,d.encode){for(const g of Dge)e.hasAxisPart(g)||delete d.encode[g];Jt(d.encode)&&delete d.encode}const p=Dmt(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},p?{title:p}:{}),d),n.aria===!1?{aria:!1}:{}),{zindex:Hn(h,0)})}}}function H0e(e){const{axes:t}=e.component,n=[];for(const r of Fo)if(t[r]){for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const s=r==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Nmt(e,t){const{x:n=[],y:r=[]}=e;return[...n.map(i=>ax(i,"grid",t)),...r.map(i=>ax(i,"grid",t)),...n.map(i=>ax(i,"main",t)),...r.map(i=>ax(i,"main",t))].filter(i=>i)}const q0e={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},X0e={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Fmt=pe(q0e),Omt=pe(X0e);function UZ(e,t,n,r){return Object.assign.apply(null,[{},...e.map(i=>{if(i==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...pe(o),...pe(a)]),l={};for(const c of u.values())l[c]={signal:`${r.signal} === "${s}" ? ${d2(o[c])} : ${d2(a[c])}`};return l}return t[i]})])}function Rmt(e,t,n,r){const i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:Tht(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=Xe(n)?"axisOrient":"axis"+MN(n),a=[...i,...i.map(l=>s+l.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:UZ(a,r,e,n),vgAxisConfig:UZ(u,r,e,n),axisConfigStyle:Mmt([...u,...a],r)}}function Mmt(e,t){var n;const r=[{}];for(const i of e){let s=(n=t[i])===null||n===void 0?void 0:n.style;if(s){s=Ln(s);for(const o of s)r.push(t.style[o])}}return Object.assign.apply(null,r)}function iP(e,t,n,r={}){var i;const s=Wme(e,n,t.style);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((i=r[o])===null||i===void 0?void 0:i[e])!==void 0)return{configFrom:o,configValue:r[o][e]};return{}}const jZ={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return Sme(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return kme(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return ve(e)&&Fi(e.bin)?!1:(r=t.grid)!==null&&r!==void 0?r:Lmt(n,e)},gridScale:({model:e,channel:t})=>Pmt(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||K0e(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||Y0e(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return(r=e.labelFlush)!==null&&r!==void 0?r:zmt(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return(r=e.labelOverlap)!==null&&r!==void 0?r:Umt(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:Wmt({fieldOrDatumDef:r,scaleType:i,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const r=Z0e(t,n);if(r!==void 0)return r;const i=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Gme(i?[dZ(i)]:[],ve(o)?[dZ(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Vmt(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return(r=e.zindex)!==null&&r!==void 0?r:Gmt(n,t)}};function Lmt(e,t){return!ks(e)&&ve(t)&&!sn(t==null?void 0:t.bin)}function Pmt(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function Bmt(e,t,n,r,i){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return Xe(s)?s:LA(s);{const{configValue:o}=iP("labelAngle",e.config,t==null?void 0:t.style,i);return o!==void 0?LA(o):n===Cn&&We([rj,nj],r.type)?270:void 0}}function sP(e){return`(((${e.signal} % 360) + 360) % 360)`}function Y0e(e,t,n,r){if(e!==void 0)if(n==="x"){if(Xe(e)){const i=sP(e),s=Xe(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Xe(t)){const i=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${i} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(Xe(e)){const i=sP(e),s=Xe(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${i} && ${i} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(Xe(t)){const i=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function K0e(e,t,n){if(e===void 0)return;const r=n==="x",i=r?0:90,s=r?"bottom":"left";if(Xe(e)){const o=sP(e),a=Xe(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${i?"("+o+" + 90)":o} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${o} && ${o} < ${180+i}) === ${a} ? "left" : "right"`}}if((e+i)%180===0)return r?null:"center";if(Xe(t)){const o=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${o} "${s}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===s)?"left":"right"}function zmt(e,t){if(t==="x"&&We(["quantitative","temporal"],e))return!0}function Umt(e,t){if(e!=="nominal")return t==="log"?"greedy":!0}function jmt(e){return e==="x"?"bottom":"left"}function Wmt({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!ks(t)&&t!=="log"){if(ve(e)){if(sn(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&We(["month","hours","day","quarter"],(i=Vi(e.timeUnit))===null||i===void 0?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function Z0e(e,t){const n=t==="x"?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),s=r?r.title:void 0,o=i?i.title:void 0;if(s&&o)return Hme(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function Vmt(e,t){const n=e.values;if(Ue(n))return zme(t,n);if(Xe(n))return n}function Gmt(e,t){return e==="rect"&&Fme(t)?1:0}class L0 extends Yt{constructor(t,n){super(t),this.transform=n,this._dependentFields=W0e(this.transform.calculate)}clone(){return new L0(null,ft(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((r,i)=>{if(hj(r)&&Tme(r.sort)){const{field:s,timeUnit:o}=r,a=r.sort,u=a.map((l,c)=>`${dme({field:s,timeUnit:o,equal:l})} ? ${c} : `).join("")+a.length;t=new L0(t,{calculate:u,as:P0(r,i,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${St(this.transform)}`}}function P0(e,t,n){return me(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function hF(e,t){return We(["top","bottom"],t)?"column":We(["left","right"],t)||e==="row"?"row":"column"}function B0(e,t,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return Hn(((t==null?void 0:t.header)||{})[e],i[e],n.header[e])}function dF(e,t,n,r){const i={};for(const s of e){const o=B0(s,t,n,r);o!==void 0&&(i[s]=o)}return i}const Mj=["row","column"],Lj=["header","footer"];function Hmt(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=dF(["titleAnchor","titleAngle","titleOrient"],i,r,t),u=hF(t,a),l=LA(o);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Q0e(l,u)),J0e(u,l,s)),e1e(r,i,t,Fmt,q0e))}}function J0e(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=K0e(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function Q0e(e,t){const n=Y0e(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function qmt(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of Lj)if(n[i])for(const s of n[i]){const o=Ymt(e,t,i,n,s);o!=null&&r.push(o)}return r}function Xmt(e,t){var n;const{sort:r}=e;return bu(r)?{field:me(r,{expr:"datum"}),order:(n=r.order)!==null&&n!==void 0?n:"ascending"}:Ue(r)?{field:P0(e,t,{expr:"datum"}),order:"ascending"}:{field:me(e,{expr:"datum"}),order:r??"ascending"}}function oP(e,t,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=dF(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),l=oj({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=hF(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?N0(N0(u,"datum.label",l),"datum.value",me(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Q0e(s,c)),J0e(c,s,o)),e1e(n,e,t,Omt,X0e))}function Ymt(e,t,n,r,i){if(i){let s=null;const{facetFieldDef:o}=r,a=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:f}=dF(["labelOrient"],o,a,t);(t==="row"&&!We(["top","bottom"],f)||t==="column"&&!We(["left","right"],f))&&(s=oP(o,t,a))}const u=xa(e)&&!Y$(e.facet),l=i.axes,c=(l==null?void 0:l.length)>0;if(s||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:Xmt(o,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),i.sizeSignal?{encode:{update:{[f]:i.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const Kmt={column:{start:0,end:1},row:{start:1,end:0}};function Zmt(e,t){return Kmt[t][e]}function Jmt(e,t){const n={};for(const r of xo){const i=e[r];if(i!=null&&i.facetFieldDef){const{titleAnchor:s,titleOrient:o}=dF(["titleAnchor","titleOrient"],i.facetFieldDef,t,r),a=hF(r,o),u=Zmt(s,a);u!==void 0&&(n[a]=u)}}return Jt(n)?void 0:n}function e1e(e,t,n,r,i){const s={};for(const o of r){if(!i[o])continue;const a=B0(o,t,e,n);a!==void 0&&(s[i[o]]=a)}return s}function Pj(e){return[...$S(e,"width"),...$S(e,"height"),...$S(e,"childWidth"),...$S(e,"childHeight")]}function $S(e,t){const n=t==="width"?"x":"y",r=e.component.layoutSize.get(t);if(!r||r==="merged")return[];const i=e.getSizeSignalRef(t).signal;if(r==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(ks(o)&&Vh(a)){const u=e.scaleName(n);return xa(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[WZ(u,a)]:[WZ(u,a),{name:i,update:t1e(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(r=="container"){const s=i.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=KL(e.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:i,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:i,value:r}]}function WZ(e,t){return{name:e+"_step",value:t.step}}function t1e(e,t,n){const r=t.get("type"),i=t.get("padding"),s=Hn(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o=r==="band"?o!==void 0?o:i:1,`bandspace(${n}, ${o}, ${s}) * ${e}_step`}function n1e(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function r1e(e,t){return pe(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),J$(t,i,r,s=>Xe(s)?s:{value:s.value}))},{})}function Qmt(e,t){if(Iy(t)||xa(t))return"shared";if(Wj(t))return Mu(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function Bj(e,t){const n=e.scale[t],r=Mu(t)?"axis":"legend";return n==="independent"?(e[r][t]==="shared"&&fe(Mft(t)),"independent"):e[r][t]||"shared"}const e0t=Object.assign(Object.assign({},Tdt),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),i1e=pe(e0t);class t0t extends _c{}const VZ={symbols:n0t,gradient:r0t,labels:i0t,entries:s0t};function n0t(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:s}){var o,a,u,l,c;if(s!=="symbol")return;const{markDef:f,encoding:h,config:d,mark:p}=n,g=f.filled&&p!=="trail";let m=Object.assign(Object.assign({},udt({},n,$ct)),w0e(n,{filled:g}));const y=(o=s1e(h.opacity))!==null&&o!==void 0?o:f.opacity;if(m.fill){if(r==="fill"||g&&r===Cs)delete m.fill;else if(m.fill.field)i.get("symbolFillColor")?delete m.fill:(m.fill=On((a=d.legend.symbolBaseFillColor)!==null&&a!==void 0?a:"black"),m.fillOpacity=On(y??1));else if(Ue(m.fill)){const b=(c=(l=aP((u=h.fill)!==null&&u!==void 0?u:h.color))!==null&&l!==void 0?l:f.fill)!==null&&c!==void 0?c:g&&f.color;b&&(m.fill=On(b))}}if(m.stroke){if(r==="stroke"||!g&&r===Cs)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(Ue(m.stroke)){const b=Hn(aP(h.stroke||h.color),f.stroke,g?f.color:void 0);b&&(m.stroke={value:b})}}if(r!==Ac){const b=ve(t)&&a1e(n,i,t);b?m.opacity=[Object.assign({test:b},On(y??1)),On(d.legend.unselectedOpacity)]:y&&(m.opacity=On(y))}return m=Object.assign(Object.assign({},m),e),Jt(m)?void 0:m}function r0t(e,{model:t,legendType:n}){if(n!=="gradient")return;let r={};const i=s1e(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=On(i)),r=Object.assign(Object.assign({},r),e),Jt(r)?void 0:r}function i0t(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},o=n.config,a=ve(t)?a1e(n,i,t):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s,f=Vp(c)?aj({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:o}):void 0,h=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return Jt(h)?void 0:h}function s0t(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function s1e(e){return o1e(e,(t,n)=>Math.max(t,n.value))}function aP(e){return o1e(e,(t,n)=>Hn(t,n.value))}function o1e(e,t){if(Jht(e))return Ln(e.condition).reduce(t,e.value);if(fc(e))return e.value}function a1e(e,t,n){const r=t.get("selections");if(!(r!=null&&r.length))return;const i=wt(n.field);return r.map(s=>`(!length(data(${wt(mn(s)+Hp)})) || (${s}[${i}] && indexof(${s}[${i}], datum.value) >= 0))`).join(" || ")}const GZ={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return Sme(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return kme(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:h0t(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return(i=(r=e.labelOverlap)!==null&&r!==void 0?r:t.labelOverlap)!==null&&i!==void 0?i:d0t(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return(i=e.symbolType)!==null&&i!==void 0?i:a0t(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>op(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(zm(n)&&da(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>o0t(t,e)};function o0t(e,t){const n=e.values;if(Ue(n))return zme(t,n);if(Xe(n))return n}function a0t(e,t,n,r){var i;if(t!=="shape"){const s=(i=aP(n))!==null&&i!==void 0?i:r;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function u0t(e){const{legend:t}=e;return Hn(t.type,l0t(e))}function l0t({channel:e,timeUnit:t,scaleType:n}){if(zm(e)){if(We(["quarter","month","day"],t))return"symbol";if(da(n))return"gradient"}return"symbol"}function c0t({legendConfig:e,legendType:t,orient:n,legend:r}){var i,s;return(s=(i=r.direction)!==null&&i!==void 0?i:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:f0t(n,t)}function f0t(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function h0t({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(da(i))return n==="horizontal"?r==="top"||r==="bottom"?HZ(t,"width",o,s):o:HZ(t,"height",u,a)}function HZ(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function d0t(e){if(We(["quantile","threshold","log"],e))return"greedy"}function u1e(e){const t=En(e)?p0t(e):b0t(e);return e.component.legends=t,t}function p0t(e){const{encoding:t}=e,n={};for(const r of[Cs,...a0e]){const i=er(t[r]);!i||!e.getScaleComponent(r)||r===Ss&&ve(i)&&i.type===ky||(n[r]=y0t(e,r))}return n}function g0t(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function m0t(e,t,n,r){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(r==null?void 0:r.title))return!0}return e===(n||{})[t]}function y0t(e,t){var n,r,i;let s=e.legend(t);const{markDef:o,encoding:a,config:u}=e,l=u.legend,c=new t0t({},g0t(e,t));Jpt(e,t,c);const f=s!==void 0?!s:l.disable;if(c.set("disable",f,s!==void 0),f)return c;s=s||{};const h=e.getScaleComponent(t).get("type"),d=er(a[t]),p=ve(d)?(n=Vi(d.timeUnit))===null||n===void 0?void 0:n.unit:void 0,g=s.orient||u.legend.orient||"right",m=u0t({legend:s,channel:t,timeUnit:p,scaleType:h}),y=c0t({legend:s,legendType:m,orient:g,legendConfig:l}),b={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:d,legendConfig:l,config:u,scaleType:h,orient:g,legendType:m,direction:y};for(const $ of i1e){const S=$ in GZ?GZ[$](b):s[$];if(S!==void 0){const k=m0t(S,$,s,e.fieldDef(t));(k||u.legend[$]===void 0)&&c.set($,S,k)}}const v=(r=s==null?void 0:s.encoding)!==null&&r!==void 0?r:{},x=c.get("selections"),w={},C={fieldOrDatumDef:d,model:e,channel:t,legendCmpt:c,legendType:m};for(const $ of["labels","legend","title","symbols","gradient","entries"]){const S=r1e((i=v[$])!==null&&i!==void 0?i:{},e),k=$ in VZ?VZ[$](S,C):S;k!==void 0&&!Jt(k)&&(w[$]=Object.assign(Object.assign(Object.assign({},x!=null&&x.length&&ve(d)?{name:`${mn(d.field)}_legend_${$}`}:{}),x!=null&&x.length?{interactive:!!x}:{}),{update:k}))}return Jt(w)||c.set("encode",w,!!(s!=null&&s.encoding)),c}function b0t(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){u1e(r);for(const i of pe(r.component.legends))n.legend[i]=Bj(e.component.resolve,i),n.legend[i]==="shared"&&(t[i]=l1e(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of pe(t))for(const i of e.children)i.component.legends[r]&&n.legend[r]==="shared"&&delete i.component.legends[r];return t}function l1e(e,t){var n,r,i,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let u=!1;for(const l of i1e){const c=fh(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,h)=>{switch(l){case"symbolType":return x0t(f,h);case"title":return qme(f,h);case"type":return u=!0,Rs("symbol")}return sF(f,h,l,"legend")});e.setWithExplicit(l,c)}return u&&(!((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0)&&r.gradient&&VL(e.implicit,["encode","gradient"]),!((s=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||s===void 0)&&s.gradient&&VL(e.explicit,["encode","gradient"])),e}function x0t(e,t){return t.value==="circle"?t:e}function qZ(e,t,n,r){var i,s,o;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=r}function c1e(e){const t=e.component.legends,n={};for(const i of pe(t)){const s=e.getScaleComponent(i),o=gn(s.get("domains"));if(n[o])for(const a of n[o])l1e(a,t[i])||n[o].push(t[i]);else n[o]=[t[i].clone()]}return Sf(n).flat().map(i=>v0t(i,e.config)).filter(i=>i!==void 0)}function v0t(e,t){var n,r,i;const s=e.combine(),{disable:o,labelExpr:a,selections:u}=s,l=Pe(s,["disable","labelExpr","selections"]);if(!o){if(t.aria===!1&&l.aria==null&&(l.aria=!1),!((n=l.encode)===null||n===void 0)&&n.symbols){const c=l.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!l.stroke&&(c.stroke={value:"transparent"});for(const f of a0e)l[f]&&delete c[f]}if(l.title||delete l.title,a!==void 0){let c=a;!((i=(r=l.encode)===null||r===void 0?void 0:r.labels)===null||i===void 0)&&i.update&&Xe(l.encode.labels.update.text)&&(c=N0(a,"datum.label",l.encode.labels.update.text.signal)),qZ(l,"labels","text",{signal:c})}for(const c in l){const f=l[c];if(Xe(f)){const h=Adt[c];if(h){const{vgProp:d,part:p}=h;qZ(l,p,d,f),delete l[c]}}}return l}}function w0t(e){return Iy(e)||Wj(e)?$0t(e):f1e(e)}function $0t(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),f1e(e))}function f1e(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const u=Xe(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return We(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const C0t=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class h1e extends _c{constructor(t,n,r,i){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=r,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function d1e(e){e.component.projection=En(e)?S0t(e):A0t(e)}function S0t(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(n.scale!=null||n.translate!=null)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=r?k0t(e):void 0;return new h1e(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),i,s)}}function k0t(e){const t=[],{encoding:n}=e;for(const r of[[rl,nl],[No,Ua]])(er(n[r[0]])||er(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Ss)&&e.typedFieldDef(Ss).type===ky&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(ri)),t}function E0t(e,t){const n=kge(C0t,i=>!!(!Wd(e.explicit,i)&&!Wd(t.explicit,i)||Wd(e.explicit,i)&&Wd(t.explicit,i)&&gn(e.get(i))===gn(t.get(i))));if(gn(e.size)===gn(t.size)){if(n)return e;if(gn(e.explicit)===gn({}))return t;if(gn(t.explicit)===gn({}))return e}return null}function A0t(e){if(e.children.length===0)return;let t;for(const r of e.children)d1e(r);const n=kge(e.children,r=>{const i=r.component.projection;if(i)if(t){const s=E0t(t,i);return s&&(t=s),!!s}else return t=i,!0;else return!0});if(t&&n){const r=e.projectionName(!0),i=new h1e(r,t.specifiedProjection,t.size,ft(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&i.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),r),o.merged=!0)}return i}}function _0t(e,t,n,r){var i,s;if(Z$(t,n)){const o=En(e)?(s=(i=e.axis(n))!==null&&i!==void 0?i:e.legend(n))!==null&&s!==void 0?s:{}:{},a=me(t,{expr:"datum"}),u=me(t,{expr:"datum",binSuffix:"end"});return{formulaAs:me(t,{binSuffix:"range",forAs:!0}),formula:ZN(a,u,o.format,o.formatType,r)}}return{}}function p1e(e,t){return`${Yge(e)}_${t}`}function T0t(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function zj(e,t,n){var r;const i=(r=tF(n,void 0))!==null&&r!==void 0?r:{},s=p1e(i,t);return e.getName(`${s}_bins`)}function I0t(e){return"as"in e}function XZ(e,t,n){let r,i;I0t(e)?r=ct(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:r=[me(e,{forAs:!0}),me(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},tF(t,void 0)),o=p1e(s,e.field),{signal:a,extentSignal:u}=T0t(n,o);if(YN(s.extent)){const c=s.extent,f=c.selection;i=G0e(n.getSelectionComponent(mn(f),f),c),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[r]},a?{signal:a}:{}),u?{extentSignal:u}:{}),i?{span:i}:{});return{key:o,binComponent:l}}class vu extends Yt{constructor(t,n){super(t),this.bins=n}clone(){return new vu(null,ft(this.bins))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,o)=>{if(Js(s)&&sn(s.bin)){const{key:a,binComponent:u}=XZ(s,s.bin,n);i[a]=Object.assign(Object.assign(Object.assign({},u),i[a]),_0t(n,s,o,n.config))}return i},{});return Jt(r)?null:new vu(t,r)}static makeFromTransform(t,n,r){const{key:i,binComponent:s}=XZ(n,n.bin,r);return new vu(t,{[i]:s})}merge(t,n){for(const r of pe(t.bins))r in this.bins?(n(t.bins[r].signal,this.bins[r].signal),this.bins[r].as=ff([...this.bins[r].as,...t.bins[r].as],St)):this.bins[r]=t.bins[r];for(const r of t.children)t.removeChild(r),r.parent=this;t.remove()}producedFields(){return new Set(Sf(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Sf(this.bins).map(t=>t.field))}hash(){return`Bin ${St(this.bins)}`}assemble(){return Sf(this.bins).flatMap(t=>{const n=[],[r,...i]=t.as,s=t.bin,{extent:o}=s,a=Pe(s,["extent"]),u=Object.assign(Object.assign(Object.assign({type:"bin",field:uh(t.field),as:r,signal:t.signal},YN(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:uh(t.field),signal:t.extentSignal}),u.extent={signal:t.extentSignal}),n.push(u);for(const l of i)for(let c=0;c<2;c++)n.push({type:"formula",expr:me({field:r[c]},{expr:"datum"}),as:l[c]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class z0 extends Yt{constructor(t){super(null),t=t??{name:"source"};let n;if(up(t)||(n=t.format?Object.assign({},Yl(t.format,["parse"])):{}),qA(t))this._data={values:t.values};else if(g2(t)){if(this._data={url:t.url},!n.type){let r=/(?:\.([^.]+))?$/.exec(t.url)[1];We(["json","csv","tsv","dsv","topojson"],r)||(r="json"),n.type=r}}else y0e(t)?this._data={values:[{type:"Sphere"}]}:(g0e(t)||up(t))&&(this._data={});this._generator=up(t),t.name&&(this._name=t.name),n&&!Jt(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function uP(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!uP(t.children))return!1}return!0}class rC extends Yt{constructor(t,n){super(t),this.params=n}clone(){return new rC(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${St(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class iC extends Yt{constructor(t,n){super(t),this.params=n}clone(){return new iC(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${St(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function pF(e){return e instanceof z0||e instanceof rC||e instanceof iC}class g1e{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Tc extends g1e{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(pF(t))return!1;const n=t.parent,{continueFlag:r}=this.run(t);return r&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class Uj extends g1e{}function D0t(e,t,n,r){const i=En(r)?r.encoding[ol(t)]:void 0;if(Js(n)&&En(r)&&lj(t,n,i,r.stack,r.markDef,r.config))e.add(me(n,{})),e.add(me(n,{suffix:"end"})),n.bin&&Z$(n,t)&&e.add(me(n,{binSuffix:"range"}));else if(zct(t)){const s=Bct(t);e.add(r.getName(s))}else e.add(me(n));return e}function N0t(e,t){var n;for(const r of pe(t)){const i=t[r];for(const s of pe(i))r in e?e[r][s]=new Set([...(n=e[r][s])!==null&&n!==void 0?n:[],...i[s]]):e[r]={[s]:i[s]}}}class ba extends Yt{constructor(t,n,r){super(t),this.dimensions=n,this.measures=r}clone(){return new ba(null,new Set(this.dimensions),ft(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let r=!1;n.forEachFieldDef(o=>{o.aggregate&&(r=!0)});const i={},s=new Set;return!r||(n.forEachFieldDef((o,a)=>{var u,l,c,f;const{aggregate:h,field:d}=o;if(h)if(h==="count")i["*"]=(u=i["*"])!==null&&u!==void 0?u:{},i["*"].count=new Set([me(o,{forAs:!0})]);else{if(lh(h)||Pg(h)){const p=lh(h)?"argmin":"argmax",g=h[p];i[g]=(l=i[g])!==null&&l!==void 0?l:{},i[g][p]=new Set([me({op:p,field:g},{forAs:!0})])}else i[d]=(c=i[d])!==null&&c!==void 0?c:{},i[d][h]=new Set([me(o,{forAs:!0})]);Wh(a)&&n.scaleDomain(a)==="unaggregated"&&(i[d]=(f=i[d])!==null&&f!==void 0?f:{},i[d].min=new Set([me({field:d,aggregate:"min"},{forAs:!0})]),i[d].max=new Set([me({field:d,aggregate:"max"},{forAs:!0})]))}else D0t(s,a,o,n)}),s.size+pe(i).length===0)?null:new ba(t,s,i)}static makeFromTransform(t,n){var r,i,s;const o=new Set,a={};for(const u of n.aggregate){const{op:l,field:c,as:f}=u;l&&(l==="count"?(a["*"]=(r=a["*"])!==null&&r!==void 0?r:{},a["*"].count=new Set([f||me(u,{forAs:!0})])):(a[c]=(i=a[c])!==null&&i!==void 0?i:{},a[c][l]=new Set([f||me(u,{forAs:!0})])))}for(const u of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(u);return o.size+pe(a).length===0?null:new ba(t,o,a)}merge(t){return uct(this.dimensions,t.dimensions)?(N0t(this.measures,t.measures),!0):(Jft("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...pe(this.measures)])}producedFields(){const t=new Set;for(const n of pe(this.measures))for(const r of pe(this.measures[n])){const i=this.measures[n][r];i.size===0?t.add(`${r}_${n}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${St({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],r=[];for(const s of pe(this.measures))for(const o of pe(this.measures[s]))for(const a of this.measures[s][o])r.push(a),t.push(o),n.push(s==="*"?null:uh(s));return{type:"aggregate",groupby:[...this.dimensions].map(uh),ops:t,fields:n,as:r}}}class _y extends Yt{constructor(t,n,r,i){super(t),this.model=n,this.name=r,this.data=i;for(const s of xo){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[me(o),...sn(a)?[me(o,{binSuffix:"end"})]:[]]},bu(u)?{sortField:u}:Ue(u)?{sortIndexField:P0(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of xo)this[n]&&(t+=` ${n.charAt(0)}:${St(this[n])}`);return t}get fields(){var t;const n=[];for(const r of xo)!((t=this[r])===null||t===void 0)&&t.fields&&n.push(...this[r].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of xo)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Fo){const r=this.childModel.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(ks(i)&&Vh(s)){const o=gF(this.childModel,n),a=jj(o);a?t[n]=a:fe(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,r){const i={row:"y",column:"x"}[t],s=[],o=[],a=[];r&&r[i]&&(n?(s.push(`distinct_${r[i]}`),o.push("max")):(s.push(r[i]),o.push("distinct")),a.push(`distinct_${r[i]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=JN,field:f}=u;s.push(f),o.push(c),a.push(me(u,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,r;const{columns:i}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const c of Mj){for(const f of Lj){const h=(n=s[c]&&s[c][f])!==null&&n!==void 0?n:[];for(const d of h)if(((r=d.axes)===null||r===void 0?void 0:r.length)>0){a[c]=!0;break}}if(a[c]){const f=`length(data("${this.facet.name}"))`,h=c==="row"?i?{signal:`ceil(${f} / ${i})`}:1:i?{signal:`min(${f}, ${i})`}:{signal:f};o.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:h}]})}}const{row:u,column:l}=a;return(u||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const r=[];let i=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:u}=this;if(o&&a&&(s.x||s.y)){i=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),c=l.map(()=>"distinct");r.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:c}]})}for(const l of[Zl,Kl])this[l]&&r.push(this.assembleRowColumnHeaderData(l,i,s));if(u){const l=this.assembleFacetHeaderData(s);l&&r.push(...l)}return r}}function YZ(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function F0t(e,t){const n=Tge(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const r=YZ(t.slice(5,t.length));return`timeParse(${n},'${r}')`}else if(t.indexOf("utc:")===0){const r=YZ(t.slice(4,t.length));return`utcParse(${n},'${r}')`}else return fe(cft(t)),null}function O0t(e){const t={};return Sk(e.filter,n=>{var r;if(hme(n)){let i=null;JU(n)?i=n.equal:QU(n)?i=n.range[0]:ej(n)&&(i=((r=n.oneOf)!==null&&r!==void 0?r:n.in)[0]),i&&(Cy(i)?t[n.field]="date":Gn(i)?t[n.field]="number":ct(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function R0t(e){const t={};function n(r){nF(r)?t[r.field]="date":r.type==="quantitative"&&Oct(r.aggregate)?t[r.field]="number":f2(r.field)>1?r.field in t||(t[r.field]="flatten"):hj(r)&&bu(r.sort)&&f2(r.sort.field)>1&&(r.sort.field in t||(t[r.sort.field]="flatten"))}if((En(e)||xa(e))&&e.forEachFieldDef((r,i)=>{if(Js(r))n(r);else{const s=zg(i),o=e.fieldDef(s);n(Object.assign(Object.assign({},r),{type:o.type}))}}),En(e)){const{mark:r,markDef:i,encoding:s}=e;if(Lg(r)&&!e.encoding.order){const o=i.orient==="horizontal"?"y":"x",a=s[o];ve(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function M0t(e){const t={};if(En(e)&&e.component.selection)for(const n of pe(e.component.selection)){const r=e.component.selection[n];for(const i of r.project.items)!i.channel&&f2(i.field)>1&&(t[i.field]="flatten")}return t}class di extends Yt{constructor(t,n){super(t),this._parse=n}clone(){return new di(null,ft(this._parse))}hash(){return`Parse ${St(this._parse)}`}static makeExplicit(t,n,r){let i={};const s=n.data;return!up(s)&&s&&s.format&&s.format.parse&&(i=s.format.parse),this.makeWithAncestors(t,i,{},r)}static makeWithAncestors(t,n,r,i){for(const a of pe(r)){const u=i.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===r[a]||u.value==="derived"||r[a]==="flatten"?delete r[a]:fe(oZ(a,r[a],u.value)))}for(const a of pe(n)){const u=i.get(a);u!==void 0&&(u===n[a]?delete n[a]:fe(oZ(a,n[a],u)))}const s=new _c(n,r);i.copyAll(s);const o={};for(const a of pe(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return pe(o).length===0||i.parseNothing?null:new di(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of pe(this._parse)){const r=this._parse[n];f2(n)===1&&(t[n]=r)}return t}producedFields(){return new Set(pe(this._parse))}dependentFields(){return new Set(pe(this._parse))}assembleTransforms(t=!1){return pe(this._parse).filter(n=>t?f2(n)>1:!0).map(n=>{const r=F0t(n,this._parse[n]);return r?{type:"formula",expr:r,as:Ige(n)}:null}).filter(n=>n!==null)}}class ph extends Yt{clone(){return new ph(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([R0])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:R0}}}class Wg extends Yt{constructor(t,n){super(t),this.transform=n}clone(){return new Wg(null,ft(this.transform))}addDimensions(t){this.transform.groupby=ff(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:me(t)}hash(){return`JoinAggregateTransform ${St(this.transform)}`}assemble(){const t=[],n=[],r=[];for(const s of this.transform.joinaggregate)n.push(s.op),r.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},i!==void 0?{groupby:i}:{})}}function L0t(e){return e.stack.stackBy.reduce((t,n)=>{const r=n.fieldDef,i=me(r);return i&&t.push(i),t},[])}function P0t(e){return Ue(e)&&e.every(t=>ct(t))&&e.length>1}class Ql extends Yt{constructor(t,n){super(t),this._stack=n}clone(){return new Ql(null,ft(this._stack))}static makeFromTransform(t,n){const{stack:r,groupby:i,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(Hn(f.order,"ascending"));const l={field:a,order:u};let c;return P0t(s)?c=s:ct(s)?c=[s,s+"_end"]:c=[n.stack+"_start",n.stack+"_end"],new Ql(t,{stackField:r,groupby:i,offset:o,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const r=n.stack,{encoding:i}=n;if(!r)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:u}=r;let l;if(s){const d=i[s];l=Lu(d)}const c=L0t(n),f=n.encoding.order;let h;return Ue(f)||ve(f)?h=Vme(f):h=c.reduce((d,p)=>(d.field.push(p),d.order.push(o==="y"?"descending":"ascending"),d),{field:[],order:[]}),new Ql(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:c,sort:h,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${St(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:r}=this._stack;return t?t.bin?n?[me(t,{binSuffix:"mid"})]:[me(t,{}),me(t,{binSuffix:"end"})]:[me(t)]:r??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:r,stackField:i,stackby:s,sort:o,offset:a,impute:u,as:l}=this._stack;if(u&&r){const{band:c=.5,bin:f}=r;f&&t.push({type:"formula",expr:`${c}*`+me(r,{expr:"datum"})+`+${1-c}*`+me(r,{expr:"datum",binSuffix:"end"}),as:me(r,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...s,...n],key:me(r,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:i,sort:o,as:l,offset:a}),t}}class Ty extends Yt{constructor(t,n){super(t),this.transform=n}clone(){return new Ty(null,ft(this.transform))}addDimensions(t){this.transform.groupby=ff(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const r=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(r.add,r),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(i=>r.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:me(t)}hash(){return`WindowTransform ${St(this.transform)}`}assemble(){var t;const n=[],r=[],i=[],s=[];for(const h of this.transform.window)r.push(h.op),i.push(this.getDefaultName(h)),s.push(h.param===void 0?null:h.param),n.push(h.field===void 0?null:h.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&r.every(h=>jU(h)))return Object.assign({type:"joinaggregate",as:i,ops:r,fields:n},a!==void 0?{groupby:a}:{});const u=[],l=[];if(this.transform.sort!==void 0)for(const h of this.transform.sort)u.push(h.field),l.push((t=h.order)!==null&&t!==void 0?t:"ascending");const c={field:u,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:i,ops:r,fields:n,sort:c},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}class B0t extends Tc{run(t){const n=t.parent;if(t instanceof di){if(pF(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof di)this.setMutated(),n.merge(t);else{if(Age(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class z0t extends Uj{mergeNodes(t,n){const r=n.shift();for(const i of n)t.removeChild(i),i.parent=r,i.remove()}run(t){const n=t.children.map(i=>i.hash()),r={};for(let i=0;i<n.length;i++)r[n[i]]===void 0?r[n[i]]=[t.children[i]]:r[n[i]].push(t.children[i]);for(const i of pe(r))r[i].length>1&&(this.setMutated(),this.mergeNodes(t,r[i]));for(const i of t.children)this.run(i);return this.mutatedFlag}}class U0t extends Tc{run(t){return t instanceof Pi||t.numChildren()>0||t instanceof _y?this.flags:(this.setMutated(),t.remove(),this.flags)}}class j0t extends Tc{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof xu){const n=t.producedFields();Ege(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class W0t extends Tc{run(t){this.setContinue();const r=t.parent.children.filter(s=>s instanceof xu),i=r.pop();for(const s of r)this.setMutated(),i.merge(s);return this.flags}}function V0t(e){function t(n){if(!(n instanceof _y)){const r=n.clone();if(r instanceof Pi){const i=cP+r.getSource();r.setSource(i),e.model.component.data.outputNodes[i]=r}else(r instanceof ba||r instanceof Ql||r instanceof Ty||r instanceof Wg)&&r.addDimensions(e.fields);for(const i of n.children.flatMap(t))i.parent=r;return[r]}return n.children.flatMap(t)}return t}function lP(e){if(e instanceof _y)if(e.numChildren()===1&&!(e.children[0]instanceof Pi)){const t=e.children[0];(t instanceof ba||t instanceof Ql||t instanceof Ty||t instanceof Wg)&&t.addDimensions(e.fields),t.swapWithParent(),lP(e)}else{const t=e.model.component.data.main;m1e(t);const n=V0t(e),r=e.children.map(n).flat();for(const i of r)i.parent=t}else e.children.map(lP)}function m1e(e){if(e instanceof Pi&&e.type===ri&&e.numChildren()===1){const t=e.children[0];t instanceof _y||(t.swapWithParent(),m1e(e))}}class G0t extends Uj{constructor(){super()}run(t){t instanceof Pi&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class H0t extends Uj{constructor(t){super(),this.requiresSelectionId=t&&Nj(t)}run(t){t instanceof ph&&(this.requiresSelectionId&&(pF(t.parent)||t.parent instanceof ba||t.parent instanceof di)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class q0t extends Tc{run(t){const n=t.parent,r=[...n.children],i=n.children.filter(s=>s instanceof di);if(n.numChildren()>1&&i.length>=1){const s={},o=new Set;for(const a of i){const u=a.parse;for(const l of pe(u))l in s?s[l]!==u[l]&&o.add(l):s[l]=u[l]}for(const a of o)delete s[a];if(!Jt(s)){this.setMutated();const a=new di(n,s);for(const u of r){if(u instanceof di)for(const l of pe(s))delete u.parse[l];n.removeChild(u),u.parent=a,u instanceof di&&pe(u.parse).length===0&&u.remove()}}}return this.setContinue(),this.flags}}class X0t extends Tc{run(t){const n=t.parent,r=n.children.filter(s=>s instanceof ba),i={};for(const s of r){const o=St(s.groupBy);o in i||(i[o]=[]),i[o].push(s)}for(const s of pe(i)){const o=i[s];if(o.length>1){const a=o.pop();for(const u of o)a.merge(u)&&(n.removeChild(u),u.parent=a,u.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class Y0t extends Tc{constructor(t){super(),this.model=t}run(t){const n=t.parent,r=!(pF(n)||n instanceof Ay||n instanceof di||n instanceof ph),i=[],s=[];for(const o of n.children)o instanceof vu&&(r&&!Age(n.producedFields(),o.dependentFields())?i.push(o):s.push(o));if(i.length>0){const o=i.pop();for(const a of i)o.merge(a,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof vu?n.merge(o,this.model.renameSignal.bind(this.model)):o.swapWithParent()}if(s.length>1){const o=s.pop();for(const a of s)o.merge(a,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class K0t extends Tc{run(t){const n=t.parent,r=[...n.children];if(!c2(r,a=>a instanceof Pi)||n.numChildren()<=1)return this.setContinue(),this.flags;const s=[];let o;for(const a of r)if(a instanceof Pi){let u=a;for(;u.numChildren()===1;){const l=u.children[0];if(l instanceof Pi)u=l;else break}s.push(...u.children),o?(n.removeChild(a),a.parent=o.parent,o.parent.removeChild(o),o.parent=u,this.setMutated()):o=u}else s.push(a);if(s.length){this.setMutated();for(const a of s)a.parent.removeChild(a),a.parent=o}return this.setContinue(),this.flags}}const cP="scale_",CS=5;function Pc(e){const t=[];function n(r){if(r.numChildren()===0)t.push(r);else for(const i of r.children)n(i)}for(const r of e)n(r);return t}function Z0t(e){return e}function Vo(e,t){return t.map(r=>{if(e instanceof Tc){const i=e.optimizeNextFromLeaves(r);return e.reset(),i}else return e.run(r)}).some(Z0t)}function KZ(e,t){let n=e.sources;const r=new Set;return r.add(Vo(new G0t,n)),r.add(Vo(new H0t(t),n)),n=n.filter(i=>i.numChildren()>0),r.add(Vo(new U0t,Pc(n))),n=n.filter(i=>i.numChildren()>0),r.add(Vo(new B0t,Pc(n))),r.add(Vo(new Y0t(t),Pc(n))),r.add(Vo(new j0t,Pc(n))),r.add(Vo(new q0t,Pc(n))),r.add(Vo(new X0t,Pc(n))),r.add(Vo(new W0t,Pc(n))),r.add(Vo(new z0t,n)),r.add(Vo(new K0t,Pc(n))),e.sources=n,r.has(!0)}function J0t(e,t){uP(e.sources);let n=0,r=0;for(let i=0;i<CS&&KZ(e,t);i++)n++;e.sources.map(lP);for(let i=0;i<CS&&KZ(e,t);i++)r++;uP(e.sources),Math.max(n,r)===CS&&fe(`Maximum optimization runs(${CS}) reached.`)}class Gs{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Gs(()=>t(n))}}function y1e(e){En(e)?Q0t(e):e1t(e)}function Q0t(e){const t=e.component.scales;for(const n of pe(t)){const r=n1t(e,n);if(t[n].setWithExplicit("domains",r),i1t(e,n),e.component.data.isFaceted){let s=e;for(;!xa(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of r.value)hf(a)&&(a.data=cP+a.data.replace(cP,""))}}}function e1t(e){for(const n of e.children)y1e(n);const t=e.component.scales;for(const n of pe(t)){let r,i=null;for(const s of e.children){const o=s.component.scales[n];if(o){r===void 0?r=o.getWithExplicit("domains"):r=fh(r,o.getWithExplicit("domains"),"domains","scale",fP);const a=o.get("selectionExtent");i&&a&&i.selection!==a.selection&&fe("The same selection must be used to override scale domains in a layered view."),i=a}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}function t1t(e,t,n,r){if(e==="unaggregated"){const{valid:i,reason:s}=ZZ(t,n);if(!i){fe(s);return}}else if(e===void 0&&r.useUnaggregatedDomain){const{valid:i}=ZZ(t,n);if(i)return"unaggregated"}return e}function n1t(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=t1t(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),t==="x"&&er(r.x2)?er(r.x)?fh(jc(n,i,e,"x"),jc(n,i,e,"x2"),"domain","scale",fP):jc(n,i,e,"x2"):t==="y"&&er(r.y2)?er(r.y)?fh(jc(n,i,e,"y"),jc(n,i,e,"y2"),"domain","scale",fP):jc(n,i,e,"y2"):jc(n,i,e,t)}function r1t(e,t,n){return e.map(r=>({signal:`{data: ${gj(r,{timeUnit:n,type:t})}}`}))}function pR(e,t,n){var r;const i=(r=Vi(n))===null||r===void 0?void 0:r.unit;return t==="temporal"||i?r1t(e,t,i):[e]}function jc(e,t,n,r){const{encoding:i}=n,s=er(i[r]),{type:o}=s,a=s.timeUnit;if(Pht(t)){const f=jc(e,void 0,n,r),h=pR(t.unionWith,o,a);return Vd([...f.value,...h])}else{if(Xe(t))return Vd([t]);if(t&&t!=="unaggregated"&&!gme(t))return Vd(pR(t,o,a))}const u=n.stack;if(u&&r===u.fieldChannel){if(u.offset==="normalize")return Rs([[0,1]]);const f=n.requestDataName(ri);return Rs([{data:f,field:n.vgField(r,{suffix:"start"})},{data:f,field:n.vgField(r,{suffix:"end"})}])}const l=Wh(r)&&ve(s)?s1t(n,r,e):void 0;if(Gh(s)){const f=pR([s.datum],o,a);return Rs(f)}const c=s;if(t==="unaggregated"){const f=n.requestDataName(ri),{field:h}=s;return Rs([{data:f,field:me({field:h,aggregate:"min"})},{data:f,field:me({field:h,aggregate:"max"})}])}else if(sn(c.bin)){if(ks(e))return Rs(e==="bin-ordinal"?[]:[{data:MA(l)?n.requestDataName(ri):n.requestDataName(XA),field:n.vgField(r,Z$(c,r)?{binSuffix:"range"}:{}),sort:l===!0||!kr(l)?{field:n.vgField(r,{}),op:"min"}:l}]);{const{bin:f}=c;if(sn(f)){const h=zj(n,c.field,f);return Rs([new Gs(()=>{const d=n.getSignalName(h);return`[${d}.start, ${d}.stop]`})])}else return Rs([{data:n.requestDataName(ri),field:n.vgField(r,{})}])}}else if(c.timeUnit&&We(["time","utc"],e)&&lj(r,c,En(n)?n.encoding[ol(r)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(ri);return Rs([{data:f,field:n.vgField(r)},{data:f,field:n.vgField(r,{suffix:"end"})}])}else return Rs(l?[{data:MA(l)?n.requestDataName(ri):n.requestDataName(XA),field:n.vgField(r),sort:l}]:[{data:n.requestDataName(ri),field:n.vgField(r)}])}function gR(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:n??(t?"sum":JN)},r?{field:uh(r)}:{}),i?{order:i}:{})}function i1t(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=gme(i)&&i,a=X$(s)&&YN(s.extent)&&s.extent;(o||a)&&r.set("selectionExtent",o??a,!0)}function s1t(e,t,n){if(!ks(n))return;const r=e.fieldDef(t),i=r.sort;if(Tme(i))return{op:"min",field:P0(r,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(bu(i)){const a=s&&!We(o,i.field);return gR(i,a)}else if(_me(i)){const{encoding:a,order:u}=i,l=e.fieldDef(a),{aggregate:c,field:f}=l,h=s&&!We(o,f);if(lh(c)||Pg(c))return gR({field:me(l),order:u},h);if(jU(c)||!c)return gR({op:c,field:f,order:u},h)}else{if(i==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(We(["ascending",void 0],i))return!0}}function ZZ(e,t){const{aggregate:n,type:r}=e;return n?ct(n)&&!Lct[n]?{valid:!1,reason:Tft(n)}:r==="quantitative"&&t==="log"?{valid:!1,reason:Ift(e)}:{valid:!0}:{valid:!1,reason:_ft(e)}}function fP(e,t,n,r){return e.explicit&&t.explicit&&fe(Rft(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function o1t(e){const t=ff(e.map(o=>hf(o)?Pe(o,["sort"]):o),St),n=ff(e.map(o=>{if(hf(o)){const a=o.sort;return a!==void 0&&!MA(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),St);if(t.length===0)return;if(t.length===1){const o=e[0];if(hf(o)&&n.length>0){let a=n[0];if(n.length>1)fe(uZ),a=!0;else if(kr(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const r=ff(n.map(o=>MA(o)||!("op"in o)||o.op in Nct?o:(fe(Lft(o)),!0)),St);let i;r.length===1?i=r[0]:r.length>1&&(fe(uZ),i=!0);const s=ff(e.map(o=>hf(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?Object.assign({data:s[0],fields:t.map(a=>a.field)},i?{sort:i}:{}):Object.assign({fields:t},i?{sort:i}:{})}function jj(e){if(hf(e)&&ct(e.field))return e.field;if(hht(e)){let t;for(const n of e.fields)if(hf(n)&&ct(n.field)){if(!t)t=n.field;else if(t!==n.field)return fe(Pft),t}return fe(Bft),t}else if(dht(e)){fe(zft);const t=e.fields[0];return ct(t)?t:void 0}}function gF(e,t){const r=e.component.scales[t].get("domains").map(i=>(hf(i)&&(i.data=e.lookupDataSource(i.data)),i));return o1t(r)}function b1e(e){return Iy(e)||Wj(e)?e.children.reduce((t,n)=>t.concat(b1e(n)),JZ(e)):JZ(e)}function JZ(e){return pe(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:l,reverse:c}=i,f=Pe(i,["name","type","selectionExtent","domains","range","reverse"]),h=a1t(i.range,s,n);let d;a&&(d=agt(e,a));const p=gF(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},p?{domain:p}:{}),d?{domainRaw:d}:{}),{range:h}),c!==void 0?{reverse:c}:{}),f)),t},[])}function a1t(e,t,n){return Mu(n)&&Vh(e)?{step:{signal:t+"_step"}}:e}class x1e extends _c{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:c2(this.get("domains"),t=>Ue(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const u1t=["range","scheme"];function v1e(e){return e==="x"?"width":e==="y"?"height":void 0}function l1t(e){const t=e.component.scales;for(const n of XN){const r=t[n];if(!r)continue;const i=c1t(n,e);r.setWithExplicit("range",i)}}function QZ(e,t){const n=e.fieldDef(t);if(n&&n.bin&&sn(n.bin)){const r=zj(e,n.field,n.bin),i=v1e(t),s=e.getName(i);return new Gs(()=>{const o=e.getSignalName(r),a=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(s)} / (${a})`})}}function c1t(e,t){const n=t.specifiedScales[e],{size:r}=t,s=t.getScaleComponent(e).get("type");for(const o of u1t)if(n[o]!==void 0){const a=mme(s,o),u=yme(e,o);if(!a)fe(Qge(s,o,e));else if(u)fe(u);else switch(o){case"range":return Ue(n.range)&&Mu(e)?Vd(n.range.map(l=>{if(l==="width"||l==="height"){const c=t.getName(l),f=t.getSignalName.bind(t);return Gs.fromName(f,c)}return l})):Vd(n.range);case"scheme":return Vd(f1t(n[o]))}}if(e===Cn||e===ir){const o=e===Cn?"width":"height",a=r[o];if(Pu(a)){if(ks(s))return Vd({step:a.step});fe(eme(o))}}return Rs(h1t(e,t))}function f1t(e){return Lht(e)?Object.assign({scheme:e.name},Yl(e,["name"])):{scheme:e}}function h1t(e,t){const{size:n,config:r,mark:i,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=er(s[e]),l=t.getScaleComponent(e).get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case Cn:case ir:{if(We(["point","band"],l)){if(e===Cn&&!n.width){const p=p2(r.view,"width");if(Pu(p))return p}else if(e===ir&&!n.height){const p=p2(r.view,"height");if(Pu(p))return p}}const h=v1e(e),d=t.getName(h);return e===ir&&Oo(l)?[Gs.fromName(o,d),0]:[0,Gs.fromName(o,d)]}case Ec:{const h=t.component.scales[e].get("zero"),d=w1e(i,h,r),p=g1t(i,n,t,r);return zA(l)?p1t(d,p,d1t(l,r,c,e)):[d,p]}case za:return[0,Math.PI*2];case Bg:return[0,360];case tl:return[0,new Gs(()=>{const h=t.getSignalName("width"),d=t.getSignalName("height");return`min(${h},${d})/2`})];case zh:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case Uh:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Ss:return"symbol";case Cs:case il:case sl:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":i==="rect"||i==="geoshape"?"heatmap":"ramp";case Ac:case Ph:case Bh:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function d1t(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&Ue(n)?n.length+1:(fe(Yft(r)),3)}}function p1t(e,t,n){const r=()=>{const i=d2(t),s=d2(e),o=`(${i} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${i} + ${o}, ${o})`};return Xe(t)?new Gs(r):{signal:r()}}function w1e(e,t,n){if(t)return Xe(t)?{signal:`${t.signal} ? 0 : ${w1e(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(KN("size",e))}const eJ=.95;function g1t(e,t,n,r){const i={x:QZ(n,"x"),y:QZ(n,"y")};switch(e){case"bar":case"tick":{if(r.scale.maxBandSize!==void 0)return r.scale.maxBandSize;const s=tJ(t,i,r.view);return Gn(s)?s-1:new Gs(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const s=tJ(t,i,r.view);return Gn(s)?Math.pow(eJ*s,2):new Gs(()=>`pow(${eJ} * ${s.signal}, 2)`)}}throw new Error(KN("size",e))}function tJ(e,t,n){const r=Pu(e.width)?e.width.step:HA(n,"width"),i=Pu(e.height)?e.height.step:HA(n,"height");return t.x||t.y?new Gs(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function $1e(e,t){En(e)?m1t(e,t):S1e(e,t)}function m1t(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:s,specifiedScales:o}=e;for(const a of pe(n)){const u=o[a],l=n[a],c=e.getScaleComponent(a),f=er(i[a]),h=u[t],d=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=mme(d,t),y=yme(a,t);if(h!==void 0&&(m?y&&fe(y):fe(Qge(d,t,a))),m&&y===void 0)if(h!==void 0)l.copyKeyFromObject(t,u);else{const b=t in nJ?nJ[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:d,scalePadding:p,scalePaddingInner:g,domain:u.domain,markDef:s,config:r}):r.scale[t];b!==void 0&&l.set(t,b,!1)}}}const nJ={bins:({model:e,fieldOrDatumDef:t})=>ve(t)?y1t(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>b1t(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>x1t(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>v1t(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>w1t(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:s})=>$1t(e,t,n,r.type,i,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>{const i=ve(e)?e.sort:void 0;return C1t(t,i,n,r.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>S1t(e,t,n,r,i)};function C1e(e){En(e)?l1t(e):S1e(e,"range")}function S1e(e,t){const n=e.component.scales;for(const r of e.children)t==="range"?C1e(r):$1e(r,t);for(const r of pe(n)){let i;for(const s of e.children){const o=s.component.scales[r];if(o){const a=o.getWithExplicit(t);i=fh(i,a,t,"scale",p0e((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[r].setWithExplicit(t,i)}}function y1t(e,t){const n=t.bin;if(sn(n)){const r=zj(e,t.field,n);return new Gs(()=>e.getSignalName(r))}else if(Fi(n)&&X$(n)&&n.step!==void 0)return{step:n.step}}function b1t(e,t){if(We([Cs,il,sl],e)&&t!=="nominal")return"hcl"}function x1t(e,t,n){var r;if(!(!((r=Lu(n))===null||r===void 0)&&r.bin||We([Pn.TIME,Pn.UTC],e)))return t in jh?!0:void 0}function v1t(e,t,n,r,i,s){if(e in jh){if(da(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=i;if(o==="bar"&&!(ve(r)&&(r.bin||r.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Pn.POINT)return n.pointPadding}}function w1t(e,t,n,r){if(e===void 0&&t in jh){const{bandPaddingInner:i,barBandPaddingInner:s,rectBandPaddingInner:o}=r;return Hn(i,n==="bar"?s:o)}}function $1t(e,t,n,r,i,s){if(e===void 0&&t in jh&&n===Pn.BAND){const{bandPaddingOuter:o}=s;return Hn(o,Xe(i)?{signal:`${i.signal}/2`}:i/2)}}function C1t(e,t,n,r){if(n==="x"&&r.xReverse!==void 0)return Oo(e)&&t==="descending"?Xe(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(Oo(e)&&t==="descending")return!0}function S1t(e,t,n,r,i){if(!!n&&n!=="unaggregated"&&Oo(i)){if(Ue(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!zA(i))return!0;if(!(ve(t)&&t.bin)&&We([...Fo,...Xct],e)){const{orient:o,type:a}=r;return!(We(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function k1t(e,t,n,r){const i=E1t(t,n,r),{type:s}=e;return Wh(t)?s!==void 0?xme(t,s)?ve(n)&&!bme(s,n.type)?(fe(Fft(s,i)),i):s:(fe(Nft(t,s,i)),i):i:null}function E1t(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(zm(e)||Ek(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&fe(rR(e,"ordinal")),"ordinal";if(e in jh){if(We(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in HU)return"band";return t.band!==void 0||dj(t)&&(!((r=t.axis)===null||r===void 0)&&r.tickBand)?"band":"point";case"temporal":return zm(e)?"time":Ek(e)==="discrete"?(fe(rR(e,"temporal")),"ordinal"):ve(t)&&t.timeUnit&&Vi(t.timeUnit).utc?"utc":"time";case"quantitative":return zm(e)?ve(t)&&sn(t.bin)?"bin-ordinal":"linear":Ek(e)==="discrete"?(fe(rR(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Zge(t.type))}function A1t(e,{ignoreRange:t}={}){k1e(e),y1e(e);for(const n of Uht)$1e(e,n);t||C1e(e)}function k1e(e){En(e)?e.component.scales=_1t(e):e.component.scales=I1t(e)}function _1t(e){const{encoding:t,mark:n}=e;return XN.reduce((r,i)=>{const s=er(t[i]);if(s&&n===Rge&&i===Ss&&s.type===ky)return r;let o=s&&s.scale;if(s&&o!==null&&o!==!1){o=o??{};const a=k1t(o,i,s,n);r[i]=new x1e(e.scaleName(i+"",!0),{value:a,explicit:o.type===a})}return r},{})}const T1t=p0e((e,t)=>cZ(e)-cZ(t));function I1t(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const s of e.children){k1e(s);for(const o of pe(s.component.scales))if(i.scale[o]=(t=i.scale[o])!==null&&t!==void 0?t:Qmt(o,e),i.scale[o]==="shared"){const a=r[o],u=s.component.scales[o].getWithExplicit("type");a?Sht(a.value,u.value)?r[o]=fh(a,u,"type","scale",T1t):(i.scale[o]="independent",delete r[o]):r[o]=u}}for(const s of pe(r)){const o=e.scaleName(s,!0),a=r[s];n[s]=new x1e(o,a);for(const u of e.children){const l=u.component.scales[s];l&&(u.renameScale(l.get("name"),o),l.merged=!0)}}return n}class mR{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function En(e){return(e==null?void 0:e.type)==="unit"}function xa(e){return(e==null?void 0:e.type)==="facet"}function Wj(e){return(e==null?void 0:e.type)==="concat"}function Iy(e){return(e==null?void 0:e.type)==="layer"}class Vj{constructor(t,n,r,i,s,o,a){var u,l;this.type=n,this.parent=r,this.config=s,this.view=a,this.children=[],this.correctDataNames=c=>(c.from&&c.from.data&&(c.from.data=this.lookupDataSource(c.from.data)),c.from&&c.from.facet&&c.from.facet.data&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c),this.parent=r,this.config=s,this.name=(u=t.name)!==null&&u!==void 0?u:i,this.title=qc(t.title)?{text:t.title}:t.title,this.scaleNameMap=r?r.scaleNameMap:new mR,this.projectionNameMap=r?r.projectionNameMap:new mR,this.signalNameMap=r?r.signalNameMap:new mR,this.data=t.data,this.description=t.description,this.transforms=Fpt((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Odt(t,n,s),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:QN(t)||r&&r.component.data.isFaceted&&t.data===void 0},layoutSize:new _c,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?ft(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){A1t(this)}parseProjection(){d1e(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){u1e(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=Pe(t,["style"]),r={};for(const i of pe(n)){const s=n[i];s!==void 0&&(r[i]=On(s))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=On(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):Jt(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,r=Pe(t,["spacing"]),{component:i,config:s}=this,o=Jmt(i.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),r),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const r of xo)t[r].title&&n.push(Hmt(this,r));for(const r of Mj)n=n.concat(qmt(this,r));return n}assembleAxes(){return Nmt(this.component.axes,this.config)}assembleLegends(){return c1e(this)}assembleProjections(){return w0t(this)}assembleTitle(){var t,n,r;const i=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=i,o=Pe(i,["encoding"]),a=Object.assign(Object.assign(Object.assign({},Ume(this.config.title).nonMark),o),s?{encode:{update:s}}:{});if(a.text)return We(["unit","layer"],this.type)?We(["middle",void 0],a.anchor)&&(a.frame=(n=a.frame)!==null&&n!==void 0?n:"group"):a.anchor=(r=a.anchor)!==null&&r!==void 0?r:"start",Jt(a)?void 0:a}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const r=this.assembleLayout();r&&(n.layout=r),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||xa(this.parent)?b1e(this):[];i.length>0&&(n.scales=i);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return mn((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const r=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[r]=((n=i[r])!==null&&n!==void 0?n:0)+1,r}getSizeSignalRef(t){if(xa(this.parent)){const n=n1e(t),r=qN(n),i=this.component.scales[r];if(i&&!i.merged){const s=i.get("type"),o=i.get("range");if(ks(s)&&Vh(o)){const a=i.get("name"),u=gF(this,r),l=jj(u);if(l){const c=me({aggregate:"distinct",field:l},{expr:"datum"});return{signal:t1e(a,i,c)}}else return fe(`Unknown field for ${r}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(Vge(t)&&Wh(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let r=this.component.selection[t];if(!r&&this.parent&&(r=this.parent.getSelectionComponent(t,n)),!r)throw new Error(ift(n));return r}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(r=>r.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(r=>r.hasOrientSignalRef()))}}class E1e extends Vj{vgField(t,n={}){const r=this.fieldDef(t);if(r)return me(r,n)}reduceFieldDef(t,n){return Xme(this.getMapping(),(r,i,s)=>{const o=Lu(i);return o?t(r,o,s):r},n)}forEachFieldDef(t,n){bj(this.getMapping(),(r,i)=>{const s=Lu(r);s&&t(s,i)},n)}}class mF extends Yt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ft(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new mF(null,ft(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${St(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,r=Pe(t,["density"]);return Object.assign({type:"kde",field:n},r)}}class x2 extends Yt{constructor(t,n){super(t),this.filter=n}clone(){return new x2(null,Object.assign({},this.filter))}static make(t,n){const{config:r,mark:i,markDef:s}=n;if(Lt("invalid",s,r)!=="filter")return null;const a=n.reduceFieldDef((u,l,c)=>{const f=Wh(c)&&n.getScaleComponent(c);if(f){const h=f.get("type");Oo(h)&&l.aggregate!=="count"&&!Lg(i)&&(u[l.field]=l)}return u},{});return pe(a).length?new x2(t,a):null}dependentFields(){return new Set(pe(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${St(this.filter)}`}assemble(){const t=pe(this.filter).reduce((n,r)=>{const i=this.filter[r],s=me(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):i.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class yF extends Yt{constructor(t,n){super(t),this.transform=n,this.transform=ft(n);const{flatten:r,as:i=[]}=this.transform;this.transform.as=r.map((s,o)=>{var a;return(a=i[o])!==null&&a!==void 0?a:s})}clone(){return new yF(this.parent,ft(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${St(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class bF extends Yt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ft(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new bF(null,ft(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${St(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Um extends Yt{constructor(t,n,r,i){super(t),this.fields=n,this.geojson=r,this.signal=i}clone(){return new Um(null,ft(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let r=0;for(const i of[[rl,nl],[No,Ua]]){const s=i.map(o=>{const a=er(n.encoding[o]);return ve(a)?a.field:Gh(a)?{expr:`${a.datum}`}:fc(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new Um(t,s,null,n.getName(`geojson_${r++}`)))}if(n.channelHasField(Ss)){const i=n.typedFieldDef(Ss);i.type===ky&&(t=new Um(t,null,i.field,n.getName(`geojson_${r++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(ct);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${St(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class v2 extends Yt{constructor(t,n,r,i){super(t),this.projection=n,this.fields=r,this.as=i}clone(){return new v2(null,this.projection,ft(this.fields),ft(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const r of[[rl,nl],[No,Ua]]){const i=r.map(o=>{const a=er(n.encoding[o]);return ve(a)?a.field:Gh(a)?{expr:`${a.datum}`}:fc(a)?{expr:`${a.value}`}:void 0}),s=r[0]===No?"2":"";(i[0]||i[1])&&(t=new v2(t,n.projectionName(),i,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(ct))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${St(this.fields)} ${St(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class lp extends Yt{constructor(t,n){super(t),this.transform=n}clone(){return new lp(null,ft(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:r,step:i}=t;return{signal:`sequence(${[n,r,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,n){return new lp(t,n)}static makeFromEncoding(t,n){const r=n.encoding,i=r.x,s=r.y;if(ve(i)&&ve(s)){const o=i.impute?i:s.impute?s:void 0;if(o===void 0)return;const a=i.impute?s:s.impute?i:void 0,{method:u,value:l,frame:c,keyvals:f}=o.impute,h=Yme(n.mark,r);return new lp(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},u?{method:u}:{}),l!==void 0?{value:l}:{}),c?{frame:c}:{}),f!==void 0?{keyvals:f}:{}),h.length?{groupby:h}:{}))}return null}hash(){return`Impute ${St(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:r,method:i,groupby:s,value:o,frame:a=[null,null]}=this.transform,u=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},r?{keyvals:dpt(r)?this.processSequence(r):r}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!i||i==="value"?o:null});if(i&&i!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}class xF extends Yt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ft(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new xF(null,ft(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${St(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:r}=t,i=Pe(t,["loess","on"]);return Object.assign({type:"loess",x:r,y:n},i)}}class w2 extends Yt{constructor(t,n,r){super(t),this.transform=n,this.secondary=r}clone(){return new w2(null,ft(this.transform),this.secondary)}static make(t,n,r,i){const s=n.component.data.sources,{from:o}=r;let a=null;if(gpt(o)){let u=T1e(o.data,s);u||(u=new z0(o.data),s.push(u));const l=n.getName(`lookup_${i}`);a=new Pi(u,l,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(mpt(o)){const u=o.selection;if(r=Object.assign({as:u},r),a=n.getSelectionComponent(mn(u),u).materialized,!a)throw new Error(aft(u))}return new w2(t,r,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Ln(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${St({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:Ln(this.transform.as)}:{});else{let n=this.transform.as;ct(n)||(fe(hft),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class vF extends Yt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ft(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new vF(null,ft(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${St(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,r=Pe(t,["quantile"]);return Object.assign({type:"quantile",field:n},r)}}class wF extends Yt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ft(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new wF(null,ft(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${St(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:r}=t,i=Pe(t,["regression","on"]);return Object.assign({type:"regression",x:r,y:n},i)}}class $F extends Yt{constructor(t,n){super(t),this.transform=n}clone(){return new $F(null,ft(this.transform))}addDimensions(t){var n;this.transform.groupby=ff(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),r=>r)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${St(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:r,limit:i,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},i!==void 0?{limit:i}:{}),s!==void 0?{op:s}:{}),r!==void 0?{groupby:r}:{})}}class CF extends Yt{constructor(t,n){super(t),this.transform=n}clone(){return new CF(null,ft(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${St(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function A1e(e){let t=0;function n(r,i){var s;if(r instanceof z0&&!r.isGenerator&&!g2(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof di&&(r.parent instanceof z0&&!i.source?(i.format=Object.assign(Object.assign({},(s=i.format)!==null&&s!==void 0?s:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof _y){i.name||(i.name=`data_${t++}`),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const o of r.assemble())e.push(o);return}switch((r instanceof rC||r instanceof iC||r instanceof x2||r instanceof Ay||r instanceof L0||r instanceof v2||r instanceof Um||r instanceof ba||r instanceof w2||r instanceof Ty||r instanceof Wg||r instanceof bF||r instanceof yF||r instanceof mF||r instanceof xF||r instanceof vF||r instanceof wF||r instanceof ph||r instanceof CF||r instanceof $F)&&i.transform.push(r.assemble()),(r instanceof vu||r instanceof xu||r instanceof lp||r instanceof Ql)&&i.transform.push(...r.assemble()),r instanceof Pi&&(i.source&&i.transform.length===0?r.setSource(i.source):r.parent instanceof Pi?r.setSource(i.name):(i.name||(i.name=`data_${t++}`),r.setSource(i.name),r.numChildren()===1&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof Pi&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${t++}`);let o=i.name;!i.source||i.transform.length>0?e.push(i):o=i.source;for(const a of r.children)n(a,{name:null,source:o,transform:[]});break}}}return n}function D1t(e){const t=[],n=A1e(t);for(const r of e.children)n(r,{source:e.name,name:null,transform:[]});return t}function N1t(e,t){var n,r;const i=[],s=A1e(i);let o=0;for(const u of e.sources){u.hasName()||(u.dataName=`source_${o++}`);const l=u.assemble();s(u,l)}for(const u of i)u.transform.length===0&&delete u.transform;let a=0;for(const[u,l]of i.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&i.splice(a++,0,i.splice(u,1)[0]);for(const u of i)for(const l of(r=u.transform)!==null&&r!==void 0?r:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const u of i)u.name in t&&(u.values=t[u.name]);return i}function F1t(e){return e==="top"||e==="left"||Xe(e)?"header":"footer"}function O1t(e){for(const t of xo)R1t(e,t);rJ(e,"x"),rJ(e,"y")}function R1t(e,t){var n;const{facet:r,config:i,child:s,component:o}=e;if(e.channelHasField(t)){const a=r[t],u=B0("title",null,i,t);let l=op(a,i,{allowDisabling:!0,includeDefault:u===void 0||!!u});s.component.layoutHeaders[t].title&&(l=Ue(l)?l.join(", "):l,l+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const c=B0("labelOrient",a,i,t),f=(n=a.header)!==null&&n!==void 0?n:{},h=Hn(f.labels,i.header.labels,!0),d=We(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:l,facetFieldDef:a,[d]:t==="facet"?[]:[_1e(e,t,h)]}}}function _1e(e,t,n){const r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function rJ(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:s}=e.component;if(s.axis[t]=Bj(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=i[o];for(const u of r.component.axes[t]){const l=F1t(u.get("orient"));a[l]=(n=a[l])!==null&&n!==void 0?n:[_1e(e,o,!1)];const c=ax(u,"main",e.config,{header:!0});c&&a[l][0].axes.push(c),u.mainExtracted=!0}}}}function M1t(e){Gj(e),QA(e,"width"),QA(e,"height")}function L1t(e){Gj(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";QA(e,t),QA(e,n)}function Gj(e){for(const t of e.children)t.parseLayoutSize()}function QA(e,t){const n=n1e(t),r=qN(n),i=e.component.resolve,s=e.component.layoutSize;let o;for(const a of e.children){const u=a.component.layoutSize.getWithExplicit(n),l=i.scale[r];if(l==="independent"&&u.value==="step"){o=void 0;break}if(o){if(l==="independent"&&o.value!==u.value){o=void 0;break}o=fh(o,u,n,"")}else o=u}if(o){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function P1t(e){const{size:t,component:n}=e;for(const r of Fo){const i=al(r);if(t[i]){const s=t[i];n.layoutSize.set(i,Pu(s)?"step":s,!0)}else{const s=B1t(e,i);n.layoutSize.set(i,s,!1)}}}function B1t(e,t){const n=t==="width"?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const s=i.get("type"),o=i.get("range");if(ks(s)){const a=p2(r.view,t);return Vh(o)||Pu(a)?"step":a}else return KL(r.view,t)}else{if(e.hasProjection||e.mark==="arc")return KL(r.view,t);{const s=p2(r.view,t);return Pu(s)?s.step:s}}}function hP(e,t,n){return me(t,Object.assign({suffix:`by_${me(e)}`},n??{}))}class Lx extends E1e{constructor(t,n,r,i){super(t,"facet",n,r,i,t.resolve),this.child=Yj(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,n){return Y$(t)?Xme(t,(r,i,s)=>We([Kl,Zl],s)?i.field===void 0?(fe(GL(i,s)),r):(r[s]=XL(i,s,n),r):(fe(KN(s,"facet")),r),{}):{facet:XL(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=SF(this),this.child.parseData()}parseLayoutSize(){Gj(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),O1t(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,r;const i={};for(const s of xo)for(const o of Lj){const a=this.component.layoutHeaders[s],u=a[o],{facetFieldDef:l}=a;if(l){const c=B0("titleOrient",l,this.config,s);if(We(["right","bottom"],c)){const f=hF(s,c);i.titleAnchor=(t=i.titleAnchor)!==null&&t!==void 0?t:{},i.titleAnchor[f]="end"}}if(u!=null&&u[0]){const c=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(c)&&(i[f]=(n=i[f])!==null&&n!==void 0?n:{},i[f][s]=.5),a.title&&(i.offset=(r=i.offset)!==null&&r!==void 0?r:{},i.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:n}=this.facet,r=t?this.columnDistinctSignal():n?1:void 0;let i="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Lx))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof Lx?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:me(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],r=[];if(this.child instanceof Lx){if(this.child.channelHasField("column")){const i=me(this.child.facet.column);t.push(i),n.push("distinct"),r.push(`distinct_${i}`)}}else for(const i of Fo){const s=this.child.component.scales[i];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(ks(o)&&Vh(a)){const u=gF(this.child,i),l=jj(u);l?(t.push(l),n.push("distinct"),r.push(`distinct_${l}`)):fe(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:r}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:r,column:i}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const c of xo){const f=this.facet[c];if(f){u.push(me(f));const{bin:h,sort:d}=f;if(sn(h)&&u.push(me(f,{binSuffix:"end"})),bu(d)){const{field:p,op:g=JN}=d,m=hP(f,d);r&&i?(s.push(m),o.push("max"),a.push(m)):(s.push(p),o.push(g),a.push(m))}else if(Ue(d)){const p=P0(f,c);s.push(p),o.push("max"),a.push(p)}}}const l=!!r&&!!i;return Object.assign({name:t,data:n,groupby:u},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,r=n[t];return r?bu(r.sort)?[hP(r,r.sort,{expr:"datum"})]:Ue(r.sort)?[P0(r,t,{expr:"datum"})]:[me(r,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,r=n[t];if(r){const{sort:i}=r;return[(bu(i)?i.order:!Ue(i)&&i)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return oP(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of Mj)if(t[i]){const s=B0("labelOrient",t[i],n,i);if(We(r[i],s))return oP(t[i],i,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,r=D1t(n),i=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:xo.map(u=>this.facetSortFields(u)).flat(),order:xo.map(u=>this.facetSortOrder(u)).flat()}}),r.length>0?{data:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup(rgt(this,[])))]}getMapping(){return this.facet}}function z1t(e,t){const{row:n,column:r}=t;if(n&&r){let i=null;for(const s of[n,r])if(bu(s.sort)){const{field:o,op:a=JN}=s.sort;e=i=new Wg(e,{joinaggregate:[{op:a,field:o,as:hP(s,s.sort,{forAs:!0})}],groupby:[me(s)]})}return i}return null}function T1e(e,t){var n,r,i,s,o,a,u,l,c,f;for(const h of t){const d=h.data;if(!(e.name&&h.hasName()&&e.name!==h.dataName)&&!(!((n=e.format)===null||n===void 0)&&n.mesh&&(!((r=d.format)===null||r===void 0)&&r.feature))&&!((!((i=e.format)===null||i===void 0)&&i.feature||!((s=d.format)===null||s===void 0)&&s.feature)&&((o=e.format)===null||o===void 0?void 0:o.feature)!==((a=d.format)===null||a===void 0?void 0:a.feature))&&!((!((u=e.format)===null||u===void 0)&&u.mesh||!((l=d.format)===null||l===void 0)&&l.mesh)&&((c=e.format)===null||c===void 0?void 0:c.mesh)!==((f=d.format)===null||f===void 0?void 0:f.mesh))){if(qA(e)&&qA(d)){if(V$(e.values,d.values))return h}else if(g2(e)&&g2(d)){if(e.url===d.url)return h}else if(g0e(e)&&e.name===h.dataName)return h}}return null}function U1t(e,t){if(e.data||!e.parent){if(e.data===null){const r=new z0({values:[]});return t.push(r),r}const n=T1e(e.data,t);if(n)return up(e.data)||(n.data.format=oct({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const r=new z0(e.data);return t.push(r),r}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function j1t(e,t,n){var r,i;let s=0;for(const o of t.transforms){let a,u;if(Ept(o))u=e=new L0(e,o),a="derived";else if(b0e(o)){const l=O0t(o);u=e=(r=di.makeWithAncestors(e,{},l,n))!==null&&r!==void 0?r:e,e=new Ay(e,t,o.filter)}else if(Apt(o))u=e=vu.makeFromTransform(e,o,t),a="number";else if(Tpt(o))a="date",n.getWithExplicit(o.field).value===void 0&&(e=new di(e,{[o.field]:a}),n.set(o.field,a,!1)),u=e=xu.makeFromTransform(e,o);else if(Ipt(o))u=e=ba.makeFromTransform(e,o),a="number",Nj(t)&&(e=new ph(e));else if(ppt(o))u=e=w2.make(e,t,o,s++),a="derived";else if(Cpt(o))u=e=new Ty(e,o),a="number";else if(Spt(o))u=e=new Wg(e,o),a="number";else if(Dpt(o))u=e=Ql.makeFromTransform(e,o),a="derived";else if(Npt(o))u=e=new bF(e,o),a="derived";else if(kpt(o))u=e=new yF(e,o),a="derived";else if(ypt(o))u=e=new $F(e,o),a="derived";else if($pt(o))e=new CF(e,o);else if(_pt(o))u=e=lp.makeFromTransform(e,o),a="derived";else if(bpt(o))u=e=new mF(e,o),a="derived";else if(xpt(o))u=e=new vF(e,o),a="derived";else if(vpt(o))u=e=new wF(e,o),a="derived";else if(wpt(o))u=e=new xF(e,o),a="derived";else{fe(fft(o));continue}if(u&&a!==void 0)for(const l of(i=u.producedFields())!==null&&i!==void 0?i:[])n.set(l,a,!1)}return e}function SF(e){var t,n,r,i,s,o,a,u,l,c;let f=U1t(e,e.component.data.sources);const{outputNodes:h,outputNodeRefCounts:d}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new hpt,g=e.data;up(g)?(m0e(g)?f=new iC(f,g.sequence):Aj(g)&&(f=new rC(f,g.graticule)),p.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=di.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new ph(f);const m=e.parent&&Iy(e.parent);(En(e)||xa(e))&&m&&(f=(r=vu.makeFromEncoding(f,e))!==null&&r!==void 0?r:f),e.transforms.length>0&&(f=j1t(f,e,p));const y=M0t(e),b=R0t(e);f=(i=di.makeWithAncestors(f,{},Object.assign(Object.assign({},y),b),p))!==null&&i!==void 0?i:f,En(e)&&(f=Um.parseAll(f,e),f=v2.parseAll(f,e)),(En(e)||xa(e))&&(m||(f=(s=vu.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=xu.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=L0.parseAllForSortIndex(f,e));const v=e.getName(XA),x=new Pi(f,v,XA,d);if(h[v]=x,f=x,En(e)){const S=ba.makeFromEncoding(f,e);S&&(f=S,Nj(e)&&(f=new ph(f))),f=(a=lp.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(u=Ql.makeFromEncoding(f,e))!==null&&u!==void 0?u:f}En(e)&&(f=(l=x2.make(f,e))!==null&&l!==void 0?l:f);const w=e.getName(ri),C=new Pi(f,w,ri,d);h[w]=C,f=C,En(e)&&Imt(e,C);let $=null;if(xa(e)){const S=e.getName("facet");f=(c=z1t(f,e.facet))!==null&&c!==void 0?c:f,$=new _y(f,e,S,C.getSource()),h[S]=$}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:d,raw:x,main:C,facetRoot:$,ancestorParse:p})}class W1t extends Vj{constructor(t,n,r,i){var s,o,a,u;super(t,"concat",n,r,i,t.resolve),(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((u=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||u===void 0?void 0:u.y)==="shared")&&fe(lft),this.children=this.getChildren(t).map((l,c)=>Yj(l,this,this.getName("concat_"+c),void 0,i))}parseData(){this.component.data=SF(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of pe(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return rF(t)?t.vconcat:kj(t)?t.hconcat:t.concat}parseLayoutSize(){L1t(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=Pj(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),r=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),r?{style:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function V1t(e){return e===!1||e===null}const G1t=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Nge),{labelExpr:1,encode:1}),I1e=pe(G1t);class Hj extends _c{constructor(t={},n={},r=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=r}clone(){return new Hj(ft(this.explicit),ft(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!V1t(this.get(t))}hasOrientSignalRef(){return Xe(this.explicit.orient)}}function H1t(e,t,n){var r;const{encoding:i,config:s}=e,o=(r=er(i[t]))!==null&&r!==void 0?r:er(i[ol(t)]),a=e.axis(t)||{},{format:u,formatType:l}=a;return Vp(l)?Object.assign({text:aj({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:l,config:s})},n):n}function q1t(e){return Fo.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[eyt(n,e)]),t),{})}const X1t={bottom:"top",top:"bottom",left:"right",right:"left"};function Y1t(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of pe(s.component.axes))r.axis[o]=Bj(e.component.resolve,o),r.axis[o]==="shared"&&(n[o]=K1t(n[o],s.component.axes[o]),n[o]||(r.axis[o]="independent",delete n[o]))}for(const s of Fo){for(const o of e.children)if(o.component.axes[s]){if(r.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:u,explicit:l}=a.getWithExplicit("orient");if(!Xe(u)){if(i[u]>0&&!l){const c=X1t[u];i[u]>i[c]&&a.set("orient",c,!1)}i[u]++}}}delete o.component.axes[s]}if(r.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function K1t(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const i=e[r],s=t[r];if(!!i!=!!s)return;if(i&&s){const o=i.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[r]=Z1t(i,s)}}}else return t.map(n=>n.clone());return e}function Z1t(e,t){for(const n of I1e){const r=fh(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(i,s)=>{switch(n){case"title":return qme(i,s);case"gridScale":return{explicit:i.explicit,value:Hn(i.value,s.value)}}return sF(i,s,n,"axis")});e.setWithExplicit(n,r)}return e}function J1t(e,t,n,r,i){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Xe(n.labelAngle)?n.labelAngle:LA(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Z0e(r,i))return!0}return e===n[t]}const Q1t=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function eyt(e,t){var n,r,i;let s=t.axis(e);const o=new Hj,a=er(t.encoding[e]),{mark:u,config:l}=t,c=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((r=l.axis)===null||r===void 0?void 0:r.orient)||jmt(e),f=t.getScaleComponent(e).get("type"),h=Rmt(e,f,c,t.config),d=s!==void 0?!s:iP("disable",l,s==null?void 0:s.style,h).configValue;if(o.set("disable",d,s!==void 0),d)return o;s=s||{};const p=Bmt(t,s,e,a,h),g={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:u,config:l};for(const b of I1e){const v=b in jZ?jZ[b](g):ZK(b)?s[b]:void 0,x=v!==void 0,w=J1t(v,b,s,t,e);if(x&&w)o.set(b,v,w);else{const{configValue:C=void 0,configFrom:$=void 0}=ZK(b)&&b!=="values"?iP(b,t.config,s.style,h):{},S=C!==void 0;x&&!S?o.set(b,v,w):($!=="vgAxisConfig"||Q1t.has(b)&&S||PU(C)||Xe(C))&&o.set(b,C,!1)}}const m=(i=s.encoding)!==null&&i!==void 0?i:{},y=Dge.reduce((b,v)=>{var x;if(!o.hasAxisPart(v))return b;const w=r1e((x=m[v])!==null&&x!==void 0?x:{},t),C=v==="labels"?H1t(t,e,w):w;return C!==void 0&&!Jt(C)&&(b[v]={update:C}),b},{});return Jt(y)||o.set("encode",y,!!s.encoding||s.labelAngle!==void 0),o}function tyt({encoding:e,size:t}){for(const n of Fo){const r=al(n);Pu(t[r])&&uu(e[n])&&(delete t[r],fe(eme(r)))}return t}function nyt(e,t,n,{graticule:r}){const i=Ru(e)?Object.assign({},e):{type:e},s=Lt("orient",i,n);if(i.orient=oyt(i.type,t,s),s!==void 0&&s!==i.orient&&fe(kft(i.orient,s)),i.type==="bar"&&i.orient){const l=Lt("cornerRadiusEnd",i,n);if(l!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Ect[i.orient];for(const f of c)i[f]=l;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Lt("opacity",i,n)===void 0&&(i.opacity=iyt(i.type,t)),i.filled===void 0&&(i.filled=r?!1:syt(i,n)),Lt("cursor",i,n)===void 0&&(i.cursor=ryt(i,t,n)),i}function ryt(e,t,n){return t.href||e.href||Lt("href",e,n)?"pointer":e.cursor}function iyt(e,t){if(We([zN,BU,zU,UU],e)&&!mj(t))return .7}function syt(e,t){const n=Gp("filled",e,t),r=e.type;return Hn(n,r!==zN&&r!==BN&&r!==PA)}function oyt(e,t,n){switch(e){case zN:case zU:case UU:case Oge:case bct:case yct:return}const{x:r,y:i,x2:s,y2:o}=t;switch(e){case PN:if(ve(r)&&(Fi(r.bin)||ve(i)&&i.aggregate&&!r.aggregate))return"vertical";if(ve(i)&&(Fi(i.bin)||ve(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(ve(r)&&r.type===Wp&&!sn(r.bin)||qL(r)))return"horizontal";if(!o&&(ve(i)&&i.type===Wp&&!sn(i.bin)||qL(i)))return"vertical"}case PA:if(s&&!(ve(r)&&Fi(r.bin))&&o&&!(ve(i)&&Fi(i.bin)))return;case LN:if(o)return ve(i)&&Fi(i.bin)?"horizontal":"vertical";if(s)return ve(r)&&Fi(r.bin)?"vertical":"horizontal";if(e===PA){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case BN:case BU:{const a=uu(r),u=uu(i);if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u){const l=r,c=i,f=l.type===O0,h=c.type===O0;return f&&!h?e!=="tick"?"vertical":"horizontal":!f&&h?e!=="tick"?"horizontal":"vertical":!l.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const ayt={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),fi("x",e,{defaultPos:"mid"})),fi("y",e,{defaultPos:"mid"})),hh(e,"radius","arc")),hh(e,"theta","arc"))},uyt={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),YA("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),YA("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),Ij(e))},lyt={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hh(e,"x","bar")),hh(e,"y","bar"))},cyt={vgMark:"shape",encodeEntry:e=>Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&ve(n)&&n.type===ky?{field:me(n,{expr:"datum"})}:{})]}},fyt={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),hh(e,"x","image")),hh(e,"y","image")),_j(e,"url"))},hyt={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),fi("x",e,{defaultPos:"mid"})),fi("y",e,{defaultPos:"mid"})),gr("size",e,{vgChannel:"strokeWidth"})),Ij(e))},dyt={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),fi("x",e,{defaultPos:"mid"})),fi("y",e,{defaultPos:"mid"})),gr("size",e)),Ij(e))};function qj(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),fi("x",e,{defaultPos:"mid"})),fi("y",e,{defaultPos:"mid"})),gr("size",e)),gr("angle",e)),pyt(e,n,t))}function pyt(e,t,n){return n?{shape:{value:n}}:gr("shape",e)}const gyt={vgMark:"symbol",encodeEntry:e=>qj(e)},myt={vgMark:"symbol",encodeEntry:e=>qj(e,"circle")},yyt={vgMark:"symbol",encodeEntry:e=>qj(e,"square")},byt={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hh(e,"x","rect")),hh(e,"y","rect"))},xyt={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),YA("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),YA("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),gr("size",e,{vgChannel:"strokeWidth"}))}},vyt={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),fi("x",e,{defaultPos:"mid"})),fi("y",e,{defaultPos:"mid"})),_j(e)),gr("size",e,{vgChannel:"fontSize"})),gr("angle",e)),DZ("align",wyt(e.markDef,n,t))),DZ("baseline",$yt(e.markDef,n,t))),fi("radius",e,{defaultPos:null,isMidPoint:!0})),fi("theta",e,{defaultPos:null,isMidPoint:!0}))}};function wyt(e,t,n){if(Lt("align",e,n)===void 0)return"center"}function $yt(e,t,n){if(Lt("baseline",e,n)===void 0)return"middle"}const Cyt={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i=r==="horizontal"?"width":"height",s=r==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Bo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),fi("x",e,{defaultPos:"mid",vgChannel:"xc"})),fi("y",e,{defaultPos:"mid",vgChannel:"yc"})),gr("size",e,{defaultValue:Syt(e),vgChannel:i})),{[s]:On(Lt("thickness",n,t))})}};function Syt(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,s=i==="horizontal"?"width":"height",o=e.getScaleComponent(i==="horizontal"?"x":"y"),a=(t=Lt("size",r,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const u=o?o.get("range"):void 0;return u&&Vh(u)&&Gn(u.step)?u.step*3/4:HA(n.view,s)*3/4}}const SS={arc:ayt,area:uyt,bar:lyt,circle:myt,geoshape:cyt,image:fyt,line:hyt,point:gyt,rect:byt,rule:xyt,square:yyt,text:vyt,tick:Cyt,trail:dyt};function kyt(e){return We([BN,LN,xct],e.mark)?Eyt(e):We([PN],e.mark)?Ayt(e):e_(e)}const iJ="faceted_path_";function Eyt(e){const t=Yme(e.mark,e.encoding),n=e_(e,{fromPrefix:t.length>0?iJ:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:iJ+e.requestDataName(ri),data:e.requestDataName(ri),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const sJ="stack_group_";function Ayt(e){const t=iR.some(n=>Lt(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[n]=e_(e,{fromPrefix:sJ}),r=e.scaleName(e.stack.fieldChannel),i=(f={})=>e.vgField(e.stack.fieldChannel,f),s=(f,h)=>{const d=[i({prefix:"min",suffix:"start",expr:h}),i({prefix:"max",suffix:"start",expr:h}),i({prefix:"min",suffix:"end",expr:h}),i({prefix:"max",suffix:"end",expr:h})];return`${f}(${d.map(p=>`scale('${r}',${p})`).join(",")})`};let o,a;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},l2(n.encode.update,["y","yc","y2","height",...iR])),{x:{signal:s("min","datum")},x2:{signal:s("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},Yl(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},l2(n.encode.update,["x","xc","x2","width"])),{y:{signal:s("min","datum")},y2:{signal:s("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},Yl(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of iR){const h=Gp(f,e.markDef,e.config);n.encode.update[f]?(o[f]=n.encode.update[f],delete n.encode.update[f]):h&&(o[f]=On(h)),h&&(n.encode.update[f]={value:0})}const u=e.fieldDef(e.stack.groupbyChannel),l=me(u)?[me(u)]:[];return(u!=null&&u.bin||u!=null&&u.timeUnit)&&l.push(me(u,{binSuffix:"end"})),o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((f,h)=>{if(n.encode.update[h])return Object.assign(Object.assign({},f),{[h]:n.encode.update[h]});{const d=Gp(h,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},f),{[h]:On(d)}):f}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(ri),name:sJ+e.requestDataName(ri),groupby:l,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[n]}]}]}else return e_(e)}function _yt(e){const{encoding:t,stack:n,mark:r,markDef:i,config:s}=e,o=t.order;if(!(!Ue(o)&&fc(o)&&XK(o.value)||!o&&XK(Lt("order",i,s)))){if((Ue(o)||ve(o))&&!n)return Vme(o,{expr:"datum"});if(Lg(r)){const a=i.orient==="horizontal"?"y":"x",u=t[a];if(ve(u)){const l=u.sort;if(Ue(l))return{field:me(u,{prefix:a,suffix:"sort_index",expr:"datum"})};if(bu(l))return{field:me({aggregate:mj(e.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(_me(l)){const c=e.fieldDef(l.encoding);return{field:me(c,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:me(u,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}}}function e_(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,s=Hn(r.clip,Tyt(e),Iyt(e)),o=jme(r),a=e.encoding.key,u=_yt(e),l=Dyt(e),c=Lt("aria",r,i),f=SS[n].postEncodingTransform?SS[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:SS[n].vgMark},s?{clip:!0}:{}),o?{style:o}:{}),a?{key:a.field}:{}),u?{sort:u}:{}),l||{}),c===!1?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(ri)},encode:{update:SS[n].encodeEntry(e)}}),f?{transform:f}:{})]}function Tyt(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function Iyt(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function Dyt(e){if(!e.component.selection)return null;const t=pe(e.component.selection).length;let n=t,r=e.parent;for(;r&&n===0;)n=pe(r.component.selection).length,r=r.parent;return n?{interactive:t>0}:null}class D1e extends E1e{constructor(t,n,r,i={},s){var o,a;super(t,"unit",n,r,s,void 0,mZ(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const u=Ru(t.mark)?t.mark.type:t.mark;this.markDef=nyt(t.mark,(o=t.encoding)!==null&&o!==void 0?o:{},s,{graticule:t.data&&Aj(t.data)});const l=this.encoding=cdt((a=t.encoding)!==null&&a!==void 0?a:{},this.markDef,s);this.size=tyt({encoding:l,size:mZ(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=c0e(u,l),this.specifiedScales=this.initScales(u,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===Rge,r=t&&Uct.some(i=>Ze(t[i]));return n||r}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return XN.reduce((r,i)=>{var s;const o=er(n[i]);return o&&(r[i]=(s=o.scale)!==null&&s!==void 0?s:{}),r},{})}initAxes(t){return Fo.reduce((n,r)=>{const i=t[r];if(Ze(i)||r===Cn&&Ze(t.x2)||r===ir&&Ze(t.y2)){const s=Ze(i)?i.axis:void 0;n[r]=s&&Object.assign({},s)}return n},{})}initLegend(t){return Yct.reduce((n,r)=>{const i=er(t[r]);if(i&&Zct(r)){const s=i.legend;n[r]=s&&Object.assign({},s)}return n},{})}parseData(){this.component.data=SF(this)}parseLayoutSize(){P1t(this)}parseSelections(){this.component.selection=Tmt(this,this.selection)}parseMarkGroup(){this.component.mark=kyt(this)}parseAxesAndHeaders(){this.component.axes=q1t(this)}assembleSelectionTopLevelSignals(t){return igt(this,t)}assembleSignals(){return[...H0e(this),...ngt(this,[])]}assembleSelectionData(t){return sgt(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return Pj(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!Iy(this.parent))&&(n=N0e(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return ap(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Lu(n)}typedFieldDef(t){const n=this.fieldDef(t);return Js(n)?n:null}}class Xj extends Vj{constructor(t,n,r,i,s){super(t,"layer",n,r,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,u)=>{if(iF(a))return new Xj(a,this,this.getName("layer_"+u),o,s);if(Cc(a))return new D1e(a,this,this.getName("layer_"+u),o,s);throw new Error(qU(a))})}parseData(){this.component.data=SF(this);for(const t of this.children)t.parseData()}parseLayoutSize(){M1t(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of pe(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){Y1t(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),H0e(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),Pj(this))}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return ogt(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),c1e(this))}}function Yj(e,t,n,r,i){if(QN(e))return new Lx(e,t,n,i);if(iF(e))return new Xj(e,t,n,r,i);if(Cc(e))return new D1e(e,t,n,r,i);if(Ddt(e))return new W1t(e,t,n,i);throw new Error(qU(e))}function Nyt(e,t={}){t.logger&&Kft(t.logger),t.fieldTitle&&Lme(t.fieldTitle);try{const n=u0e(Cge(t.config,e.config)),r=d0e(e,n),i=Yj(r,null,"",void 0,n);return i.parse(),J0t(i.component.data,i),{spec:Oyt(i,Fyt(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&Zft(),t.fieldTitle&&rdt()}}function Fyt(e,t,n,r){const i=r.component.layoutSize.get("width"),s=r.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):ct(t)&&(t={type:t}),i&&s&&lpt(t.type)){if(i==="step"&&s==="step")fe(rZ()),t.type="pad";else if(i==="step"||s==="step"){const o=i==="step"?"width":"height";fe(rZ(qN(o)));const a=o==="width"?"height":"width";t.type=cpt(a)}}return Object.assign(Object.assign(Object.assign({},pe(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),AZ(n)),AZ(e))}function Oyt(e,t,n={},r){const i=e.config?Wdt(e.config):void 0,s=[].concat(e.assembleSelectionData([]),N1t(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(f=>(f.name==="width"||f.name==="height")&&f.value!==void 0?(t[f.name]=+f.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),i?{config:i}:{}),r?{usermeta:r}:{})}class Ryt extends l0e{mapUnit(t,{config:n}){if(t.encoding){const{encoding:r,transform:i}=t,{bins:s,timeUnits:o,aggregate:a,groupby:u,encoding:l}=yj(r,n),c=[...i||[],...s,...o,...a.length===0?[]:[{aggregate:a,groupby:u}]];return Object.assign(Object.assign(Object.assign({},t),c.length>0?{transform:c}:{}),{encoding:l})}else return t}}const Myt=new Ryt;function Lyt(e,t){return Myt.map(e,{config:t})}const Pyt=Ult.version,Byt=Object.freeze(Object.defineProperty({__proto__:null,compile:Nyt,extractTransforms:Lyt,normalize:d0e,version:Pyt},Symbol.toStringTag,{value:"Module"}));function N1e(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var zyt="vega-themes",Uyt="2.14.0",jyt="Themes for stylized Vega and Vega-Lite visualizations.",Wyt=["vega","vega-lite","themes","style"],Vyt="BSD-3-Clause",Gyt={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},Hyt=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],qyt="build/vega-themes.js",Xyt="build/vega-themes.module.js",Yyt="build/vega-themes.min.js",Kyt="build/vega-themes.min.js",Zyt="build/vega-themes.module.d.ts",Jyt={type:"git",url:"https://github.com/vega/vega-themes.git"},Qyt=["src","build"],ebt={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},tbt={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@typescript-eslint/eslint-plugin":"^6.0.0","@typescript-eslint/parser":"^6.0.0","browser-sync":"^2.29.3",concurrently:"^8.2.0",eslint:"^8.45.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^5.0.0","gh-pages":"^5.0.0",prettier:"^3.0.0","release-it":"^16.1.0",rollup:"^3.26.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.1.6",vega:"^5.25.0","vega-lite":"^5.9.3"},nbt={vega:"*","vega-lite":"*"},rbt={},ibt={name:zyt,version:Uyt,description:jyt,keywords:Wyt,license:Vyt,author:Gyt,contributors:Hyt,main:qyt,module:Xyt,unpkg:Yyt,jsdelivr:Kyt,types:Zyt,repository:Jyt,files:Qyt,scripts:ebt,devDependencies:tbt,peerDependencies:nbt,dependencies:rbt};const cm="#fff",oJ="#888",sbt={background:"#333",view:{stroke:oJ},title:{color:cm,subtitleColor:cm},style:{"guide-label":{fill:cm},"guide-title":{fill:cm}},axis:{domainColor:cm,gridColor:oJ,tickColor:cm}},id="#4572a7",obt={background:"#fff",arc:{fill:id},area:{fill:id},line:{stroke:id,strokeWidth:2},path:{stroke:id},rect:{fill:id},shape:{stroke:id},symbol:{fill:id,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},sd="#30a2da",yR="#cbcbcb",abt="#999",ubt="#333",aJ="#f0f0f0",uJ="#333",lbt={arc:{fill:sd},area:{fill:sd},axis:{domainColor:yR,grid:!0,gridColor:yR,gridWidth:1,labelColor:abt,labelFontSize:10,titleColor:ubt,tickColor:yR,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:aJ,group:{fill:aJ},legend:{labelColor:uJ,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:uJ,titleFontSize:14,titlePadding:10},line:{stroke:sd,strokeWidth:2},path:{stroke:sd,strokeWidth:.5},rect:{fill:sd},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:sd},bar:{binSpacing:2,fill:sd,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},od="#000",cbt={group:{fill:"#e5e5e5"},arc:{fill:od},area:{fill:od},line:{stroke:od},path:{stroke:od},rect:{fill:od},shape:{stroke:od},symbol:{fill:od,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},fbt=22,hbt="normal",lJ="Benton Gothic, sans-serif",cJ=11.5,dbt="normal",ad="#82c6df",bR="Benton Gothic Bold, sans-serif",fJ="normal",hJ=13,Eb={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},pbt={background:"#ffffff",title:{anchor:"start",color:"#000000",font:bR,fontSize:fbt,fontWeight:hbt},arc:{fill:ad},area:{fill:ad},line:{stroke:ad,strokeWidth:2},path:{stroke:ad},rect:{fill:ad},shape:{stroke:ad},symbol:{fill:ad,size:30},axis:{labelFont:lJ,labelFontSize:cJ,labelFontWeight:dbt,titleFont:bR,titleFontSize:hJ,titleFontWeight:fJ},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:lJ,labelFontSize:cJ,symbolType:"square",titleFont:bR,titleFontSize:hJ,titleFontWeight:fJ},range:{category:Eb["category-6"],diverging:Eb["fireandice-6"],heatmap:Eb["fire-7"],ordinal:Eb["fire-7"],ramp:Eb["fire-7"]}},ud="#ab5787",kS="#979797",gbt={background:"#f9f9f9",arc:{fill:ud},area:{fill:ud},line:{stroke:ud},path:{stroke:ud},rect:{fill:ud},shape:{stroke:ud},symbol:{fill:ud,size:30},axis:{domainColor:kS,domainWidth:.5,gridWidth:.2,labelColor:kS,tickColor:kS,tickWidth:.2,titleColor:kS},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},ld="#3e5c69",mbt={background:"#fff",arc:{fill:ld},area:{fill:ld},line:{stroke:ld},path:{stroke:ld},rect:{fill:ld},shape:{stroke:ld},symbol:{fill:ld},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},ro="#1696d2",dJ="#000000",ybt="#FFFFFF",ES="Lato",xR="Lato",bbt="Lato",xbt="#DEDDDD",vbt=18,Ab={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},wbt={background:ybt,title:{anchor:"start",fontSize:vbt,font:ES},axisX:{domain:!0,domainColor:dJ,domainWidth:1,grid:!1,labelFontSize:12,labelFont:xR,labelAngle:0,tickColor:dJ,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:ES},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:xbt,gridWidth:1,labelFontSize:12,labelFont:xR,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:ES,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:xR,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:ES,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Ab["six-groups-cat-1"],diverging:Ab["diverging-colors"],heatmap:Ab["diverging-colors"],ordinal:Ab["six-groups-seq"],ramp:Ab["shades-blue"]},area:{fill:ro},rect:{fill:ro},line:{color:ro,stroke:ro,strokeWidth:5},trail:{color:ro,stroke:ro,strokeWidth:0,size:1},path:{stroke:ro,strokeWidth:.5},point:{filled:!0},text:{font:bbt,color:ro,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:ro,stroke:null}},arc:{fill:ro},shape:{stroke:ro},symbol:{fill:ro,size:30}},cd="#3366CC",pJ="#ccc",AS="Arial, sans-serif",$bt={arc:{fill:cd},area:{fill:cd},path:{stroke:cd},rect:{fill:cd},shape:{stroke:cd},symbol:{stroke:cd},circle:{fill:cd},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:AS,fontSize:12},"guide-title":{font:AS,fontSize:12},"group-title":{font:AS,fontSize:12}},title:{font:AS,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:pJ,tickColor:pJ,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},Kj=e=>e*(1/3+1),gJ=Kj(9),mJ=Kj(10),yJ=Kj(12),_b="Segoe UI",bJ="wf_standard-font, helvetica, arial, sans-serif",xJ="#252423",Tb="#605E5C",vJ="transparent",Cbt="#C8C6C4",Yo="#118DFF",Sbt="#12239E",kbt="#E66C37",Ebt="#6B007B",Abt="#E044A7",_bt="#744EC2",Tbt="#D9B300",Ibt="#D64550",F1e=Yo,O1e="#DEEFFF",wJ=[O1e,F1e],Dbt=[O1e,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",F1e],Nbt={view:{stroke:vJ},background:vJ,font:_b,header:{titleFont:bJ,titleFontSize:yJ,titleColor:xJ,labelFont:_b,labelFontSize:mJ,labelColor:Tb},axis:{ticks:!1,grid:!1,domain:!1,labelColor:Tb,labelFontSize:gJ,titleFont:bJ,titleColor:xJ,titleFontSize:yJ,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:Cbt,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:Yo},line:{stroke:Yo,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:_b,fontSize:gJ,fill:Tb},arc:{fill:Yo},area:{fill:Yo,line:!0,opacity:.6},path:{stroke:Yo},rect:{fill:Yo},point:{fill:Yo,filled:!0,size:75},shape:{stroke:Yo},symbol:{fill:Yo,strokeWidth:1.5,size:50},legend:{titleFont:_b,titleFontWeight:"bold",titleColor:Tb,labelFont:_b,labelFontSize:mJ,labelColor:Tb,symbolType:"circle",symbolSize:75},range:{category:[Yo,Sbt,kbt,Ebt,Abt,_bt,Tbt,Ibt],diverging:wJ,heatmap:wJ,ordinal:Dbt}},vR='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',$J=400,Fbt=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],Obt=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function kF({type:e,background:t}){const n=e==="dark"?"#161616":"#ffffff",r=e==="dark"?"#f4f4f4":"#161616",i=e==="dark"?Fbt:Obt,s=e==="dark"?"#d4bbff":"#6929c4";return{background:t,arc:{fill:s},area:{fill:s},path:{stroke:s},rect:{fill:s},shape:{stroke:s},symbol:{stroke:s},circle:{fill:s},view:{fill:n,stroke:n},group:{fill:n},title:{color:r,anchor:"start",dy:-15,fontSize:16,font:vR,fontWeight:600},axis:{labelColor:r,labelFontSize:12,grid:!0,gridColor:"#525252",titleColor:r,labelAngle:0},style:{"guide-label":{font:vR,fill:r,fontWeight:$J},"guide-title":{font:vR,fill:r,fontWeight:$J}},range:{category:i,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const Rbt=kF({type:"light",background:"#ffffff"}),Mbt=kF({type:"light",background:"#f4f4f4"}),Lbt=kF({type:"dark",background:"#262626"}),Pbt=kF({type:"dark",background:"#161616"}),Bbt=ibt.version,zbt=Object.freeze(Object.defineProperty({__proto__:null,carbong10:Mbt,carbong100:Pbt,carbong90:Lbt,carbonwhite:Rbt,dark:sbt,excel:obt,fivethirtyeight:lbt,ggplot2:cbt,googlecharts:$bt,latimes:pbt,powerbi:Nbt,quartz:gbt,urbaninstitute:wbt,version:Bbt,vox:mbt},Symbol.toStringTag,{value:"Module"}));var Ubt=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const R1e="vg-tooltip-element",jbt={offsetX:10,offsetY:10,id:R1e,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:Wbt,maxDepth:2};function Wbt(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function Vbt(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return Ubt.toString().replace(R1e,e)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Gbt(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function Hbt(e,t,n){if(rt(e))return`[${e.map(r=>t(hn(r)?r:CJ(r,n))).join(", ")}]`;if(ht(e)){let r="";const i=e,{title:s,image:o}=i,a=Gbt(i,["title","image"]);s&&(r+=`<h2>${t(s)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const u=Object.keys(a);if(u.length>0){r+="<table>";for(const l of u){let c=a[l];c!==void 0&&(ht(c)&&(c=CJ(c,n)),r+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(c)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function qbt(e){const t=[];return function(n,r){if(typeof r!="object"||r===null)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}function CJ(e,t){return JSON.stringify(e,qbt(t))}function Xbt(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let s=e.clientY+r;return s+t.height>window.innerHeight&&(s=+e.clientY-r-t.height),{x:i,y:s}}class Ybt{constructor(t){this.options=Object.assign(Object.assign({},jbt),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=Vbt(n);const i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}tooltipHandler(t,n,r,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=Hbt(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:o,y:a}=Xbt(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${o}px`)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function t_(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(f){o(f)}}function u(c){try{l(r.throw(c))}catch(f){o(f)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(e,t||[])).next())})}function Kbt(e,t,n){const r=e.open(t),i=1e4,s=250,{origin:o}=new URL(t);let a=~~(i/s);function u(c){c.source===r&&(a=0,e.removeEventListener("message",u,!1))}e.addEventListener("message",u,!1);function l(){a<=0||(r.postMessage(n,o),setTimeout(l,s),a-=1)}setTimeout(l,s)}var Zbt=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function M1e(e,...t){for(const n of t)Jbt(e,n);return e}function Jbt(e,t){for(const n of Object.keys(t))TI(e,n,t[n],!0)}var wR;const El=xlt;let U0=Byt;const _S=typeof window<"u"?window:void 0;U0===void 0&&(!((wR=_S==null?void 0:_S.vl)===null||wR===void 0)&&wR.compile)&&(U0=_S.vl);const L1e={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},Qbt={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},ux={vega:"Vega","vega-lite":"Vega-Lite"},n_={vega:El.version,"vega-lite":U0?U0.version:"not available"},ext={vega:e=>e,"vega-lite":(e,t)=>U0.compile(e,{config:t}).spec},txt=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,nxt="chart-wrapper";function rxt(e){return typeof e=="function"}function SJ(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+s),o.document.title=`${ux[r]} JSON Source`}function P1e(e,t){var n;if(e.$schema){const r=N1e(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${ux[r.library]}, but mode argument sets ${(n=ux[t])!==null&&n!==void 0?n:t}.`);const i=r.library;return $re.satisfies(n_[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${ux[i]} ${r.version}, but the current version of ${ux[i]} is v${n_[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function ixt(e){return!!(e&&"load"in e)}function kJ(e){return ixt(e)?e:El.loader(e)}function EJ(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function sxt(e,t,n={}){var r,i,s;return t_(this,void 0,void 0,function*(){let o,a;hn(t)?(a=kJ(n.loader),o=JSON.parse(yield a.load(t))):o=t;const u=EJ(o).loader;(!a||u)&&(a=kJ((r=n.loader)!==null&&r!==void 0?r:u));const l=yield AJ(EJ(o),a),c=yield AJ(n,a),f=Object.assign(Object.assign({},M1e(c,l)),{config:_I((i=c.config)!==null&&i!==void 0?i:{},(s=l.config)!==null&&s!==void 0?s:{})});return yield axt(e,o,f,a)})}function AJ(e,t){var n;return t_(this,void 0,void 0,function*(){const r=hn(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},i=hn(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})})}function oxt(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:(t=document.head)!==null&&t!==void 0?t:document.body}}function axt(e,t,n={},r){var i,s,o,a,u,l;return t_(this,void 0,void 0,function*(){const c=n.theme?_I(zbt[n.theme],(i=n.config)!==null&&i!==void 0?i:{}):n.config,f=Bre(n.actions)?n.actions:M1e({},L1e,(s=n.actions)!==null&&s!==void 0?s:{}),h=Object.assign(Object.assign({},Qbt),n.i18n),d=(o=n.renderer)!==null&&o!==void 0?o:"canvas",p=(a=n.logLevel)!==null&&a!==void 0?a:El.Warn,g=(u=n.downloadFileName)!==null&&u!==void 0?u:"visualization",m=typeof e=="string"?document.querySelector(e):e;if(!m)throw new Error(`${e} does not exist`);if(n.defaultStyle!==!1){const A="vega-embed-style",{root:F,rootContainer:_}=oxt(m);if(!F.getElementById(A)){const I=document.createElement("style");I.id=A,I.innerText=n.defaultStyle===void 0||n.defaultStyle===!0?Zbt.toString():n.defaultStyle,_.appendChild(I)}}const y=P1e(t,n.mode);let b=ext[y](t,c);if(y==="vega-lite"&&b.$schema){const A=N1e(b.$schema);$re.satisfies(n_.vega,`^${A.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${A.version}, but current version is v${n_.vega}.`)}m.classList.add("vega-embed"),f&&m.classList.add("has-actions"),m.innerHTML="";let v=m;if(f){const A=document.createElement("div");A.classList.add(nxt),m.appendChild(A),v=A}const x=n.patch;x&&(x instanceof Function?b=x(b):b=wI(b,x,!0,!1).newDocument),n.formatLocale&&El.formatLocale(n.formatLocale),n.timeFormatLocale&&El.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,C=El.parse(b,y==="vega-lite"?{}:c,{ast:w}),$=new(n.viewClass||El.View)(C,Object.assign({loader:r,logLevel:p,renderer:d},w?{expr:El.expressionInterpreter}:{}));if(n.tooltip!==!1){let A;rxt(n.tooltip)?A=n.tooltip:A=new Ybt(n.tooltip===!0?{}:n.tooltip).call,$.tooltip(A)}let{hover:S}=n;if(S===void 0&&(S=y==="vega"),S){const{hoverSet:A,updateSet:F}=typeof S=="boolean"?{}:S;$.hover(A,F)}n&&(n.width!=null&&$.width(n.width),n.height!=null&&$.height(n.height),n.padding!=null&&$.padding(n.padding)),yield $.initialize(v,n.bind).runAsync();let k;if(f!==!1){let A=m;if(n.defaultStyle!==!1){const _=document.createElement("details");_.title=h.CLICK_TO_VIEW_ACTIONS,m.append(_),A=_;const I=document.createElement("summary");I.innerHTML=txt,_.append(I),k=T=>{_.contains(T.target)||_.removeAttribute("open")},document.addEventListener("click",k)}const F=document.createElement("div");if(A.append(F),F.classList.add("vega-actions"),f===!0||f.export!==!1){for(const _ of["svg","png"])if(f===!0||f.export===!0||f.export[_]){const I=h[`${_.toUpperCase()}_ACTION`],T=document.createElement("a");T.text=I,T.href="#",T.target="_blank",T.download=`${g}.${_}`,T.addEventListener("mousedown",function(O){return t_(this,void 0,void 0,function*(){O.preventDefault();const L=yield $.toImageURL(_,n.scaleFactor);this.href=L})}),F.append(T)}}if(f===!0||f.source!==!1){const _=document.createElement("a");_.text=h.SOURCE_ACTION,_.href="#",_.addEventListener("click",function(I){var T,O;SJ(l3(t),(T=n.sourceHeader)!==null&&T!==void 0?T:"",(O=n.sourceFooter)!==null&&O!==void 0?O:"",y),I.preventDefault()}),F.append(_)}if(y==="vega-lite"&&(f===!0||f.compiled!==!1)){const _=document.createElement("a");_.text=h.COMPILED_ACTION,_.href="#",_.addEventListener("click",function(I){var T,O;SJ(l3(b),(T=n.sourceHeader)!==null&&T!==void 0?T:"",(O=n.sourceFooter)!==null&&O!==void 0?O:"","vega"),I.preventDefault()}),F.append(_)}if(f===!0||f.editor!==!1){const _=(l=n.editorUrl)!==null&&l!==void 0?l:"https://vega.github.io/editor/",I=document.createElement("a");I.text=h.EDITOR_ACTION,I.href="#",I.addEventListener("click",function(T){Kbt(window,_,{config:c,mode:y,renderer:d,spec:l3(t)}),T.preventDefault()}),F.append(I)}}function E(){k&&document.removeEventListener("click",k),$.finalize()}return{view:$,spec:t,vgSpec:b,finalize:E}})}const uxt=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_ACTIONS:L1e,default:sxt,guessMode:P1e,vega:El,get vegaLite(){return U0}},Symbol.toStringTag,{value:"Module"})),Dy=tg(uxt);var zo={},de={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var _J=Object.getOwnPropertySymbols,lxt=Object.prototype.hasOwnProperty,cxt=Object.prototype.propertyIsEnumerable;function fxt(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function hxt(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(s){return t[s]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Zj=hxt()?Object.assign:function(e,t){for(var n,r=fxt(e),i,s=1;s<arguments.length;s++){n=Object(arguments[s]);for(var o in n)lxt.call(n,o)&&(r[o]=n[o]);if(_J){i=_J(n);for(var a=0;a<i.length;a++)cxt.call(n,i[a])&&(r[i[a]]=n[i[a]])}}return r},Jj={};Object.defineProperty(Jj,"__esModule",{value:!0});Jj.StyleSheet=B1e;var dxt=Zj,pxt=gxt(dxt);function gxt(e){return e&&e.__esModule?e:{default:e}}function mxt(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}else return Array.from(e)}function $R(e){return e[e.length-1]}function TJ(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}var Id=typeof window<"u",yxt=!1,bxt=function(){if(Id){var e=document.createElement("div");return e.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",e.getElementsByTagName("i").length===1}}();function IJ(){var e=document.createElement("style");return e.type="text/css",e.setAttribute("data-glamor",""),e.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}function B1e(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.speedy,n=t===void 0?!yxt:t,r=e.maxLength,i=r===void 0?Id&&bxt?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,pxt.default)(B1e.prototype,{getSheet:function(){return TJ($R(this.tags))},inject:function(){var t=this;if(this.injected)throw new Error("already injected stylesheet!");Id?this.tags[0]=IJ():this.sheet={cssRules:[],insertRule:function(r){t.sheet.cssRules.push({cssText:r})}},this.injected=!0},speedy:function(t){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+t+") earlier in your app, or call flush() before speedy("+t+")");this.isSpeedy=!!t},_insert:function(t){try{var n=this.getSheet();n.insertRule(t,t.indexOf("@import")!==-1?0:n.cssRules.length)}catch{}},insert:function(t){if(Id)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(t);else if(t.indexOf("@import")!==-1){var n=$R(this.tags);n.insertBefore(document.createTextNode(t),n.firstChild)}else $R(this.tags).appendChild(document.createTextNode(t));else this.sheet.insertRule(t,t.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,Id&&this.ctr%this.maxLength===0&&this.tags.push(IJ()),this.ctr-1},delete:function(t){return this.replace(t,"")},flush:function(){Id?(this.tags.forEach(function(t){return t.parentNode.removeChild(t)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!Id)return this.sheet.cssRules;var t=[];return this.tags.forEach(function(n){return t.splice.apply(t,[t.length,0].concat(mxt(Array.from(TJ(n).cssRules))))}),t}});var Ny={},xxt=/-(.)/g;function vxt(e){return e.replace(xxt,function(t,n){return n.toUpperCase()})}var wxt=vxt,$xt=wxt,Cxt=/^-ms-/;function Sxt(e){return $xt(e.replace(Cxt,"ms-"))}var kxt=Sxt,Qj={},eW={};Object.defineProperty(eW,"__esModule",{value:!0});var _k={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function Ext(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var Axt=["Webkit","ms","Moz","O"];Object.keys(_k).forEach(function(e){Axt.forEach(function(t){_k[Ext(t,e)]=_k[e]})});var _xt={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},Txt={isUnitlessNumber:_k,shorthandPropertyExpansions:_xt};eW.default=Txt;function EF(e){return function(){return e}}var Vg=function(){};Vg.thatReturns=EF;Vg.thatReturnsFalse=EF(!1);Vg.thatReturnsTrue=EF(!0);Vg.thatReturnsNull=EF(null);Vg.thatReturnsThis=function(){return this};Vg.thatReturnsArgument=function(e){return e};var Ixt=Vg,Dxt=Ixt,Nxt=Dxt,z1e=Nxt;Object.defineProperty(Qj,"__esModule",{value:!0});var Fxt=eW,Oxt=U1e(Fxt),Rxt=z1e;U1e(Rxt);function U1e(e){return e&&e.__esModule?e:{default:e}}var DJ=Oxt.default.isUnitlessNumber;function Mxt(e,t,n){var r=t==null||typeof t=="boolean"||t==="";if(r)return"";var i=isNaN(t);return i||t===0||DJ.hasOwnProperty(e)&&DJ[e]?""+t:(typeof t=="string"&&(t=t.trim()),t+"px")}Qj.default=Mxt;var Lxt=/([A-Z])/g;function Pxt(e){return e.replace(Lxt,"-$1").toLowerCase()}var Bxt=Pxt,zxt=Bxt,Uxt=/^ms-/;function jxt(e){return zxt(e).replace(Uxt,"-ms-")}var Wxt=jxt;function Vxt(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}var Gxt=Vxt;Object.defineProperty(Ny,"__esModule",{value:!0});Ny.processStyleName=void 0;Ny.createMarkupForStyles=tvt;var Hxt=kxt;sC(Hxt);var qxt=Qj,Xxt=sC(qxt),Yxt=Wxt,Kxt=sC(Yxt),Zxt=Gxt,Jxt=sC(Zxt),Qxt=z1e;sC(Qxt);function sC(e){return e&&e.__esModule?e:{default:e}}var evt=Ny.processStyleName=(0,Jxt.default)(Kxt.default);function tvt(e,t){var n="";for(var r in e){var i=r.indexOf("--")===0;if(e.hasOwnProperty(r)&&r!=="label"){var s=e[r];s!=null&&(i?n+=r+":"+s+";":(n+=evt(r)+":",n+=(0,Xxt.default)(r,s,t)+";"))}}return n||null}var tW={};Object.defineProperty(tW,"__esModule",{value:!0});var j1e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};tW.default=nW;function nvt(e){return e==null||e===!1||(typeof e>"u"?"undefined":j1e(e))==="object"&&Object.keys(e).length===0}function rvt(e){if(nvt(e))return null;if((typeof e>"u"?"undefined":j1e(e))!=="object")return e;for(var t={},n=Object.keys(e),r=!1,i=0;i<n.length;i++){var s=e[n[i]],o=nW(s);(o===null||o!==s)&&(r=!0),o!==null&&(t[n[i]]=o)}return Object.keys(t).length===0?null:r?t:e}function ivt(e){var t=!1,n=[];return e.forEach(function(r){var i=nW(r);(i===null||i!==r)&&(t=!0),i!==null&&n.push(i)}),n.length==0?null:t?n:e}function nW(e){return Array.isArray(e)?ivt(e):rvt(e)}var Fy={},rW={},dP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=["Webkit"],r=["Moz"],i=["ms"],s=["Webkit","Moz"],o=["Webkit","ms"],a=["Webkit","Moz","ms"];t.default={plugins:[],prefixMap:{appearance:s,userSelect:a,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:a,breakBefore:a,breakInside:a,columnCount:s,columnFill:s,columnGap:s,columnRule:s,columnRuleColor:s,columnRuleStyle:s,columnRuleWidth:s,columns:s,columnSpan:s,columnWidth:s,writingMode:o,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:o,scrollSnapPointsX:o,scrollSnapPointsY:o,scrollSnapDestination:o,scrollSnapCoordinate:o,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:a,flowInto:o,flowFrom:o,regionFragment:o,textAlignLast:r,tabSize:r,wrapFlow:i,wrapThrough:i,wrapMargin:i,gridTemplateColumns:i,gridTemplateRows:i,gridTemplateAreas:i,gridTemplate:i,gridAutoColumns:i,gridAutoRows:i,gridAutoFlow:i,grid:i,gridRowStart:i,gridColumnStart:i,gridRowEnd:i,gridRow:i,gridColumn:i,gridColumnEnd:i,gridColumnGap:i,gridRowGap:i,gridArea:i,gridGap:i,textSizeAdjust:o,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},e.exports=t.default})(dP,dP.exports);var svt=dP.exports,pP={exports:{}},gP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r){return r.charAt(0).toUpperCase()+r.slice(1)}e.exports=t.default})(gP,gP.exports);var W1e=gP.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=W1e,r=i(n);function i(o){return o&&o.__esModule?o:{default:o}}function s(o,a,u){if(o.hasOwnProperty(a))for(var l=o[a],c=0,f=l.length;c<f;++c)u[l[c]+(0,r.default)(a)]=u[a]}e.exports=t.default})(pP,pP.exports);var ovt=pP.exports,mP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r,i,s,o,a){for(var u=0,l=r.length;u<l;++u){var c=r[u](i,s,o,a);if(c)return c}}e.exports=t.default})(mP,mP.exports);var avt=mP.exports,yP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};function i(s,o){if(s==="cursor"&&r.hasOwnProperty(o))return n.map(function(a){return a+o})}e.exports=t.default})(yP,yP.exports);var uvt=yP.exports,bP={exports:{}},xP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var n=/-webkit-|-moz-|-ms-/;function r(i){return typeof i=="string"&&n.test(i)}e.exports=t.default})(xP,xP.exports);var oC=xP.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=oC,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("cross-fade(")>-1)return s.map(function(l){return u.replace(/cross-fade\(/g,l+"cross-fade(")})}e.exports=t.default})(bP,bP.exports);var lvt=bP.exports,vP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=oC,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("filter(")>-1)return s.map(function(l){return u.replace(/filter\(/g,l+"filter(")})}e.exports=t.default})(vP,vP.exports);var cvt=vP.exports,wP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};function r(i,s){if(i==="display"&&n.hasOwnProperty(s))return n[s]}e.exports=t.default})(wP,wP.exports);var fvt=wP.exports,$P={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},r={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};function i(s,o,a){s==="flexDirection"&&typeof o=="string"&&(o.indexOf("column")>-1?a.WebkitBoxOrient="vertical":a.WebkitBoxOrient="horizontal",o.indexOf("reverse")>-1?a.WebkitBoxDirection="reverse":a.WebkitBoxDirection="normal"),r.hasOwnProperty(s)&&(a[r[s]]=n[o]||o)}e.exports=t.default})($P,$P.exports);var hvt=$P.exports,CP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var n=oC,r=i(n);function i(u){return u&&u.__esModule?u:{default:u}}var s=["-webkit-","-moz-",""],o=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;function a(u,l){if(typeof l=="string"&&!(0,r.default)(l)&&o.test(l))return s.map(function(c){return c+l})}e.exports=t.default})(CP,CP.exports);var dvt=CP.exports,SP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=oC,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("image-set(")>-1)return s.map(function(l){return u.replace(/image-set\(/g,l+"image-set(")})}e.exports=t.default})(SP,SP.exports);var pvt=SP.exports,kP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r,i){if(r==="position"&&i==="sticky")return["-webkit-sticky","sticky"]}e.exports=t.default})(kP,kP.exports);var gvt=kP.exports,EP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=["-webkit-","-moz-",""],r={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},i={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};function s(o,a){if(r.hasOwnProperty(o)&&i.hasOwnProperty(a))return n.map(function(u){return u+a})}e.exports=t.default})(EP,EP.exports);var mvt=EP.exports,AP={exports:{}},_P={exports:{}},yvt=/[A-Z]/g,bvt=/^ms-/,CR={};function xvt(e){return"-"+e.toLowerCase()}function vvt(e){if(CR.hasOwnProperty(e))return CR[e];var t=e.replace(yvt,xvt);return CR[e]=bvt.test(t)?"-"+t:t}const wvt=Object.freeze(Object.defineProperty({__proto__:null,default:vvt},Symbol.toStringTag,{value:"Module"})),$vt=tg(wvt);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=$vt,r=i(n);function i(o){return o&&o.__esModule?o:{default:o}}function s(o){return(0,r.default)(o)}e.exports=t.default})(_P,_P.exports);var Cvt=_P.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=h;var n=Cvt,r=u(n),i=oC,s=u(i),o=W1e,a=u(o);function u(d){return d&&d.__esModule?d:{default:d}}var l={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},c={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};function f(d,p){if((0,s.default)(d))return d;for(var g=d.split(/,(?![^()]*(?:\([^()]*\))?\))/g),m=0,y=g.length;m<y;++m){var b=g[m],v=[b];for(var x in p){var w=(0,r.default)(x);if(b.indexOf(w)>-1&&w!=="order")for(var C=p[x],$=0,S=C.length;$<S;++$)v.unshift(b.replace(w,c[C[$]]+w))}g[m]=v.join(",")}return g.join(",")}function h(d,p,g,m){if(typeof p=="string"&&l.hasOwnProperty(d)){var y=f(p,m),b=y.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(x){return!/-moz-|-ms-/.test(x)}).join(",");if(d.indexOf("Webkit")>-1)return b;var v=y.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(x){return!/-webkit-|-ms-/.test(x)}).join(",");return d.indexOf("Moz")>-1?v:(g["Webkit"+(0,a.default)(d)]=b,g["Moz"+(0,a.default)(d)]=v,y)}}e.exports=t.default})(AP,AP.exports);var Svt=AP.exports;Object.defineProperty(rW,"__esModule",{value:!0});rW.default=Jvt;var kvt=svt,Evt=Qs(kvt),Avt=ovt,_vt=Qs(Avt),Tvt=avt,Ivt=Qs(Tvt),Dvt=uvt,Nvt=Qs(Dvt),Fvt=lvt,Ovt=Qs(Fvt),Rvt=cvt,Mvt=Qs(Rvt),Lvt=fvt,Pvt=Qs(Lvt),Bvt=hvt,zvt=Qs(Bvt),Uvt=dvt,jvt=Qs(Uvt),Wvt=pvt,Vvt=Qs(Wvt),Gvt=gvt,Hvt=Qs(Gvt),qvt=mvt,Xvt=Qs(qvt),Yvt=Svt,Kvt=Qs(Yvt);function Qs(e){return e&&e.__esModule?e:{default:e}}var Zvt=[Ovt.default,Nvt.default,Mvt.default,zvt.default,jvt.default,Vvt.default,Hvt.default,Xvt.default,Kvt.default,Pvt.default],NJ=Evt.default.prefixMap;function Jvt(e){for(var t in e){var n=e[t],r=(0,Ivt.default)(Zvt,t,n,e,NJ);r&&(e[t]=r),(0,_vt.default)(NJ,t,e)}return e}Object.defineProperty(Fy,"__esModule",{value:!0});var TP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};Fy.PluginSet=G1e;Fy.fallbacks=i2t;Fy.contentWrap=o2t;Fy.prefixes=a2t;var Qvt=Zj,iW=V1e(Qvt),e2t=Ny,t2t=rW,n2t=V1e(t2t);function V1e(e){return e&&e.__esModule?e:{default:e}}var r2t=function(e){return e==="development"||!e}("production");function G1e(e){this.fns=e||[]}(0,iW.default)(G1e.prototype,{add:function(){for(var t=this,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach(function(s){t.fns.indexOf(s)>=0?r2t&&console.warn("adding the same plugin again, ignoring"):t.fns=[s].concat(t.fns)})},remove:function(t){this.fns=this.fns.filter(function(n){return n!==t})},clear:function(){this.fns=[]},transform:function(t){return this.fns.reduce(function(n,r){return r(n)},t)}});function i2t(e){var t=Object.keys(e.style).map(function(i){return Array.isArray(e.style[i])}).indexOf(!0)>=0;if(t){var n=e.style,r=Object.keys(n).reduce(function(i,s){return i[s]=Array.isArray(n[s])?n[s].join("; "+(0,e2t.processStyleName)(s)+": "):n[s],i},{});return(0,iW.default)({},e,{style:r})}return e}var s2t=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"];function o2t(e){if(e.style.content){var t=e.style.content;return s2t.indexOf(t)>=0||/^(attr|calc|counters?|url)\(/.test(t)||t.charAt(0)===t.charAt(t.length-1)&&(t.charAt(0)==='"'||t.charAt(0)==="'")?e:TP({},e,{style:TP({},e.style,{content:'"'+t+'"'})})}return e}function a2t(e){return(0,iW.default)({},e,{style:(0,n2t.default)(TP({},e.style))})}var sW={};Object.defineProperty(sW,"__esModule",{value:!0});sW.default=u2t;function u2t(e,t){for(var n=1540483477,r=24,i=t^e.length,s=e.length,o=0;s>=4;){var a=l2t(e,o);a=fd(a,n),a^=a>>>r,a=fd(a,n),i=fd(i,n),i^=a,o+=4,s-=4}switch(s){case 3:i^=FJ(e,o),i^=e.charCodeAt(o+2)<<16,i=fd(i,n);break;case 2:i^=FJ(e,o),i=fd(i,n);break;case 1:i^=e.charCodeAt(o),i=fd(i,n);break}return i^=i>>>13,i=fd(i,n),i^=i>>>15,i>>>0}function l2t(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function FJ(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function fd(e,t){e=e|0,t=t|0;var n=e&65535,r=e>>>16,i=n*t+((r*t&65535)<<16)|0;return i}Object.defineProperty(de,"__esModule",{value:!0});de.compose=de.merge=de.$=de.style=de.presets=de.keyframes=de.fontFace=de.insertGlobal=de.insertRule=de.plugins=de.styleSheet=void 0;de.speedy=m2t;de.simulations=y2t;de.simulate=b2t;de.cssLabels=x2t;de.isLikeRule=cW;de.idFor=fW;de.css=Er;de.rehydrate=F2t;de.flush=O2t;de.select=hW;de.parent=M2t;de.media=L2t;de.pseudo=Ye;de.active=P2t;de.any=B2t;de.checked=z2t;de.disabled=U2t;de.empty=j2t;de.enabled=W2t;de._default=V2t;de.first=G2t;de.firstChild=H2t;de.firstOfType=q2t;de.fullscreen=X2t;de.focus=Y2t;de.hover=K2t;de.indeterminate=Z2t;de.inRange=J2t;de.invalid=Q2t;de.lastChild=ewt;de.lastOfType=twt;de.left=nwt;de.link=rwt;de.onlyChild=iwt;de.onlyOfType=swt;de.optional=owt;de.outOfRange=awt;de.readOnly=uwt;de.readWrite=lwt;de.required=cwt;de.right=fwt;de.root=hwt;de.scope=dwt;de.target=pwt;de.valid=gwt;de.visited=mwt;de.dir=ywt;de.lang=bwt;de.not=xwt;de.nthChild=vwt;de.nthLastChild=wwt;de.nthLastOfType=$wt;de.nthOfType=Cwt;de.after=Swt;de.before=kwt;de.firstLetter=Ewt;de.firstLine=Awt;de.selection=_wt;de.backdrop=Twt;de.placeholder=Iwt;de.cssFor=Dwt;de.attribsFor=Nwt;var c2t=Zj,f2t=aW(c2t),h2t=Jj,oW=Ny,d2t=tW,qh=aW(d2t),Gl=Fy,p2t=sW,g2t=aW(p2t);function aW(e){return e&&e.__esModule?e:{default:e}}function aC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var js=de.styleSheet=new h2t.StyleSheet;js.inject();function m2t(e){return js.speedy(e)}var uC=de.plugins=js.plugins=new Gl.PluginSet([Gl.prefixes,Gl.contentWrap,Gl.fallbacks]);uC.media=new Gl.PluginSet;uC.fontFace=new Gl.PluginSet;uC.keyframes=new Gl.PluginSet([Gl.prefixes,Gl.fallbacks]);var uW=!1,AF=typeof window<"u",lW=uW,OJ=!1,RJ=!1;function y2t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;lW=!!e}function b2t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t=(0,qh.default)(t),t?lW?t.reduce(function(r,i){return r["data-simulate-"+r_(i)]="",r},{}):(OJ||(console.warn("can't simulate without once calling simulations(true)"),OJ=!0),RJ||(console.warn("don't use simulation outside dev"),RJ=!0),{}):{}}var lC=uW;function x2t(e){lC=!!e}function r_(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return e.toLowerCase().replace(/[^a-z0-9]/g,t)}function cC(e){var t=JSON.stringify(e),n=(0,g2t.default)(t).toString(36);return e.label&&e.label.length>0&&uW?r_(e.label.join("."),"-")+"-"+n:n}function cW(e){var t=Object.keys(e).filter(function(n){return n!=="toString"});return t.length!==1?!1:!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0])}function fW(e){var t=Object.keys(e).filter(function(i){return i!=="toString"});if(t.length!==1)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/,r=n.exec(t[0]);if(!r)throw new Error("not a rule");return r[1]}var v2t=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function IP(e){if(e.indexOf(",")===-1)return[e];for(var t=[],n=[],r=0,i;i=v2t.exec(e);)switch(i[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;t.push(i.index)}for(i=t.length;i--;)n.unshift(e.slice(t[i]+1)),e=e.slice(0,t[i]);return n.unshift(e),n}function MJ(e,t){if(!e)return t.replace(/\&/g,"");if(!t)return".css-"+e+",[data-css-"+e+"]";var n=IP(t).map(function(r){return r.indexOf("&")>=0?[r.replace(/\&/mg,".css-"+e),r.replace(/\&/mg,"[data-css-"+e+"]")].join(","):".css-"+e+r+",[data-css-"+e+"]"+r}).join(",");return lW&&/^\&\:/.exec(t)&&!/\s/.exec(t)&&(n+=",.css-"+e+"[data-simulate-"+r_(t)+"],[data-css-"+e+"][data-simulate-"+r_(t)+"]"),n}function DP(e){var t=e.selector,n=e.style,r=uC.transform({selector:t,style:n});return r.selector+"{"+(0,oW.createMarkupForStyles)(r.style)+"}"}function i_(e){var t=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(e).forEach(function(s){s.indexOf("&")>=0?(n=n||{},n[s]=e[s]):s.indexOf("@media")===0?(r=r||{},r[s]=i_(e[s])):s.indexOf("@supports")===0?(i=i||{},i[s]=i_(e[s])):s==="label"?e.label.length>0&&(t=t||{},t.label=lC?e.label.join("."):""):(t=t||{},t[s]=e[s])}),{plain:t,selects:n,medias:r,supports:i}}function s_(e,t){var n=[],r=t.plain,i=t.selects,s=t.medias,o=t.supports;return r&&n.push(DP({style:r,selector:MJ(e)})),i&&Object.keys(i).forEach(function(a){return n.push(DP({style:i[a],selector:MJ(e,a)}))}),s&&Object.keys(s).forEach(function(a){return n.push(a+"{"+s_(e,s[a]).join("")+"}")}),o&&Object.keys(o).forEach(function(a){return n.push(a+"{"+s_(e,o[a]).join("")+"}")}),n}var va=js.inserted={};function w2t(e){if(!va[e.id]){va[e.id]=!0;var t=i_(e.style),n=s_(e.id,t);va[e.id]=AF?!0:n,n.forEach(function(r){return js.insert(r)})}}var $2=js.registered={};function _F(e){$2[e.id]||($2[e.id]=e)}function $2t(e){if(cW(e)){var t=$2[fW(e)];if(t==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return t}return e}var Tk={};function C2t(e){if(_F(e),w2t(e),Tk[e.id])return Tk[e.id];var t=aC({},"data-css-"+e.id,lC&&e.label||"");return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-"+e.id}}),Tk[e.id]=t,t}function S2t(e){for(var t=[":",".","[",">"," "],n=!1,r=e.charAt(0),i=0;i<t.length;i++)if(r===t[i]){n=!0;break}return n||e.indexOf("&")>=0}function LJ(e,t){var n=IP(e).map(function(i){return i.indexOf("&")>=0?i:"&"+i}),r=IP(t).map(function(i){return i.indexOf("&")>=0?i:"&"+i});return r.reduce(function(i,s){return i.concat(n.map(function(o){return s.replace(/\&/g,o)}))},[]).join(",")}function k2t(e,t){return e?"@media "+e.substring(6)+" and "+t.substring(6):t}function E2t(e){return e.indexOf("@media")===0}function A2t(e){return e.indexOf("@supports")===0}function _2t(e,t){return e?"@supports "+e.substring(9)+" and "+t.substring(9):t}function H1e(e){for(var t=[],n=0;n<e.length;n++)Array.isArray(e[n])?t=t.concat(H1e(e[n])):t=t.concat(e[n]);return t}var PJ={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function Dd(e,t){var n=t.selector,r=n===void 0?"":n,i=t.mq,s=i===void 0?"":i,o=t.supp,a=o===void 0?"":o,u=t.src,l=u===void 0?{}:u;Array.isArray(l)||(l=[l]),l=H1e(l),l.forEach(function(c){if(cW(c)){var f=$2t(c);if(f.type!=="css")throw new Error("cannot merge this rule");c=f.style}c=(0,qh.default)(c),c&&c.composes&&Dd(e,{selector:r,mq:s,supp:a,src:c.composes}),Object.keys(c||{}).forEach(function(h){if(S2t(h))PJ[h]&&PJ[h].forEach(function(p){return Dd(e,{selector:LJ(r,p),mq:s,supp:a,src:c[h]})}),Dd(e,{selector:LJ(r,h),mq:s,supp:a,src:c[h]});else if(E2t(h))Dd(e,{selector:r,mq:k2t(s,h),supp:a,src:c[h]});else if(A2t(h))Dd(e,{selector:r,mq:s,supp:_2t(a,h),src:c[h]});else if(h!=="composes"){var d=e;a&&(d[a]=d[a]||{},d=d[a]),s&&(d[s]=d[s]||{},d=d[s]),r&&(d[r]=d[r]||{},d=d[r]),h==="label"?lC&&(e.label=e.label.concat(c.label)):d[h]=c[h]}})})}function BJ(e){var t={label:[]};Dd(t,{src:e});var n={id:cC(t),style:t,label:lC?t.label.join("."):"",type:"css"};return C2t(n)}var o_={};Object.defineProperty(o_,"toString",{enumerable:!1,value:function(){return"css-nil"}});var TS=typeof WeakMap<"u"?[o_,new WeakMap,new WeakMap,new WeakMap]:[o_];function T2t(e){return function(t){if(TS[t.length]){for(var n=TS[t.length],r=0;r<t.length-1;)n.has(t[r])||n.set(t[r],new WeakMap),n=n.get(t[r]),r++;if(n.has(t[t.length-1])){var i=n.get(t[r]);if($2[i.toString().substring(4)])return i}}var s=e(t);if(TS[t.length]){for(var o=0,a=TS[t.length];o<t.length-1;)a=a.get(t[o]),o++;try{a.set(t[o],s)}catch{}}return s}}var I2t=typeof WeakMap<"u"?T2t(BJ):BJ;function Er(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0]&&t[0].length&&t[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return t=(0,qh.default)(t),t?I2t(t):o_}Er.insert=function(e){var t={id:cC(e),css:e,type:"raw"};_F(t),va[t.id]||(js.insert(t.css),va[t.id]=AF?!0:[t.css])};de.insertRule=Er.insert;Er.global=function(e,t){if(t=(0,qh.default)(t),t)return Er.insert(DP({selector:e,style:t}))};de.insertGlobal=Er.global;function D2t(e){if(!va[e.id]){var t=Object.keys(e.keyframes).map(function(r){var i=uC.keyframes.transform({id:e.id,name:r,style:e.keyframes[r]});return i.name+"{"+(0,oW.createMarkupForStyles)(i.style)+"}"}).join(""),n=["-webkit-","-moz-","-o-",""].map(function(r){return"@"+r+"keyframes "+(e.name+"_"+e.id)+"{"+t+"}"});n.forEach(function(r){return js.insert(r)}),va[e.id]=AF?!0:n}}Er.keyframes=function(e,t){t||(t=e,e="animation"),t=(0,qh.default)(t)||{};var n={id:cC({name:e,kfs:t}),type:"keyframes",name:e,keyframes:t};return _F(n),D2t(n),e+"_"+n.id};Er.fontFace=function(e){e=(0,qh.default)(e);var t={id:cC(e),type:"font-face",font:e};return _F(t),N2t(t),e.fontFamily};de.fontFace=Er.fontFace;de.keyframes=Er.keyframes;function N2t(e){if(!va[e.id]){var t="@font-face{"+(0,oW.createMarkupForStyles)(e.font)+"}";js.insert(t),va[e.id]=AF?!0:[t]}}function F2t(e){(0,f2t.default)(va,e.reduce(function(t,n){return t[n]=!0,t},{}))}function O2t(){va=js.inserted={},$2=js.registered={},Tk={},js.flush(),js.inject()}de.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var R2t=de.style=Er;function hW(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e?Er(aC({},e,n)):R2t(n)}de.$=hW;function M2t(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Er(aC({},e+" &",n))}de.merge=Er;de.compose=Er;function L2t(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Er(aC({},"@media "+e,n))}function Ye(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Er(aC({},e,n))}function P2t(e){return Ye(":active",e)}function B2t(e){return Ye(":any",e)}function z2t(e){return Ye(":checked",e)}function U2t(e){return Ye(":disabled",e)}function j2t(e){return Ye(":empty",e)}function W2t(e){return Ye(":enabled",e)}function V2t(e){return Ye(":default",e)}function G2t(e){return Ye(":first",e)}function H2t(e){return Ye(":first-child",e)}function q2t(e){return Ye(":first-of-type",e)}function X2t(e){return Ye(":fullscreen",e)}function Y2t(e){return Ye(":focus",e)}function K2t(e){return Ye(":hover",e)}function Z2t(e){return Ye(":indeterminate",e)}function J2t(e){return Ye(":in-range",e)}function Q2t(e){return Ye(":invalid",e)}function ewt(e){return Ye(":last-child",e)}function twt(e){return Ye(":last-of-type",e)}function nwt(e){return Ye(":left",e)}function rwt(e){return Ye(":link",e)}function iwt(e){return Ye(":only-child",e)}function swt(e){return Ye(":only-of-type",e)}function owt(e){return Ye(":optional",e)}function awt(e){return Ye(":out-of-range",e)}function uwt(e){return Ye(":read-only",e)}function lwt(e){return Ye(":read-write",e)}function cwt(e){return Ye(":required",e)}function fwt(e){return Ye(":right",e)}function hwt(e){return Ye(":root",e)}function dwt(e){return Ye(":scope",e)}function pwt(e){return Ye(":target",e)}function gwt(e){return Ye(":valid",e)}function mwt(e){return Ye(":visited",e)}function ywt(e,t){return Ye(":dir("+e+")",t)}function bwt(e,t){return Ye(":lang("+e+")",t)}function xwt(e,t){var n=e.split(",").map(function(r){return r.trim()}).map(function(r){return":not("+r+")"});return n.length===1?Ye(":not("+e+")",t):hW(n.join(""),t)}function vwt(e,t){return Ye(":nth-child("+e+")",t)}function wwt(e,t){return Ye(":nth-last-child("+e+")",t)}function $wt(e,t){return Ye(":nth-last-of-type("+e+")",t)}function Cwt(e,t){return Ye(":nth-of-type("+e+")",t)}function Swt(e){return Ye("::after",e)}function kwt(e){return Ye("::before",e)}function Ewt(e){return Ye("::first-letter",e)}function Awt(e){return Ye("::first-line",e)}function _wt(e){return Ye("::selection",e)}function Twt(e){return Ye("::backdrop",e)}function Iwt(e){return Er({"::placeholder":e})}function Dwt(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t=(0,qh.default)(t),t?t.map(function(r){var i={label:[]};return Dd(i,{src:r}),s_(cC(i),i_(i)).join("")}).join(""):""}function Nwt(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t=(0,qh.default)(t);var r=t?t.map(function(i){fW(i);var s=Object.keys(i)[0],o=i[s];return s+'="'+(o||"")+'"'}).join(" "):"";return r}var Ki={},fC={};Object.defineProperty(fC,"__esModule",{value:!0});function Fwt(e){return e.name!=null}fC.isSurfaceInfo=Fwt;function Owt(e){return e.drawArea instanceof HTMLElement}fC.isSurface=Owt;var hC={},dW={};function Rwt(){}var Es={},fm=[],zJ=[];function C2(e,t){var n=zJ,r,i,s,o;for(o=arguments.length;o-- >2;)fm.push(arguments[o]);for(t&&t.children!=null&&(fm.length||fm.push(t.children),delete t.children);fm.length;)if((i=fm.pop())&&i.pop!==void 0)for(o=i.length;o--;)fm.push(i[o]);else typeof i=="boolean"&&(i=null),(s=typeof e!="function")&&(i==null?i="":typeof i=="number"?i=String(i):typeof i!="string"&&(s=!1)),s&&r?n[n.length-1]+=i:n===zJ?n=[i]:n.push(i),r=s;var a=new Rwt;return a.nodeName=e,a.children=n,a.attributes=t??void 0,a.key=t==null?void 0:t.key,Es.vnode!==void 0&&Es.vnode(a),a}function kf(e,t){for(var n in t)e[n]=t[n];return e}var Mwt=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function q1e(e,t){return C2(e.nodeName,kf(kf({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var Lwt=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,NP=[];function X1e(e){!e._dirty&&(e._dirty=!0)&&NP.push(e)==1&&(Es.debounceRendering||Mwt)(pW)}function pW(){var e,t=NP;for(NP=[];e=t.pop();)e._dirty&&TF(e)}function Pwt(e,t,n){return typeof t=="string"||typeof t=="number"?e.splitText!==void 0:typeof t.nodeName=="string"?!e._componentConstructor&&Y1e(e,t.nodeName):n||e._componentConstructor===t.nodeName}function Y1e(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function K1e(e){var t=kf({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(n!==void 0)for(var r in n)t[r]===void 0&&(t[r]=n[r]);return t}function Bwt(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}function gW(e){var t=e.parentNode;t&&t.removeChild(e)}function UJ(e,t,n,r,i){if(t==="className"&&(t="class"),t!=="key")if(t==="ref")n&&n(null),r&&r(e);else if(t==="class"&&!i)e.className=r||"";else if(t==="style"){if((!r||typeof r=="string"||typeof n=="string")&&(e.style.cssText=r||""),r&&typeof r=="object"){if(typeof n!="string")for(var s in n)s in r||(e.style[s]="");for(var s in r)e.style[s]=typeof r[s]=="number"&&Lwt.test(s)===!1?r[s]+"px":r[s]}}else if(t==="dangerouslySetInnerHTML")r&&(e.innerHTML=r.__html||"");else if(t[0]=="o"&&t[1]=="n"){var o=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,jJ,o):e.removeEventListener(t,jJ,o),(e._listeners||(e._listeners={}))[t]=r}else if(t!=="list"&&t!=="type"&&!i&&t in e)zwt(e,t,r??""),(r==null||r===!1)&&e.removeAttribute(t);else{var a=i&&t!==(t=t.replace(/^xlink:?/,""));r==null||r===!1?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):typeof r!="function"&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}}function zwt(e,t,n){try{e[t]=n}catch{}}function jJ(e){return this._listeners[e.type](Es.event&&Es.event(e)||e)}var Z1e=[],FP=0,Kc=!1,a_=!1;function J1e(){for(var e;e=Z1e.pop();)Es.afterMount&&Es.afterMount(e),e.componentDidMount&&e.componentDidMount()}function Q1e(e,t,n,r,i,s){FP++||(Kc=i!=null&&i.ownerSVGElement!==void 0,a_=e!=null&&!("__preactattr_"in e));var o=eye(e,t,n,r,s);return i&&o.parentNode!==i&&i.appendChild(o),--FP||(a_=!1,s||J1e()),o}function eye(e,t,n,r,i){var s=e,o=Kc;if((t==null||typeof t=="boolean")&&(t=""),typeof t=="string"||typeof t=="number")return e&&e.splitText!==void 0&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(s=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(s,e),Yp(e,!0))),s.__preactattr_=!0,s;var a=t.nodeName;if(typeof a=="function")return Gwt(e,t,n,r);if(Kc=a==="svg"?!0:a==="foreignObject"?!1:Kc,a=String(a),(!e||!Y1e(e,a))&&(s=Bwt(a,Kc),e)){for(;e.firstChild;)s.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(s,e),Yp(e,!0)}var u=s.firstChild,l=s.__preactattr_,c=t.children;if(l==null){l=s.__preactattr_={};for(var f=s.attributes,h=f.length;h--;)l[f[h].name]=f[h].value}return!a_&&c&&c.length===1&&typeof c[0]=="string"&&u!=null&&u.splitText!==void 0&&u.nextSibling==null?u.nodeValue!=c[0]&&(u.nodeValue=c[0]):(c&&c.length||u!=null)&&Uwt(s,c,n,r,a_||l.dangerouslySetInnerHTML!=null),jwt(s,t.attributes,l),Kc=o,s}function Uwt(e,t,n,r,i){var s=e.childNodes,o=[],a={},u=0,l=0,c=s.length,f=0,h=t?t.length:0,d,p,g,m,y;if(c!==0)for(var b=0;b<c;b++){var v=s[b],x=v.__preactattr_,w=h&&x?v._component?v._component.__key:x.key:null;w!=null?(u++,a[w]=v):(x||(v.splitText!==void 0?!i||v.nodeValue.trim():i))&&(o[f++]=v)}if(h!==0)for(var b=0;b<h;b++){m=t[b],y=null;var w=m.key;if(w!=null)u&&a[w]!==void 0&&(y=a[w],a[w]=void 0,u--);else if(!y&&l<f){for(d=l;d<f;d++)if(o[d]!==void 0&&Pwt(p=o[d],m,i)){y=p,o[d]=void 0,d===f-1&&f--,d===l&&l++;break}}y=eye(y,m,n,r),g=s[b],y&&y!==e&&y!==g&&(g==null?e.appendChild(y):y===g.nextSibling?gW(g):e.insertBefore(y,g))}if(u)for(var b in a)a[b]!==void 0&&Yp(a[b],!1);for(;l<=f;)(y=o[f--])!==void 0&&Yp(y,!1)}function Yp(e,t){var n=e._component;n?IF(n):(e.__preactattr_!=null&&e.__preactattr_.ref&&e.__preactattr_.ref(null),(t===!1||e.__preactattr_==null)&&gW(e),tye(e))}function tye(e){for(e=e.lastChild;e;){var t=e.previousSibling;Yp(e,!0),e=t}}function jwt(e,t,n){var r;for(r in n)!(t&&t[r]!=null)&&n[r]!=null&&UJ(e,r,n[r],n[r]=void 0,Kc);for(r in t)r!=="children"&&r!=="innerHTML"&&(!(r in n)||t[r]!==(r==="value"||r==="checked"?e[r]:n[r]))&&UJ(e,r,n[r],n[r]=t[r],Kc)}var OP={};function Wwt(e){var t=e.constructor.name;(OP[t]||(OP[t]=[])).push(e)}function nye(e,t,n){var r=OP[e.name],i;if(e.prototype&&e.prototype.render?(i=new e(t,n),S2.call(i,t,n)):(i=new S2(t,n),i.constructor=e,i.render=Vwt),r){for(var s=r.length;s--;)if(r[s].constructor===e){i.nextBase=r[s].nextBase,r.splice(s,1);break}}return i}function Vwt(e,t,n){return this.constructor(e,n)}function u_(e,t,n,r,i){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,n!==0&&(n===1||Es.syncComponentUpdates!==!1||!e.base?TF(e,1,i):X1e(e)),e.__ref&&e.__ref(e))}function TF(e,t,n,r){if(!e._disable){var i=e.props,s=e.state,o=e.context,a=e.prevProps||i,u=e.prevState||s,l=e.prevContext||o,c=e.base,f=e.nextBase,h=c||f,d=e._component,p=!1,g,m,y;if(c&&(e.props=a,e.state=u,e.context=l,t!==2&&e.shouldComponentUpdate&&e.shouldComponentUpdate(i,s,o)===!1?p=!0:e.componentWillUpdate&&e.componentWillUpdate(i,s,o),e.props=i,e.state=s,e.context=o),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!p){g=e.render(i,s,o),e.getChildContext&&(o=kf(kf({},o),e.getChildContext()));var b=g&&g.nodeName,v,x;if(typeof b=="function"){var w=K1e(g);m=d,m&&m.constructor===b&&w.key==m.__key?u_(m,w,1,o,!1):(v=m,e._component=m=nye(b,w,o),m.nextBase=m.nextBase||f,m._parentComponent=e,u_(m,w,0,o,!1),TF(m,1,n,!0)),x=m.base}else y=h,v=d,v&&(y=e._component=null),(h||t===1)&&(y&&(y._component=null),x=Q1e(y,g,o,n||!c,h&&h.parentNode,!0));if(h&&x!==h&&m!==d){var C=h.parentNode;C&&x!==C&&(C.replaceChild(x,h),v||(h._component=null,Yp(h,!1)))}if(v&&IF(v),e.base=x,x&&!r){for(var $=e,S=e;S=S._parentComponent;)($=S).base=x;x._component=$,x._componentConstructor=$.constructor}}if(!c||n?Z1e.unshift(e):p||(e.componentDidUpdate&&e.componentDidUpdate(a,u,l),Es.afterUpdate&&Es.afterUpdate(e)),e._renderCallbacks!=null)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);!FP&&!r&&J1e()}}function Gwt(e,t,n,r){for(var i=e&&e._component,s=i,o=e,a=i&&e._componentConstructor===t.nodeName,u=a,l=K1e(t);i&&!u&&(i=i._parentComponent);)u=i.constructor===t.nodeName;return i&&u&&(!r||i._component)?(u_(i,l,3,n,r),e=i.base):(s&&!a&&(IF(s),e=o=null),i=nye(t.nodeName,l,n),e&&!i.nextBase&&(i.nextBase=e,o=null),u_(i,l,1,n,r),e=i.base,o&&e!==o&&(o._component=null,Yp(o,!1))),e}function IF(e){Es.beforeUnmount&&Es.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?IF(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,gW(t),Wwt(e),tye(t)),e.__ref&&e.__ref(null)}function S2(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}kf(S2.prototype,{setState:function(t,n){var r=this.state;this.prevState||(this.prevState=kf({},r)),kf(r,typeof t=="function"?t(r,this.props):t),n&&(this._renderCallbacks=this._renderCallbacks||[]).push(n),X1e(this)},forceUpdate:function(t){t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),TF(this,2)},render:function(){}});function rye(e,t,n){return Q1e(n,e,{},!1,t,!1)}var Hwt={h:C2,createElement:C2,cloneElement:q1e,Component:S2,render:rye,rerender:pW,options:Es};const qwt=Object.freeze(Object.defineProperty({__proto__:null,Component:S2,cloneElement:q1e,createElement:C2,default:Hwt,h:C2,options:Es,render:rye,rerender:pW},Symbol.toStringTag,{value:"Module"})),mW=tg(qwt);var yW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(yW,"__esModule",{value:!0});const IS=mW,SR=de;class jm extends IS.Component{componentDidMount(){const{name:t,tab:n}=this.props;this.props.registerSurface(t,n,this)}componentDidUpdate(){return!1}render(){const{name:t,visible:n,styles:r}=this.props,i=Object.assign({},jm.defaultStyles,r),{width:s,height:o}=i;let{maxHeight:a,maxWidth:u}=i;a=o===jm.defaultStyles.height?a:o,u=s===jm.defaultStyles.width?u:s;const l=SR.css({display:n?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:o,width:s,maxHeight:a,maxWidth:u,overflow:"auto"}),c=SR.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),f=SR.css({boxSizing:"border-box"});return IS.h("div",{className:`${l} tf-surface`,ref:h=>this.container=h,"data-visible":n},IS.h("div",{className:`${c} tf-label`,ref:h=>this.label=h},t),IS.h("div",{className:`${f} tf-draw-area`,ref:h=>this.drawArea=h}))}}jm.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"};yW.SurfaceComponent=jm;var bW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(bW,"__esModule",{value:!0});const Px=mW,iye=de;class Xwt extends Px.Component{render(){const{tabNames:t,activeTab:n,handleClick:r}=this.props,i=t.length>0?t.map(o=>Px.h(Ywt,{key:o,id:o,handleClick:r,isActive:o===n},o)):null,s=iye.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return Px.h("div",{className:`${s} visor-tabs`},i)}}bW.Tabs=Xwt;class Ywt extends Px.Component{render(){const{children:t,isActive:n,handleClick:r,id:i}=this.props,s=iye.css({borderBottomColor:n?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return Px.h("a",{className:`${s} tf-tab`,"data-isactive":n,onClick:()=>r(i)},t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(dW,"__esModule",{value:!0});const Qo=mW,Gd=de,Kwt=yW,Zwt=bW;class xW extends Qo.Component{static render(t,n,r){return Qo.render(Qo.h(xW,Object.assign({},r)),t,n)}constructor(t){super(t),this.surfaces=new Map;const n=t.startOpen==null?!0:t.startOpen;this.state={isOpen:n,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(t,n){const r=this.surfaceId(t,n);let i;if(this.surfaces.has(r))i=this.surfaces.get(r);else throw Error(`Surface not found with id: ${r}`);return{container:i.container,label:i.label,drawArea:i.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(t,n){return t+n}setTabs(t){const n=t.map(s=>s.tab),r=this.state.tabs;let i;for(const s of n)r.has(s)||(r.add(s),i=s);i!=null&&this.setState({tabs:r,activeTab:i})}getTabs(){return this.state.tabs}registerSurface(t,n,r){const i=this.surfaceId(t,n);this.surfaces.set(i,r)}keyHandler(t){t.keyCode===192&&(t.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(t){this.setState({activeTab:t})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(t){this.setTabs(t.surfaceList)}render(){const{isOpen:t,isFullscreen:n,activeTab:r}=this.state,{surfaceList:i}=this.props,s=Array.from(this.getTabs().values()),u=n?"90vw":"550px",l=Gd.css({width:u,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),c=Gd.css({right:"0"}),f=Gd.css({right:`calc(-${u} - 10px)`}),h=t?c:f,d=Gd.css({});return Qo.h("div",{className:`${l} ${h} visor`,"data-isopen":t,"data-isfullscreen":n},Qo.h(Jwt,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:n}),Qo.h(Zwt.Tabs,{tabNames:s,activeTab:r,handleClick:this.setActiveTab.bind(this)}),Qo.h("div",{className:`${d} visor-surfaces`},i.map(p=>Qo.h(Kwt.SurfaceComponent,{key:p.name+p.tab,name:p.name,tab:p.tab,styles:p.styles,registerSurface:this.registerSurface.bind(this),visible:r===p.tab}))))}}dW.VisorComponent=xW;function Jwt(e){const{isFullScreen:t,fullScreenHandler:n,closeHandler:r}=e,i=Gd.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),s=Gd.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),o=Gd.css({marginLeft:"auto"});return Qo.h("div",{className:`${i} visor-controls`},Qo.h("button",{className:`${s}`,onClick:n},t?"Minimize":"Maximize"),Qo.h("button",{className:`${s} ${o}`,onClick:r},"Hide"))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(hC,"__esModule",{value:!0});const Qwt=dW;let DS;const e$t="Visor",kR="tfjs-visor-container";function t$t(){if(typeof document>"u")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(kR)&&DS!=null)return DS;let e=document.getElementById(kR);e==null&&(e=document.createElement("div"),e.id=kR,document.body.appendChild(e));let t;function n(s,o){let a=null;return t=Qwt.VisorComponent.render(s,t,{ref:u=>a=u,surfaceList:Array.from(o.values())}),a}const r=new Map,i=n(e,r);return DS=new sye(i,e,r,n),DS}hC.visor=t$t;class sye{constructor(t,n,r,i){this.visorComponent=t,this.el=n,this.surfaceList=r,this.renderVisor=i}surface(t){const{name:n}=t,r=t.tab==null?e$t:t.tab;if(n==null||!(typeof n=="string"||n instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const i=Object.assign({},t,{tab:r}),s=`${n}-${r}`;return this.surfaceList.has(s)||this.surfaceList.set(s,i),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(n,r)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(t){if(!this.visorComponent.state.tabs.has(t))throw new Error(`Tab '${t}' does not exist`);this.visorComponent.setState({activeTab:t})}}hC.Visor=sye;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var n$t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(Ki,"__esModule",{value:!0});const WJ=fC,r$t=hC;function i$t(e){if(e instanceof HTMLElement)return e;if(WJ.isSurface(e))return e.drawArea;if(WJ.isSurfaceInfo(e))return r$t.visor().surface({name:e.name,tab:e.tab,styles:e.styles}).drawArea;throw new Error("Not a drawable")}Ki.getDrawArea=i$t;function s$t(e,t){const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const s=n[i];if(e[s]!==t[s])return!1}return!0}Ki.shallowEquals=s$t;function o$t(){return n$t(this,void 0,void 0,function*(){yield new Promise(e=>requestAnimationFrame(e))})}Ki.nextFrame=o$t;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(zo,"__esModule",{value:!0});const VJ=de,a$t=Ki,u$t={prepend:!1};function l$t(e,t,n={}){const r=a$t.getDrawArea(e),i=VJ.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),s=VJ.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),o=Object.assign({},u$t,n);let a=r.querySelector(`div[data-name=${t}]`);if(!a){if(a=document.createElement("div"),a.setAttribute("class",`${i}`),a.dataset.name=t,o.title){const u=document.createElement("div");u.setAttribute("class",`subsurface-title ${s}`),u.innerText=o.title,a.appendChild(u)}o.prepend?r.insertBefore(a,r.firstChild):r.appendChild(a)}return a}zo.subSurface=l$t;function c$t(e){let n=0,r=e;for(;r&&r.clientWidth===0;)r=r.parentElement,n=50;return r.clientWidth-n}zo.getDefaultWidth=c$t;function f$t(e){return e.clientHeight===0?200:e.clientHeight}zo.getDefaultHeight=f$t;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var h$t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},d$t=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(B5,"__esModule",{value:!0});const p$t=d$t(Dy),GJ=zo,NS=Ki;function g$t(e,t,n={}){return h$t(this,void 0,void 0,function*(){const r=NS.getDrawArea(e),i=t,s=Object.assign({},m$t,n);if(ER.has(r)){const m=ER.get(r);if(NS.shallowEquals(s,m.lastOptions)){yield NS.nextFrame();const y=m.view,b=y.changeset().remove(()=>!0).insert(i);yield y.change("values",b).runAsync();return}}const{xLabel:o,yLabel:a,xType:u,yType:l}=s;let c=null;o!=null&&(c={title:o});let f=null;a!=null&&(f={title:a});const h={actions:!1,mode:"vega-lite",defaultStyle:!1};let d;s.color!=null?Array.isArray(s.color)?d={field:"index",type:"nominal",scale:{range:s.color}}:d={value:s.color}:d={value:"#4C78A0"};const p={width:s.width||GJ.getDefaultWidth(r),height:s.height||GJ.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:s.fontSize,titleFontSize:s.fontSize},text:{fontSize:s.fontSize},legend:{labelFontSize:s.fontSize,titleFontSize:s.fontSize}},data:{values:i,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:u,axis:c},y:{field:"value",type:l,axis:f},color:d}};yield NS.nextFrame();const g=yield p$t.default(r,p,h);ER.set(r,{view:g.view,lastOptions:s})})}B5.barchart=g$t;const m$t={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},ER=new Map;var vW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var y$t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},b$t=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(vW,"__esModule",{value:!0});const x$t=b$t(Dy),HJ=zo,v$t=Ki;function w$t(e,t,n={}){return y$t(this,void 0,void 0,function*(){const r=Object.assign({},$$t,n),i=v$t.getDrawArea(e),s=[],o=t.values,a=t.tickLabels||[],u=a.length===0;let l=!0;for(let d=0;d<o.length;d++){const p=u?`Class ${d}`:a[d];u&&a.push(p);for(let g=0;g<o[d].length;g++){const m=u?`Class ${g}`:a[g],y=o[d][g];d===g&&!r.shadeDiagonal?s.push({label:p,prediction:m,count:y,noFill:!0}):(s.push({label:p,prediction:m,count:y,scaleCount:y}),y!==0&&(l=!1))}}if(!r.shadeDiagonal&&l)for(const d of s)d.noFill===!0&&(d.noFill=!1,d.scaleCount=d.count);const c={actions:!1,mode:"vega-lite",defaultStyle:!1},f={width:r.width||HJ.getDefaultWidth(i),height:r.height||HJ.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},data:{values:s},encoding:{x:{field:"prediction",type:"ordinal",title:r.xLabel||"prediction",scale:{domain:a}},y:{field:"label",type:"ordinal",title:r.yLabel||"label",scale:{domain:a}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:r.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};r.shadeDiagonal===!1&&f.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),r.showTextOverlay&&f.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const h=typeof r.colorMap=="string"?{scheme:r.colorMap}:r.colorMap;f.layer[0].encoding.color.scale.range=h,yield x$t.default(i,f,c)})}vW.confusionMatrix=w$t;const $$t={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]};var wW={},Ic={};Object.defineProperty(Ic,"__esModule",{value:!0});/*
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oye(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}Ic.assert=oye;function C$t(e,t,n=""){oye(aye(e,t),n+` Shapes ${e} and ${t} must match`)}Ic.assertShapesMatch=C$t;function aye(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}Ic.arraysEqual=aye;Ic.DECIMAL_PLACES_TO_CHECK=4;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var uye=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},S$t=Je&&Je.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},k$t=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(wW,"__esModule",{value:!0});const Bx=S$t(cre),E$t=k$t(Dy),qJ=zo,k2=Ic,A$t=Ki;function _$t(e,t,n={}){return uye(this,void 0,void 0,function*(){const r=Object.assign({},I$t,n),i=A$t.getDrawArea(e);let s=t.values;r.rowMajor&&(s=yield T$t(t.values));const{xTickLabels:o,yTickLabels:a}=t;o!=null&&XJ(s,o,0),a!=null&&XJ(s,a,1);const u="@tfidx@",l=[];if(s instanceof Bx.Tensor){k2.assert(s.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const g=yield s.data(),[m,y]=s.shape;for(let b=0;b<m;b++){const v=o?`${o[b]}${u}${b}`:b;for(let x=0;x<y;x++){const w=a?`${a[x]}${u}${x}`:x,C=b*y+x,$=g[C];l.push({x:v,y:w,value:$})}}}else{const g=s;for(let m=0;m<g.length;m++){const y=o?`${o[m]}${u}${m}`:m;for(let b=0;b<g[m].length;b++){const v=a?`${a[b]}${u}${b}`:b,x=g[m][b];l.push({x:y,y:v,value:x})}}}const c={actions:!1,mode:"vega-lite",defaultStyle:!1},f={width:r.width||qJ.getDefaultWidth(i),height:r.height||qJ.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:l},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:r.xType,title:r.xLabel,sort:!1},y:{field:"y",type:r.yType,title:r.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},h=`${u}\\d+$`,d=new RegExp(h);o&&(f.encoding.x.axis={labelExpr:`replace(datum.value, regexp(/${h}/), '')`}),a&&(f.encoding.y.axis={labelExpr:`replace(datum.value, regexp(/${h}/), '')`}),(o||a)&&(c.tooltip={sanitize:g=>String(g).replace(d,"")});let p;switch(r.colorMap){case"blues":p=["#f7fbff","#4292c6"];break;case"greyscale":p=["#000000","#ffffff"];break;case"viridis":default:p="viridis";break}if(p!=="viridis"){const g=f.encoding.fill;g.scale={range:p}}if(r.domain){const g=f.encoding.fill;g.scale!=null?g.scale=Object.assign({},g.scale,{domain:r.domain}):g.scale={domain:r.domain}}yield E$t.default(i,f,c)})}wW.heatmap=_$t;function T$t(e){return uye(this,void 0,void 0,function*(){let t,n;e instanceof Bx.Tensor?(t=e.shape,n=e.transpose()):(t=[e.length,e[0].length],n=Bx.tidy(()=>Bx.tensor2d(e).transpose())),k2.assert(n.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const r=yield n.array();n.dispose();const i=[r.length,r[0].length];return k2.assert(t[0]===i[1]&&t[1]===i[0],`Unexpected transposed shape. Original ${t} : Transposed ${i}`),r})}function XJ(e,t,n){const r=e instanceof Bx.Tensor?e.shape:[e.length,e[0].length];n===0?k2.assert(r[0]===t.length,`Length of xTickLabels (${t.length}) must match number of rows (${r[0]})`):n===1&&k2.assert(r[1]===t.length,`Length of yTickLabels (${t.length}) must match number of columns (${r[1]})`)}const I$t={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1};var dC={};const lye=tg(S9e);var ll={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var DF=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(ll,"__esModule",{value:!0});const Kp=cre,df=Ic;function D$t(e){if(!Array.isArray(e))throw new Error("input must be an array");if(e.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const t=e.length;let n=-1/0,r=1/0,i=0,s=0,o=0;for(let u=0;u<t;u++){const l=e[u];l>n&&(n=l),l<r&&(r=l),l===0&&(i+=1),isNaN(l)?s+=1:isFinite(l)||(o+=1)}const a={numVals:t,numZeros:i,numNans:s,max:n,min:r,numInfs:o};return a.max===-1/0&&(a.max=NaN),a.min===1/0&&(a.min=NaN),a}ll.arrayStats=D$t;function N$t(e){return DF(this,void 0,void 0,function*(){const[t,n,r]=Kp.tidy(()=>{const i=Kp.scalar(0,e.dtype),s=e.min(),o=e.max(),a=e.equal(i).sum();return[s,o,a]});return Promise.all([e.data(),t.data(),n.data(),r.data()]).then(([i,s,o,a])=>{const u=i.length;let l=0,c=0;for(let p=0;p<u;p++){const g=i[p];isNaN(g)?l+=1:isFinite(g)||(c+=1)}let f=s[0],h=o[0];return l===u&&(f=NaN,h=NaN),{numVals:u,numZeros:a[0],numNans:l,min:f,max:h,numInfs:c}})})}ll.tensorStats=N$t;function F$t(e,t,n,r){return DF(this,void 0,void 0,function*(){df.assert(e.rank===1,"labels must be a 1D tensor"),df.assert(t.rank===1,"predictions must be a 1D tensor"),df.assert(e.size===t.size,"labels and predictions must be the same length"),r!=null&&df.assert(r.size===t.size,"labels and predictions must be the same length");const i=e.cast("int32"),s=t.cast("int32");n==null&&(n=Kp.tidy(()=>Kp.maximum(i.max(),s.max()).cast("int32").dataSync()[0]+1));let o=Promise.resolve(null);return r!=null&&(o=r.data()),Promise.all([i.data(),s.data(),o]).then(([a,u,l])=>{const c=Array(n).fill(0);for(let f=0;f<n;f++)c[f]=Array(n).fill(0);for(let f=0;f<a.length;f++){const h=a[f],d=u[f];l!=null?c[h][d]+=l[f]:c[h][d]+=1}return c})})}ll.confusionMatrix=F$t;function O$t(e,t){return DF(this,void 0,void 0,function*(){df.assertShapesMatch(e.shape,t.shape,"Error computing accuracy.");const n=e.equal(t),r=n.mean(),i=(yield r.data())[0];return Kp.dispose([n,r]),i})}ll.accuracy=O$t;function R$t(e,t,n){return DF(this,void 0,void 0,function*(){return df.assert(e.rank===1,"labels must be a 1D tensor"),df.assert(t.rank===1,"predictions must be a 1D tensor"),df.assert(e.size===t.size,"labels and predictions must be the same length"),n==null&&(n=Kp.tidy(()=>Kp.maximum(e.max(),t.max()).dataSync()[0]+1)),Promise.all([e.data(),t.data()]).then(([r,i])=>{const s=Array(n).fill(0),o=Array(n).fill(0);for(let u=0;u<r.length;u++){const l=r[u],c=i[u];s[l]+=1,l===c&&(o[l]+=1)}const a=[];for(let u=0;u<s.length;u++)a.push({count:s[u],accuracy:s[u]===0?0:o[u]/s[u]});return a})})}ll.perClassAccuracy=R$t;var Oy={},RP="http://www.w3.org/1999/xhtml";const MP={svg:"http://www.w3.org/2000/svg",xhtml:RP,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $W(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),MP.hasOwnProperty(t)?{space:MP[t],local:e}:e}function M$t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===RP&&t.documentElement.namespaceURI===RP?t.createElement(e):t.createElementNS(n,e)}}function L$t(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function NF(e){var t=$W(e);return(t.local?L$t:M$t)(t)}function P$t(){}function CW(e){return e==null?P$t:function(){return this.querySelector(e)}}function B$t(e){typeof e!="function"&&(e=CW(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=new Array(o),u,l,c=0;c<o;++c)(u=s[c])&&(l=e.call(u,u.__data__,c,s))&&("__data__"in u&&(l.__data__=u.__data__),a[c]=l);return new Gi(r,this._parents)}function z$t(){return[]}function cye(e){return e==null?z$t:function(){return this.querySelectorAll(e)}}function U$t(e){typeof e!="function"&&(e=cye(e));for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],a=o.length,u,l=0;l<a;++l)(u=o[l])&&(r.push(e.call(u,u.__data__,l,o)),i.push(u));return new Gi(r,i)}var fye=function(e){return function(){return this.matches(e)}};if(typeof document<"u"){var Ib=document.documentElement;if(!Ib.matches){var j$t=Ib.webkitMatchesSelector||Ib.msMatchesSelector||Ib.mozMatchesSelector||Ib.oMatchesSelector;fye=function(e){return function(){return j$t.call(this,e)}}}}const hye=fye;function W$t(e){typeof e!="function"&&(e=hye(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],u,l=0;l<o;++l)(u=s[l])&&e.call(u,u.__data__,l,s)&&a.push(u);return new Gi(r,this._parents)}function dye(e){return new Array(e.length)}function V$t(){return new Gi(this._enter||this._groups.map(dye),this._parents)}function l_(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}l_.prototype={constructor:l_,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function G$t(e){return function(){return e}}var YJ="$";function H$t(e,t,n,r,i,s){for(var o=0,a,u=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new l_(e,s[o]);for(;o<u;++o)(a=t[o])&&(i[o]=a)}function q$t(e,t,n,r,i,s,o){var a,u,l={},c=t.length,f=s.length,h=new Array(c),d;for(a=0;a<c;++a)(u=t[a])&&(h[a]=d=YJ+o.call(u,u.__data__,a,t),d in l?i[a]=u:l[d]=u);for(a=0;a<f;++a)d=YJ+o.call(e,s[a],a,s),(u=l[d])?(r[a]=u,u.__data__=s[a],l[d]=null):n[a]=new l_(e,s[a]);for(a=0;a<c;++a)(u=t[a])&&l[h[a]]===u&&(i[a]=u)}function X$t(e,t){if(!e)return d=new Array(this.size()),l=-1,this.each(function(C){d[++l]=C}),d;var n=t?q$t:H$t,r=this._parents,i=this._groups;typeof e!="function"&&(e=G$t(e));for(var s=i.length,o=new Array(s),a=new Array(s),u=new Array(s),l=0;l<s;++l){var c=r[l],f=i[l],h=f.length,d=e.call(c,c&&c.__data__,l,r),p=d.length,g=a[l]=new Array(p),m=o[l]=new Array(p),y=u[l]=new Array(h);n(c,f,g,m,y,d,t);for(var b=0,v=0,x,w;b<p;++b)if(x=g[b]){for(b>=v&&(v=b+1);!(w=m[v])&&++v<p;);x._next=w||null}}return o=new Gi(o,r),o._enter=a,o._exit=u,o}function Y$t(){return new Gi(this._exit||this._groups.map(dye),this._parents)}function K$t(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var u=t[a],l=n[a],c=u.length,f=o[a]=new Array(c),h,d=0;d<c;++d)(h=u[d]||l[d])&&(f[d]=h);for(;a<r;++a)o[a]=t[a];return new Gi(o,this._parents)}function Z$t(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&s!==o.nextSibling&&s.parentNode.insertBefore(o,s),s=o);return this}function J$t(e){e||(e=Q$t);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,u=i[s]=new Array(a),l,c=0;c<a;++c)(l=o[c])&&(u[c]=l);u.sort(t)}return new Gi(i,this._parents).order()}function Q$t(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function eCt(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function tCt(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function nCt(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function rCt(){var e=0;return this.each(function(){++e}),e}function iCt(){return!this.node()}function sCt(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function oCt(e){return function(){this.removeAttribute(e)}}function aCt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function uCt(e,t){return function(){this.setAttribute(e,t)}}function lCt(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function cCt(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function fCt(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function hCt(e,t){var n=$W(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?aCt:oCt:typeof t=="function"?n.local?fCt:cCt:n.local?lCt:uCt)(n,t))}function SW(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function dCt(e){return function(){this.style.removeProperty(e)}}function pCt(e,t,n){return function(){this.style.setProperty(e,t,n)}}function gCt(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function mCt(e,t,n){return arguments.length>1?this.each((t==null?dCt:typeof t=="function"?gCt:pCt)(e,t,n??"")):pye(this.node(),e)}function pye(e,t){return e.style.getPropertyValue(t)||SW(e).getComputedStyle(e,null).getPropertyValue(t)}function yCt(e){return function(){delete this[e]}}function bCt(e,t){return function(){this[e]=t}}function xCt(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function vCt(e,t){return arguments.length>1?this.each((t==null?yCt:typeof t=="function"?xCt:bCt)(e,t)):this.node()[e]}function gye(e){return e.trim().split(/^|\s+/)}function kW(e){return e.classList||new mye(e)}function mye(e){this._node=e,this._names=gye(e.getAttribute("class")||"")}mye.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function yye(e,t){for(var n=kW(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function bye(e,t){for(var n=kW(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function wCt(e){return function(){yye(this,e)}}function $Ct(e){return function(){bye(this,e)}}function CCt(e,t){return function(){(t.apply(this,arguments)?yye:bye)(this,e)}}function SCt(e,t){var n=gye(e+"");if(arguments.length<2){for(var r=kW(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?CCt:t?wCt:$Ct)(n,t))}function kCt(){this.textContent=""}function ECt(e){return function(){this.textContent=e}}function ACt(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function _Ct(e){return arguments.length?this.each(e==null?kCt:(typeof e=="function"?ACt:ECt)(e)):this.node().textContent}function TCt(){this.innerHTML=""}function ICt(e){return function(){this.innerHTML=e}}function DCt(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function NCt(e){return arguments.length?this.each(e==null?TCt:(typeof e=="function"?DCt:ICt)(e)):this.node().innerHTML}function FCt(){this.nextSibling&&this.parentNode.appendChild(this)}function OCt(){return this.each(FCt)}function RCt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function MCt(){return this.each(RCt)}function LCt(e){var t=typeof e=="function"?e:NF(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function PCt(){return null}function BCt(e,t){var n=typeof e=="function"?e:NF(e),r=t==null?PCt:typeof t=="function"?t:CW(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function zCt(){var e=this.parentNode;e&&e.removeChild(this)}function UCt(){return this.each(zCt)}function jCt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function WCt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function VCt(e){return this.select(e?WCt:jCt)}function GCt(e){return arguments.length?this.property("__data__",e):this.node().__data__}var xye={},Hl=null;if(typeof document<"u"){var HCt=document.documentElement;"onmouseenter"in HCt||(xye={mouseenter:"mouseover",mouseleave:"mouseout"})}function qCt(e,t,n){return e=vye(e,t,n),function(r){var i=r.relatedTarget;(!i||i!==this&&!(i.compareDocumentPosition(this)&8))&&e.call(this,r)}}function vye(e,t,n){return function(r){var i=Hl;Hl=r;try{e.call(this,this.__data__,t,n)}finally{Hl=i}}}function XCt(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function YCt(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.capture):t[++r]=s;++r?t.length=r:delete this.__on}}}function KCt(e,t,n){var r=xye.hasOwnProperty(e.type)?qCt:vye;return function(i,s,o){var a=this.__on,u,l=r(t,s,o);if(a){for(var c=0,f=a.length;c<f;++c)if((u=a[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=n),u.value=t;return}}this.addEventListener(e.type,l,n),u={type:e.type,name:e.name,value:t,listener:l,capture:n},a?a.push(u):this.__on=[u]}}function ZCt(e,t,n){var r=XCt(e+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,l=a.length,c;u<l;++u)for(i=0,c=a[u];i<s;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value}return}for(a=t?KCt:YCt,n==null&&(n=!1),i=0;i<s;++i)this.each(a(r[i],t,n));return this}function JCt(e,t,n,r){var i=Hl;e.sourceEvent=Hl,Hl=e;try{return t.apply(n,r)}finally{Hl=i}}function wye(e,t,n){var r=SW(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function QCt(e,t){return function(){return wye(this,e,t)}}function eSt(e,t){return function(){return wye(this,e,t.apply(this,arguments))}}function tSt(e,t){return this.each((typeof t=="function"?eSt:QCt)(e,t))}var EW=[null];function Gi(e,t){this._groups=e,this._parents=t}function $ye(){return new Gi([[document.documentElement]],EW)}Gi.prototype=$ye.prototype={constructor:Gi,select:B$t,selectAll:U$t,filter:W$t,data:X$t,enter:V$t,exit:Y$t,merge:K$t,order:Z$t,sort:J$t,call:eCt,nodes:tCt,node:nCt,size:rCt,empty:iCt,each:sCt,attr:hCt,style:mCt,property:vCt,classed:SCt,text:_Ct,html:NCt,raise:OCt,lower:MCt,append:LCt,insert:BCt,remove:UCt,clone:VCt,datum:GCt,on:ZCt,dispatch:tSt};function Cye(e){return typeof e=="string"?new Gi([[document.querySelector(e)]],[document.documentElement]):new Gi([[e]],EW)}function nSt(e){return Cye(NF(e).call(document.documentElement))}var rSt=0;function Sye(){return new LP}function LP(){this._="@"+(++rSt).toString(36)}LP.prototype=Sye.prototype={constructor:LP,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};function AW(){for(var e=Hl,t;t=e.sourceEvent;)e=t;return e}function FF(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function iSt(e){var t=AW();return t.changedTouches&&(t=t.changedTouches[0]),FF(e,t)}function sSt(e){return typeof e=="string"?new Gi([document.querySelectorAll(e)],[document.documentElement]):new Gi([e??[]],EW)}function oSt(e,t,n){arguments.length<3&&(n=t,t=AW().changedTouches);for(var r=0,i=t?t.length:0,s;r<i;++r)if((s=t[r]).identifier===n)return FF(e,s);return null}function aSt(e,t){t==null&&(t=AW().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=FF(e,t[n]);return i}const uSt=Object.freeze(Object.defineProperty({__proto__:null,clientPoint:FF,create:nSt,creator:NF,customEvent:JCt,get event(){return Hl},local:Sye,matcher:hye,mouse:iSt,namespace:$W,namespaces:MP,select:Cye,selectAll:sSt,selection:$ye,selector:CW,selectorAll:cye,style:pye,touch:oSt,touches:aSt,window:SW},Symbol.toStringTag,{value:"Module"})),lSt=tg(uSt);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Oy,"__esModule",{value:!0});const cSt=lye,KJ=lSt,AR=de,fSt=Ki;function hSt(e,t,n={}){if(t&&t.headers==null)throw new Error('Data to render must have a "headers" property');if(t&&t.values==null)throw new Error('Data to render must have a "values" property');const r=fSt.getDrawArea(e),i=Object.assign({},dSt,n);let s=KJ.select(r).select("table.tf-table");const o=AR.css({fontSize:i.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(s.size()===0&&(s=KJ.select(r).append("table"),s.attr("class",` ${o} tf-table`),s.append("thead").append("tr"),s.append("tbody")),s.size()!==1)throw new Error("Error inserting table");const a=AR.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),u=s.select("thead").select("tr").selectAll("th").data(t.headers),l=u.enter().append("th").attr("class",`${a}`);u.merge(l).html(m=>m),u.exit().remove();const c=cSt.format(",.4~f"),f=s.select("tbody").selectAll("tr").data(t.values),h=f.enter().append("tr"),d=AR.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),p=f.merge(h).selectAll("td").data(m=>m),g=p.enter().append("td").attr("class",`${d}`);p.merge(g).html(m=>typeof m=="number"?c(m):m),p.exit().remove(),f.exit().remove()}Oy.table=hSt;const dSt={fontSize:14};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pSt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},gSt=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(dC,"__esModule",{value:!0});const ZJ=lye,mSt=gSt(Dy),FS=zo,ySt=ll,bSt=Oy,xSt={maxBins:12,fontSize:11};function vSt(e,t,n={}){return pSt(this,void 0,void 0,function*(){const r=$St(t),i=Object.assign({},xSt,n),s={actions:!1,mode:"vega-lite",defaultStyle:!1},o=FS.subSurface(e,"histogram");if(n.stats!==!1){const l=FS.subSurface(e,"stats",{prepend:!0});let c;n.stats?c=n.stats:c=ySt.arrayStats(r.map(f=>f.value)),wSt(c,l,{fontSize:i.fontSize})}if(r.length===0)return;const a=[];for(let l=0;l<r.length;l++){const c=r[l].value;c!=null&&isFinite(c)&&a.push(r[l])}const u={width:i.width||FS.getDefaultWidth(o),height:i.height||FS.getDefaultHeight(o),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:a},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},encoding:{x:{bin:{maxbins:i.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:i.color||"#001B44"}}};return mSt.default(o,u,s)})}dC.histogram=vSt;function wSt(e,t,n){const r=ZJ.format(",.4~f"),i=ZJ.format(".4~p"),s=[],o=[];if(e.numVals!=null&&(s.push("Num Vals"),o.push(r(e.numVals))),e.min!=null&&(s.push("Min"),o.push(r(e.min))),e.max!=null&&(s.push("Max"),o.push(r(e.max))),e.numZeros!=null){s.push("# Zeros");let a="";e.numVals&&(a=e.numZeros>0?`(${i(e.numZeros/e.numVals)})`:""),o.push(`${r(e.numZeros)} ${a}`)}if(e.numNans!=null){s.push("# NaNs");let a="";e.numVals&&(a=e.numNans>0?`(${i(e.numNans/e.numVals)})`:""),o.push(`${r(e.numNans)} ${a}`)}if(e.numInfs!=null){s.push("# Infinity");let a="";e.numVals&&(a=e.numInfs>0?`(${i(e.numInfs/e.numVals)})`:""),o.push(`${r(e.numInfs)} ${a}`)}bSt.table(t,{headers:s,values:[o]},n)}function $St(e){if(e.length==null)throw new Error("input data must be an array");if(e.length===0)return[];if(typeof e[0]=="object"){if(e[0].value==null)throw new Error("input data must have a value field");return e}else{const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={value:e[n]};return t}}var OF={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var CSt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},SSt=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(OF,"__esModule",{value:!0});const kSt=SSt(Dy),JJ=zo,QJ=Ic,ESt=Ki;function ASt(e,t,n={}){return CSt(this,void 0,void 0,function*(){const r=Array.isArray(t.values[0])?t.values:[t.values],i=r[0].length,s=t.series?t.series:r.map((g,m)=>`Series ${m+1}`);QJ.assert(s.length===r.length,"Must have an equal number of series labels as there are data series"),n.seriesColors!=null&&QJ.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const o=[];for(let g=0;g<i;g++){const m={x:g};s.forEach((y,b)=>{const v=r[b][g].y;m[y]=v,m[`${y}-name`]=y}),o.push(m)}const a=Object.assign({},_St,n),u=()=>{if(a.zoomToFit)return{zero:!1};if(a.yAxisDomain!=null)return{domain:a.yAxisDomain}},l={x:{field:"x",type:a.xType,title:a.xLabel},tooltip:[{field:"x",type:"quantitative"},...s.map(g=>({field:g,type:"quantitative"}))]},c=s.map(g=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:g,type:a.yType,title:a.yLabel,scale:u()},color:{field:`${g}-name`,type:"nominal",legend:{values:s,title:null},scale:{range:a.seriesColors}}}})),f={mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}},h=ESt.getDrawArea(e),d={width:a.width||JJ.getDefaultWidth(h),height:a.height||JJ.getDefaultHeight(h),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize}},data:{values:o},encoding:l,layer:[...c,f]},p={actions:!1,mode:"vega-lite",defaultStyle:!1};return yield kSt.default(h,d,p),Promise.resolve()})}OF.linechart=ASt;const _St={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11};var _W={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var TSt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},ISt=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_W,"__esModule",{value:!0});const DSt=ISt(Dy),eQ=zo,NSt=Ic,FSt=Ki;function OSt(e,t,n={}){return TSt(this,void 0,void 0,function*(){let r=t.values;const i=t.series==null?[]:t.series;r=Array.isArray(r[0])?r:[r];const s=[];r.forEach((h,d)=>{const p=i[d]!=null?i[d]:`Series ${d+1}`,g=h.map(m=>Object.assign({},m,{series:p}));s.push(...g)}),n.seriesColors!=null&&NSt.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const o=FSt.getDrawArea(e),a=Object.assign({},RSt,n),u={actions:!1,mode:"vega-lite",defaultStyle:!1},l=()=>{if(a.zoomToFit)return{zero:!1};if(a.xAxisDomain!=null)return{domain:a.xAxisDomain}},c=()=>{if(a.zoomToFit)return{zero:!1};if(a.yAxisDomain!=null)return{domain:a.yAxisDomain}},f={width:a.width||eQ.getDefaultWidth(o),height:a.height||eQ.getDefaultHeight(o),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize}},data:{values:s},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:a.xType,title:a.xLabel,scale:l()},y:{field:"y",type:a.yType,title:a.yLabel,scale:c()},color:{field:"series",type:"nominal",scale:{range:a.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield DSt.default(o,f,u),Promise.resolve()})}_W.scatterplot=OSt;const RSt={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11};var RF={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kye=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(RF,"__esModule",{value:!0});const MSt=OF,PP=Ki,Eye=zo;function Aye(e,t,n,r={}){return kye(this,void 0,void 0,function*(){const i=PP.getDrawArea(e),s={};for(const l of n)if(/val_/.test(l)){const c=l.replace("val_","");tQ(s,c);const f=nQ(t,l,n.indexOf(l));s[c].series.push(l),s[c].values.push(f)}else{const c=nQ(t,l,n.indexOf(l));tQ(s,l),s[l].series.push(l),s[l].values.push(c)}const o=Object.keys(s),a=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},r),u=[];for(const l of o){const c=Eye.subSurface(i,l),f=s[l].series,h=s[l].values;f.every(p=>!!p.match("acc"))&&(a.zoomToFitAccuracy?a.zoomToFit=!0:(a.yAxisDomain=[0,1],delete a.zoomToFit));const d=MSt.linechart(c,{values:h,series:f},a);u.push(d)}yield Promise.all(u)})}RF.history=Aye;function tQ(e,t){e[t]==null&&(e[t]={series:[],values:[]})}function nQ(e,t,n){if(Array.isArray(e)){const r=Array.isArray(e[0])?e[n]:e,i=[];for(let s=0;s<r.length;s++){const o=r[s];i.push({x:s,y:o[t]})}return i}else return e.history[t].map((r,i)=>({x:i,y:r}))}function LSt(e,t,n={}){const r={},i=n.callbacks||["onEpochEnd","onBatchEnd"],s=PP.getDrawArea(e),o=Object.assign({},n);delete o.callbacks;function a(l){return(c,f)=>kye(this,void 0,void 0,function*(){/batch/i.test(l)?o.xLabel="Batch":/epoch/i.test(l)&&(o.xLabel="Epoch");const h=[],d=[];for(const g of t)if(f[g]!=null){d.push(g);const m=PSt(r,l,g);m.push({[g]:f[g]}),h.push(m)}const p=Eye.subSurface(s,l,{title:l});Aye(p,h,d,o),yield PP.nextFrame()})}const u={};return i.forEach(l=>{u[l]=a(l)}),u}RF.fitCallbacks=LSt;function PSt(e,t,n){return e[t]==null&&(e[t]={}),e[t][n]==null&&(e[t][n]=[]),e[t][n]}var MF={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var c_=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(MF,"__esModule",{value:!0});const BSt=dC,_ye=Ki,Tye=Oy,_R=zo,zSt=ll;function USt(e,t){return c_(this,void 0,void 0,function*(){const n=_ye.getDrawArea(e),r=WSt(t),i=["Layer Name","Output Shape","# Of Params","Trainable"],s=r.layers.map(o=>[o.name,o.outputShape,o.parameters,o.trainable]);Tye.table(n,{headers:i,values:s})})}MF.modelSummary=USt;function jSt(e,t){return c_(this,void 0,void 0,function*(){const n=_ye.getDrawArea(e),r=yield GSt(t),i=["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],s=_R.subSurface(n,"layer-weights-info"),o=r.map(c=>[c.name,c.shape,c.stats.min,c.stats.max,c.weight.size,c.stats.numZeros,c.stats.numNans,c.stats.numInfs]);Tye.table(s,{headers:i,values:o});const a=_R.subSurface(n,"select-layer"),u=_R.subSurface(n,"param-distribution"),l=c=>c_(this,void 0,void 0,function*(){const h=yield r.filter(d=>d.name===c)[0].weight.data();BSt.histogram(u,h,{height:150,width:460,stats:!1})});HSt(r.map(c=>c.name),a,l)})}MF.layer=jSt;function WSt(e){return{layers:e.layers.map(VSt)}}function VSt(e){let t;return Array.isArray(e.outputShape[0])?t=`[${e.outputShape.map(r=>BP(r)).join(", ")}]`:t=BP(e.outputShape),{name:e.name,trainable:e.trainable,parameters:e.countParams(),outputShape:t}}function GSt(e){return c_(this,void 0,void 0,function*(){const t=e.getWeights(),n=e.weights,r=t.map(zSt.tensorStats),i=yield Promise.all(r),s=t.map(o=>o.shape);return t.map((o,a)=>({name:n[a].name,stats:i[a],shape:BP(s[a]),weight:o}))})}function BP(e){const t=e.slice();return t.length===0?"Scalar":(t[0]===null&&(t[0]="batch"),`[${t.join(",")}]`)}function HSt(e,t,n){const s=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${e.map(u=>`<option value=${u}>${u}</option>`)}
    </select>
  `}</div>`;t.innerHTML=s;const o=t.querySelector("button"),a=t.querySelector("select");o.addEventListener("click",()=>{n(a.selectedOptions[0].label)})}var TW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var qSt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(TW,"__esModule",{value:!0});const XSt=Ki,YSt=Oy;function KSt(e,t,n){return qSt(this,void 0,void 0,function*(){const r=XSt.getDrawArea(e),i=["Class","Accuracy","# Samples"],s=[];for(let o=0;o<t.length;o++){const a=n?n[o]:o.toString(),u=t[o];s.push([a,u.accuracy,u.count])}return YSt.table(r,{headers:i,values:s})})}TW.perClassAccuracy=KSt;var IW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ZSt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(IW,"__esModule",{value:!0});const JSt=dC,QSt=Ki,ekt=ll;function tkt(e,t){return ZSt(this,void 0,void 0,function*(){const n=QSt.getDrawArea(e),r=yield ekt.tensorStats(t),i=yield t.data();JSt.histogram(n,i,{height:150,stats:r})})}IW.valuesDistribution=tkt;var DW={};/** @license See the LICENSE file. */Object.defineProperty(DW,"__esModule",{value:!0});const nkt="1.5.1";DW.version=nkt;(function(e){function t(v){for(var x in v)e.hasOwnProperty(x)||(e[x]=v[x])}Object.defineProperty(e,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n=B5,r=vW,i=wW,s=dC,o=OF,a=_W,u=Oy,l=RF,c=MF,f=TW,h=IW,d=ll,p=DW;e.version_vis=p.version;const g={barchart:n.barchart,table:u.table,histogram:s.histogram,linechart:o.linechart,scatterplot:a.scatterplot,confusionMatrix:r.confusionMatrix,heatmap:i.heatmap};e.render=g;const m={accuracy:d.accuracy,perClassAccuracy:d.perClassAccuracy,confusionMatrix:d.confusionMatrix};e.metrics=m;const y={history:l.history,fitCallbacks:l.fitCallbacks,perClassAccuracy:f.perClassAccuracy,valuesDistribution:h.valuesDistribution,layer:c.layer,modelSummary:c.modelSummary};e.show=y;var b=hC;e.visor=b.visor,t(fC)})(ao);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iye={kernelName:O2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,H1(ge(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rkt={kernelName:Y0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Gt(ge(n,"float32")),i=Vr(ke(Ve(1),r));return rn(Oe(e,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ikt={kernelName:K0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Vr(ke(Gt(ge(n,"float32")),1));return Oe(e,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const skt={kernelName:sg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ke(n.shape,r.shape);return{a:()=>{let a=e;const u=Mn(n.shape,i);return u.length>0&&(a=_e(a,u)),V(a,n.shape)},b:()=>{let a=e;const u=Mn(r.shape,i);return u.length>0&&(a=_e(a,u)),V(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const okt={kernelName:R2,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((r,i)=>{n[i]=()=>e.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const akt={kernelName:M2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mt(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ukt={kernelName:L2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mt(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lkt={kernelName:Z0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,Vr(ke(Ve(1),Gt(ge(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ckt={kernelName:J0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Vr(ue(Ve(1),Gt(ge(n,"float32"))));return Oe(e,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fkt={kernelName:t1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ke(n.shape,r.shape);return{a:()=>{const a=ue(Gt(n),Gt(r));let u=j(e,Oe(r,a));const l=Mn(n.shape,i);return l.length>0&&(u=_e(u,l)),V(u,n.shape)},b:()=>{const a=ue(Gt(n),Gt(r));let u=rn(j(e,Oe(n,a)));const l=Mn(r.shape,i);return l.length>0&&(u=_e(u,l)),V(u,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hkt={kernelName:Q0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,ue(Gt(ge(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dkt={kernelName:e1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,ke(Ve(1),Gt(ge(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pkt(e,t,n,r,i,s){const o=N(e,"dy","avgPool3dGrad"),a=N(t,"input","avgPool3dGrad");let u=o,l=a,c=!1;a.rank===4&&(c=!0,u=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=V(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),D(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),D(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Si("avgPool3dGrad",i,s);const f={dy:u,input:l},h={filterSize:n,strides:r,pad:i,dimRoundingMode:s},d=z.runKernel(L_,f,h);return c?V(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const gkt=U({avgPool3dGrad_:pkt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mkt={kernelName:B2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>gkt(e,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ykt(e,t,n,r,i){const s=N(e,"dy","avgPoolGrad"),o=N(t,"input","avgPoolGrad");D(o.rank===s.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`);let a=o,u=s,l=!1;o.rank===3&&(l=!0,a=V(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=V(s,[1,s.shape[0],s.shape[1],s.shape[2]])),D(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),D(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:u,input:a},f={filterSize:n,strides:r,pad:i},h=z.runKernel(M_,c,f);return l?V(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const bkt=U({avgPoolGrad_:ykt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xkt={kernelName:P2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:s,pad:o}=n;return{x:()=>bkt(e,r,i,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vkt={kernelName:z2,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,i]=t,{transposeA:s,transposeB:o}=n;return!s&&!o?{a:()=>st(e,i,!1,!0),b:()=>st(r,e,!0,!1)}:!s&&o?{a:()=>st(e,i,!1,!1),b:()=>st(e,r,!0,!1)}:s&&!o?{a:()=>st(i,e,!1,!0),b:()=>st(r,e,!1,!1)}:{a:()=>st(i,e,!0,!0),b:()=>st(e,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wkt={kernelName:U2,gradFunc:(e,t,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>JT(e,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $kt={kernelName:Aee,gradFunc:(e,t,n)=>{const r=n,i=r.inputShape,s=r.shape,o=Array.from(s);for(let u=i.length-1;u>=0;u--)if(i[u]===s[u])o[u]=1;else if(i[u]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const a=[];for(let u=0;u<o.length;u++)o[u]>1&&a.push(u);return{x:()=>_e(e,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ckt={kernelName:n1,gradFunc:e=>({x:()=>e.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Skt={kernelName:r1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kkt={kernelName:i1,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>jr(Eu(Sh(r,i),ag(r,s)),e,mt(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ekt={kernelName:W2,inputsToSave:["x"],gradFunc:Iye.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Akt={kernelName:V2,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(u=>u.shape),{axis:i}=n,s=it(i,t[0].shape)[0],o=r.map(u=>u[s]);return gs(e,o,s).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _kt={kernelName:G2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{dilations:s,strides:o,pad:a,dataFormat:u}=n;return D(Nf(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>kB(r.shape,e,i,o,a,u),filter:()=>i5(r,e,i.shape,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tkt={kernelName:H2,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{strides:s,pad:o,dataFormat:a,dimRoundingMode:u}=n;return{dy:()=>Ff(e,i,s,o,a,1,u),filter:()=>i5(e,r,i.shape,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ikt(e,t,n,r,i){let s=e;e.rank===4&&(s=V(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;o.rank===4&&(o=V(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),D(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),D(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),D(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),D(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),D(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:s,dy:o},u={strides:r,pad:i,filterShape:n};return z.runKernel(j_,a,u)}const Dkt=U({conv3DBackpropFilter_:Ikt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nkt={kernelName:q2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:s}=n;D(Nf(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=t;return{x:()=>_te(o.shape,e,a,i,s),filter:()=>Dkt(o,e,a.shape,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fkt={kernelName:s1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(rn(YB(ge(n,"float32"))),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Okt={kernelName:o1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(KB(ge(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rkt={kernelName:X2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const a=xn([i],r.rank);let u=_B(e,i,s,!o);return a!=null&&(u=dt(u,a)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mkt={kernelName:Y2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=r??[1,1];D(Nf(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[u,l]=t;return D(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),D(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),D(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),D(_r(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),Si("depthwiseConv2d",s,o),{x:()=>pne(u.shape,e,l,i,s,a,o),filter:()=>dne(u,e,l.shape,i,s,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lkt={kernelName:K2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,s={x:r,filter:i,dy:e},o={x:r,filter:i,dy:e};return{x:()=>z.runKernel(Rk,s,n),filter:()=>z.runKernel(Mk,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pkt={kernelName:u1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>z.runKernel(Q_,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bkt={kernelName:l1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=j(bs(rn(Gt(n))),2/Math.sqrt(Math.PI));return{x:()=>j(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zkt={kernelName:c1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ukt={kernelName:J2,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>V(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jkt={kernelName:f1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,bs(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wkt={kernelName:h1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vkt={kernelName:d1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ke(n.shape,r.shape);return{a:()=>{const a=Oe(e,ge(r,"float32")),u=Mn(n.shape,i);return u.length>0?V(_e(a,u),n.shape):a},b:()=>{let a=j(e,ge(n,"float32"));const u=Mn(r.shape,i);u.length>0&&(a=V(_e(a,u),r.shape));const l=Gt(r);return rn(Oe(a,ge(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gkt={kernelName:Q2,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=t,u=a??Ve(1),l=Mn(s.shape,i.shape),c=[];if(s.rank===1){for(let x=0;x<i.shape.length-1;++x)c.push(i.shape[x]);c.push(1)}const f=ke(i,s),h=j(e,u),d=HB(ue(o,Ve(r))),p=j(j(j(d,d),d),Ve(-.5));return{x:()=>s.rank===1?V(j(j(e,ho(V(d,[1,1,1,s.shape[0]]),c)),u),i.shape):V(j(j(e,d),u),i.shape),mean:()=>{let x=j(j(d,Ve(-1)),h);return s.rank===1&&(x=_e(x,l)),V(x,s.shape)},variance:()=>{let x=j(j(p,f),h);return s.rank===1&&(x=_e(x,l)),V(x,s.shape)},scale:()=>{const x=j(f,d);let w=j(e,x);return s.rank===1&&(w=_e(w,l)),V(w,s.shape)},offset:()=>{let x=e;return s.rank===1&&(x=_e(x,l)),V(x,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hkt={kernelName:ew,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,i]=t,{axis:s,batchDims:o}=n,a=it(s,r.shape)[0],u=(l,c,f)=>()=>{const h=l.shape,d=c.size,p=h.slice(0,a),g=p.length,m=h.slice(s,h.length).slice(1),y=m.length,b=rQ(0,g),v=rQ(g+1,g+1+y),x=iQ([p,[d],m]),w=V(f,x),C=V(c,[d]),$=iQ([[g],b,v]),S=dt(w,$);let k=n5(S,C,l.shape[a]);const E=Ch($);return k=dt(k,E),k};if(o===1){const l=r.shape[0],c=r.split(l,0);return{x:()=>Au(c.map((d,p)=>u(d,i.slice(p,1),e.slice(p,1))())).reshape(r.shape),indices:()=>i}}else return{x:u(r,i,e),indices:()=>i}}};function rQ(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function iQ(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qkt={kernelName:p1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>mt(n),b:()=>mt(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xkt={kernelName:g1,gradFunc:e=>({x:()=>ge(e,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ykt={kernelName:m1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kkt={kernelName:y1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zkt={kernelName:b1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jkt={kernelName:nw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:i}=n,s=Ds(r,0);return{x:()=>jr(s,e,j(e,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qkt={kernelName:v1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,ue(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eEt={kernelName:x1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,ge(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tEt={kernelName:_ee,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;return{logits:()=>{const o=bs(r);return ke(e,j(_e(e,i,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nEt(e,t,n,r=5,i=1,s=1,o=.5){const a={x:e,y:t,dy:n},u={depthRadius:r,bias:i,alpha:s,beta:o};return z.runKernel(aT,a,u)}const rEt=U({localResponseNormalizationBackprop_:nEt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iEt={kernelName:uw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{depthRadius:s,bias:o,alpha:a,beta:u}=n;return{x:()=>rEt(r,i,e,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dye(e,t,n,r){return t.rank<n.rank&&(t=V(t,Tn(t.shape,r))),e.rank<n.rank&&(e=V(e,Tn(e.shape,r))),{x:()=>j(e,ge($a(n,t),e.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sQ={kernelName:lw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:i}=r,s=t[0],o=t[1],a=it(i,s.shape),u=Dye(e,o,s,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sEt={kernelName:w1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>j(e,ge(Sh(n,r),"float32")),b:()=>j(e,ge(Jx(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oEt(e,t,n,r,i,s,o){const a=N(e,"dy","maxPool3dGrad"),u=N(t,"input","maxPool3dGrad"),l=N(n,"output","maxPool3dGrad");let c=a,f=u,h=l,d=!1;u.rank===4&&(d=!0,c=V(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=V(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=V(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),D(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),D(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),D(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Si("maxPool3dGrad",s,o);const p={dy:c,input:f,output:h},g={filterSize:r,strides:i,pad:s,dimRoundingMode:o},m=z.runKernel(lT,p,g);return d?V(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const aEt=U({maxPool3dGrad_:oEt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uEt={kernelName:fw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=n;return{x:()=>aEt(e,r,i,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lEt(e,t,n,r,i,s,o){const a=N(e,"dy","maxPoolGrad"),u=N(t,"input","maxPoolGrad"),l=N(n,"output","maxPoolGrad");D(u.rank===a.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`),D(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),D(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Si("maxPoolGrad",s,o);const c={dy:a,input:u,output:l},f={filterSize:r,strides:i,pad:s,dimRoundingMode:o};return z.runKernel(uT,c,f)}const cEt=U({maxPoolGrad_:lEt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fEt={kernelName:cw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:s,strides:o,pad:a}=n;return{x:()=>cEt(e,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hEt={kernelName:hw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n,s=it(i,r.shape),a=ar(r.shape,s)[1],u=Z(a);return{x:()=>{const c=r.shape.slice();s.forEach(d=>{c[d]=1});const f=V(e,c);return Oe(j(f,fs(r.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dEt={kernelName:dw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:i}=r,[s,o]=t,a=it(i,s.shape),u=Dye(e,o,s,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pEt={kernelName:$1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>j(e,ge(ag(n,r),"float32")),b:()=>j(e,ge(Ds(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gEt={kernelName:pw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>xt(e,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mEt={kernelName:C1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ke(n.shape,r.shape);return{a:()=>{const a=Mn(n.shape,i);return a.length>0?V(_e(e,a),n.shape):e},b:()=>{const a=j(e,rn(Vw(Oe(n,r)))),u=Mn(r.shape,i);return u.length>0?V(_e(a,u),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yEt={kernelName:S1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ke(n.shape,r.shape);return{a:()=>{const a=j(e,ge(r,"float32")),u=Mn(n.shape,i);return u.length>0?V(_e(a,u),n.shape):a},b:()=>{const a=j(e,ge(n,"float32")),u=Mn(r.shape,i);return u.length>0?V(_e(a,u),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bEt={kernelName:gw,gradFunc:e=>({x:()=>rn(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xEt={kernelName:bw,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>zn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vEt={kernelName:yw,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wEt={kernelName:xw,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return Rf(e,r).map(s=>()=>s)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oQ={kernelName:vw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>xt(e,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Et={kernelName:k1,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,i]=t,s=n,o=r,a=Ke(s.shape,o.shape);return{a:()=>{const c=ge(o,"float32");let f=j(e,j(c,Of(s,ke(c,Ve(1)))));const h=Mn(s.shape,a);return h.length>0&&(f=_e(f,h)),V(f,s.shape)},b:()=>{const c=Ds(s,0),f=jr(c,Hs(s),mt(s));let h=j(e,j(i,f));const d=Mn(o.shape,a);return d.length>0&&(h=_e(h,d)),V(h,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CEt={kernelName:ww,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,i=Ds(n,0);return{x:()=>jr(i,e,j(e,r)),alpha:()=>{let s=jr(i,mt(e),j(e,n));const o=Mn(r.shape,e.shape);return o.length>0&&(s=_e(s,o)),V(s,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SEt(e,t,n){const r=e.shape.slice();r[n]=1;const i=V(t,r),s=jk(e,n,!0,!1),o=jk(e,n,!0,!0),a=j(s,o);return j(i,a)}function kEt(e,t,n){const r=e.shape.length,i=r-n.length,s=xn(n,r);let o=e;s!=null&&(o=dt(e,s));const a=o.shape.slice(),l=a.splice(r-n.length,n.length).reduce((h,d)=>h*d,1);a.push(l);const c=o.reshape(a);let f=SEt(c,t,i);if(f=f.reshape(o.shape),s!=null){const h=Ch(s);f=dt(f,h)}return f}const EEt={kernelName:$w,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;let s=[];return i==null?s=r.shape.map((o,a)=>a):typeof i=="number"?s=[i]:s=i,{x:()=>kEt(r,e,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AEt={kernelName:a1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ke(n.shape,r.shape);return{a:()=>{const a=Oe(e,ge(r,"float32")),u=Mn(n.shape,i);return u.length>0?V(_e(a,u),n.shape):a},b:()=>{let a=j(e,ge(n,"float32"));const u=Mn(r.shape,i);u.length>0&&(a=V(_e(a,u),r.shape));const l=Gt(r);return rn(Oe(a,ge(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Et={kernelName:E1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,rn(Gt(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TEt={kernelName:_1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=j(ag(n,6),H1(n));return{x:()=>j(e,ge(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IEt={kernelName:A1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,ge(H1(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DEt={kernelName:Cw,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>V(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NEt={kernelName:kw,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>z.runKernel(wT,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FEt={kernelName:Sw,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>z.runKernel(vT,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OEt={kernelName:Ew,gradFunc:(e,t,n)=>{const{dims:r}=n,i=it(r,e.shape);return{x:()=>Eo(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const REt={kernelName:T1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MEt={kernelName:I1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>rn(Oe(e,j(Of(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LEt={kernelName:Aw,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>ge(mt(n),"float32"),t:()=>j(e,ge(n,e.dtype)),e:()=>j(e,ge(YT(n),e.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PEt={kernelName:D1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Ds(n,Ve(0)),i=Ve(xI),s=Ve(vI),o=j(e,s),a=j(j(e,i),bs(ge(n,"float32")));return jr(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BEt={kernelName:R1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,j(n,ke(Ve(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zEt={kernelName:O1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UEt={kernelName:N1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(WT(ge(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jEt={kernelName:F1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(AB(ge(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WEt={kernelName:_w,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:i,size:s}=n,o=r.shape,[a,u]=yI(r,i,s),l=[];for(let c=0;c<e.rank;c++)l.push([a[c],o[c]-a[c]-u[c]]);return{x:()=>kh(e,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VEt={kernelName:Nw,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:i}=n,s=!0,o=j(e,r);return{logits:()=>ke(o,j(_e(o,[i],s),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GEt={kernelName:M1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,fu(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aQ={kernelName:Iw,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>jT(e,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ={kernelName:Dw,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>nr(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HEt={kernelName:L1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,j(Vr(ge(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEt={kernelName:IT,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,j(ge(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XEt={kernelName:P1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ve(2);return{a:()=>j(e,j(i,ke(n,r))),b:()=>j(e,j(i,ke(r,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YEt={kernelName:W1,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KEt={kernelName:B1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ke(n.shape,r.shape);return{a:()=>{let a=e;const u=Mn(n.shape,i);return u.length>0&&(a=_e(a,u)),V(a,n.shape)},b:()=>{let a=e;const u=Mn(r.shape,i);return u.length>0&&(a=_e(a,u)),V(rn(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZEt={kernelName:Tw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,i=r.shape.slice(),{axis:s}=n;it(s,r.shape).forEach(l=>{i[l]=1});const a=V(e,i),u=j(a,fs(r.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JEt={kernelName:z1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Oe(e,Gt(WT(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QEt={kernelName:U1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(ke(Ve(1),Gt(n)),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eAt={kernelName:j1,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:i}=n;return{x:()=>{let o=mt(r);if(r.rank===1)for(let a=0;a<i[0];++a)o=ue(o,xt(e,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)o=ue(o,xt(e,[a*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)for(let l=0;l<i[2];++l)o=ue(o,xt(e,[a*r.shape[0],u*r.shape[1],l*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)for(let l=0;l<i[2];++l)for(let c=0;c<i[3];++c)o=ue(o,xt(e,[a*r.shape[0],u*r.shape[1],l*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tAt={kernelName:Xd,gradFunc:(e,t,n)=>{const r=n,{perm:i}=r,s=Ch(i);return{x:()=>dt(e,s)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nAt={kernelName:Ow,gradFunc:(e,t,n)=>{const r=n,{axis:i}=r;return{value:()=>Au(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rAt={kernelName:Rw,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>iAt(e,n)}}};function iAt(e,t){const n=mc(t,mt(t)),r=Gw(e,n);let i=Sh(t,Ve(0,"int32"));const s=r.rank-i.rank;for(let a=0;a<s;++a)i=si(i,a+1);i=Eu(i,fs(r.shape,"bool"));const o=mt(r);return jr(i,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sAt={kernelName:Mw,gradFunc:e=>({x:()=>mt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oAt=[Iye,rkt,ikt,skt,okt,akt,ukt,lkt,ckt,fkt,hkt,dkt,mkt,xkt,vkt,wkt,$kt,Ckt,Skt,kkt,Ekt,Akt,Tkt,_kt,Nkt,Fkt,Okt,Rkt,Mkt,Lkt,AEt,Pkt,Bkt,zkt,Ukt,jkt,Vkt,Wkt,Gkt,Hkt,qkt,Xkt,Ykt,Kkt,Zkt,Jkt,Qkt,eEt,tEt,iEt,sQ,sQ,sEt,uEt,fEt,hEt,dEt,pEt,gEt,mEt,yEt,bEt,xEt,vEt,wEt,oQ,oQ,$Et,CEt,EEt,_Et,TEt,IEt,DEt,NEt,FEt,OEt,REt,MEt,LEt,PEt,BEt,zEt,UEt,jEt,WEt,VEt,GEt,aQ,aQ,uQ,uQ,HEt,XEt,qEt,YEt,KEt,ZEt,JEt,QEt,eAt,tAt,nAt,rAt,sAt];for(const e of oAt)Tee(e);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ja extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ja.prototype)}}class vo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vo.prototype)}}class W extends Error{constructor(t){super(t),Object.setPrototypeOf(this,W.prototype)}}class et extends Error{constructor(t){super(t),Object.setPrototypeOf(this,et.prototype)}}class NW extends Error{constructor(t){super(t),Object.setPrototypeOf(this,NW.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Nye{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let n;return this.cache.has(t)&&(n=this.cache.get(t),this.cache.delete(t),this.cache.set(t,n)),n}put(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(t,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let n=0;n<this.maxEntries-t;n++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zp(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}else{const n=new Array(t);return n.fill(e),n}}function Qa(e,t){if(!e)throw new NW(t)}function lQ(e,t){let n=0;for(const r of e)r===t&&n++;return n}function Oi(e){return e.length===1?e[0]:e}function Ot(e){return Array.isArray(e)?e:[e]}function Al(e){const n=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Nd(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}let io={};function FW(e){if(e==null)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function zP(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>zP(t));else{const t=Object.keys(e);for(const n of t){const r=e[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?e[n]=r.value:zP(r))}}}function pC(e,t={},n={},r="object",i=!1){if(typeof e=="string"){const s=e;let o;if(s in n)o=n[s];else if(s in io)o=io[s];else if(o=t[s],o==null)throw new W(`Unknown ${r}: ${e}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const s=e;if(s.className==null||s.config==null)throw new W(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);const o=s.className;let a,u;if(o in n?[a,u]=n[o]:o in io?[a,u]=io.className:o in t&&([a,u]=t[o]),a==null)throw new W(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const l={};for(const d of Object.keys(io))l[d]=io[d];for(const d of Object.keys(n))l[d]=n[d];const c=s.config;c.customObjects=l;const f=Object.assign({},io);for(const d of Object.keys(n))io[d]=n[d];zP(s.config);const h=u(a,s.config,n,i);return io=Object.assign({},f),h}else{const l=Object.assign({},io);for(const f of Object.keys(n))io[f]=n[f];const c=new a(s.config);return io=Object.assign({},l),c}}}function aAt(e,t){return e<t?-1:e>t?1:0}function OS(e,t){return-1*aAt(e,t)}function Ef(e){if(e==null)return e;const t=[];for(const n of e)t.indexOf(n)===-1&&t.push(n);return t}function uAt(e){if(e==null)throw new W(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function Gg(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new W(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function OW(e,t,n=0,r=1/0){return Qa(n>=0),Qa(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(i=>typeof i===t)}function tr(e,t){Array.isArray(e)?(D(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,r)=>tr(n,`element ${r+1} of ${t}`))):D(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${Fye(e)}.`)}function Fye(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>Fye(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function lAt(e,t,n){let r=n!=null?n():ti(),i;return(...o)=>{const a=n!=null?n():ti();return a-r<t||(r=a,i=e(...o)),i}}function Oye(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let cAt=0;function Rye(){return cAt++}const RS={};function LF(e=""){return e in RS||(RS[e]=0),RS[e]+=1,e+RS[e].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const fAt=["channelsFirst","channelsLast"],hAt=["nearest","bilinear"],dAt=["valid","same","causal"],pAt=["max","avg"],gAt=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const hm=new Map;function Dn(e){Gg(fAt,"DataFormat",e)}function mAt(e){Gg(hAt,"InterpolationFormat",e)}function eo(e){Gg(dAt,"PaddingMode",e)}function Mye(e){Gg(pAt,"PoolMode",e)}const zx=[],cQ="/";function cp(e,t){zx.push(e);try{const n=t();return zx.pop(),n}catch(n){throw zx.pop(),n}}function yAt(){return zx.length===0?"":zx.join(cQ)+cQ}function Lye(e){if(!Bye(e))throw new Error("Not a valid tensor name: '"+e+"'");return yAt()+e}function Pye(e){if(!Bye(e))throw new Error("Not a valid tensor name: '"+e+"'");hm.has(e)||hm.set(e,0);const t=hm.get(e);if(hm.set(e,hm.get(e)+1),t>0){const n=`${e}_${t}`;return hm.set(n,1),n}else return e}const bAt=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Bye(e){return!!e.match(bAt)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xAt(e){return e===parseInt(e.toString(),10)}function Af(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function j0(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function gh(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function Ea(e,t){if(t<e)throw new W(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let r=e;r<t;++r)n.push(r);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let TR;function Un(){return TR==null&&(TR=bB().epsilon()),TR}function Aa(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wu(e,t){return ge(e,t)}function gC(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),V(e,n)}function vAt(e,t){return X(()=>{if(e.shape.length!==2)throw new W(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);const n=gC(e,1);return UP(n,[1,t,1])})}function wAt(e){const t=[Af(e.shape)];return V(e,t)}function $At(e){if(e.rank<=1)throw new W(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],Af(e.shape,1)];return V(e,t)}function fp(e,t,n){return X(()=>{switch(e.rank){case 1:return tI(e,t,n);case 2:return ZB(e,[t,0],[n,e.shape[1]]);case 3:return nI(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return tv(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return xt(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return xt(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new W(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function IR(e,t,n){return X(()=>{switch(e.rank){case 1:return tI(e,t,n);case 2:return ZB(e,[0,t],[e.shape[0],n]);case 3:return nI(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return tv(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new W(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function MS(e,t,n,r){return X(()=>{switch(e.rank){case 1:return tI(e,t,n);case 2:switch(r){case 1:return fp(e,t,n);case 2:return IR(e,t,n);default:throw new W(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return fp(e,t,n);case 2:return nI(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return IR(e,t,n);default:throw new W(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return fp(e,t,n);case 2:return tv(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return tv(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return IR(e,t,n);default:throw new W(`The axis is not within the rank of the tensor ${r}`)}default:throw new W(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function RW(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),nr(e,t)}function fQ(e,t){switch(e.rank){case 1:return Cte([e,t]);case 2:return Ste([e,t],0);case 3:return kte([e,t],0);case 4:return Ete([e,t],0);default:throw new W(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function UP(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new W(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return ho(e,t)}function PF(e,t=0,n=1,r,i){return WB(e,t,n,r,i)}function $u(e,t,n,r){if(e.rank<2||t.rank<2)throw new et(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){const i=e.shape.slice(-1)[0],s=t.shape.slice(-2)[0];if(i!==s)throw new et(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return oM({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?jP(e.rank,r,Aa()):null,activation:n});{const i=e.shape.slice(),s=i.pop();e=V(e,[-1,s]);const o=t.shape.slice(),a=o.pop(),u=o.pop(),l=[...o,a],c=Array.from({length:t.rank},(p,g)=>g===0?t.rank-2:g<=t.rank-2?g-1:g);t=V(dt(t,c),[u,-1]);const f=[...i,...l];return V(oM({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?jP(e.rank,r,Aa()):null,activation:n}),f)}}function zye(e,t,n){return X(()=>(Array.isArray(t)?t=li(t,"int32"):t=ge(t,"int32"),Gw(e,t,n)))}function mC(e){return j(e,e)}function jP(e,t,n){const r=t.shape;if(t.rank!==1&&t.rank!==e)throw new W(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return r.length===1?V(t,[1,r[0],1,1,1]):V(t,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?V(t,[1,1,1,1,r[0]]):V(t,[1].concat(r))}else if(e===4){if(n==="channelsFirst")return r.length===1?V(t,[1,r[0],1,1]):V(t,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?V(t,[1,1,1,r[0]]):V(t,[1].concat(r))}else if(e===3){if(n==="channelsFirst")return r.length===1?V(t,[1,r[0],1]):V(t,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?V(t,[1,1,r[0]]):V(t,[1].concat(r))}else if(e<3)return t;throw new W(`Unsupported input rank by biasAdd: ${t.rank}`)}function Wa(e,t,n){return X(()=>(n==null&&(n=Aa()),Dn(n),ue(e,jP(e.rank,t,n))))}function CAt(e,t=1){if(t!==1)throw new et(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return jw(e)}function SAt(e){return X(()=>Oe(e,ue(Bn(e),1)))}function Uye(e,t,n,r){return X(()=>cne(e,t,n,r))}function kAt(e){return X(()=>{const t=ue(.5,j(.2,e));return ys(t,0,1)})}function yC(e,t,n=!1){return n?e():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const EAt=["fanIn","fanOut","fanAvg"],AAt=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _At(e){Gg(EAt,"FanMode",e)}function TAt(e){Gg(AAt,"Distribution",e)}class Uo extends fg{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class jye extends Uo{apply(t,n){return zn(t,n)}}jye.className="Zeros";le(jye);class MW extends Uo{apply(t,n){return fs(t,n)}}MW.className="Ones";le(MW);class Wye extends Uo{constructor(t){if(super(),typeof t!="object")throw new W(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new W(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return X(()=>j(Ve(this.value),fs(t,n)))}getConfig(){return{value:this.value}}}Wye.className="Constant";le(Wye);class Vye extends Uo{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return lg(t,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Vye.className="RandomUniform";le(Vye);class Gye extends Uo{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new et(`randomNormal does not support dType ${n}.`);return PF(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Gye.className="RandomNormal";le(Gye);class Hye extends Uo{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new et(`truncatedNormal does not support dType ${n}.`);return t5(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Hye.className="TruncatedNormal";le(Hye);class qye extends Uo{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return X(()=>{if(t.length!==2||t[0]!==t[1])throw new W("Identity matrix initializer can only be used for 2D square matrices.");return j(this.gain,IB(t[0]))})}getConfig(){return{gain:this.gain}}}qye.className="Identity";le(qye);function IAt(e,t="channelsLast"){let n,r;if(Dn(t),e.length===2)n=e[0],r=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){const i=Af(e,2);n=e[1]*i,r=e[0]*i}else if(t==="channelsLast"){const i=Af(e,0,e.length-2);n=e[e.length-2]*i,r=e[e.length-1]*i}}else{const i=Af(e);n=Math.sqrt(i),r=Math.sqrt(i)}return[n,r]}class As extends Uo{constructor(t){if(super(),t.scale<0)throw new W(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,_At(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,TAt(this.distribution),this.seed=t.seed}apply(t,n){const r=IAt(t),i=r[0],s=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,i):this.mode==="fanOut"?o/=Math.max(1,s):o/=Math.max(1,(i+s)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new et(`${this.getClassName()} does not support dType ${n}.`);return t5(t,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return lg(t,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}As.className="VarianceScaling";le(As);class LW extends As{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return As.className}}LW.className="GlorotUniform";le(LW);class PW extends As{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return As.className}}PW.className="GlorotNormal";le(PW);class BW extends As{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return As.className}}BW.className="HeNormal";le(BW);class zW extends As{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return As.className}}zW.className="HeUniform";le(zW);class UW extends As{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return As.className}}UW.className="LeCunNormal";le(UW);class jW extends As{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return As.className}}jW.className="LeCunUniform";le(jW);class Xye extends Uo{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,n){return X(()=>{if(t.length<2)throw new et("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const r=Z(t.slice(0,-1)),i=t[t.length-1],s=r*i;s>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${s}) elements: Slowness may result.`);const o=[Math.max(i,r),Math.min(i,r)],a=PF(o,0,1,n,this.seed),u=xne.qr(a,!1);let l=u[0];const f=u[1].flatten().stridedSlice([0],[Math.min(i,r)*Math.min(i,r)],[Math.min(i,r)+1]);return l=j(l,f.sign()),r<i&&(l=l.transpose()),j(Ve(this.gain),l.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}Xye.className="Orthogonal";le(Xye);const hQ={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function dQ(e,t={}){return pC(e,Bs.getMap().classNameMap,t,"initializer")}function yn(e){return FW(e)}function cn(e){if(typeof e=="string"){const t=e in hQ?hQ[e]:e;if(t==="GlorotNormal")return new PW;if(t==="GlorotUniform")return new LW;if(t==="HeNormal")return new BW;if(t==="HeUniform")return new zW;if(t==="LeCunNormal")return new UW;if(t==="LeCunUniform")return new jW;{const n={};return n.className=t,n.config={},dQ(n)}}else return e instanceof Uo?e:dQ(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WP(e){return Array.isArray(e)&&Array.isArray(e[0])}function f_(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function Ge(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new W(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function Ct(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new W(`Expected exactly 1 Shape; got ${e.length}`)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function h_(e){let t=0;for(const n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((r,i)=>r*i);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const pQ="Variable";class DAt{constructor(t,n="float32",r=pQ,i=!0,s=null){this.dtype=n??"float32",this.shape=t.shape,this.id=Rye(),r=r??pQ,this.originalName=Lye(r),this.name=Pye(this.originalName),this.trainable_=i,this.constraint=s,this.val=une(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),NAt(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function NAt(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function VP(e){return e.map(t=>t.read())}function WW(e){e.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jn{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class zu{constructor(t,n,r,i,s,o,a){this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=i,this.callArgs=s,this.outputTensorIndex=a,this.id=Rye(),o!=null&&(this.originalName=Lye(o),this.name=Pye(this.originalName)),this.rank=n.length}}let FAt=0;class BF{constructor(t,n){this.callArgs=n,this.id=FAt++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const r of t.inboundLayers)r!=null&&r.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const n of this.inboundLayers)n!=null?t.push(n.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let OAt=0;class at extends fg{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=OAt++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=t.name;if(!n){const r=this.getClassName();n=Al(r)+"_"+LF(r)}if(this.name=n,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let r;if(t.batchInputShape!=null)r=t.batchInputShape;else if(t.inputShape!=null){let s=null;t.batchSize!=null&&(s=t.batchSize),r=[s].concat(t.inputShape)}this.batchInputShape=r;let i=t.dtype;i==null&&(i=t.inputDType),i==null&&(i="float32"),this.dtype=i}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,n){return t.name+"_ib-"+n.toString()}getNodeAtIndex(t,n){if(this.inboundNodes.length===0)throw new vo(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=t)throw new W(`Asked to get ${n} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Oi(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Oi(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ja(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ja(`Layer ${this.name} is not connected, no input to return.`);return Oi(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ja(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ja(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Oi(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(n=>n.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){const n=Ot(t);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=Ot(this.inputSpec);if(n.length!==r.length)throw new W(`Layer ${this.name} expects ${r.length} inputs, but it received ${n.length} input tensors. Input received: ${t}`);for(let i=0;i<n.length;i++){const s=n[i],o=r[i];if(o==null)continue;const a=s.rank;if(o.ndim!=null&&a!==o.ndim)throw new W(`Input ${i} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new W(`Input ${i} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new W(`Input ${i} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&s.dtype!==o.dtype)throw new W(`Input ${i} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${s.dtype}.`);if(o.axes){const u=s.shape;for(const l in o.axes){const c=Number(l),f=o.axes[l],h=c>=0?u[c]:u[u.length+c];if(f!=null&&[f,null].indexOf(h)===-1)throw new W(`Input ${i} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${f} but got shape ${u}.`)}}if(o.shape!=null)for(let u=0;u<o.shape.length;++u){const l=o.shape[u],c=s.shape[u];if(l!=null&&c!=null&&l!==c)throw new W(`Input ${i} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${s.shape}.`)}}}call(t,n){return t}invokeCallHook(t,n){this._callHook!=null&&this._callHook(t,n)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,n){n=n||{},this.assertNotDisposed();const r=Ot(t),i=LAt(t),s=PAt(t);if(i===s)throw new W("Arguments to apply() must be all SymbolicTensors or all Tensors");return cp(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const o=[];for(const a of Ot(t))o.push(a.shape);this.build(Oi(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(t),s){let o=this.call(t,n);this.supportsMasking&&this.setMaskMetadata(t,o);const a=Ot(o),u=[];for(let l of a)r.indexOf(l)!==-1&&(l=l.clone()),u.push(l);if(o=Oi(u),this.activityRegularizer!=null)throw new et("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=RAt(t),a=this.computeOutputShape(o);let u;const l=MAt(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?u=a.map((c,f)=>new zu(l,c,this,Ot(t),n,this.name,f)):u=new zu(l,a,this,Ot(t),n,this.name),this.addInboundNode(t,u,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new et("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((r,i)=>{r!=null&&t[i]!=null&&t[i]!==r&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ja(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const n of this.inboundNodes){const r=JSON.stringify(n.outputShapes);t.indexOf(r)===-1&&t.push(r)}if(t.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new Ja(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new vo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return h_(this.weights)}build(t){this.built=!0}getWeights(t=!1){return VP(t?this.trainableWeights:this.weights)}setWeights(t){X(()=>{const n=this.weights;if(n.length!==t.length)throw new W(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${n.length} weights. Provided weights: ${t}...`);if(n.length===0)return;const r=[],i=VP(n);for(let s=0;s<i.length;++s){const o=i[s],a=n[s],u=t[s];if(!gt(o.shape,u.shape))throw new W(`Layer weight shape ${o.shape} not compatible with provided weight shape ${u.shape}`);r.push([a,u])}WW(r)})}addWeight(t,n,r,i,s,o,a,u){if(this._addedWeightNames.indexOf(t)!==-1)throw new W(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(i=u!=null?u():cn("zeros"));const l=i.apply(n,r),c=new DAt(l,r,t,o,a);return l.dispose(),s!=null&&this.addLoss(()=>s.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=Ot(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(t,n,r){if(!this.supportsMasking)return;const i=this.computeMask(t,r),s=Ot(n),o=Ot(i);if(s.length!==o.length)throw new Error(`${this.name} outputs ${s.length} tensors but ${s.length} masks for those tensors`);for(let a=0;a<s.length;a++)s[a].kerasMask=o[a]}addInboundNode(t,n,r,i,s,o,a=null){const u=Ot(t);n=Ot(n),r=Ot(r),i=Ot(i),s=f_(s),o=f_(o);const l=[],c=[],f=[];for(const h of u)l.push(h.sourceLayer),c.push(h.nodeIndex),f.push(h.tensorIndex);new BF({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:f,inputTensors:u,outputTensors:n,inputMasks:r,outputMasks:i,inputShapes:s,outputShapes:o},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function RAt(e){e=Ot(e);const t=[];for(const n of e)t.push(n.shape);return Oi(t)}function MAt(e){return"float32"}function Yye(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{const r=t.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{const i=[];for(let s=0;s<r.inboundLayers.length;s++){const o=r.inputTensors[s],a=r.inboundLayers[s],u=r.nodeIndices[s],l=Yye(o,a,u);for(const c of l)i.indexOf(c)===-1&&i.push(c)}return i}}}function LAt(e){let t=!0;for(const n of Ot(e))if(!(n instanceof zu)){t=!1;break}return t}function PAt(e){let t=!0;for(const n of Ot(e))if(n instanceof zu){t=!1;break}return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bC extends at{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:LF("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new W("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new W("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new W("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=t.dtype||"float32";this.batchInputShape=n,this.dtype=r,this.inputSpec=[{shape:n}];const i=new zu(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new BF({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new W(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}bC.className="InputLayer";le(bC);function BAt(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new W("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new bC({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zAt(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return ge(t,e.dtype)}catch{throw new W(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}class pf{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof pf)for(const n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(const n of t)this.add(n.key,n.value)}}add(t,n,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=zAt(t,n),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new W(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof zu){if(this.id2Value[t.id]==null)throw new W(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const n=this.name2Id[t];if(n==null)throw new W(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof zu){if(this.id2Value[t.id]==null)throw new W(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const n=this.name2Id[t];if(n==null)throw new W(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&ot(this.id2Mask)}}const d_=new Nye,p_=new Nye;function UAt(e){d_!=null&&d_.setMaxEntries(e),p_!=null&&p_.setMaxEntries(e)}function lx(e,t,n,r){const i=n==null?!1:n.training,s=Array.isArray(e),o=s?e:[e],a=o.map(p=>p.name),u=[],l=t.names();for(const p of a)l.indexOf(p)!==-1?u.push(t.getValue(p)):u.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const c=a.join(",")+"|"+t.names().sort().join(",");let f=d_.get(c),h;if(f==null){const p=jAt(o,t);f=p.sorted,h=p.recipientCounts,d_.put(c,f),p_.put(c,h)}h={},i||Object.assign(h,p_.get(c));const d=new pf(t);for(let p=0;p<f.length;++p){if(r!=null){const k=zk().numTensors;k>r.maxNumTensors&&(r.maxNumTensors=k),k<r.minNumTensors&&(r.minNumTensors=k)}const g=f[p],m=g.sourceLayer;if(m instanceof bC)continue;const y=[],b=[],v=[];let x=!1;for(const k of g.inputs){const E=d.getValue(k),A=d.getMask(k);y.push(E),b.push(A),A!=null&&(x=!0),i||(h[k.name]--,h[k.name]===0&&!t.hasKey(k)&&a.indexOf(k.name)===-1&&!E.isDisposed&&k.sourceLayer.stateful!==!0&&v.push(E))}x&&(n=n||{},n.mask=b[0]);const w=Ot(m.apply(y,n));let C=null;m.supportsMasking&&(C=m.computeMask(y,b));const $=VAt(g),S=Array.isArray($)?$:[$];for(let k=0;k<S.length;++k){d.hasKey(S[k])||d.add(S[k],w[k],Array.isArray(C)?C[0]:C);const E=a.indexOf(S[k].name);E!==-1&&(u[E]=w[k])}i||ot(v)}return d.disposeMasks(),s?u:u[0]}function jAt(e,t){D(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(e.length===1){const i=gQ(e[0],t);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of e){const{sorted:o,recipientMap:a}=gQ(s,t);for(const u of o)i.has(u.name)||(n.push(u),i.add(u.name));for(const u in a)r[u]==null&&(r[u]=new Set),a[u].forEach(l=>r[u].add(l))}}return{sorted:n,recipientCounts:WAt(r)}}function WAt(e){const t={};for(const n in e)t[n]=e[n].size;return t}function gQ(e,t){const n=new Set,r=[],i={};for(const a of t.names())n.add(a);const s=[],o=[];for(s.push(e);s.length>0;){const a=s[s.length-1];if(n.has(a.name)){s.pop();continue}const u=o[o.length-1]===s.length-1;if(a.inputs.length===0||u)s.pop(),r.push(a),n.add(a.name),u&&o.pop();else{o.push(s.length-1);for(const l of a.inputs)i[l.name]==null&&(i[l.name]=new Set),i[l.name].add(a.name),!n.has(l.name)&&s.push(l)}}return{sorted:r,recipientMap:i}}function VAt(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let r=0;r<e.sourceLayer.inboundNodes.length;++r)for(const i of e.sourceLayer.inboundNodes[r].outputTensors)if(i.id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GAt=q();GAt.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,UAt);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VW(e,t){return X(()=>Vr(_e(j(e,e),t,!0)))}class xC extends fg{getConfig(){return{}}}class Kye extends xC{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return X(()=>{const n=VW(t,this.axis),r=ys(n,0,this.maxValue);return j(t,Oe(r,ue(Un(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Kye.className="MaxNorm";le(Kye);class Zye extends xC{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return X(()=>Oe(t,ue(Un(),VW(t,this.axis))))}getConfig(){return{axis:this.axis}}}Zye.className="UnitNorm";le(Zye);class Jye extends xC{apply(t){return ju(t)}}Jye.className="NonNeg";le(Jye);class Qye extends xC{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return X(()=>{const n=VW(t,this.axis),r=ue(j(this.rate,ys(n,this.minValue,this.maxValue)),j(1-this.rate,n));return j(t,Oe(r,ue(Un(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Qye.className="MinMaxNorm";le(Qye);const mQ={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Wn(e){return FW(e)}function yQ(e,t={}){return pC(e,Bs.getMap().classNameMap,t,"constraint")}function Vn(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in mQ?mQ[e]:e,config:{}};return yQ(n)}else return e instanceof xC?e:yQ(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function hd(e){if(e==null)return;const t=[],n=[],r=[];for(const i in e){const s=e[i];if(typeof s!="number"){const o=s;t.push(o.data()),n.push(i),r.push(o)}}if(t.length>0){const i=await Promise.all(t);for(let s=0;s<i.length;++s)e[n[s]]=i[s][0];ot(r)}}function ebe(e){if(e!=null)for(const t in e){const n=e[t];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var bQ;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(bQ||(bQ={}));const HAt=125;class E2{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,n){}async onEpochEnd(t,n){}async onBatchBegin(t,n){}async onBatchEnd(t,n){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class qAt{constructor(t,n=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=n}append(t){this.callbacks.push(t)}setParams(t){for(const n of this.callbacks)n.setParams(t)}setModel(t){for(const n of this.callbacks)n.setModel(t)}async onEpochBegin(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochBegin(t,n)}async onEpochEnd(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochEnd(t,n)}async onBatchBegin(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchBegin(t,n)}async onBatchEnd(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchEnd(t,n)}async onTrainBegin(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainEnd(t)}}class XAt extends E2{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,n){n==null&&(n={});const r=n.size==null?0:n.size;this.seen+=r;for(const i in n){const s=n[i];if(typeof s=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+s*r;else{let o;i in this.totals?o=this.totals[i]:this.totals[i]=0;const a=X(()=>ue(this.totals[i],j(s,r)));this.totals[i]=a,o!=null&&o.dispose()}}}async onEpochEnd(t,n){if(n!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?n[r]=this.totals[r]/this.seen:X(()=>{const i=j(Oe(1,this.seen),this.totals[r]);n[r]=i,this.totals[r].dispose(),ga(n[r])}))}}class YAt extends E2{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,n){n==null&&(n={}),this.epoch.push(t);for(const r in n)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(n[r])}async syncData(){const t=[],n=[],r=[];for(const s in this.history){const o=this.history[s];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const u=o[a];t.push(u.data()),n.push(s),r.push(a)}}const i=await Promise.all(t);for(let s=0;s<i.length;++s)this.history[n[s]][r[s]].dispose(),this.history[n[s]][r[s]]=i[s][0]}}class KAt extends E2{constructor(t,n){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||x5,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=HAt),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Fk(this.yieldEvery)&&(this.maybeWait=lAt(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,n,r){const i=[];this.yield!=null&&(await hd(r),i.push(this.yield(t,n,r))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(t,n){this.currentEpoch=t,this.epochBegin!=null&&(await hd(n),await this.epochBegin(t,n))}async onEpochEnd(t,n){const r=[];this.epochEnd!=null&&(await hd(n),r.push(this.epochEnd(t,n))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(t,n){this.batchBegin!=null&&(await hd(n),await this.batchBegin(t,n))}async onBatchEnd(t,n){const r=[];this.batchEnd!=null&&(await hd(n),r.push(this.batchEnd(t,n))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):Fk(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),await Promise.all(r)}async onTrainBegin(t){this.trainBegin!=null&&(await hd(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await hd(t),await this.trainEnd(t))}}function tbe(e,t){return e==null&&(e={}),e instanceof E2?[e]:Array.isArray(e)&&e[0]instanceof E2?e:Ot(e).map(r=>new KAt(r,t))}class oo{constructor(){}static registerCallbackConstructor(t,n){D(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),oo.checkForDuplicate(n),oo.constructors[t]==null&&(oo.constructors[t]=[]),oo.constructors[t].push(n)}static checkForDuplicate(t){for(const n in oo.constructors)oo.constructors[+n].forEach(i=>{if(i===t)throw new W("Duplicate callback constructor.")})}static clear(){oo.constructors={}}static createCallbacks(t){const n=[];for(const r in oo.constructors){const i=+r;t>=i&&n.push(...oo.constructors[i])}return n.map(r=>new r)}}oo.constructors={};function nbe(e,t,n,r,i,s,o,a,u){const l=new YAt,c=[new XAt,...oo.createCallbacks(t)];e!=null&&c.push(...e),c.push(l);const f=new qAt(c);return f.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:t,doValidation:a,metrics:u}),{callbackList:f,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ec(e,t={},n=!1){return pC(e,Bs.getMap().classNameMap,t,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function g_(e,t){return X(()=>{e.dtype!=="float32"&&(e=ge(e,"float32"));const n=_e(mC(e),t,!0),r=V1(n.shape,Un()),i=Vr(mc(n,r));return Oe(e,i)})}function zF(e,t){return X(()=>wn(mC(ke(t,e)),-1))}function GW(e,t){return X(()=>wn(Bn(ke(t,e)),-1))}function HW(e,t){return X(()=>{const n=ke(e,t),r=ys(Bn(e),Un(),Number.MAX_VALUE),i=Bn(Oe(n,r));return j(100,wn(i,-1))})}function ZAt(e,t){return X(()=>{const n=ys(t,Un(),Number.MAX_VALUE),r=Hs(ue(1,n)),i=ys(e,Un(),Number.MAX_VALUE),s=Hs(ue(1,i));return wn(mC(ke(r,s)),-1)})}function JAt(e,t){return X(()=>{const n=mc(0,ke(1,j(e,t)));return wn(mC(n),-1)})}function QAt(e,t){return X(()=>{const n=mc(0,ke(1,j(e,t)));return wn(n,-1)})}function e_t(e,t){return X(()=>{const n=_e(j(e,t),-1),r=Co(j(ke(1,e),t),-1);return mc(0,ue(1,ke(r,n)))})}function t_t(e,t){return X(()=>{const n=Math.log(2),r=ke(t,e),i=ke(ue(r,G1(j(-2,r))),n);return wn(i,-1)})}function A2(e,t,n=!1){return X(()=>{if(n)t=rI(t);else{const r=_e(t,t.shape.length-1,!0);t=Oe(t,r)}return t=ys(t,Un(),1-Un()),rn(_e(j(ge(e,"float32"),Hs(t)),t.shape.length-1))})}function m_(e,t,n=!1){return X(()=>{const r=ge(Vw(wAt(e)),"int32");t=ys(t,Un(),1-Un());const i=t.shape,s=V(Qx(r,i[i.length-1]),i);return A2(s,t,n)})}function n_t(e,t){if(!gt(e.shape,t.shape))throw new W(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return X(()=>{const n=ju(t),r=rn(Bn(t));return ue(ke(n,j(t,e)),HT(bs(r)))})}function UF(e,t){return X(()=>{let n;return n=ys(t,Un(),1-Un()),n=Hs(Oe(n,ke(1,n))),wn(n_t(e,n),-1)})}function r_t(e,t){return X(()=>{const n=ys(e,Un(),1),r=ys(t,Un(),1);return _e(j(e,Hs(Oe(n,r))),-1)})}function i_t(e,t){return X(()=>{const n=Hs(ue(Un(),t));return wn(ke(t,j(e,n)),-1)})}function rbe(e,t){return X(()=>{const n=g_(e,-1),r=g_(t,-1),i=j(n,r);return rn(_e(i,-1))})}const y_={meanSquaredError:zF,meanAbsoluteError:GW,meanAbsolutePercentageError:HW,meanSquaredLogarithmicError:ZAt,squaredHinge:JAt,hinge:QAt,categoricalHinge:e_t,logcosh:t_t,categoricalCrossentropy:A2,sparseCategoricalCrossentropy:m_,binaryCrossentropy:UF,kullbackLeiblerDivergence:r_t,poisson:i_t,cosineProximity:rbe};function DR(e){if(typeof e=="string"){if(e in y_)return y_[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new W(t)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ibe(e,t){return X(()=>{const n=j(.5,qs(t)),r=wu(Ds(t,n),e.dtype);return wn($a(e,r),-1)})}function sbe(e,t){return X(()=>wu($a(Xm(e,-1),Xm(t,-1)),"float32"))}function s_t(e,t){return X(()=>ge(_e(Eu($a(e,1),$a(t,1))),"float32"))}function o_t(e,t){return X(()=>ge(_e(Eu($a(e,0),$a(t,1))),"float32"))}function a_t(e,t){return X(()=>{const n=s_t(e,t),r=o_t(e,t),i=ue(n,r);return ge(jr(Ds(i,0),Oe(n,i),0),"float32")})}function u_t(e,t){return UF(e,t)}function l_t(e,t){return e.rank===t.rank&&(e=cg(e,[e.rank-1])),t=Xm(t,-1),t.dtype!==e.dtype&&(t=ge(t,e.dtype)),ge($a(e,t),"float32")}const c_t=zF,f_t=zF,h_t=GW,d_t=GW,p_t=HW,g_t=HW,obe=A2,m_t=rbe,abe=m_,b_={binaryAccuracy:ibe,categoricalAccuracy:sbe,precision:a_t,categoricalCrossentropy:obe,sparseCategoricalCrossentropy:abe,mse:c_t,MSE:f_t,mae:h_t,MAE:d_t,mape:p_t,MAPE:g_t,cosine:m_t};function y_t(e){if(typeof e=="string"&&e in b_)return b_[e];if(typeof e!="string"&&e!=null)return e;throw new W(`Unknown metric ${e}`)}function LS(e){if(Qa(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(const n of Object.keys(y_))if(y_[n]===e){t=n;break}if(t!==void 0)return t;for(const n of Object.keys(b_))if(b_[n]===e){t=n;break}return t!==void 0?t:e.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function b_t(e){const t={Adagrad:()=>vl.adagrad(.01),Adadelta:()=>vl.adadelta(1,.95,Un()),Adam:()=>vl.adam(.001,.9,.999,Un()),Adamax:()=>vl.adamax(.002,.9,.999,Un(),0),RMSProp:()=>vl.rmsprop(.001,.9,0,Un()),SGD:()=>vl.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new W(`Unknown Optimizer ${e}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xQ=1*1024*1024;function vQ(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!GP(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const r=JSON.stringify(e);r.length>xQ&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${xQ}.`)}}function GP(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t)if(typeof n!="string"||!GP(e[n]))return!1;return!0}else if(Array.isArray(e)){for(const t of e)if(!GP(t))return!1;return!0}else return!1;else{const t=typeof e;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function x_t(e,t,n,r=console.log){const i=w_t(e),s=["Layer (type)","Input Shape","Output shape","Param #"];i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(t*c)));let o;if(!i){s.push("Receives inputs"),o=[];for(const c in e.nodesByDepth)o.push(...e.nodesByDepth[c])}r("_".repeat(t)),x_(s,n,r),r("=".repeat(t));const a=e.layers;for(let c=0;c<a.length;++c)i?$_t(a[c],n,r):C_t(a[c],n,o,r),r((c===a.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const u=v_t(e),l=h_(e.nonTrainableWeights);r(`Total params: ${u+l}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${l}`),r("_".repeat(t))}function v_t(e){let t;return e.collectedTrainableWeights!=null?t=h_(e.collectedTrainableWeights):t=h_(e.trainableWeights),t}function w_t(e){let t=!0;const n=[],r=[];for(const i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(const i of n){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){t=!1;break}r.push(...i)}if(t)for(const i of e.layers){let s=!1;for(const o of i.inboundNodes)if(r.indexOf(o)!==-1)if(s){t=!1;break}else s=!0;if(!t)break}return t}function x_(e,t,n=console.log){let r="";for(let i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=e[i],r=r.slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function $_t(e,t,n){let r,i;try{i=e.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(e.outputShape)}catch{r="multiple"}const s=e.name,o=e.getClassName(),a=[`${s} (${o})`,i,r,e.countParams().toString()];x_(a,t,n)}function C_t(e,t,n,r){let i,s;try{s=e.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{s="multiple"}try{i=JSON.stringify(e.outputShape)}catch{i="multiple"}const o=[];for(const f of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(f)===-1))for(let h=0;h<f.inboundLayers.length;++h){const d=f.inboundLayers[h].name,p=f.nodeIndices[h],g=f.tensorIndices[h];o.push(`${d}[${p}][${g}]`)}const a=e.name,u=e.getClassName(),l=o.length===0?"":o[0],c=[`${a} (${u})`,s,i,e.countParams().toString(),l];x_(c,t,r);for(let f=1;f<o.length;++f)x_(["","","","",o[f]],t,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ube(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function HP(e,t){if(e===null)return null;if(typeof e=="string")return Nd(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const s=e[i];ube(t,i,s)?n.push(s):n.push(HP(s,t))}return n}else{const n={};for(const r of Object.keys(e)){const i=e[r];if(r==="name"&&typeof i=="string")n[r]=i;else{const s=Nd(r);n[s]=HP(i,s)}}return n}}function qP(e,t){if(e==null)return null;if(typeof e=="string")return Al(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const s=e[i];ube(t,i,s)?n.push(s):n.push(qP(s,t))}return n}else{const n={};for(const r of Object.keys(e)){const i=e[r],s=Al(r);(r==="name"||r==="className")&&typeof i=="string"?n[s]=i:n[s]=qP(i,r)}return n}}/** @license See the LICENSE file. */const lbe="4.18.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const S_t=e=>{const t=Object.keys(e);if(t.length===0)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Zo extends at{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=LF(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Ef(this.inputs).length!==this.inputs.length)throw new W(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);Ef(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const v=b.sourceLayer,x=b.nodeIndex,w=b.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(x),this.outputLayersTensorIndices.push(w)}for(const b of this.inputs){const v=b.sourceLayer,x=b.nodeIndex,w=b.tensorIndex;Qa(x===0,"input layer has >1 nodes"),Qa(w===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(x),this.inputLayersTensorIndices.push(w)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const v=this.inputLayers[b];if(!(v instanceof bC))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const n={},r={},i={},s={},o={},a=[],u=(b,v,x,w,C,$)=>{(w==null||C==null||$==null)&&(w=b.sourceLayer,C=b.nodeIndex,$=b.tensorIndex);const S=w.inboundNodes[C];if(x.indexOf(S)!==-1)throw new vo(`The tensor ${b.name} at layer "${w.name}" is part of a cycle.`);if(v.indexOf(S)!==-1)return;this.containerNodes.add(Zo.nodeKey(w,C)),w.id in o||(o[w.id]=Object.keys(o).length),x.indexOf(S)===-1&&x.push(S);const k=S.inboundLayers.length;for(let E=0;E<k;E++){const A=S.inputTensors[E],F=S.inboundLayers[E],_=S.nodeIndices[E],I=S.tensorIndices[E];u(A,v,x,F,_,I)}for(v.push(S);x.indexOf(S)>=0;)x.splice(x.indexOf(S),1);a.push(S)},l=[],c=[];for(const b of this.outputs)u(b,l,c);const f=a.slice().reverse();for(const b of f){r[b.id]=b,b.id in n||(n[b.id]=0);let v=n[b.id];const x=i[b.outboundLayer.id]==null?0:i[b.outboundLayer.id];v=Math.max(v,x),i[b.outboundLayer.id]=v,s[b.outboundLayer.id]=b.outboundLayer,n[b.id]=v;for(let w=0;w<b.inboundLayers.length;w++){const C=b.inboundLayers[w],$=b.nodeIndices[w],S=C.inboundNodes[$],k=n[S.id]==null?0:n[S.id];n[S.id]=Math.max(v+1,k),r[S.id]=S}}const h={};for(const b in n){const v=n[b];v in h||(h[v]=[]),h[v].push(r[b])}const d={};for(const b in i){const v=i[b];v in d||(d[v]=[]),d[v].push(s[b])}let p=Object.keys(d).map(b=>parseInt(b,10)).sort(OS);this.layers=[];for(const b of p){const v=d[b];v.sort((x,w)=>{const C=o[x.id],$=o[w.id];return C<$?-1:C>$?1:0});for(const x of v)x instanceof Zo&&this.internalContainerRefs.push(x),this.layers.push(x)}this.layersByDepth=d,p=Object.keys(h).map(b=>parseInt(b,10)).sort(OS);const g=this.inputs.slice(),m=[];for(const b of p)for(const v of h[b]){const x=v.outboundLayer;if(x!=null){for(const w of v.inputTensors)if(g.indexOf(w)===-1)throw new vo(`Graph disconnected: cannot obtain value for tensor ${w} at layer "${x.name}". The following previous layers were accessed without issue: ${m}`);for(const w of v.outputTensors)g.push(w);m.push(x.name)}}this.nodesByDepth=h;const y=this.layers.map(b=>b.name);for(const b of y){const v=y.filter(x=>x===b).length;if(v!==1)throw new vo(`The name "${b}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new BF({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new W("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.layers)n.push(...r.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){const r={};let i=0;const s=S_t(t);s&&this.parseWeights(t);for(const a of this.layers)for(const[u,l]of a.weights.entries()){const c=s?`${l.name.split("/").slice(0,-1).join("/")+"/"}${u}`:l.originalName;if(r[c]!=null)throw new W(`Duplicate weight name: ${c}`);r[c]=l,i++}const o=[];for(const a in t){let u=a;if(r[a]==null){const l=a.split("/");u=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[u]!=null)o.push([r[u],t[a]]);else if(n)throw new W(`Provided weight data has no target variable: ${a}`);delete r[u]}if(n){const a=[];for(const u in r)a.push(u);if(a.length>0)throw new W(`${a.length} of ${i} weights are not set: ${a}`)}WW(o)}parseWeights(t){for(const n in Object.keys(t)){const r=n.split("/"),i=["vars","layer_checkpoint_dependencies"],s=r.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!i.includes(o)).join("/");s!==n&&(t[s]=t[n],delete t[n])}}updatedConfig(){const t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${lbe}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){const r=qP(this.updatedConfig());return n?JSON.stringify(r):r}call(t,n){return X(()=>{t=Ot(t);const r=new pf;for(let i=0;i<this.inputs.length;++i)r.add(this.inputs[i],t[i]);return lx(this.outputs,r,n)})}computeMask(t,n){return X(()=>{t=Ot(t);let r;return n==null?r=Zp(null,t.length):r=Ot(n),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){const n=f_(t);if(n.length!==this.inputLayers.length)throw new W(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<n.length;a++){const u=this.inputLayers[a],l=n[a],c=u.name+"_0_0";r[c]=l}const i=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(OS);if(i.length>1)for(const a of i){const u=this.nodesByDepth[a];for(const l of u){const c=l.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(c.id)!==-1)continue;const f=[];for(let g=0;g<l.inboundLayers.length;g++){const m=l.inboundLayers[g],y=l.nodeIndices[g],b=l.tensorIndices[g],v=`${m.name}_${y}_${b}`,x=r[v];f.push(x)}const h=c.computeOutputShape(Oi(f)),d=f_(h),p=c.inboundNodes.indexOf(l);for(let g=0;g<d.length;g++){const m=`${c.name}_${p}_${g}`;r[m]=d[g]}}}const s=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const u=this.outputLayers[a],l=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],f=`${u.name}_${l}_${c}`;o.push(f)}for(let a=0;a<o.length;a++){const u=o[a];Qa(u in r),s.push(r[u])}return Oi(s)}runInternalGraph(t,n){n==null&&(n=Zp(null,t.length));const r={};for(let u=0;u<this.inputs.length;++u){const l=this.inputs[u],c=t[u],f=n[u];r[l.id]=[c,f]}const i=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(OS);for(const u of i){const l=this.nodesByDepth[u];for(const c of l){const f=c.outboundLayer,h=c.inputTensors,d=c.outputTensors,p=new Array;for(const g of h)g.id in r&&p.push(r[g.id]);if(p.length===h.length){let g={},m,y,b,v;if(c.callArgs!=null&&(g=c.callArgs),p.length===1){const[x,w]=p[0];g.mask==null&&(g.mask=w),b=Ot(f.call(x,g)),v=Ot(f.computeMask(x,w)),m=[x],y=[w]}else m=p.map(x=>x[0]),y=p.map(x=>x[1]),g.mask==null&&(g.mask=y),b=Ot(f.call(m,g)),v=Ot(f.computeMask(m,y));if(f.activityRegularizer)throw new et("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let x=0;x<d.length;++x){const w=d[x],C=b[x],$=v[x];r[w.id]=[C,$]}}}}const s=[],o=[],a=[];for(const u of this.outputs){Qa(u.id in r,`Could not compute output ${u.name} : ${u.id}`);const[l,c]=r[u.id];a.push(l.shape),s.push(l),o.push(c)}return[s,o,a]}buildNodeConversionMap(t){const n={};let r;for(const i of this.layers){r=i instanceof Zo?1:0;for(let s=0;s<i.inboundNodes.length;s++){const o=Zo.nodeKey(i,s);this.containerNodes.has(o)&&(n[o]=r,r+=1)}}return n}getLayer(t,n){if(n!=null)return this.findLayer(n);if(t==null)throw new W("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const r of this.layers)if(r.name===t)return r;throw new W(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new W(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return X(()=>{const t=[];for(const n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){const i=Zo.nodeKey(n,r);this.containerNodes.has(i)&&t.push(...n.calculateLosses())}return t})}getConfig(){const t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),u=o.getConfig(),l=[];for(let f=0;f<o.inboundNodes.length;f++){const h=o.inboundNodes[f],d=Zo.nodeKey(o,f);let p={};if(this.containerNodes.has(d)){if(h.callArgs)try{JSON.stringify(h.callArgs),p=h.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(h.inboundLayers.length>0){const g=[];for(let m=0;m<h.inboundLayers.length;m++){const y=h.inboundLayers[m],b=h.nodeIndices[m],v=h.tensorIndices[m],x=Zo.nodeKey(y,b);let w=n[x];w==null&&(w=0),g.push([y.name,w,v,p])}l.push(g)}}}const c={};c.name=o.name,c.className=a,c.config=u,c.inboundNodes=l,r.push(c)}t.layers=r;const i=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],u=this.inputLayersNodeIndices[o],l=Zo.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=n[l];c==null&&(c=0);const f=this.inputLayersTensorIndices[o];i.push([a.name,c,f])}t.inputLayers=i;const s=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],u=this.outputLayersNodeIndices[o],l=Zo.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=n[l];c==null&&(c=0);const f=this.outputLayersTensorIndices[o];s.push([a.name,c,f])}return t.outputLayers=s,t}static fromConfig(t,n,r={},i=!1){const s={},o={};function a(m,y){m.name in o?o[m.name].push(y):o[m.name]=[y]}function u(m,y){const b=[];let v;for(const x of y){const w=x[0],C=x[1],$=x[2];if(v=x[3]==null?{}:x[3],!(w in s)){a(m,y);return}const S=s[w];if(S.inboundNodes.length<=C){a(m,y);return}const k=S.inboundNodes[C];b.push(k.outputTensors[$])}b.length>0&&m.apply(Oi(b),v)}function l(m){const y=m.name,b=ec(m,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(i),s[y]=b,m.inboundNodes.forEach(x=>{if(!(x instanceof Array))throw new W(`Corrupted configuration, expected array for nodeData: ${x}`);a(b,x)})}const c=n.name,f=n.layers;for(const m of f)l(m);for(;!uAt(o);)for(const m of f){const y=s[m.name];if(y.name in o){const b=o[y.name];delete o[y.name];for(const v of b)u(y,v)}}const h=[],d=[],p=n.inputLayers;for(const m of p){const y=m[0],b=m[1],v=m[2];Qa(y in s);const w=s[y].inboundNodes[b].outputTensors;h.push(w[v])}const g=n.outputLayers;for(const m of g){const y=m[0],b=m[1],v=m[2];Qa(y in s);const w=s[y].inboundNodes[b].outputTensors;d.push(w[v])}return new t({inputs:h,outputs:d,name:c})}get stateful(){if(this._stateful)throw new W("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){X(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function k_t(e,t,n){const r=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(i=>null);if(r===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){const i=[];return t.forEach(s=>{s in e?i.push(e[s]):i.push(null)}),i}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function cbe(e,t){return k_t(e,t,"classWeight")}async function fbe(e,t,n,r){if(t!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const i=X(()=>{if(e.shape.length===1)return yf(e);if(e.shape.length===2){if(e.shape[1]>1)return Xm(e,1);if(e.shape[1]===1)return V(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await i.data());ot(i);const o=[];return s.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),li(o,"float32")}else return null}function E_t(e,t){return j(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const A_t=32;function hbe(e,t){let n,r;const i=t;n=i.xs,r=i.ys,D(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const s=wQ("input",e.inputNames,n),o=wQ("output",e.outputNames,r),a=s[0].shape[0];D(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),D(o.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let u=0;u<s.length;u++)D(s[u].shape[0]===a,()=>`Batch size mismatch: input ${e.inputNames[u]} has ${s[u].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);for(let u=0;u<o.length;u++)D(o[u].shape[0]===a,()=>`Batch size mismatch: output ${e.outputNames[u]} has ${o[u].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);return{xs:s,ys:o}}function wQ(e,t,n){if(n instanceof zt)return[n];if(Array.isArray(n))return D(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const r=[];for(const i of t){if(n[i]==null)throw new W(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);r.push(n[i])}return r}}function __t(e){if(e.length===3)throw new et("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function T_t(e,t,n){const r=n.batchesPerEpoch!=null;if(D(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),D(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),D(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),D(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),D(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const i=n.validationData!=null;let s,o;if(i)if($Q(n.validationData))D(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const m=__t(n.validationData);s=m.xs,o=m.ys}const a=e.makeTrainFunction(),u=e.getDedupedMetricsNames();let l;i?l=u.slice().concat(u.map(m=>"val_"+m)):l=u.slice();const c=tbe(n.callbacks,n.yieldEvery),f=n.verbose==null?1:n.verbose,{callbackList:h,history:d}=nbe(c,f,n.epochs,null,null,I_t(t,n),null,i,l);h.setModel(e),e.history=d,await h.onTrainBegin(),e.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,g=await t.iterator();for(;p<n.epochs;){const m={};await h.onEpochBegin(p);let y=0,b=0;for(r||(g=await t.iterator());!r||y<n.batchesPerEpoch;){const v=await g.next();if(r&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:x,ys:w}=hbe(e,v.value),C={};C.batch=b,C.size=x[0].shape[0],await h.onBatchBegin(b,C);const $=[];if(n.classWeight!=null){const E=cbe(n.classWeight,e.outputNames);for(let A=0;A<E.length;++A)$.push(await fbe(w[A],null,E[A]))}const S=x.concat(w).concat($),k=a(S);ot(S);for(let E=0;E<u.length;++E){const A=u[E],F=k[E];C[A]=F,ga(F)}await h.onBatchEnd(b,C),ebe(C),b++,y++}if(r?y>=n.batchesPerEpoch:v.done){if(i){let x;$Q(n.validationData)?x=Ot(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):x=Ot(e.evaluate(s,o,{batchSize:n.validationBatchSize==null?A_t:n.validationBatchSize,verbose:0}));for(let w=0;w<e.metricsNames.length;++w)m[`val_${e.metricsNames[w]}`]=x[w]}break}if(e.stopTraining_)break}if(await h.onEpochEnd(p,m),p++,e.stopTraining_)break}return await h.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function I_t(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function $Q(e){return typeof e.iterator=="function"}function D_t(e){return typeof e.next=="function"}async function N_t(e,t,n){n=n||{};const r=n.batches!=null,i=e.testFunction;let s=[];if(n.verbose>0)throw new et("Verbose mode is not implemented yet.");D(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=D_t(t)?t:await t.iterator();let a=0,u=0;for(;!r||u<n.batches;){const l=await o.next();if(s=X(()=>{if(l.value){const{xs:c,ys:f}=hbe(e,l.value),h=c.concat(f),d=X(()=>i(h));if(ot(h),u===0)for(let g=0;g<d.length;++g)s.push(Ve(0));const p=h[0].shape[0];for(let g=0;g<d.length;++g){const m=d[g],y=s[g];s[g]=X(()=>ue(s[g],j(p,m))),u>0&&ot(y)}ot(d),a+=p,++u}return s}),l.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<s.length;++l){const c=s[l];s[l]=Oe(s[l],a),ot(c)}return Oi(s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function NR(e){D(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function Db(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(r=>fp(r,t,n-t)):fp(e,t,n-t)}function XP(e,t){return X(()=>e==null?null:Array.isArray(e)?e.map(n=>XP(n,t)):zye(e,t.dtype==="int32"?t:ge(t,"int32")))}function FR(e,t){const n=[];let r=0,i=null;for(;r<e;)i=r+t,i>=e&&(i=e),n.push([r,i]),r=i;return n}function dbe(e){const t=[];e instanceof zt&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(r.rank===1)t.push(gC(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Go(e,t){if(e==null)return;const n=[];if(t instanceof zt)n.push(t.id);else if(Array.isArray(t))t.forEach(i=>n.push(i.id));else if(t!=null)for(const i in t){const s=t[i];n.push(s.id)}const r=[];if(e instanceof zt)n.indexOf(e.id)===-1&&r.push(e);else if(Array.isArray(e))e.forEach(i=>{n.indexOf(i.id)===-1&&r.push(i)});else if(e!=null)for(const i in e){const s=e[i];n.indexOf(s.id)===-1&&r.push(s)}r.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function F_t(e){return e instanceof zt}function YP(e){return Array.isArray(e)}function CQ(e){return!F_t(e)&&!YP(e)}function SQ(e,t,n,r=!0,i=""){if(t==null||t.length===0){if(e!=null){let o=!1;if(YP(e)&&e.length>0)o=!0;else if(CQ(e)){for(const a in e)if(e.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new W(`Error when checking model ${i} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(o=>null);let s;if(CQ(e)){e=e,s=[];for(const o of t){if(e[o]==null)throw new W(`No data provided for "${o}". Need data for each key in: ${t}`);s.push(e[o])}}else if(YP(e)){if(e=e,e.length!==t.length)throw new W(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(e=e,t.length>1)throw new W(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=dbe(s),n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new W(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let u=0;u<n[o].length;++u){if(u===0&&!r)continue;const l=a.shape[u],c=n[o][u];if(c!=null&&c>=0&&l!==c)throw new W(`${i} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function O_t(e,t,n){const r=Ef(e.map(s=>s.shape[0]));r.sort();const i=Ef(t.map(s=>s.shape[0]));if(i.sort(),r.length>1)throw new W(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(i.length>1)throw new W(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(r.length>0&&i.length>0&&!gt(r,i))throw new W(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}function R_t(e,t,n){const r=[zF,UF,A2];for(let i=0;i<e.length;++i){const s=e[i],o=t[i],a=n[i];if(o!=null){if(o===A2&&s.shape[s.shape.length-1]===1)throw new W(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const u=s.shape.slice(1),l=a.slice(1);for(let c=0;c<u.length;++c){const f=u[c],h=l[c];if(h!=null&&f!==h)throw new W(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function kQ(e,t,n,r=!0,i=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new W(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new W(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new W(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let u=0;u<n[o].length;++u){if(u===0&&!r)continue;const l=a.shape[u],c=n[o][u];if(c!=null&&c!==l)throw new W(`Error when checking ${i}: expected ${t[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function M_t(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(r=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(r=>n);{const r=[];for(const i of t){let s=n.hasOwnProperty(i)?n[i]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}const L_t="layers-model";class Wm extends Zo{constructor(t){super(t),this.isTraining=!1}summary(t,n,r=console.log){if(!this.built)throw new W("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");x_t(this,t,n,r)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=b_t(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof bc))throw new W("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const o in t.loss)if(this.outputNames.indexOf(o)===-1)throw new W(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)t.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(DR(t.loss[o]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new W(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(a=>DR(a))}else{const o=DR(t.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],u=this.outputNames[o];this.feedOutputNames.push(u),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],cp("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const i=M_t(t.metrics,this.outputNames),s=(o,a,u)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([u,o])};cp("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=i[o];(l=>{const c="";let f,h,d;for(const p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const m=this.internalOutputShapes[o];m[m.length-1]===1||this.lossFunctions[o]===UF?["accuracy","acc"].indexOf(p)!==-1?h=ibe:["crossentropy","ce"].indexOf(p)!==-1&&(h=u_t):this.lossFunctions[o]===m_?["accuracy","acc"].indexOf(p)!==-1?h=l_t:["crossentropy","ce"].indexOf(p)!==-1&&(h=abe):["accuracy","acc"].indexOf(p)!==-1?h=sbe:["crossentropy","ce"].indexOf(p)!==-1&&(h=obe);let y;["accuracy","acc"].indexOf(p)!==-1?y="acc":["crossentropy","ce"].indexOf(p)!==-1&&(y="ce"),d=h,f=c+y}else d=y_t(p),f=c+LS(p);let g;cp(f,()=>{g=d}),s(o,f,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,r={}){const i=r.batchSize==null?32:r.batchSize;NR(i);const o=this.standardizeUserDataXY(t,n,!0,i);try{const a=o[0].concat(o[1]);this.makeTestFunction();const u=this.testFunction,l=this.testLoop(u,a,i,r.verbose,r.steps);return Oi(l)}finally{Go(o[0],t),Go(o[1],n)}}async evaluateDataset(t,n){return this.makeTestFunction(),N_t(this,t,n)}checkNumSamples(t,n,r,i="steps"){let s;if(r!=null){if(s=null,n!=null)throw new W(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(t!=null)Array.isArray(t)?s=t[0].shape[0]:s=t.shape[0];else throw new W(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new W("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(n),i=r?n:[n],s=this.retrieveSymbolicTensors(i),o=new pf;if(t instanceof zt&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new W(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)o.add(this.inputs[u],t[u])}else for(const u of this.inputs){const l=t[u.name];if(l==null)throw new W(`No value is provided for the model's input ${u.name}`);o.add(u,l)}const a=lx(s,o);return r?a:a[0]}retrieveSymbolicTensors(t){const n=Zp(null,t.length);let r=t.length;for(const i of this.layers){const s=Array.isArray(i.output)?i.output:[i.output],o=s.map(a=>a.name);for(let a=0;a<t.length;++a){const u=o.indexOf(t[a]);if(u!==-1&&(n[a]=s[u],r--),r===0)break}if(r===0)break}if(r>0){const i=[];throw n.forEach((s,o)=>{s==null&&i.push(t[o])}),new W(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return n}predictLoop(t,n=32,r=!1){return X(()=>{const i=this.checkNumSamples(t);if(r)throw new et("Verbose predictLoop() is not implemented yet.");const s=FR(i,n),o=this.outputs.map(a=>[]);for(let a=0;a<s.length;++a)X(()=>{const l=s[a][0],c=s[a][1],f=Db(t,l,c),h=[];if(Array.isArray(f))for(let p=0;p<f.length;++p)h.push({key:this.inputs[p],value:f[p]});else h.push({key:this.inputs[0],value:f});const d=new pf(h);return lx(this.outputs,d)}).forEach((l,c)=>o[c].push(l));return Oi(o.map(a=>nr(a,0)))})}predict(t,n={}){const r=dbe(t);kQ(r,this.inputNames,this.feedInputShapes,!1);try{const i=n.batchSize==null?32:n.batchSize;return NR(i),this.predictLoop(r,i)}finally{Go(r,t)}}predictOnBatch(t){kQ(t,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,r=!0,i){if(this.optimizer_==null)throw new vo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===m_?s.push(a.slice(0,a.length-1).concat([1])):s.push(a)}if(t=SQ(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=SQ(n,this.feedOutputNames,s,!1,"target"),O_t(t,n),R_t(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new W(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}async standardizeUserData(t,n,r,i,s=!0,o){const[a,u]=this.standardizeUserDataXY(t,n,s,o);if(r!=null)throw new Error("sample weight is not supported yet.");let l=null;if(i!=null){const c=cbe(i,this.outputNames);l=[];for(let f=0;f<c.length;++f)l.push(await fbe(u[f],null,c[f]))}return[a,u,l]}testLoop(t,n,r,i=0,s){return X(()=>{const o=this.checkNumSamples(n,r,s,"steps"),a=[];if(i>0)throw new et("Verbose mode is not implemented yet.");if(s!=null)throw new et("steps mode in testLoop() is not implemented yet");{const u=FR(o,r),l=li(Ea(0,o));for(let c=0;c<u.length;++c){const f=u[c][0],h=u[c][1],d=fp(l,f,h-f),p=XP(n,d),g=t(p);if(c===0)for(let m=0;m<g.length;++m)a.push(Ve(0));for(let m=0;m<g.length;++m){const y=g[m];a[m]=ue(a[m],j(h-f,y))}}for(let c=0;c<a.length;++c)a[c]=Oe(a[c],o)}return a})}getDedupedMetricsNames(){const t=this.metricsNames,n=[];for(let r=0;r<t.length;++r){const i=t[r];let s=i;if(lQ(t,i)>1){const o=lQ(t.slice(0,r),i);s+=`_${o}`}n.push(s)}return n}makeTrainFunction(){return t=>{const n=[],r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let g=0;g<this.inputs.length;++g)f.push({key:this.inputs[g],value:r[g]});const h=new pf(f),d=lx(this.outputs,h,{training:!0});let p;for(let g=0;g<this.lossFunctions.length;++g){const m=this.lossFunctions[g];let y=m(i[g],d[g]);s[g]!=null&&(y=E_t(y,s[g]));const b=wn(y);n.push(b),g===0?p=y:p=ue(p,y)}for(let g=0;g<this.metricsTensors.length;++g){let m;if(this.outputs.length>1&&g<this.outputs.length)m=n[g];else{const y=this.metricsTensors[g][0],b=this.metricsTensors[g][1];m=wn(y(i[b],d[b]))}ga(m),o.push(m)}return p=wn(p),this.calculateLosses().forEach(g=>{p=ue(p,g)}),p},u=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,u)].concat(o)}}makeTestFunction(){this.testFunction=t=>X(()=>{const n=[];let r;const i=t.slice(0,this.inputs.length),s=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let l=0;l<this.inputs.length;++l)o.push({key:this.inputs[l],value:i[l]});const a=new pf(o),u=lx(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const c=this.lossFunctions[l],f=wn(c(s[l],u[l]));l===0?r=f:r=ue(r,f),n.push(r)}for(let l=0;l<this.metricsTensors.length;++l){const c=this.metricsTensors[l][0],f=this.metricsTensors[l][1],h=wn(c(s[f],u[f]));n.push(h)}return n})}async fit(t,n,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,s,o,a,u,l,c,f,h;try{const d=r.batchSize==null?32:r.batchSize;NR(d);const g=await this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,!1,d);i=g[0],s=g[1],h=g[2];let m=!1,y;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)u=r.validationData[0],l=r.validationData[1];else throw r.validationData.length===3?new et("validationData including sample weights is not supported yet."):new W(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const E=await this.standardizeUserData(u,l,null,null,!0,d);c=E[0],f=E[1],y=c.concat(f)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;const k=Math.floor(i[0].shape[0]*(1-r.validationSplit)),E=i[0].shape[0];c=Db(i,k,E),o=i,i=Db(i,0,k),f=Db(s,k,E),a=s,s=Db(s,0,k),y=c.concat(f)}else r.validationSteps!=null&&(m=!0);const b=i.concat(s).concat(h);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),x=this.getDedupedMetricsNames();let w,C;m?(this.makeTestFunction(),w=this.testFunction,C=x.slice().concat(x.map(k=>"val_"+k))):(w=null,y=[],C=x.slice());const $=tbe(r.callbacks,r.yieldEvery);return await this.fitLoop(v,b,x,d,r.epochs,r.verbose,$,w,y,r.shuffle,C,r.initialEpoch,null,null)}finally{this.isTraining=!1,Go(i,t),Go(s,n),Go(o,t),Go(a,n),Go(c,u),Go(f,l),h!=null&&ot(h)}}async fitLoop(t,n,r,i,s,o,a,u,l,c,f,h,d,p){i==null&&(i=32),s==null&&(s=1),c==null&&(c=!0),h==null&&(h=0);let g=!1;if(u!=null&&l!=null&&(g=!0),p!=null&&(g=!0,d==null))throw new W("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(n,i,d,"steps_per_epoch");let y;m!=null&&(y=Ea(0,m)),o==null&&(o=1);const{callbackList:b,history:v}=nbe(a,o,s,h,m,d,i,g,f);b.setModel(this),this.history=v,await b.onTrainBegin(),this.stopTraining_=!1;for(let x=h;x<s;++x){await b.onEpochBegin(x);const w={};if(d!=null)throw new et("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new et("batch shuffling is not implemneted yet");c&&I_(y);const C=li(y),$=FR(m,i);for(let S=0;S<$.length;++S){const k={};if(await b.onBatchBegin(S,k),X(()=>{const E=$[S][0],A=$[S][1],F=fp(C,E,A-E);k.batch=S,k.size=A-E;const _=XP(n,F),I=t(_);for(let T=0;T<r.length;++T){const O=r[T],L=I[T];k[O]=L,ga(L)}if(S===$.length-1&&g){const T=this.testLoop(u,l,i);for(let O=0;O<r.length;++O){const L=r[O],M=T[O];ga(M),w["val_"+L]=M}}}),await b.onBatchEnd(S,k),ebe(k),this.stopTraining_)break}C.dispose()}if(await b.onEpochEnd(x,w),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,n){return T_t(this,t,n)}async trainOnBatch(t,n){const r=await this.standardizeUserData(t,n),i=r[0],s=r[1],a=this.makeTrainFunction()(i.concat(s)),u=[];for(const l of a){const c=await l.data();u.push(c[0])}return ot(a),Go(r[0],t),Go(r[1],n),Oi(u)}getNamedWeights(t){const n=[],r=t!=null&&t.trainableOnly,i=r?this.trainableWeights:this.weights,s=this.getWeights(r);for(let o=0;o<i.length;++o)r&&!i[o].trainable||n.push({name:i[o].originalName,tensor:s[o]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=zk().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-zk().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Al(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>Al(n))}else{const n=Object.keys(this.loss);t={};const r=this.loss;for(const i of n)if(typeof r[i]=="string")t[i]=Al(r[i]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Al(LS(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Al(LS(t)));{const t={};for(const n in this.metrics)t[n]=Al(LS(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=HP(t.optimizer_config),r=ec(n);let i;if(typeof t.loss=="string")i=Nd(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(o=>Nd(o));else if(t.loss!=null){i={};for(const o in t.loss)i[o]=Nd(t.loss[o])}let s;if(Array.isArray(t.metrics))s=t.metrics.map(o=>Nd(o));else if(t.metrics!=null){s={};for(const o in t.metrics)s[o]=Nd(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:r})}async save(t,n){if(typeof t=="string"){const l=ete(t);if(l.length===0)throw new W(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new W(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new W("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await JR(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:L_t,generatedBy:`TensorFlow.js tfjs-layers v${lbe}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:c,specs:f}=await JR(await this.optimizer.getWeights(),l);r.specs.push(...f),r.data=Zee([r.data,c])}return this.userDefinedMetadata!=null&&(vQ(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,t.save(a)}setUserDefinedMetadata(t){vQ(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Wm.className="Model";le(Wm);class pbe extends Wm{}pbe.className="Functional";le(pbe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class W0 extends Wm{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:LF("sequential_"),t.layers!=null)for(const n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new W(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const n=t instanceof W0||t instanceof Wm;let r;if(n){if(r=t,r.outputs.length!==1)throw new W("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new W("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new W("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=BAt({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(t.inboundNodes.length!==1)throw new W(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new W("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=Yye(this.outputs[0])}this.inboundNodes=[],new BF({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Zp(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(Ct(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Wm({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,r=console.log){this.built||this.build(),super.summary(t,n,r)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,r={}){if(!this.built)throw new vo("The model needs to be compiled before being used.");return this.model.evaluate(t,n,r)}async evaluateDataset(t,n){if(!this.built)throw new vo("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,r={}){if(!this.built)throw new vo("The model needs to be compiled before being used.");return this.model.fit(t,n,r)}async fitDataset(t,n){if(!this.built)throw new vo("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,r={},i=!1){let s,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new W("Legacy serialization format not supported yet.");s=n}else D(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=n.layers,delete n.layers,o=n;const a=new t(o);if(!(a instanceof W0))throw new et(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const u of s){const c=ec(u,void 0,i);i&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(t){if(this.model==null)throw new W("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new W("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const n of this.layers){const r={};r.className=n.getClassName(),r.config=n.getConfig(),t.push(r)}return{name:this.name,layers:t}}}W0.className="Sequential";le(W0);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gbe(e){return new W0(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Zi=class extends fg{getConfig(){return{}}};class mbe extends Zi{apply(t,n=1){return CAt(t,n)}}mbe.className="elu";le(mbe);class ybe extends Zi{apply(t){return qB(t)}}ybe.className="selu";le(ybe);class bbe extends Zi{apply(t){return ju(t)}}bbe.className="relu";le(bbe);class xbe extends Zi{apply(t){return X(()=>bp(6,ju(t)))}}xbe.className="relu6";le(xbe);class vbe extends Zi{apply(t){return t}}vbe.className="linear";le(vbe);class wbe extends Zi{apply(t){return fu(t)}}wbe.className="sigmoid";le(wbe);class $be extends Zi{apply(t){return kAt(t)}}$be.className="hardSigmoid";le($be);class Cbe extends Zi{apply(t){return G1(t)}}Cbe.className="softplus";le(Cbe);class Sbe extends Zi{apply(t){return SAt(t)}}Sbe.className="softsign";le(Sbe);class kbe extends Zi{apply(t){return Ym(t)}}kbe.className="tanh";le(kbe);let qW=class extends Zi{apply(t,n=-1){return rI(t,n)}};qW.className="softmax";le(qW);class Ebe extends Zi{apply(t,n=-1){return DB(t,n)}}Ebe.className="logSoftmax";le(Ebe);class Abe extends Zi{apply(t,n=1){return X(()=>j(fu(j(t,n)),t))}}Abe.className="swish";le(Abe);class _be extends Zi{apply(t){return X(()=>j(t,Ym(G1(t))))}}_be.className="mish";le(_be);function mh(e){return e.getClassName()}function OR(e,t={}){return pC(e,Bs.getMap().classNameMap,t,"activation")}function yh(e){if(e==null){const t={};return t.className="linear",t.config={},OR(t)}if(typeof e=="string"){const t={};return t.className=e,t.config={},OR(t)}else return e instanceof Zi?e:OR(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P_t(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}class Tbe extends fg{}class Ibe extends Tbe{constructor(t){super(),P_t(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return X(()=>{let n=zn([1]);return this.hasL1&&(n=ue(n,_e(j(this.l1,Bn(t))))),this.hasL2&&(n=ue(n,_e(j(this.l2,mC(t))))),V(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}Ibe.className="L1L2";le(Ibe);const EQ={l1l2:"L1L2"};function Ht(e){return FW(e)}function AQ(e,t={}){return pC(e,Bs.getMap().classNameMap,t,"regularizer")}function fn(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in EQ?EQ[e]:e,config:{}};return AQ(n)}else return e instanceof Tbe?e:AQ(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Dbe extends at{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=Ge(t);let r=ju(t);return this.maxValue!=null&&(r=ys(r,0,this.maxValue)),r}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}Dbe.className="ReLU";le(Dbe);class Nbe extends at{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const r=Ge(t);return GT(r,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}Nbe.className="LeakyReLU";le(Nbe);class Fbe extends at{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=cn(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=fn(t.alphaRegularizer),this.alphaConstraint=Vn(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new W(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=Ct(t);const n=t.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)n[i-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let i=1;i<t.length;++i)r[i]=t[i];this.inputSpec=[new jn({ndim:t.length,axes:r})],this.built=!0}call(t,n){return t=Ge(t),QT(t,this.alpha.read())}getConfig(){const t={alphaInitializer:yn(this.alphaInitializer),alphaRegularizer:Ht(this.alphaRegularizer),alphaConstraint:Wn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}Fbe.className="PReLU";le(Fbe);let Obe=class extends at{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new et(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const r=Ge(t);return jw(r)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}};Obe.className="ELU";le(Obe);class Rbe extends at{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){const r=Ge(t);return j(r,ge(Ds(r,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}Rbe.className="ThresholdedReLU";le(Rbe);class Mbe extends at{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new qW().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){return X(()=>{let r=Ge(t);const i=n.mask;if(i!=null){const s=j(ke(fs(r.shape),ge(i,r.dtype)),Ve(-1e9));r=ue(r,s)}return this.axis instanceof Array?this.axis.length>1?bs(ke(r,XT(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}Mbe.className="Softmax";le(Mbe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vm(e,t,n){if(typeof e=="number")return Zp(e,t);if(e.length!==t)throw new W(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){const i=e[r];if(!xAt(i))throw new W(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${i}`)}return e}function wa(e,t,n,r,i=1){if(e==null)return e;const s=t+(t-1)*(i-1);let o;return n==="same"?o=e:o=e-s+1,Math.floor((o+r-1)/r)}function eu(e,t,n,r){if(e==null)return null;if(r==="valid")e=e*t+gh([n-t,0]);else if(r==="same")e=e*t;else throw new W(`Unsupport padding mode: ${r}.`);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XW(e,t){return X(()=>(Dn(t),t==="channelsFirst"?dt(e,[0,2,3,1]):e))}function Lbe(e,t){return X(()=>(Dn(t),t==="channelsFirst"?dt(e,[0,2,3,4,1]):e))}function B_t(e,t,n,r=1,i="valid",s,o=1){return X(()=>{if(s==null&&(s=Aa()),Dn(s),e.shape.length!==3)throw new W(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new W(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new W(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(s==="channelsFirst"&&(e=dt(e,[0,2,1])),i==="causal")throw new et("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=SB(e,t,r,i==="same"?"same":"valid","NWC",o);return n!=null&&(a=Wa(a,n)),a})}function _Q(e,t,n,r=[1,1],i="valid",s,o,a=null){return X(()=>{if(s==null&&(s=Aa()),Dn(s),e.rank!==3&&e.rank!==4)throw new W(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new W(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let u=XW(e,s);if(i==="causal")throw new et("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=hne({x:u,filter:t,strides:r,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),s==="channelsFirst"&&(u=dt(u,[0,3,1,2])),u})}function z_t(e,t,n,r=[1,1,1],i="valid",s,o){return X(()=>{if(s==null&&(s=Aa()),Dn(s),e.rank!==4&&e.rank!==5)throw new W(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new W(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let a=Lbe(e,s);if(i==="causal")throw new et("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Ate(a,t,r,i==="same"?"same":"valid","NDHWC",o),n!=null&&(a=Wa(a,n)),s==="channelsFirst"&&(a=dt(a,[0,4,1,2,3])),a})}class jF extends at{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",jF.verifyArgs(n),this.rank=t,tr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new et(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Vm(n.kernelSize,t,"kernelSize"),this.strides=Vm(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,eo(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Dn(this.dataFormat),this.activation=yh(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=cn(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Vn(n.biasConstraint),this.biasRegularizer=fn(n.biasRegularizer),this.activityRegularizer=fn(n.activityRegularizer),this.dilationRate=Vm(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new W(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new W(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new W(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Qa("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!OW(t.kernelSize,"number",1,3))throw new W(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:mh(this.activation),useBias:this.useBias,biasInitializer:yn(this.biasInitializer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),biasConstraint:Wn(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}class Ry extends jF{constructor(t,n){super(t,n),this.kernel=null,Ry.verifyArgs(n),this.filters=n.filters,tr(this.filters,"filters"),this.kernelInitializer=cn(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Vn(n.kernelConstraint),this.kernelRegularizer=fn(n.kernelRegularizer)}build(t){t=Ct(t);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new W(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(t,n){return X(()=>{t=Ge(t);let r;const i=this.bias==null?null:this.bias.read(),s=Oye(this.activation.getClassName());if(s!=null&&this.rank===2)r=_Q(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=B_t(t,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=_Q(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=z_t(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new et("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=Ct(t);const n=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let s=0;s<r.length;++s){const o=wa(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);n.push(o)}let i=[t[0]];return this.dataFormat==="channelsLast"?(i=i.concat(n),i.push(this.filters)):(i.push(this.filters),i=i.concat(n)),i}getConfig(){const t={filters:this.filters,kernelInitializer:yn(this.kernelInitializer),kernelRegularizer:Ht(this.kernelRegularizer),kernelConstraint:Wn(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new W(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class My extends Ry{constructor(t){super(2,t),My.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!OW(t.kernelSize,"number",1,2))throw new W(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}My.className="Conv2D";le(My);class vC extends Ry{constructor(t){super(3,t),vC.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new W(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}vC.className="Conv3D";le(vC);class Pbe extends My{constructor(t){if(super(t),this.inputSpec=[new jn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new W(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Ct(t),t.length!==4)throw new W("Input should have rank 4; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new W("The channel dimension of the inputs should be defined. Found `None`.");const r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new jn({ndim:4,axes:{[n]:r}})],this.built=!0}call(t,n){return X(()=>{let r=Ge(t);if(r.shape.length!==4)throw new W(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const u=i[o],l=i[a],c=this.kernelSize[0],f=this.kernelSize[1],h=this.strides[0],d=this.strides[1],p=eu(u,h,c,this.padding),g=eu(l,d,f,this.padding),m=[s,p,g,this.filters];this.dataFormat!=="channelsLast"&&(r=dt(r,[0,2,3,1]));let y=EB(r,this.kernel.read(),m,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=dt(y,[0,3,1,2])),this.bias!=null&&(y=Wa(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(t){t=Ct(t);const n=t.slice();let r,i,s;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3):(r=3,i=1,s=2);const o=this.kernelSize[0],a=this.kernelSize[1],u=this.strides[0],l=this.strides[1];return n[r]=this.filters,n[i]=eu(n[i],u,o,this.padding),n[s]=eu(n[s],l,a,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}Pbe.className="Conv2DTranspose";le(Pbe);class Bbe extends vC{constructor(t){if(super(t),this.inputSpec=[new jn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new W(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Ct(t),t.length!==5)throw new W("Input should have rank 5; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new W("The channel dimension of the inputs should be defined. Found `None`.");const r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new jn({ndim:5,axes:{[n]:r}})],this.built=!0}call(t,n){return X(()=>{let r=Ge(t);if(r.shape.length!==5)throw new W(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a,u;this.dataFormat==="channelsFirst"?(u=2,o=3,a=4):(u=1,o=2,a=3);const l=i[u],c=i[o],f=i[a],h=this.kernelSize[0],d=this.kernelSize[1],p=this.kernelSize[2],g=this.strides[0],m=this.strides[1],y=this.strides[2],b=eu(l,g,h,this.padding),v=eu(c,m,d,this.padding),x=eu(f,y,p,this.padding),w=[s,b,v,x,this.filters];this.dataFormat!=="channelsLast"&&(r=dt(r,[0,2,3,4,1]));let C=Tte(r,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=dt(C,[0,4,1,2,3])),this.bias!==null&&(C=Wa(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(t){t=Ct(t);const n=t.slice();let r,i,s,o;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3,o=4):(r=4,i=1,s=2,o=3);const a=this.kernelSize[0],u=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],f=this.strides[1],h=this.strides[2];return n[r]=this.filters,n[i]=eu(n[i],c,a,this.padding),n[s]=eu(n[s],f,u,this.padding),n[o]=eu(n[o],h,l,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}Bbe.className="Conv3DTranspose";le(Bbe);class zbe extends Ry{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new W("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new W("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new W(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=cn(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=fn(n.depthwiseRegularizer),this.depthwiseConstraint=Vn(n.depthwiseConstraint),this.pointwiseInitializer=cn(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=fn(n.pointwiseRegularizer),this.pointwiseConstraint=Vn(n.pointwiseConstraint)}build(t){if(t=Ct(t),t.length<this.rank+2)throw new W(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new W(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);const r=t[n],i=this.kernelSize.concat([r,this.depthMultiplier]),s=[];for(let a=0;a<this.rank;++a)s.push(1);s.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new jn({ndim:this.rank+2,axes:{[n]:r}})],this.built=!0}call(t,n){return X(()=>{t=Ge(t);let r;if(this.rank===1)throw new et("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=dt(t,[0,2,3,1])),r=XB(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=Wa(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=dt(r,[0,3,1,2])),r})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=yn(this.depthwiseInitializer),t.pointwiseInitializer=yn(this.pointwiseInitializer),t.depthwiseRegularizer=Ht(this.depthwiseRegularizer),t.pointwiseRegularizer=Ht(this.pointwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseConstraint),t.pointwiseConstraint=Wn(this.pointwiseConstraint),t}}zbe.className="SeparableConv";class Ube extends zbe{constructor(t){super(2,t)}}Ube.className="SeparableConv2D";le(Ube);class WF extends Ry{constructor(t){super(1,t),WF.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!OW(t.kernelSize,"number",1,1))throw new W(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}WF.className="Conv1D";le(WF);class jbe extends at{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return X(()=>{if(t=Ge(t),this.dataFormat==="channelsLast"){const r=MS(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return MS(r,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=MS(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return MS(r,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}jbe.className="Cropping2D";le(jbe);class Wbe extends at{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,mAt(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const n=t[2]==null?null:this.size[0]*t[2],r=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,r]}else{const n=t[1]==null?null:this.size[0]*t[1],r=t[2]==null?null:this.size[1]*t[2];return[t[0],n,r,t[3]]}}call(t,n){return X(()=>{let r=Ge(t);const i=r.shape;if(this.dataFormat==="channelsFirst"){r=dt(r,[0,2,3,1]);const s=this.size[0]*i[2],o=this.size[1]*i[3],a=this.interpolation==="nearest"?au.resizeNearestNeighbor(r,[s,o]):au.resizeBilinear(r,[s,o]);return dt(a,[0,3,1,2])}else{const s=this.size[0]*i[1],o=this.size[1]*i[2];return this.interpolation==="nearest"?au.resizeNearestNeighbor(r,[s,o]):au.resizeBilinear(r,[s,o])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}}Wbe.className="UpSampling2D";le(Wbe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function U_t(e,t,n=[1,1],r="valid",i,s){return X(()=>{i==null&&(i=Aa()),Dn(i);let o=XW(e,i);if(e.rank!==4)throw new W(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new W(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=Uw(o,t,n,r==="same"?"same":"valid","NHWC",s),i==="channelsFirst"&&(o=dt(o,[0,3,1,2])),o})}class Vbe extends jF{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=cn(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Vn(t.depthwiseConstraint),this.depthwiseRegularizer=fn(t.depthwiseRegularizer)}build(t){if(t=Ct(t),t.length<4)throw new W(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new W(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);const r=t[n],i=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return X(()=>{t=Ge(t);let r=U_t(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=Wa(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(t){t=Ct(t);const n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,s=wa(n,this.kernelSize[0],this.padding,this.strides[0]),o=wa(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,s,o]:[t[0],s,o,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=yn(this.depthwiseInitializer),t.depthwiseRegularizer=Ht(this.depthwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseRegularizer),t}}Vbe.className="DepthwiseConv2D";le(Vbe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gbe(e,t,n,r){if(Array.isArray(e)){if(t!=null||n!=null)throw new W("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(s){return s==null||Array.isArray(s)?s:[s]}return t=i(t),n=i(n),{inputs:e,initialState:t,constants:n}}function Hbe(e,t,n,r=!1,i,s,o=!1,a=!1){return X(()=>{const u=t.shape.length;if(u<3)throw new W(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(Ea(2,u));if(t=dt(t,l),s!=null)throw new et("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=ge(ge(i,"bool"),"float32"),i.rank===u-1&&(i=si(i,-1)),i=dt(i,l)),r&&(t=Eo(t,0),i!=null&&(i=Eo(i,0)));const c=[];let f,h=n;const d=t.shape[0],p=Rf(t);let g;i!=null&&(g=Rf(i));for(let y=0;y<d;++y){const b=p[y],v=X(()=>e(b,h));if(i==null)f=v[0],h=v[1];else{const x=X(()=>{const w=g[y],C=ke(qs(w),w),$=ue(j(v[0],w),j(h[0],C)),S=h.map((k,E)=>ue(j(v[1][E],w),j(k,C)));return{output:$,newStates:S}});f=x.output,h=x.newStates}a&&c.push(f)}let m;return a&&(m=Au(c,1)),[f,m,h]})}class Xh extends at{constructor(t){super(t);let n;if(t.cell==null)throw new W("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new ZW({cells:t.cell}):n=t.cell,n.stateSize==null)throw new W("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new jn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ea(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){WP(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const r=n[0];let i;if(this.returnSequences?i=[t[0],t[1],r]:i=[t[0],r],this.returnState){const s=[];for(const o of n)s.push([t[0],o]);return[i].concat(s)}else return i}computeMask(t,n){return X(()=>{Array.isArray(n)&&(n=n[0]);const r=this.returnSequences?n:null;if(this.returnState){const i=this.states.map(s=>null);return[r].concat(i)}else return r})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<t;++r)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new et("Constants support is not implemented in RNN yet.");WP(t)&&(t=t[0]),t=t;const n=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new jn({shape:[n,null,...r]});const i=[t[0]].concat(t.slice(2));this.cell.build(i);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!gt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),s))throw new W(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(o=>new jn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){X(()=>{if(!this.stateful)throw new Ja("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new W("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>zn([r,i])):this.states_=[zn([r,this.cell.stateSize])];else if(t==null)ot(this.states_),this.keptStates!=null&&(ot(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>zn([r,i])):this.states_[0]=zn([r,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new W(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):ot(this.states_);for(let i=0;i<this.states_.length;++i){const s=t[i],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,a=[r,o];if(!gt(s.shape,a))throw new W(`State ${i} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>ga(i.clone()))})}apply(t,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=Gbe(t,r,i,this.numConstants);t=s.inputs,r=s.initialState,i=s.constants;let o=[],a=[];if(r!=null){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(const l of r)this.stateSpec.push(new jn({shape:l.shape}));a=a.concat(this.stateSpec)}if(i!=null&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof zu){const l=[t].concat(o),c=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=c;const h=super.apply(l,n);return this.inputSpec=f,h}else return super.apply(t,n)}call(t,n){return X(()=>{const r=n==null?null:n.mask,i=n==null?null:n.training;let s=n==null?null:n.initialState;t=Ge(t),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(t));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==o)throw new W(`RNN Layer has ${o} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},l=Hbe((p,g)=>{const m=this.cell.call([p].concat(g),a);return[m[0],m.slice(1)]},t,s,this.goBackwards,r,null,this.unroll,this.returnSequences),c=l[0],f=l[1],h=l[2];this.stateful&&this.resetStates(h,i);const d=this.returnSequences?f:c;return this.returnState?[d].concat(h):d})}getInitialState(t){return X(()=>{let n=zn(t.shape);return n=_e(n,[1,2]),n=gC(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?UP(n,[1,r]):n):this.cell.stateSize>1?[UP(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Xh.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),t),n)}static fromConfig(t,n,r={}){const i=n.cell,s=ec(i,r);return new t(Object.assign(n,{cell:s}))}}Xh.className="RNN";le(Xh);class VF extends at{}class YW extends VF{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,tr(this.units,"units"),this.activation=yh(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=cn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=cn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=cn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=fn(t.kernelRegularizer),this.recurrentRegularizer=fn(t.recurrentRegularizer),this.biasRegularizer=fn(t.biasRegularizer),this.kernelConstraint=Vn(t.kernelConstraint),this.recurrentConstraint=Vn(t.recurrentConstraint),this.biasConstraint=Vn(t.biasConstraint),this.dropout=j0([1,gh([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=j0([1,gh([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Ct(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return X(()=>{if(t=t,t.length!==2)throw new W(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let r=t[1];t=t[0];const i=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=bh({ones:()=>qs(t),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=bh({ones:()=>qs(r),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let s;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?s=$u(j(t,o),this.kernel.read()):s=$u(t,this.kernel.read()),this.bias!=null&&(s=Wa(s,this.bias.read())),a!=null&&(r=j(r,a));let u=ue(s,$u(r,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:mh(this.activation),useBias:this.useBias,kernelInitializer:yn(this.kernelInitializer),recurrentInitializer:yn(this.recurrentInitializer),biasInitializer:yn(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)}}YW.className="SimpleRNNCell";le(YW);class qbe extends Xh{constructor(t){t.cell=new YW(t),super(t)}call(t,n){return X(()=>{this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return new t(n)}}qbe.className="SimpleRNN";le(qbe);class KW extends VF{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new W("GRUCell does not support reset_after parameter set to true.");this.units=t.units,tr(this.units,"units"),this.activation=yh(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=yh(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=cn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=cn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=cn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=fn(t.kernelRegularizer),this.recurrentRegularizer=fn(t.recurrentRegularizer),this.biasRegularizer=fn(t.biasRegularizer),this.kernelConstraint=Vn(t.kernelConstraint),this.recurrentConstraint=Vn(t.recurrentConstraint),this.biasConstraint=Vn(t.biasConstraint),this.dropout=j0([1,gh([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=j0([1,gh([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Ct(t);const n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return X(()=>{if(t=t,t.length!==2)throw new W(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const r=n.training==null?!1:n.training;let i=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=bh({ones:()=>qs(t),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=bh({ones:()=>qs(i),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,u,l;0<this.dropout&&this.dropout<1&&(t=j(t,s[0]));let c=$u(t,this.kernel.read());this.useBias&&(c=Wa(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=j(i,o[0]));const f=this.recurrentKernel.read(),[h,d]=gs(f,[2*this.units,this.units],f.rank-1),p=$u(i,h),[g,m,y]=gs(c,3,c.rank-1),[b,v]=gs(p,2,p.rank-1);a=this.recurrentActivation.apply(ue(g,b)),u=this.recurrentActivation.apply(ue(m,v));const x=$u(j(u,i),d);l=this.activation.apply(ue(y,x));const w=ue(j(a,i),j(ue(1,rn(a)),l));return[w,w]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:mh(this.activation),recurrentActivation:mh(this.recurrentActivation),useBias:this.useBias,kernelInitializer:yn(this.kernelInitializer),recurrentInitializer:yn(this.recurrentInitializer),biasInitializer:yn(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)}}KW.className="GRUCell";le(KW);class Xbe extends Xh{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new KW(t),super(t)}call(t,n){return X(()=>{this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}Xbe.className="GRU";le(Xbe);class GF extends VF{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,tr(this.units,"units"),this.activation=yh(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=yh(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=cn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=cn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=cn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=fn(t.kernelRegularizer),this.recurrentRegularizer=fn(t.recurrentRegularizer),this.biasRegularizer=fn(t.biasRegularizer),this.kernelConstraint=Vn(t.kernelConstraint),this.recurrentConstraint=Vn(t.recurrentConstraint),this.biasConstraint=Vn(t.biasConstraint),this.dropout=j0([1,gh([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=j0([1,gh([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;t=Ct(t);const r=t[t.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const s=this.biasInitializer,o=this.units;i=new(n=class extends Uo{apply(u,l){const c=s.apply([o]),f=new MW().apply([o]),h=s.apply([o*2]);return fQ(fQ(c,f),h)}},n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return X(()=>{const r=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new W(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let i=t[1];const s=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=bh({ones:()=>qs(t),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=bh({ones:()=>qs(i),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let u,l,c,f;0<this.dropout&&this.dropout<1&&(t=j(t,o[0]));let h=$u(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=j(i,a[0])),h=ue(h,$u(i,this.recurrentKernel.read())),this.useBias&&(h=Wa(h,this.bias.read()));const[d,p,g,m]=gs(h,4,h.rank-1);u=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),c=ue(j(l,s),j(u,this.activation.apply(g))),f=this.recurrentActivation.apply(m);const y=j(f,this.activation.apply(c));return[y,y,c]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:mh(this.activation),recurrentActivation:mh(this.recurrentActivation),useBias:this.useBias,kernelInitializer:yn(this.kernelInitializer),recurrentInitializer:yn(this.recurrentInitializer),biasInitializer:yn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)}}GF.className="LSTMCell";le(GF);class Ybe extends Xh{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new GF(t),super(t)}call(t,n){return X(()=>{this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}Ybe.className="LSTM";le(Ybe);class ZW extends VF{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return X(()=>{t=t;let r=t.slice(1);const i=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?i.push(r.splice(0,a.stateSize.length)):i.push(r.splice(0,1));i.reverse();const s=[];let o;for(let a=0;a<this.cells.length;++a){const u=this.cells[a];r=i[a],a===0?o=[t[0]].concat(r):o=[o[0]].concat(r),o=u.call(o,n),s.push(o.slice(1))}r=[];for(const a of s.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(t){WP(t)&&(t=t[0]),t=t;let n;this.cells.forEach((r,i)=>{cp(`RNNCell_${i}`,()=>{r.build(t),Array.isArray(r.stateSize)?n=r.stateSize[0]:n=r.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){const t=super.getConfig(),n=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(n)};return Object.assign(Object.assign({},t),i)}static fromConfig(t,n,r={}){const i=[];for(const s of n.cells)i.push(ec(s,r));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.cells)n.push(...r.trainableWeights);return n.concat(t)}return t}getWeights(){const t=[];for(const n of this.cells)t.push(...n.weights);return VP(t)}setWeights(t){const n=[];for(const r of this.cells){const i=r.weights.length,s=t.splice(i);for(let o=0;o<r.weights.length;++o)n.push([r.weights[o],s[o]])}WW(n)}}ZW.className="StackedRNNCells";le(ZW);function bh(e){const{ones:t,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=e,o=()=>s!=null?s(t(),n):Uye(t(),n),a=()=>yC(o,t,r);return!i||i<=1?ga(a().clone()):Array(i).fill(void 0).map(a).map(l=>ga(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var j_t=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};class Kbe extends Xh{constructor(t){if(t.unroll)throw new et("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new et("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new jn({ndim:5})]}call(t,n){return X(()=>{if(this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new W("ConvRNN2D cell does not support constants");const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return X(()=>{const{stateSize:n}=this.cell,r=t.shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)],o=zn(s);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(t,n=!1){X(()=>{if(!this.stateful)throw new Ja("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)];if(r[0]==null)throw new W("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zn(s)):this.states_=[zn(s)];else if(t==null)ot(this.states_),this.keptStates!=null&&(ot(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zn(s)):this.states_[0]=zn(s);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new W(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):ot(this.states_);for(let a=0;a<this.states_.length;++a){const u=t[a],l=s;if(!gt(u.shape,l))throw new W(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${u.shape}`);this.states_[a]=u}}this.states_=this.states_.map(a=>ga(a.clone()))})}computeSingleOutputShape(t){const{dataFormat:n,filters:r,kernelSize:i,padding:s,strides:o,dilationRate:a}=this.cell,u=n==="channelsFirst",l=t[u?3:2],c=t[u?4:3],f=wa(l,i[0],s,o[0],a[0]),h=wa(c,i[1],s,o[1],a[1]);return[...t.slice(0,2),...u?[r,f,h]:[f,h,r]]}}Kbe.className="ConvRNN2D";class JW extends GF{constructor(t){const{filters:n,kernelSize:r,strides:i,padding:s,dataFormat:o,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:n})),this.filters=n,tr(this.filters,"filters"),this.kernelSize=Vm(r,2,"kernelSize"),this.kernelSize.forEach(u=>tr(u,"kernelSize")),this.strides=Vm(i||1,2,"strides"),this.strides.forEach(u=>tr(u,"strides")),this.padding=s||"valid",eo(this.padding),this.dataFormat=o||"channelsLast",Dn(this.dataFormat),this.dilationRate=Vm(a||1,2,"dilationRate"),this.dilationRate.forEach(u=>tr(u,"dilationRate"))}build(t){var n;t=Ct(t);const r=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[r]==null)throw new W(`The channel dimension of the input should be defined. Found ${t[r]}`);const i=t[r],s=4,o=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const l=this.biasInitializer,c=this.filters;u=new(n=class extends Uo{apply(h,d){const p=l.apply([c]),g=fs([c]),m=l.apply([c*2]);return RW([p,g,m])}},n.className="CustomInit",n)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return X(()=>{if(t.length!==3)throw new W(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const r=n.training||!1,i=t[0],s=t[1],o=t[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=bh({ones:()=>qs(i),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,l=(G,H,Q)=>!H||!H[Q]?G:j(H[Q],G);let c=l(i,u,0),f=l(i,u,1),h=l(i,u,2),d=l(i,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=bh({ones:()=>qs(s),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let g=l(s,p,0),m=l(s,p,1),y=l(s,p,2),b=l(s,p,3);const v=3,[x,w,C,$]=gs(this.kernel.read(),a,v),[S,k,E,A]=this.useBias?gs(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,x,S,this.padding),f=this.inputConv(f,w,k,this.padding),h=this.inputConv(h,C,E,this.padding),d=this.inputConv(d,$,A,this.padding);const[F,_,I,T]=gs(this.recurrentKernel.read(),a,v);g=this.recurrentConv(g,F),m=this.recurrentConv(m,_),y=this.recurrentConv(y,I),b=this.recurrentConv(b,T);const O=this.recurrentActivation.apply(ue(c,g)),L=this.recurrentActivation.apply(ue(f,m)),M=ue(j(L,o),j(O,this.activation.apply(ue(h,y)))),P=j(this.recurrentActivation.apply(ue(d,b)),this.activation.apply(M));return[P,P,M]})}getConfig(){const t=super.getConfig(),n=j_t(t,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(t,n,r,i){const s=Ff(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?Wa(s,r,this.dataFormat):s}recurrentConv(t,n){return Ff(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}JW.className="ConvLSTM2DCell";le(JW);class Zbe extends Kbe{constructor(t){const n=new JW(t);super(Object.assign(Object.assign({},t),{cell:n}))}static fromConfig(t,n){return new t(n)}}Zbe.className="ConvLSTM2D";le(Zbe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class QW extends at{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const n=t.shape,r=[];for(let i=0;i<this.noiseShape.length;++i)r.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return r}call(t,n){return X(()=>{this.invokeCallHook(t,n);const r=Ge(t);if(0<this.rate&&this.rate<1){const i=n.training==null?!1:n.training,s=this.getNoiseShape(r);return yC(()=>Uye(r,this.rate,s,this.seed),()=>r,i)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}QW.className="Dropout";le(QW);class Jbe extends QW{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const n=t.shape;return[n[0],1,n[2]]}}Jbe.className="SpatialDropout1D";le(Jbe);class eV extends at{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,tr(this.units,"units"),this.activation=yh(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=cn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=cn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Vn(t.kernelConstraint),this.biasConstraint=Vn(t.biasConstraint),this.kernelRegularizer=fn(t.kernelRegularizer),this.biasRegularizer=fn(t.biasRegularizer),this.activityRegularizer=fn(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=Ct(t);const n=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){t=Ct(t);const n=t.slice();return n[n.length-1]=this.units,n}call(t,n){return X(()=>{this.invokeCallHook(t,n);const r=Ge(t),i=Oye(this.activation.getClassName());let s;return i!=null?s=$u(r,this.kernel.read(),i,this.bias?this.bias.read():null):(s=$u(r,this.kernel.read()),this.bias!=null&&(s=Wa(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){const t={units:this.units,activation:mh(this.activation),useBias:this.useBias,kernelInitializer:yn(this.kernelInitializer),biasInitializer:yn(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),biasConstraint:Wn(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}eV.className="Dense";le(eV);class tV extends at{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=Ct(t);for(const n of t.slice(1))if(n==null)throw new W(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],Af(t,1)]}call(t,n){return X(()=>{this.invokeCallHook(t,n);let r=Ge(t);if(this.dataFormat==="channelsFirst"&&r.rank>1){const i=[0];for(let s=2;s<r.rank;++s)i.push(s);i.push(1),r=dt(r,i)}return $At(r)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(t,n),t}}tV.className="Flatten";le(tV);class Qbe extends at{constructor(t){super(t),this.supportsMasking=!0,this.activation=yh(t.activation)}call(t,n){return X(()=>{this.invokeCallHook(t,n);const r=Ge(t);return this.activation.apply(r)})}getConfig(){const t={activation:mh(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}Qbe.className="Activation";le(Qbe);class exe extends at{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return X(()=>(t=Ge(t),vAt(t,this.n)))}getConfig(){const t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}exe.className="RepeatVector";le(exe);class txe extends at{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){const r="Total size of new array must be unchanged.",i=n.slice();let s=1,o=null;for(let u=0;u<i.length;++u){const l=i[u];if(this.isUnknown(l))if(o===null)o=u;else throw new W("Can only specifiy one unknown dimension.");else s*=l}const a=Af(t);if(o!==null){if(s===0||a%s!==0)throw new W(r);i[o]=a/s}else if(a!==s)throw new W(r);return i}computeOutputShape(t){let n=!1;for(let r=0;r<t.length;++r)if(this.isUnknown(t[r])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return X(()=>{this.invokeCallHook(t,n);const r=Ge(t),i=r.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return V(r,s)})}getConfig(){const t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}}txe.className="Reshape";le(txe);class nxe extends at{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const n=Ea(1,t.dims.length+1);if(!gt(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new jn({ndim:this.dims.length+1})]}computeOutputShape(t){t=Ct(t);const n=t.slice();return this.dims.forEach((r,i)=>{n[i+1]=t[r]}),n}call(t,n){return dt(Ge(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}nxe.className="Permute";le(nxe);class rxe extends at{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){const r=Ge(t);return Uk(Km(r,this.maskValue),-1)}call(t,n){return X(()=>{this.invokeCallHook(t,n);const r=Ge(t),o=Uk(Km(r,this.maskValue),-1,!0);return j(r,ge(o,r.dtype))})}}rxe.className="Masking";le(rxe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ixe extends at{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(Ot(t.inputLength))}this.inputDim=t.inputDim,tr(this.inputDim,"inputDim"),this.outputDim=t.outputDim,tr(this.outputDim,"outputDim"),this.embeddingsInitializer=cn(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=fn(t.embeddingsRegularizer),this.activityRegularizer=fn(t.activityRegularizer),this.embeddingsConstraint=Vn(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return X(()=>this.maskZero?(t=Ge(t),Km(t,mt(t))):null)}computeOutputShape(t){if(t=Ct(t),this.inputLength==null)return[...t,this.outputDim];const n=Ot(this.inputLength);if(n.length!==t.length-1)throw new W(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let r=0;for(let i=0;i<n.length;++i){const s=n[i],o=t[i+1];if(s!=null&&o!=null&&s!==o)throw new W(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);s==null&&(n[r]=o),r++}}return[t[0],...n,this.outputDim]}call(t,n){return X(()=>{this.invokeCallHook(t,n);let r=Ge(t);r.dtype!=="int32"&&(r=wu(r,"int32"));const i=zye(this.embeddings.read(),V(r,[r.size]));return V(i,Ct(this.computeOutputShape(r.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:yn(this.embeddingsInitializer),embeddingsRegularizer:Ht(this.embeddingsRegularizer),activityRegularizer:Ht(this.activityRegularizer),embeddingsConstraint:Wn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}ixe.className="Embedding";le(ixe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Hg extends at{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new et}computeElementwiseOpOutputShape(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;const r=t.slice(0,t.length-n.length);for(let i=0;i<n.length;++i){const s=t[t.length-n.length+i],o=n[i];if(s==null||o==null||s<0||o<0)r.push(null);else if(s===1)r.push(o);else if(o===1)r.push(s);else{if(s!==o)throw new W("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));r.push(s)}}return r}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Ct(t)]),t=t,t.length<2)throw new W(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let n=[];for(const s of t)s!=null&&s[0]!==null&&n.push(s[0]);if(n=Ef(n),n.length>1)throw new W(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let r=t[0]==null?null:t[0].slice(1);for(let s=1;s<t.length;++s){const o=t[s]==null?null:t[s].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const i=t.map(s=>s.length);t.indexOf(null)===-1&&Ef(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,n){return X(()=>{if(t=t,this.reshapeRequired){const r=[],i=t.map(s=>s.rank);if(i.indexOf(null)===-1){const s=gh(i);for(let o of t){const a=o.rank;for(let u=0;u<s-a;++u)o=gC(o,1);r.push(o)}return this.mergeFunction(r)}else{let s=!1;for(const u of t){const l=u.rank;if(l==null){const c=u.shape,f=c[0],h=c.slice(1).concat([f]);let d=V(u,[f].concat(Af(c.slice(1))));d=dt(d,[1,0]),d=V(d,h),r.push(d),s=!0}else if(l>1){const c=Ea(1,l).concat([0]);r.push(dt(u,c)),s=!0}else r.push(u)}let o=this.mergeFunction(r);const a=o.rank;if(s){if(a==null){const u=o.shape,l=u.length,c=u[l-1],f=[c].concat(u.slice(0,u.length-1));o=V(dt(V(o,[-1,c]),[1,0]),f)}else if(a>1){const u=[a-1].concat(Ea(0,a-1));o=dt(o,u)}}return o}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let n;t[0]==null?n=null:n=t[0].slice(1);for(let i=1;i<t.length;++i){const s=t[i]==null?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,s)}let r=[];for(const i of t)i!=null&&i[0]!==null&&r.push(i[0]);return r=Ef(r),r.length===1?n=r.concat(n):n=[null].concat(n),n}computeMask(t,n){return X(()=>{if(n==null)return null;if(!Array.isArray(n))throw new W("`mask` should be an Array");if(!Array.isArray(t))throw new W("`inputs` should be an Array");if(n.length!==t.length)throw new W(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${n.length})`);if(n.every(i=>i==null))return null;n=n.map(i=>i==null?i:si(i,0));let r=n[0];for(let i=1;i<n.length-1;++i)r=Eu(r,n[i]);return r})}}class sxe extends Hg{constructor(t){super(t)}mergeFunction(t){return X(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=ue(n,t[r]);return n})}}sxe.className="Add";le(sxe);class oxe extends Hg{constructor(t){super(t)}mergeFunction(t){return X(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=j(n,t[r]);return n})}}oxe.className="Multiply";le(oxe);class axe extends Hg{constructor(t){super(t)}mergeFunction(t){return X(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=ue(n,t[r]);return j(1/t.length,n)})}}axe.className="Average";le(axe);class uxe extends Hg{constructor(t){super(t)}mergeFunction(t){return X(()=>{let n=t[0];for(let r=1;r<t.length;++r)n=mc(n,t[r]);return n})}}uxe.className="Maximum";le(uxe);class lxe extends Hg{constructor(t){super(t)}mergeFunction(t){return X(()=>{let n=t[0];for(let r=1;r<t.length;++r)n=bp(n,t[r]);return n})}}lxe.className="Minimum";le(lxe);class cxe extends Hg{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new W("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(const i of t)if(i!=null){n=!1;break}if(n)return;const r=[];for(let i=0;i<t.length;++i){const s=t[i].slice();s.splice(this.axis,1);let o=!1;for(const a of r)if(gt(a,s)){o=!0;break}o||r.push(s)}if(r.length>1)throw new W("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return X(()=>RW(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new W("A `Concatenate` layer should be called on a list of inputs.");const n=t,r=n[0].slice(),i=this.axis<0?r.length+this.axis:this.axis;for(const s of n.slice(1)){if(r[i]==null||s[i]==null){r[i]=null;break}r[i]+=s[i]}return r}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new W("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new W("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new W(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return X(()=>{let r=!0;if(n.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const i=[];for(let o=0;o<t.length;++o)n[o]==null?i.push(ge(qs(t[o]),"bool")):n[o].rank<t[o].rank?i.push(si(n[o],-1)):i.push(n[o]);const s=nr(i,this.axis);return $B(s,-1,!1)})}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}cxe.className="Concatenate";le(cxe);function Nb(e,t){for(;e<0;)e+=t;return e}function W_t(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new et("batchDot is not implemented for tensors of 4D or higher rank yet");if(D(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),D(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new et("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,i=t.shape.length;n==null&&(n=[r-1,i-2]);const s=n;return X(()=>{let o;if(r>i){o=r-i;const u=[];for(let l=0;l<o;++l)u.push(1);t=V(t,t.shape.concat(u))}else if(i>r){o=i-r;const u=[];for(let l=0;l<o;++l)u.push(1);e=V(e,e.shape.concat(u))}else o=0;let a;if(e.shape.length===2&&t.shape.length===2)s[0]===s[1]?a=_e(j(e,t),s[0]):a=_e(j(dt(e,[1,0]),t),s[1]);else{const u=s[0]!==e.shape.length-1,l=s[1]===t.shape.length-1;a=st(e,t,u,l)}if(o>0){let u;r>i?u=r+i-3:u=r-1;const l=[];for(let c=u;c<u+o;++c)l.push(c);a=cg(a,l)}return a.shape.length===1&&(a=si(a,1)),a})}class fxe extends Hg{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){D(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0],r=t[1];if(n.length>3||r.length>3)throw new et("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);if(n[i[0]]!==r[i[1]])throw new W(`Dimension incompatibility: ${n[i[0]]} !== ${r[i[1]]}`)}mergeFunction(t){if(t.length!==2)throw new W(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n=t[0],r=t[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,o)=>Nb(s,t[o].shape.length)):i=[Nb(this.axes,n.shape.length),Nb(this.axes,r.shape.length)],this.normalize&&(n=g_(n,i[0]),r=g_(r,i[1])),W_t(n,r,i)}interpretAxes(t,n){let r;return Array.isArray(this.axes)?r=this.axes:r=[Nb(this.axes,t.length),Nb(this.axes,n.length)],r}computeOutputShape(t){D(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0].slice(),r=t[1].slice();if(n.length>3||r.length>3)throw new et("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);n.splice(i[0],1),r.splice(i[1],1),r.splice(0,1);const s=n.concat(r);return s.length===1&&s.push(1),s}computeMask(t,n){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}fxe.className="Dot";le(fxe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hxe extends at{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return X(()=>{this.invokeCallHook(t,n);const r=Ge(t);return yC(()=>ue(PF(r.shape,0,this.stddev),r),()=>r,n.training||!1)})}}hxe.className="GaussianNoise";le(hxe);class dxe extends at{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return X(()=>{this.invokeCallHook(t,n);const r=Ge(t);return this.rate>0&&this.rate<1?yC(()=>{const s=Math.sqrt(this.rate/(1-this.rate));return j(r,PF(r.shape,1,s))},()=>r,n.training||!1):r})}}dxe.className="GaussianDropout";le(dxe);class pxe extends at{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Ge(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return X(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(t);return yC(()=>{const s=Ge(t),u=-1.6732632423543772*1.0507009873554805;let l=Sh(lg(r),this.rate);l=wu(l,"float32");const c=((1-this.rate)*(1+this.rate*u**2))**-.5,f=-c*u*this.rate,h=ue(j(s,l),j(ue(l,-1),u));return ue(j(h,c),f)},()=>Ge(t),n.training||!1)}return t})}}pxe.className="AlphaDropout";le(pxe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _2(e,t,n,r,i,s=.001){let o;if(e.rank===2)o=bte(e,t,n,r,i,s);else if(e.rank===3)o=xte(e,t,n,r,i,s);else if(e.rank===4)o=vte(e,t,n,r,i,s);else throw new et(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return o}function V_t(e,t,n,r,i=.001){return X(()=>{const s=ZT(e,r),o=s.mean,a=s.variance;return[_2(e,o,a,n,t,i),o,a]})}function G_t(e,t,n,r,i=.001){return X(()=>{const s=ZT(e,r),o=s.mean,a=s.variance,u=[];for(const p of Ea(0,e.rank))r.indexOf(p)!==-1?u.push(1):u.push(e.shape[p]);const l=V(o,u),c=V(a,u),f=t==null?null:V(t,u),h=n==null?null:V(n,u);return[_2(e,l,c,h,f,i),o,a]})}function H_t(e,t,n,r,i=.001){return gt(r.slice().sort(),Ea(0,e.rank-1))?V_t(e,t,n,r,i):G_t(e,t,n,r,i)}class gxe extends at{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=cn(t.betaInitializer||"zeros"),this.gammaInitializer=cn(t.gammaInitializer||"ones"),this.movingMeanInitializer=cn(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=cn(t.movingVarianceInitializer||"ones"),this.betaConstraint=Vn(t.betaConstraint),this.gammaConstraint=Vn(t.gammaConstraint),this.betaRegularizer=fn(t.betaRegularizer),this.gammaRegularizer=fn(t.gammaRegularizer)}build(t){t=Ct(t);const n=this.axis>=0?this.axis:this.axis+t.length,r=t[n];if(r==null)throw new W(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new jn({ndim:t.length,axes:{[n]:r}})];const i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return X(()=>{const r=n.training==null?!1:n.training,i=Ge(t),s=i.shape,o=s.length,a=Ea(0,o),u=this.axis>=0?this.axis:this.axis+o;a.splice(u,1);const l=Zp(1,o);l[u]=s[u];const c=a.slice();c.sort();const f=!gt(c,Ea(0,o).slice(0,o-1)),h=()=>{if(f){const b=V(this.movingMean.read(),l),v=V(this.movingVariance.read(),l),x=this.center?V(this.beta.read(),l):null,w=this.scale?V(this.gamma.read(),l):null;return _2(i,b,v,x,w,this.epsilon)}else return _2(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return h();const[d,p,g]=H_t(i,this.gamma.read(),this.beta.read(),a,this.epsilon),m=(b,v,x)=>{X(()=>{const w=1-x,C=b.read(),$=j(ke(C,v),w);b.write(ke(C,$))})};return(()=>{m(this.movingMean,p,this.momentum),m(this.movingVariance,g,this.momentum)})(),d})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:yn(this.betaInitializer),gammaInitializer:yn(this.gammaInitializer),movingMeanInitializer:yn(this.movingMeanInitializer),movingVarianceInitializer:yn(this.movingVarianceInitializer),betaRegularizer:Ht(this.betaRegularizer),gammaRegularizer:Ht(this.gammaRegularizer),betaConstraint:Wn(this.betaConstraint),gammaConstraint:Wn(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}gxe.className="BatchNormalization";le(gxe);class mxe extends at{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=cn(t.betaInitializer||"zeros"),this.gammaInitializer=cn(t.gammaInitializer||"ones"),this.betaRegularizer=fn(t.betaRegularizer),this.gammaRegularizer=fn(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=Ct(t);const n=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=n);for(const s of this.axis)if(s<0||s>=n)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==Ef(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(s=>t[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(t,n){const r=Ge(t),i=r.shape,s=i.length;return X(()=>{let{mean:a,variance:u}=ZT(r,this.axis,!0);const l=Zp(1,s);for(const g of this.axis)l[g]=i[g];const c=g=>g!=null&&g.shape.length!==s?V(g,l):g;let f=this.scale?c(this.gamma.read()):null,h=this.center?c(this.beta.read()):null;const d=[],p=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(d.push(i[g]),p.push(1)):(d.push(1),p.push(i[g]));return a=ho(a,d),u=ho(u,d),f!=null&&(f=ho(f,p)),h!=null&&(h=ho(h,p)),_2(r,a,u,h,f,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:yn(this.betaInitializer),gammaInitializer:yn(this.gammaInitializer),betaRegularizer:Ht(this.betaRegularizer),gammaRegularizer:Ht(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}mxe.className="LayerNormalization";le(mxe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function q_t(e,t,n){return X(()=>{if(e.rank!==4)throw new W(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new W("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Aa()),n!=="channelsLast"&&n!=="channelsFirst")throw new W(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],kh(e,r)})}class yxe extends at{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?Aa():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new W(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,r;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],r=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new W(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new W(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);r=t.padding[1]}this.padding=[n,r]}this.inputSpec=[new jn({ndim:4})]}computeOutputShape(t){t=Ct(t);let n,r;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?r=t[3]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],t[1],n,r]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?r=t[2]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],n,r,t[3]])}call(t,n){return X(()=>q_t(Ge(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}yxe.className="ZeroPadding2D";le(yxe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function HF(e,t,n,r,i,s){return X(()=>{Dn(i),Mye(s),eo(r),n==null&&(n=[1,1]),r==null&&(r="valid"),i==null&&(i=Aa()),s==null&&(s="max"),e=XW(e,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=KT(e,t,n,a):o=UT(e,t,n,a),i==="channelsFirst"&&(o=dt(o,[0,3,1,2])),o})}function bxe(e,t,n,r,i,s){return X(()=>{Dn(i),Mye(s),eo(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),i==null&&(i=Aa()),s==null&&(s="max"),e=Lbe(e,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=qte(e,t,n,a):o=yte(e,t,n,a),i==="channelsFirst"&&(o=dt(o,[0,4,1,2,3])),o})}class xxe extends at{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new W(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(tr(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new W(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);tr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,eo(this.padding),this.inputSpec=[new jn({ndim:3})]}computeOutputShape(t){t=Ct(t);const n=wa(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]}call(t,n){return X(()=>{this.invokeCallHook(t,n),t=gC(Ge(t),2);const r=this.poolingFunction(Ge(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return cg(r,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(t,n),t}}class vxe extends xxe{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Dn(s),eo(i),HF(t,n,r,i,s,"max")}}vxe.className="MaxPooling1D";le(vxe);class wxe extends xxe{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Dn(s),eo(i),HF(t,n,r,i,s,"avg")}}wxe.className="AveragePooling1D";le(wxe);class $xe extends at{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new W(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];tr(this.poolSize,"poolSize"),tr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(this.dataFormat),eo(this.padding),this.inputSpec=[new jn({ndim:4})]}computeOutputShape(t){t=Ct(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=wa(n,this.poolSize[0],this.padding,this.strides[0]),r=wa(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,r]:[t[0],n,r,t[3]]}call(t,n){return X(()=>(this.invokeCallHook(t,n),this.poolingFunction(Ge(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class nV extends $xe{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Dn(s),eo(i),HF(t,n,r,i,s,"max")}}nV.className="MaxPooling2D";le(nV);class Cxe extends $xe{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Dn(s),eo(i),HF(t,n,r,i,s,"avg")}}Cxe.className="AveragePooling2D";le(Cxe);class Sxe extends at{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new W(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];tr(this.poolSize,"poolSize"),tr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(this.dataFormat),eo(this.padding),this.inputSpec=[new jn({ndim:5})]}computeOutputShape(t){t=Ct(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=wa(n,this.poolSize[0],this.padding,this.strides[0]),r=wa(r,this.poolSize[1],this.padding,this.strides[1]),i=wa(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,r,i]:[t[0],n,r,i,t[4]]}call(t,n){return X(()=>(this.invokeCallHook(t,n),this.poolingFunction(Ge(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class kxe extends Sxe{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Dn(s),eo(i),bxe(t,n,r,i,s,"max")}}kxe.className="MaxPooling3D";le(kxe);class Exe extends Sxe{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Dn(s),eo(i),bxe(t,n,r,i,s,"avg")}}Exe.className="AveragePooling3D";le(Exe);class Axe extends at{constructor(t){super(t),this.inputSpec=[new jn({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,n){throw new et}}class _xe extends Axe{constructor(t){super(t||{})}call(t,n){return X(()=>{const r=Ge(t);return wn(r,1)})}}_xe.className="GlobalAveragePooling1D";le(_xe);class Txe extends Axe{constructor(t){super(t||{})}call(t,n){return X(()=>{const r=Ge(t);return Co(r,1)})}}Txe.className="GlobalMaxPooling1D";le(Txe);class Ixe extends at{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(this.dataFormat),this.inputSpec=[new jn({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,n){throw new et}getConfig(){const t={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Dxe extends Ixe{call(t,n){return X(()=>{const r=Ge(t);return this.dataFormat==="channelsLast"?wn(r,[1,2]):wn(r,[2,3])})}}Dxe.className="GlobalAveragePooling2D";le(Dxe);class Nxe extends Ixe{call(t,n){return X(()=>{const r=Ge(t);return this.dataFormat==="channelsLast"?Co(r,[1,2]):Co(r,[2,3])})}}Nxe.className="GlobalMaxPooling2D";le(Nxe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Fxe extends at{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(t,n),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,n,r={}){const i=n.layer,s=ec(i,r);delete n.layer;const o={layer:s};return Object.assign(o,n),new t(o)}}class Oxe extends Fxe{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=Ct(t),t.length<3)throw new W(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=Ct(t);const n=[t[0]].concat(t.slice(2)),r=this.layer.computeOutputShape(n),i=t[1];return[r[0],i].concat(r.slice(1))}call(t,n){return X(()=>(t=Ge(t),Hbe((o,a)=>[Ge(this.layer.call(o,n)),[]],t,[],!1,null,null,!1,!0)[1]))}}Oxe.className="TimeDistributed";le(Oxe);function X_t(e){Gg(gAt,"BidirectionalMergeMode",e)}const Y_t="concat";class Rxe extends Fxe{constructor(t){super(t);const n=t.layer.getConfig(),r={};r.className=t.layer.getClassName(),r.config=n,this.forwardLayer=ec(r),n.goBackwards=n.goBackwards!==!0;const i={};if(i.className=t.layer.getClassName(),i.config=n,this.backwardLayer=ec(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?Y_t:t.mergeMode,X_t(this.mergeMode),t.weights)throw new et("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const n=t.length,r=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,r)),this.backwardLayer.setWeights(t.slice(r))}computeOutputShape(t){let n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let r,i,s;return this.returnState&&(s=n.slice(1)),r=n[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,i=[r]):this.mergeMode==null?i=[r,r.slice()]:i=[r],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[r].concat(s).concat(s.slice()):Oi(i)}apply(t,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=Gbe(t,r,i,this.numConstants);if(t=s.inputs,r=s.initialState,i=s.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(r==null||r.length===0)&&i==null)return super.apply(t,n);const o=[],a=[];if(r!=null){const l=r.length;if(l%2>0)throw new W("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push(...r);const c=r.map(f=>new jn({shape:f.shape}));this.forwardLayer.stateSpec=c.slice(0,l/2),this.backwardLayer.stateSpec=c.slice(l/2),a.push(...c)}if(i!=null)throw new et("Support for constants in Bidirectional layers is not implemented yet.");const u=o[0]instanceof zu;for(const l of o)if(l instanceof zu!==u)throw new W("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const l=[t].concat(o),c=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=c;const h=super.apply(l,n);return this.inputSpec=f,h}else return super.apply(t,n)}call(t,n){return X(()=>{const r=n.initialState;let i,s;if(r==null)i=this.forwardLayer.call(t,n),s=this.backwardLayer.call(t,n);else{const u=r.slice(0,r.length/2),l=r.slice(r.length/2);i=this.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=this.backwardLayer.call(t,Object.assign(n,{initialState:l}))}let o;this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Eo(s,1));let a;return this.mergeMode==="concat"?a=RW([i,s]):this.mergeMode==="sum"?a=ue(i,s):this.mergeMode==="ave"?a=j(.5,ue(i,s)):this.mergeMode==="mul"?a=j(i,s):this.mergeMode==null&&(a=[i,s]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){cp(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),cp(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){Array.isArray(n)&&(n=n[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[n,n]:r=n:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const s=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(s).concat(s):[r].concat(s).concat(s)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){const r=ec(n.layer);if(delete n.layer,n.numConstants!=null)throw new et("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=n;return i.layer=r,new t(i)}}Rxe.className="Bidirectional";le(Rxe);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Mxe extends at{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return X(()=>(t=Ge(t),t.dtype!=="float32"&&(t=wu(t,"float32")),ue(j(t,this.scale),this.offset)))}}Mxe.className="Rescaling";le(Mxe);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:K_t,cropAndResize:Z_t}=au;class Lxe extends at{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,n,r,i,s,o,a,u){return X(()=>{let l,c=!1;const f=n/o,h=r/a,d=(i+n)/o,p=(s+r)/a,g=[f,h,d,p],m=[];t.rank===3?(c=!0,l=Au([t])):l=t;for(let w=0;w<l.shape[0];w++)m.push(g);const y=Yd(m,[m.length,4]),b=Zm(0,m.length,1,"int32"),x=Z_t(l,y,b,[i,s],"nearest");return wu(c?Ge(Rf(x)):x,u)})}upsize(t,n,r,i){return X(()=>{const s=K_t(t,[n,r]);return wu(s,i)})}call(t,n){return X(()=>{const r=Ge(t),i=r.dtype,s=r.shape,o=s[s.length-3],a=s[s.length-2];let u=0;o!==this.height&&(u=Math.floor((o-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),u>=0&&l>=0?this.centerCrop(r,u,l,this.height,this.width,o,a,i):this.upsize(t,this.height,this.width,i)})}getConfig(){const t={height:this.height,width:this.width},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=Ct(t);const n=t.length-3,r=t.length-2;return t[n]=this.height,t[r]=this.width,t}}Lxe.className="CenterCrop";le(Lxe);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function J_t(e,t,n,r){let i=Ge(e);if(i.dtype!=="int32"&&(i=wu(i,"int32")),t==="int")return i;const s=i.shape;if(i.rank===0&&(i=si(i,-1)),t==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=si(i,-1)),i.rank>2)throw new W(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${s} which would result in output rank ${i.rank}.`);const o=["multiHot","oneHot"].includes(t),a=i;let u;if(typeof r<"u"&&t==="count"?u=iM(a,r,n,o):u=iM(a,[],n,o),t!=="tfIdf")return u;if(r)return j(u,r);throw new W("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pxe extends at{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){return t=Ct(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,n){return X(()=>{t=Ge(t),t.dtype!=="int32"&&(t=wu(t,"int32"));let r;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new W(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);r=Ge(n.countWeights)}const i=Co(t),s=Zx(t),o=Ds(this.numTokens,i).bufferSync().get(0),a=Sh(s,0).bufferSync().get(0);if(!(o&&a))throw new W(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return J_t(t,this.outputMode,this.numTokens,r)})}}Pxe.className="CategoryEncoding";le(Pxe);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Q_t=["bilinear","nearest"],TQ=new Set(Q_t);class Bxe extends at{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(TQ.has(t.interpolation))this.interpolation=t.interpolation;else throw new W(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=Ct(t);const n=t[2];return[this.height,this.width,n]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return X(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return au.resizeBilinear(t,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return au.resizeNearestNeighbor(t,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...TQ]} are supported`)})}}Bxe.className="Resizing";le(Bxe);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zxe{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}zxe.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Uxe extends at{constructor(t){super(t),this.randomGenerator=new zxe(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(t,n),t}}Uxe.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const eTt=["bilinear","nearest"],IQ=new Set(eTt);class jxe extends Uxe{constructor(t){super(t);const{factor:n,interpolation:r="bilinear"}=t;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new W(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new W(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new W(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(IQ.has(r))this.interpolation=r;else throw new W(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=Ct(t);const n=t[2];return[this.imgHeight,-1,n]}call(t,n){return X(()=>{const r=Ge(t);this.imgHeight=r.shape[r.shape.length-3];const i=r.shape[r.shape.length-2];this.widthFactor=lg([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let s=this.widthFactor.dataSync()[0]*i;s=Math.round(s);const o=[this.imgHeight,s];switch(this.interpolation){case"bilinear":return au.resizeBilinear(t,o);case"nearest":return au.resizeNearestNeighbor(t,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...IQ]} are supported`)}})}}jxe.className="RandomWidth";le(jxe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DQ(e){return new My(e)}function Ik(e){return new eV(e)}function tTt(e){return new tV(e)}function NQ(e){return new nV(e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nTt=q();nTt.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var FQ;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(FQ||(FQ={}));var OQ;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(OQ||(OQ={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var RQ;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(RQ||(RQ={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&D(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rTt=aI;class qF extends T_{nextDataId(){return qF.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new oB(this,Jo())}write(t,n,r){this.firstUse&&(this.firstUse=!1,q().get("IS_NODE")&&Ps(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:r,refCount:1}),i}makeTensorInfo(t,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&ou(r[0])){const s=r.map(o=>cu(o));i=this.write(s,t,n)}else i=this.write(r,t,n);return{dataId:i,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){const n=this.data.get(t);n.refCount--}}move(t,n,r,i,s){this.data.set(t,{values:n,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:n,complexTensorInfos:r}=this.data.get(t);if(n==="complex64"){const i=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return nc(i,s)}return See(this.data.get(t).values,n)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const r=n.map(i=>tc(i));return nt(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return nt(t.shape,t.dtype,n)}makeOutput(t,n,r){return Jo().makeTensorFromTensorInfo(this.makeTensorInfo(n,r,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(t);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const n=ti();return t(),{kernelMs:ti()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Te([t],"where");const n=this.readSync(t.dataId);return rTt(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}qF.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wxe(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const iTt=e=>{const{x:t}=e.inputs,n=e.backend;Te(t,"abs");let r=new Float32Array(Z(t.shape));const i=n.data.get(t.dataId).values;return r=Wxe(i),n.makeOutput(r,t.shape,t.dtype)},sTt={kernelName:O2,backendName:"cpu",kernelFunc:iTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(e){return(t,n,r,i,s)=>{const o=Ke(t,n),a=o.length,u=Re(o),l=Z(o),c=sr(s,l),f=t.length,h=n.length,d=Re(t),p=Re(n),g=yp(t,o),m=yp(n,o);if(g.length+m.length===0)for(let y=0;y<c.length;++y)c[y]=e(r[y%r.length],i[y%i.length]);else for(let y=0;y<c.length;++y){const b=ig(y,a,u),v=b.slice(-f);g.forEach($=>v[$]=0);const x=pa(v,f,d),w=b.slice(-h);m.forEach($=>w[$]=0);const C=pa(w,h,p);c[y]=e(r[x],i[C])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ls(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(r.shape,"complex64"),u=n.data.get(a.dataId);return u.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const oTt={kernelName:z_,backendName:"cpu",kernelFunc:ls};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_(e,t,n="float32"){if(n==="complex64"){const i=v_(e,t,"float32"),s=v_(e,t,"float32");return ls({inputs:{real:i,imag:s},backend:e})}const r=Sr(Z(t),n);return e.makeTensorInfo(t,n,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uu(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const aTt={kernelName:g1,backendName:"cpu",kernelFunc:Uu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jp(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const uTt={kernelName:xT,backendName:"cpu",kernelFunc:Jp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vxe(e,t,n,r){if(r==="int32"){const i=Int32Array.from(e);return[t,"int32",i]}if(r==="bool"){const i=vh([0],n),[s,o]=Nn((a,u)=>a!==u?1:0)(t,[],e,i,"bool");return[o,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function xh(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return Uu({inputs:{x:i},backend:n});const c=v_(n,i.shape,i.dtype),f=xh({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),h=ls({inputs:{real:f,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),h}if(i.dtype==="complex64"){const c=Jp({inputs:{input:i},backend:n}),f=xh({inputs:{x:c},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(c),f}if(!uB(i.dtype,s)){const c=Uu({inputs:{x:i},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:s}}const o=n.data.get(i.dataId).values,[a,u,l]=Vxe(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,u,l)}const lTt={kernelName:n1,backendName:"cpu",kernelFunc:xh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xn(e,t,n,r){return n==null?({inputs:i,backend:s})=>{const{a:o,b:a}=i,u=s;Te([o,a],e);const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,f=o.dtype==="string"?rc(l):l,h=o.dtype==="string"?rc(c):c,d=r||o.dtype,[p,g]=t(o.shape,a.shape,f,h,d);return u.makeTensorInfo(g,d,p)}:({inputs:i,backend:s})=>{const{a:o,b:a}=i,u=s;if(o.dtype==="complex64"||a.dtype==="complex64"){const l=xh({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(l.dataId),f=c.complexTensorInfos.real,h=c.complexTensorInfos.imag,d=u.data.get(f.dataId).values,p=u.data.get(h.dataId).values,g=xh({inputs:{x:a},backend:u,attrs:{dtype:"complex64"}}),m=u.data.get(g.dataId),y=m.complexTensorInfos.real,b=m.complexTensorInfos.imag,v=u.data.get(y.dataId).values,x=u.data.get(b.dataId).values,[w,C,$]=n(o.shape,a.shape,d,p,v,x),S=u.makeTensorInfo($,"float32",w),k=u.makeTensorInfo($,"float32",C),E=ls({inputs:{real:S,imag:k},backend:u});return u.disposeIntermediateTensorInfo(l),u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(S),u.disposeIntermediateTensorInfo(k),E}else{const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,f=r||o.dtype,[h,d]=t(o.shape,a.shape,l,c,f);return u.makeTensorInfo(d,f,h)}}}function rV(e){return(t,n,r,i,s,o)=>{const a=Ke(t,n),u=Z(a),l=a.length,c=Re(a),f=sr("float32",u),h=sr("float32",u),d=yp(t,a),p=yp(n,a),g=nc(r,i),m=nc(s,o),y=t.length,b=Re(t),v=n.length,x=Re(n);if(d.length+p.length===0)for(let w=0;w<f.length;w++){const C=w%g.length,$=w%m.length,S=e(g[C*2],g[C*2+1],m[$*2],m[$*2+1]);f[w]=S.real,h[w]=S.imag}else for(let w=0;w<f.length;w++){const C=ig(w,l,c),$=C.slice(-y);d.forEach(F=>$[F]=0);const S=pa($,y,b),k=C.slice(-v);p.forEach(F=>k[F]=0);const E=pa(k,v,x),A=e(g[S*2],g[S*2+1],m[E*2],m[E*2+1]);f[w]=A.real,h[w]=A.imag}return[f,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gxe=Nn((e,t)=>e+t),cTt=rV((e,t,n,r)=>({real:e+n,imag:t+r})),V0=Xn(sg,Gxe,cTt),fTt={kernelName:sg,backendName:"cpu",kernelFunc:V0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(e,t,n,r,i){const s=Z(r),o=Sr(i,n);for(let a=0;a<e.length;a++){const u=e[a];if(u<0)throw new Error("Input x must be non-negative!");u>=i||(s>0?o[u]+=t[a]:o[u]+=1)}return o}function Hxe(e,t,n,r=!1){const i=e.shape[0],s=e.shape[1],o=nt([i,n],t.dtype);for(let a=0;a<i;a++)for(let u=0;u<s;u++){const l=e.get(a,u);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(r?o.set(1,a,l):t.size>0?o.set(o.get(a,l)+t.get(a,u),a,l):o.set(o.get(a,l)+1,a,l))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qxe=Nn((e,t)=>e&t),hTt=Xn(j2,qxe),dTt={kernelName:j2,backendName:"cpu",kernelFunc:hTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cl(e){return(t,n,r)=>{const i=$n(n,t.length);for(let s=0;s<t.length;++s)i[s]=e(t[s],r);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bt(e,t,n){const r=cl(t);return Yh(e,r,n)}function Yh(e,t,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;Te(o,e);const a=s,u=a.data.get(o.dataId).values;let l;if(o.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=rc(u)}else l=u;const c=n||o.dtype,f=t(l,c,i);return a.makeTensorInfo(o.shape,c,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xxe=cl(e=>Math.ceil(e)),pTt=Yh(r1,Xxe),gTt={kernelName:r1,backendName:"cpu",kernelFunc:pTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxe(e,t,n,r){const i=$n(n,Z(t));if(r&&n!=="string"){let s=0;e.forEach(o=>{const a=Z(o.shape);i.set(o.vals,s),s+=a})}else{let s=0;e.forEach(o=>{const a=n==="string"?rc(o.vals):o.vals;let u=0;for(let l=0;l<o.shape[0];++l){const c=l*t[1]+s;for(let f=0;f<o.shape[1];++f)i[c+f]=a[u++]}s+=o.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kxe=Nn((e,t)=>e===t?1:0),Zxe=Xn(Z2,Kxe,null,"bool"),mTt={kernelName:Z2,backendName:"cpu",kernelFunc:Zxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jxe=cl(e=>Math.exp(e)),Qxe=Yh(c1,Jxe,"float32"),yTt={kernelName:c1,backendName:"cpu",kernelFunc:Qxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eve=cl(e=>Math.expm1(e)),bTt=Yh(f1,eve),xTt={kernelName:f1,backendName:"cpu",kernelFunc:bTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tve=cl(e=>Math.floor(e)),vTt=Yh(h1,tve),wTt={kernelName:h1,backendName:"cpu",kernelFunc:vTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nve=Nn((e,t)=>Math.floor(e/t)),$Tt=Xn(d1,nve,null,"int32"),CTt={kernelName:d1,backendName:"cpu",kernelFunc:$Tt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rve(e,t,n,r,i,s,o,a,u){const l=nt([r,s],n);for(let c=0;c<r;c++){const f=[];let h=0;for(let d=0;d<i;d++){const p=e[c*i+d];h+=p*o[d],f.push(p)}if(h<0||h>=u/s)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let d=0;d<s;d++)l.values[c*s+d]=t.get(...t.indexToLoc(h*s+d))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ive(e,t,n){const r=nt(n,e.dtype);for(let i=0;i<r.size;++i){const o=r.indexToLoc(i).slice(),a=o[0],u=o[2],l=t.locToIndex([a,u]);o[2]=t.values[l];const c=e.locToIndex(o);0<=c&&c<e.values.length&&(r.values[i]=e.values[c])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sve=Nn((e,t)=>e>t?1:0),STt=Xn(tw,sve,null,"bool"),kTt={kernelName:tw,backendName:"cpu",kernelFunc:STt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ove=Nn((e,t)=>e>=t?1:0),ETt=Xn(p1,ove,null,"bool"),ATt={kernelName:p1,backendName:"cpu",kernelFunc:ETt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ave=Nn((e,t)=>e<t?1:0),_Tt=Xn(rw,ave,null,"bool"),TTt={kernelName:rw,backendName:"cpu",kernelFunc:_Tt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uve=Nn((e,t)=>e<=t?1:0),ITt=Xn(iw,uve,null,"bool"),DTt={kernelName:iw,backendName:"cpu",kernelFunc:ITt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lve(e,t,n){const r=(t-e)/(n-1),i=Sr(n,"float32");i[0]=e;for(let s=1;s<i.length;s++)i[s]=i[s-1]+r;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cve=cl(e=>Math.log(e)),NTt=Yh(x1,cve),FTt={kernelName:x1,backendName:"cpu",kernelFunc:NTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fve(e,t,n,r){const i=sr(r,Z(n));for(let s=0;s<i.length;++s){const o=s*t;let a=e[o];for(let u=0;u<t;++u){const l=e[o+u];(Number.isNaN(l)||l>a)&&(a=l)}i[s]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hve=Nn((e,t)=>Math.max(e,t)),OTt=Xn(w1,hve),RTt={kernelName:w1,backendName:"cpu",kernelFunc:OTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dve=Nn((e,t)=>Math.min(e,t)),MTt=Xn($1,dve),LTt={kernelName:$1,backendName:"cpu",kernelFunc:MTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sV=Nn((e,t)=>e*t),PTt=rV((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),XF=Xn(S1,sV,PTt),BTt={kernelName:S1,backendName:"cpu",kernelFunc:XF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pve(e,t,n){const r=dc(-1,n);return sV([],t,r,e,n)}function zTt(e){const{inputs:t,backend:n}=e,{x:r}=t;Te(r,"neg");const i=n.data.get(r.dataId).values,[s,o]=pve(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}const UTt={kernelName:gw,backendName:"cpu",kernelFunc:zTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gve=Nn((e,t)=>e!==t?1:0),jTt=Xn(mw,gve,null,"bool"),WTt={kernelName:mw,backendName:"cpu",kernelFunc:jTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(e,t,n,r,i){const s=t.length,o=Z(t),a=Re(t),u=Re(i),l=sr(n,Z(i));for(let c=0;c<o;++c){const f=ig(c,s,a),h=new Array(f.length);for(let p=0;p<h.length;p++)h[p]=f[r[p]];const d=pa(h,s,u);l[d]=e[c]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hi(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:s}=n;Te(i,"transpose");const o=i.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=i.shape[s[f]];const u=r.data.get(i.dataId).values,l=oV(u,i.shape,i.dtype,s,a);return{dataId:r.write(l,a,i.dtype),shape:a,dtype:i.dtype}}const VTt={kernelName:Xd,backendName:"cpu",kernelFunc:Hi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mve(e,t,n,r){const[i,s]=ar(e,r),o=Bi(t,"int32"),a=Sr(Z(i),o),u=Z(s);for(let l=0;l<a.length;++l){const c=l*u;let f=1;for(let h=0;h<u;++h)f*=n[c+h];a[l]=f}return{outVals:a,outShape:i,outDtype:o}}function GTt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"prod");const a=i.shape.length,u=it(s,i.shape),l=xn(u,a);let c=u,f=i;const h=[];l!=null&&(f=Hi({inputs:{x:i},backend:n,attrs:{perm:l}}),h.push(f),c=In(c.length,a));const d=n.data.get(f.dataId).values,{outVals:p,outShape:g,outDtype:m}=mve(f.shape,f.dtype,d,c);let y=g;return o&&(y=Tn(g,u)),h.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(y,m,p)}const HTt={kernelName:$w,backendName:"cpu",kernelFunc:GTt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qTt(e,t,n){e.forEach((r,i)=>{if(r<0||r>=n){const s=ig(i,t.length,Re(t)).join(",");throw new Error(`indices[${s}] = ${r} is not in [0, ${n})`)}})}function XTt(e,t){for(let n=0;n<e.length;++n){const r=e[n],i=n===e.length-1?t:e[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let s=1;s<r.length;++s)if(r[s-1]>r[s])throw new Error("Ragged splits must be sorted in ascending order")}}function YTt(e,t,n,r){const i=[];let s=0;const o=t.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);XTt(n,r);let u=1;for(let l=0;l<t.length-1;++l){u*=t[l];const c=t[l+1];for(let f=1;f<u+1;++f)a[l].push(f*c)}for(let l=0;l<e.length;++l){let c=e[l],f=e[l]+1;for(let h=0;h<n.length;++h){const d=n[h],p=h+t.length-1;if(p>=0){const g=a[p],m=g[g.length-1]-d[c];for(let y=c;y<f;++y)a[p].push(d[y+1]+m)}c=d[c],f=d[f]}f!==c&&(i.push([c,f]),s+=f-c)}return{outSplits:a,valueSlices:i,numValues:s}}function KTt(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n].length,i=$n("int32",r);t.push(i),e[n].forEach((s,o)=>i[o]=s)}return t}function MQ(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function ZTt(e,t,n,r,i,s){const o=MQ(t,2)[1],a=MQ(s,2)[1];let u=0;for(const l of n)for(let c=l[0];c<l[1];++c){for(let f=0;f<r;++f)i[u*a+f]=e[c*o+f];++u}}function JTt(e,t,n,r,i){const s=t.slice();s[0]=i;const o=$n(n,Z(s)),a=e.length,u=a===0?0:a/t[0];return ZTt(e,t,r,u,o,s),[o,s]}function yve(e,t,n,r,i,s,o,a){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const u=t[0][0]-1;if(qTt(s,o,u),r.length===0)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:f,numValues:h}=YTt(s,o,e,l),d=KTt(c),p=JTt(n,r,i,f,h);return[d,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LQ=2147483647;function bve(e,t,n,r,i,s,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=t.length===0,u=i.length===0,l=o.length===0,c=[];a||c.push(t[0]),u||c.push(i[0]),l||c.push(o[0]);for(let m=1;m<c.length;++m)if(c[m]!==c[m-1])throw new Error("starts, limits, and deltas must have the same shape");const f=c.length===0?1:c[0],h=$n("int32",f+1);h[0]=0;for(let m=0;m<f;++m){const y=a?e[0]:e[m],b=u?r[0]:r[m],v=l?s[0]:s[m];if(v===0)throw new Error("Requires delta != 0");let x;if(v>0&&b<y||v<0&&b>y)x=0;else if(x=Math.ceil(Math.abs((b-y)/v)),x>LQ)throw new Error(`Requires ((limit - start) / delta) <= ${LQ}`);h[m+1]=h[m]+x}const d=h[f],p=$n(n,d);let g=0;for(let m=0;m<f;++m){const y=h[m+1]-h[m];let b=a?e[0]:e[m];const v=l?s[0]:s[m];for(let x=0;x<y;++x)p[g++]=b,b+=v}return[h,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var so=na;class w_{constructor(t,n,r,i,s,o,a,u,l,c){this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=i,this.valuesDType=s,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=zne(c),this.raggedRank=Une(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===so.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===so.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case so.VALUE_ROWIDS:return w_.getMaxWidthValueRowID(n);case so.ROW_SPLITS:return w_.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${so[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const n=t.length;if(n===0||n===1)return 0;let r=0;for(let i=0;i<n-1;++i){const s=t[i+1]-t[i];s>r&&(r=s)}return r}static getMaxWidthValueRowID(t){const n=t.length;if(n===0)return 0;let r=0,i=t[0],s=0;for(let o=1;o<n;++o){const a=t[o];a!==i&&(i=a,s=Math.max(o-r,s),r=o)}return Math.max(n-r,s)}tensorShapeFromTensor(t,n,r=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return BQ(t,r)}calculateOutputSize(t){const n=this.valuesShape,r=this.defaultValueShape;jne(r,n);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Bne(this.raggedRank,i,n);o[0]<0&&(o[0]=t);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(t,n,r){const i=Math.min(t,r),s=[];let o=0;for(let a=0;a<i;++a,o+=n)s.push(o);for(let a=i;a<t;++a)s.push(-1);return D(s.length===t,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(t,n,r,i){const s=t.length,o=[];for(let a=0;a<s-1;++a){const u=t[a+1]-t[a];let l=Math.min(i,u),c=n[a];c===-1&&(l=0);for(let f=0;f<l;++f)o.push(c),c+=r;for(let f=0;f<u-l;++f)o.push(-1)}if(s>0&&o.length!==t[s-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,n,r,i){const s=t.length,o=[];if(s===0)return[];let a=0,u=t[0];if(u>=n.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${n.length}`);let l=n[u];o.push(l);for(let c=1;c<s;++c){const f=t[c];if(f===u)l>=0&&(++a,a<i?l+=r:l=-1);else{if(a=0,u=f,f>=n.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${n.length}`);l=n[f]}o.push(l)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,n,r,i){const s=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case so.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,r,i);case so.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,r,i);default:throw new Error(`Unsupported partition type: ${so[o]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case so.FIRST_DIM_SIZE:return t[0];case so.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case so.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${so[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),r=this.calculateOutputSize(n),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let u=i.length-2;u>=0;--u)i[u]=i[u+1]*r[u+1];const s=BQ(r,!1),o=$n(this.valuesDType,Z(s));if(i[0]*r[0]>0){let u=this.calculateFirstParentOutputIndex(n,i[0],r[0]);for(let l=1;l<=this.raggedRank;++l)u=this.calculateOutputIndex(l-1,u,i[l],r[l]);this.setOutput(this.raggedRank,u,o,s)}return[s,o]}setOutput(t,n,r,i){if(r.length===0)return;const s=this.values,o=r;let a=i.slice();a=a.slice(t+1);const u=Z(a),l=n.length;let c=this.defaultValue;if(c.length!==u&&c.length!==1){const p=this.defaultValueShape;X(()=>{const g=V(c,p);c=Im(g,a).dataSync()})}let f=0,h=0,d=0;for(let p=0;p<=l;++p){let g=p<l?n[p]:-1;if(g===d){++d;continue}if(h<d){const m=s.subarray(f*u),y=o.subarray(h*u),b=(d-h)*u;PQ(y,m,b)}if(p>=l){const m=r.length;g=Math.floor(m/u)}if(g>d)if(this.defaultValue.length===1)o.subarray(d*u,g*u).fill(this.defaultValue[0]),d=g;else for(;g>d;){const m=o.slice(d*u);PQ(m,c,u),++d}g<0?(f=p+1,h=d):(f=p,h=d,d=h+1)}}}function PQ(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function BQ(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function xve(e,t,n,r,i,s,o,a,u,l){return new w_(e,t,n,r,i,s,o,a,u,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vve(e,t,n,r){const i=e===t,s=e<t&&n<0,o=t<e&&n>1;if(i||s||o)return Sr(0,r);const a=Math.abs(Math.ceil((t-e)/n)),u=Sr(a,r);t<e&&n===1&&(n=-1),u[0]=e;for(let l=1;l<u.length;l++)u[l]=u[l-1]+n;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wve=cl(e=>1/Math.sqrt(e)),QTt=Yh(I1,wve),eIt={kernelName:I1,backendName:"cpu",kernelFunc:QTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hd(e,t,n,r,i,s,o,a,u,l){const c=[r/i,i],f=e.values,h=t.values;if(r===0)return nt(n,t.dtype);const d=u instanceof Rn?u:nt(c,t.dtype);typeof u=="string"||typeof u=="number"?d.values.fill(u):typeof u=="boolean"&&d.values.fill(+u);for(let p=0;p<s;p++){const g=[];let m=0;for(let y=0;y<o;y++){const b=f[p*o+y];g.push(b),m+=b*a[y]}if(m<0||m>=r/i)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let y=0;y<i;y++)l?d.values[m*i+y]+=h[p*i+y]:d.values[m*i+y]=t.rank===0?h[0]:h[p*i+y]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tIt=cl(e=>1/(1+Math.exp(-e))),$ve=Bt(R1,e=>1/(1+Math.exp(-e))),nIt={kernelName:R1,backendName:"cpu",kernelFunc:$ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cve(e,t,n,r,i){const s=m5(r,t,n),o=Z(n),a=Re(r);if(s){const f=y5(t,a);return i==="string"?e.slice(f,f+o):e.subarray(f,f+o)}const u=i==="string"?rc(e):e,l=nt(r,i,u),c=nt(n,i);for(let f=0;f<c.size;++f){const h=c.indexToLoc(f),d=h.map((p,g)=>p+t[g]);c.set(l.get(...d),...h)}return i==="string"?ure(c.values):c.values}function Qp(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:o}=r;Te(i,"slice");const[a,u]=yI(i,s,o);p5(i,a,u);const l=n.data.get(i.dataId).values,c=Cve(l,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,c)}const rIt={kernelName:_w,backendName:"cpu",kernelFunc:Qp};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sve(e,t,n,r,i,s,o){const a=t[0],u=s[0],l=new Array(u),c=new Array(a),f=t[1];if(u===0){if(a!==0)throw new Error(Yne(a));const m=$n(n,0),y=$n(i,0);return[m,[0,f],y,l,c]}let h=!0,d=0;const p=new Array(u).fill(0);for(let m=0;m<a;++m){const y=e[m*f];if(y<0)throw new Error(Kne(m,y));if(y>=u)throw new Error(Zne(m,y,u));++p[y],h=h&&y>=d,d=y}let g=!0;for(let m=0;m<u;++m){const y=p[m]===0;l[m]=y,g=g&&!y,p[m]=Math.max(p[m],1),m>0&&(p[m]+=p[m-1])}if(g&&h){const m=e,y=r;for(let b=0;b<a;++b)c[b]=b;return[m,[a,f],y,l,c]}else{const m=p[u-1],y=$n(n,m*f),b=$n(i,m),v=new Array(u).fill(0);for(let x=0;x<a;++x){const w=e[x*f],C=v[w],$=(w===0?0:p[w-1])+C;v[w]++;for(let S=0;S<f;++S)y[$*f+S]=e[x*f+S];b[$]=r[x],c[x]=$}for(let x=0;x<u;++x)if(v[x]===0){const C=x===0?0:p[x-1];y[C*f+0]=x;for(let $=1;$<f;++$)y[C*f+$]=0;b[C]=o}return[y,[m,f],b,l,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kve(e,t,n,r,i){const s=Z(r),o=t[0],a=i.length,u=[];let l=1,c=-1;for(let m=0;m<a;++m){const y=i[m];if(y===-1){if(c!==-1)throw new Error(Jne(c,m));c=m,u.push(1)}else{if(y<0)throw new Error(Qne(m,y));l*=y,u.push(y)}}if(c!==-1){if(l<=0)throw new Error(ere());const m=Math.trunc(s/l);if(l*m!==s)throw new Error(tre(r,u));u[c]=m}if(Z(u)!==s)throw new Error(nre(r,u));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let m=h-2;m>=0;--m)d[m]=d[m+1]*r[m+1]}const p=[];if(a>0){p[a-1]=1;for(let m=a-2;m>=0;--m)p[m]=p[m+1]*u[m+1]}const g=$n(n,o*a);for(let m=0;m<o;++m){let y=0;for(let b=0;b<h;++b)y+=e[m*h+b]*d[b];for(let b=0;b<a;++b)g[m*a+b]=Math.trunc(y/p[b]),y%=p[b]}return[g,[o,a],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(e,t,n,r,i,s=!1,o=0){const a=r.length,u=[t[0],e.length/t[0]],l=u[1],f=a>0?i[a-1]+1:0;if(f<0)throw new Error(cM());const h=t.slice();h[0]=f;const d=h.reduce((v,x)=>v*x,1),p=$n(n,d);if(a===0)return f>0&&p.fill(o),[p,h];if(f<=0)throw new Error(cM());let g=0,m=1,y=0,b=i[g];for(;;){let v=0;if(m<a){if(v=i[m],b===v){++m;continue}if(b>=v)throw new Error(rre())}if(b<0||b>=f)throw new Error(ire(b,f));b>y&&p.fill(o,y*l,b*l);for(let x=g;x<m;++x){const w=r[x];if(w<0||w>=u[0])throw new Error(sre(x,r[x],u[0]));for(let C=0;C<l;C++)p[b*l+C]+=e[w*l+C]}if(s)for(let x=0;x<l;x++)p[b*l+x]/=m-g;if(g=m,++m,y=b+1,b=v,m>a)break}return y<f&&p.fill(o,y*l,f*l),[p,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iIt=cl(e=>Math.sqrt(e)),sIt=Bt(L1,e=>Math.sqrt(e)),oIt={kernelName:L1,backendName:"cpu",kernelFunc:sIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eve=Nn((e,t)=>{const n=e-t;return n*n}),aIt=Xn(P1,Eve),uIt={kernelName:P1,backendName:"cpu",kernelFunc:aIt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ave=cl((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:i}=t;return e.replace(new RegExp(n,r?"g":""),i)}),lIt=Yh(Fw,Ave),cIt={kernelName:Fw,backendName:"cpu",kernelFunc:lIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ve(e,t,n,r){const i=nt(e,t.dtype);for(let s=0;s<i.size;s++){const o=i.indexToLoc(s),a=new Array(o.length);for(let u=0;u<a.length;u++)a[u]=o[u]*n[u]+r[u];i.set(t.get(...a),...o)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fIt{constructor(t,n,r,i,s,o){this.separator=cu(t),this.nGramWidths=n,this.leftPad=cu(r),this.rightPad=cu(i),this.padWidth=s,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,n){const r=this.getPadWidth(n);return Math.max(0,t+2*r-n+1)}createNGrams(t,n,r,i,s,o){for(let a=0;a<s;++a){const u=this.getPadWidth(o),l=Math.max(0,u-a),c=Math.max(0,u-(s-(a+1))),f=o-(l+c),h=n+(l>0?0:a-u);let d=0;d+=l*this.leftPad.length;for(let b=0;b<f;++b)d+=t[h+b].length;d+=c*this.rightPad.length;const p=l+c+f-1;d+=p*this.separator.length,r[i+a]=new Uint8Array(d);const g=r[i+a];let m=0;const y=b=>b.forEach(v=>g[m++]=v);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<f-1;++b)y(t[h+b]),y(this.separator);if(f>0){y(t[h+f-1]);for(let b=0;b<c;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<c-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(t,n){const r=t.length,i=n.length;if(i>0){let u=n[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let l=1;l<i;++l){let c=n[l]>=u;if(c=c&&n[l]<=r,!c)throw new Error(`Invalid split value ${n[l]}, must be in [${u}, ${r}]`);u=n[l]}if(u!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${u}`)}const s=i-1,o=$n("int32",i);if(r===0||i===0){const u=new Array(r);for(let l=0;l<=s;++l)o[l]=0;return[u,o]}o[0]=0;for(let u=1;u<=s;++u){const l=n[u]-n[u-1];let c=0;this.nGramWidths.forEach(f=>{c+=this.getNumNGrams(l,f)}),this.preserveShort&&l>0&&c===0&&(c=1),o[u]=o[u-1]+c}const a=new Array(o[s]);for(let u=0;u<s;++u){const l=n[u];let c=o[u];if(this.nGramWidths.forEach(f=>{const h=n[u+1]-n[u],d=this.getNumNGrams(h,f);this.createNGrams(t,l,a,c,d,f),c+=d}),this.preserveShort&&c===o[u]){const f=n[u+1]-n[u];if(f===0)continue;const h=f+2*this.padWidth;this.createNGrams(t,l,a,c,1,h)}}return[a,o]}}function Tve(e,t,n,r,i,s,o,a){return new fIt(n,r,i,s,o,a).compute(e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hIt(e,t,n,r){if(!e.length)return;if(t.length===0){for(let s=0;s<e.length;++s)r.push(e.subarray(s,s+1));return}if(t.length===1){const s=t[0];let o=e.indexOf(s);for(;o!==-1;){const a=e.subarray(0,o);(!n||a.length!==0)&&r.push(a),e=e.subarray(o+1),o=e.indexOf(s)}(!n||e.length!==0)&&r.push(e);return}let i=0;for(let s=0;s<e.length+1;s++)if(s===e.length||t.indexOf(e[s])!==-1){const o=e.subarray(i,s);(!n||o.length!==0)&&r.push(o),i=s+1}}function Ive(e,t,n){const r=e.length,i=[];let s=0,o=0;const a=new Array(r);for(let h=0;h<r;++h){const d=i.length;hIt(e[h],t,n,i);const p=i.length-d;a[h]=p,s+=p,o=Math.max(o,p)}const u=$n("int32",s*2),l=new Array(s),c=[r,o];let f=0;for(let h=0;h<r;++h)for(let d=0;d<a[h];++d)u[f*2]=h,u[f*2+1]=d,l[f]=i[f],++f;return[u,l,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dve(e,t){const n=$n("int32",e.length);for(let r=0;r<e.length;++r)n[r]=Bee(e[r]).modulo(t).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nve=Nn((e,t)=>e-t),dIt=rV((e,t,n,r)=>({real:e-n,imag:t-r})),uV=Xn(B1,Nve,dIt),pIt={kernelName:B1,backendName:"cpu",kernelFunc:uV};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fve(e,t){const n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=e.shape[i]*t[i];const r=nt(n,e.dtype);for(let i=0;i<r.values.length;++i){const s=r.indexToLoc(i),o=new Array(e.rank);for(let u=0;u<o.length;u++)o[u]=s[u]%e.shape[u];const a=e.locToIndex(o);r.values[i]=e.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cx=(e,t)=>{const n=t.value-e.value;return n===0?e.index-t.index:n};function Ove(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,u=t-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(a-c)/a)*Math.sign(u-a/2),h=Math.max(n,Math.floor(t-u*c/a+f)),d=Math.min(r,Math.floor(t+(a-u)*c/a+f));Ove(e,t,h,d)}const i=e[t];let s=n,o=r;for(Tl(e,n,t),cx(e[r],i)>0&&Tl(e,n,r);s<o;){for(Tl(e,s,o),s++,o--;cx(e[s],i)<0;)s=s+1;for(;cx(e[o],i)>0;)o=o-1}cx(e[n],i)===0?Tl(e,n,o):(o=o+1,Tl(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}function Rve(e,t,n,r,i){const s=t[t.length-1],[o,a]=[e.length/s,s],u=sr(n,o*r),l=sr("int32",o*r);for(let f=0;f<o;f++){const h=f*a,d=e.subarray(h,h+a);let p=new Array(d.length);d.forEach((b,v)=>p[v]={value:b,index:v}),r<p.length&&(Ove(p,r),p=p.slice(0,r)),i&&p.sort(cx);const g=f*r,m=u.subarray(g,g+r),y=l.subarray(g,g+r);for(let b=0;b<r;b++)m[b]=p[b].value,y[b]=p[b].index}const c=t.slice();return c[c.length-1]=r,[nt(c,n,u),nt(c,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mve(e,t,n,r){const i=it(t,n)[0],s=[1,n[0],1];for(let p=0;p<i;p++)s[0]*=n[p];s[1]=n[i];for(let p=i+1;p<n.length;p++)s[2]*=n[p];const o=new Map,a=new Int32Array(n[i]),u=new Rn(s,r,e),l=[],c=s[0]===1&&s[2]===1;for(let p=0;p<n[i];p++){let g;if(c)g=e[p].toString();else{const y=[];for(let b=0;b<s[0];b++)for(let v=0;v<s[2];v++)y.push(u.get(b,p,v));g=y.join(",")}const m=o.get(g);if(m!=null)a[p]=m;else{const y=o.size;o.set(g,y),a[p]=y,l.push(p)}}const f=s.slice();f[1]=o.size;const h=new Rn(f,r);l.forEach((p,g)=>{for(let m=0;m<s[0];m++)for(let y=0;y<s[2];y++)h.set(u.get(m,p,y),m,g,y)});const d=n.slice();return d[i]=f[1],{outputValues:h.values,outputShape:d,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gIt=Object.freeze(Object.defineProperty({__proto__:null,addImpl:Gxe,bincountImpl:iV,bincountReduceImpl:Hxe,bitwiseAndImpl:qxe,castImpl:Vxe,ceilImpl:Xxe,concatImpl:Yxe,equalImpl:Kxe,expImpl:Jxe,expm1Impl:eve,floorDivImpl:nve,floorImpl:tve,gatherNdImpl:rve,gatherV2Impl:ive,greaterEqualImpl:ove,greaterImpl:sve,lessEqualImpl:uve,lessImpl:ave,linSpaceImpl:lve,logImpl:cve,maxImpl:fve,maximumImpl:hve,minimumImpl:dve,multiplyImpl:sV,negImpl:pve,notEqualImpl:gve,prodImpl:mve,raggedGatherImpl:yve,raggedRangeImpl:bve,raggedTensorToTensorImpl:xve,rangeImpl:vve,rsqrtImpl:wve,scatterImpl:Hd,sigmoidImpl:tIt,simpleAbsImpl:Wxe,sliceImpl:Cve,sparseFillEmptyRowsImpl:Sve,sparseReshapeImpl:kve,sparseSegmentReductionImpl:aV,sqrtImpl:iIt,squaredDifferenceImpl:Eve,staticRegexReplaceImpl:Ave,stridedSliceImpl:_ve,stringNGramsImpl:Tve,stringSplitImpl:Ive,stringToHashBucketFastImpl:Dve,subImpl:Nve,tileImpl:Fve,topKImpl:Rve,transposeImpl:oV,uniqueImpl:Mve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */yB("cpu",()=>new qF,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lve=Bt(u1,e=>e>=0?e:Math.exp(e)-1),mIt={kernelName:u1,backendName:"cpu",kernelFunc:Lve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pve(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r;Te([i],"leakyRelu");const o=Z(i.shape),a=n.data.get(i.dataId).values,u=sr("float32",o);for(let l=0;l<a.length;l++)u[l]=a[l]<0?s*a[l]:a[l];return n.makeTensorInfo(i.shape,"float32",u)}const yIt={kernelName:nw,backendName:"cpu",kernelFunc:Pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bIt=Nn((e,t)=>e<0?t*e:e);function Bve(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t;Te([r,i],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[a,u]=bIt(r.shape,i.shape,s,o,"float32");return n.makeTensorInfo(u,"float32",a)}const xIt={kernelName:ww,backendName:"cpu",kernelFunc:Bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zve=Bt(A1,e=>Math.max(0,e)),vIt={kernelName:A1,backendName:"cpu",kernelFunc:zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uve=Bt(_1,e=>Math.min(Math.max(0,e),6)),wIt={kernelName:_1,backendName:"cpu",kernelFunc:Uve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(e,t,n,r,i){if(n==="linear")return Uu({inputs:{x:t},backend:e});if(n==="relu")return zve({inputs:{x:t},backend:e});if(n==="elu")return Lve({inputs:{x:t},backend:e});if(n==="relu6")return Uve({inputs:{x:t},backend:e});if(n==="prelu")return Bve({inputs:{x:t,alpha:r},backend:e});if(n==="leakyrelu")return Pve({inputs:{x:t},backend:e,attrs:{alpha:i}});if(n==="sigmoid")return $ve({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,o=Z(i.shape),a=aB(s,o),u=Z(a);D(o===u,()=>`The new shape (${a}) has ${u} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const l=n.data.get(i.dataId);if(l.complexTensorInfos!=null){const c=l.complexTensorInfos.real,f=l.complexTensorInfos.imag;c.shape=a,f.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const $It={kernelName:Cw,backendName:"cpu",kernelFunc:Qt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jve(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:o,transposeB:a}=r;Te([i,s],"matMul");const u=i.shape.length,l=s.shape.length,c=o?i.shape[u-2]:i.shape[u-1],f=a?s.shape[l-1]:s.shape[l-2],h=o?i.shape[u-1]:i.shape[u-2],d=a?s.shape[l-2]:s.shape[l-1],p=i.shape.slice(0,-2),g=s.shape.slice(0,-2),m=Z(p),y=Z(g),v=Ke(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([h,d]);D(c===f,()=>`Error in matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${o} and transposeB=${a} must match.`);const x=o?[m,c,h]:[m,h,c],w=a?[y,d,f]:[y,f,d],C=Qt({inputs:{x:i},backend:n,attrs:{shape:x}}),$=Qt({inputs:{x:s},backend:n,attrs:{shape:w}}),S=o?C.shape[1]:C.shape[2],k=o?C.shape[2]:C.shape[1],E=a?$.shape[1]:$.shape[2],A=Math.max(m,y),F=n.data.get(C.dataId).values,_=n.data.get($.dataId).values,I=Re(C.shape),T=Re($.shape),[O,L,M]=o?[I[0],1,I[1]]:[I[0],I[1],1],[P,G,H]=a?[1,T[1],T[0]]:[T[1],1,T[0]],Q=k*E,te=nt([A,k,E],C.dtype),ne=te.values,oe=n.blockSize;for(let he=0;he<A;he++){const we=he%m,Ae=he%y;for(let B=0;B<k;B+=oe){const Y=Math.min(B+oe,k);for(let K=0;K<E;K+=oe){const R=Math.min(K+oe,E);for(let Ce=0;Ce<S;Ce+=oe){const ce=Math.min(Ce+oe,S);for(let Ee=B;Ee<Y;Ee++)for(let Se=K;Se<R;Se++){let qe=0;for(let bt=Ce;bt<ce;bt++){const fl=F[we*O+Ee*L+bt*M],hr=_[bt*P+Se*G+Ae*H];qe+=fl*hr}ne[he*Q+(Ee*E+Se)]+=qe}}}}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo($),n.makeTensorInfo(v,te.dtype,te.values)}const CIt={kernelName:z2,backendName:"cpu",kernelFunc:jve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SIt(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:f}=r;let h,d,p;const g=[];h=jve({inputs:{a:i,b:s},attrs:{transposeA:u,transposeB:l},backend:n}),o&&(d=V0({inputs:{a:h,b:o},backend:n}),g.push(h),h=d),c&&(p=$_(n,h,c,a,f),g.push(h),h=p);for(const y of g)n.disposeIntermediateTensorInfo(y);return h}const kIt={kernelName:jx,backendName:"cpu",kernelFunc:SIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EIt=Bt(Y0,e=>Math.acos(e)),AIt={kernelName:Y0,backendName:"cpu",kernelFunc:EIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _It=Bt(K0,e=>Math.acosh(e)),TIt={kernelName:K0,backendName:"cpu",kernelFunc:_It};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IIt(e){const{inputs:t,backend:n}=e,r=t;Te(t,"addN");const i=r.map(a=>n.data.get(a.dataId).values),s=nt(r[0].shape,r[0].dtype),o=s.values;for(let a=0;a<r.length;a++){const u=i[a];for(let l=0;l<o.length;l++)o[l]+=u[l]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}const DIt={kernelName:R2,backendName:"cpu",kernelFunc:IIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NIt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"all");const a=it(s,i.shape);let u=a;const l=xn(u,i.shape.length);let c=i;l!=null&&(c=Hi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=In(u.length,i.shape.length)),Tr("all",u,c.shape.length);const[f,h]=ar(c.shape,u),d=Z(h),p=Sr(Z(f),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let v=g[b];for(let x=0;x<d;++x){const w=g[b+x];v=v&&w}p[y]=v}l!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Tn(f,a),b=Qt({inputs:{x:m},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(m),b}return m}const FIt={kernelName:O_,backendName:"cpu",kernelFunc:NIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OIt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"any");const a=it(s,i.shape);let u=a;const l=xn(u,i.shape.length);let c=i;l!=null&&(c=Hi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=In(u.length,i.shape.length)),Tr("any",u,c.shape.length);const[f,h]=ar(c.shape,u),d=Z(h),p=Sr(Z(f),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let v=g[b];for(let x=0;x<d;++x){const w=g[b+x];v=v||w}p[y]=v}l!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Tn(f,a),b=Qt({inputs:{x:m},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(m),b}return m}const RIt={kernelName:R_,backendName:"cpu",kernelFunc:OIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MIt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;Te(i,"argMax");let o=it(s,i.shape);const a=xn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Hi({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=In(o.length,u.shape.length)),o=[o[0]],Tr("argMax",o,u.shape.length);const[c,f]=ar(u.shape,o),h=Z(c),d=Sr(h,"int32"),p=Z(f),g=n.data.get(u.dataId).values;for(let m=0;m<d.length;++m){const y=m*p;let b=g[y],v=0;for(let x=0;x<p;++x){const w=g[y+x];w>b&&(b=w,v=x)}d[m]=v}return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(c,"int32",d)}const LIt={kernelName:M2,backendName:"cpu",kernelFunc:MIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PIt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;Te(i,"argMin");let o=it(s,i.shape);const a=xn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Hi({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=In(o.length,u.shape.length)),o=[o[0]],Tr("argMin",o,u.shape.length);const[c,f]=ar(u.shape,o),h=Z(c),d=Sr(h,"int32"),p=Z(f),g=n.data.get(u.dataId).values;for(let m=0;m<d.length;++m){const y=m*p;let b=g[y],v=0;for(let x=0;x<p;++x){const w=g[y+x];w<b&&(b=w,v=x)}d[m]=v}return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(c,"int32",d)}const BIt={kernelName:L2,backendName:"cpu",kernelFunc:PIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zIt=Bt(Z0,e=>Math.asin(e)),UIt={kernelName:Z0,backendName:"cpu",kernelFunc:zIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jIt=Bt(J0,e=>Math.asinh(e)),WIt={kernelName:J0,backendName:"cpu",kernelFunc:jIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VIt=Bt(Q0,e=>Math.atan(e)),GIt={kernelName:Q0,backendName:"cpu",kernelFunc:VIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HIt=Nn((e,t)=>Math.atan2(e,t)),qIt=Xn(t1,HIt),XIt={kernelName:t1,backendName:"cpu",kernelFunc:qIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YIt=Bt(e1,e=>Math.atanh(e)),KIt={kernelName:e1,backendName:"cpu",kernelFunc:YIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(e,t,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=i.padInfo.top,d=i.padInfo.left,p=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=nt(i.outShape,n),m=g.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let x=0;x<i.batchSize;++x){const w=x*y,C=x*r[0];for(let $=0;$<i.inChannels;++$)for(let S=0;S<i.outHeight;++S){const k=S*o-h,E=Math.max(0,k),A=Math.min(i.inHeight,c+k),F=w+S*b;for(let _=0;_<i.outWidth;++_){const I=_*a-d,T=Math.max(0,I),O=Math.min(i.inWidth,f+I);let L=p,M=0,P=0;for(let H=E;H<A;H+=u){const Q=C+H*r[1];for(let te=T;te<O;te+=l){const ne=Q+te*r[2],oe=e[ne+$];s==="max"&&oe>L?L=oe:s==="avg"&&(M+=oe,P++)}if(isNaN(L))break}const G=F+_*v+$;m[G]=s==="avg"?M/P:L}}}return g}function Wve(e,t,n,r,i=!1,s=!1){const o=nt(r.outShape,"int32"),a=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,g=nt(t,n,e);for(let m=0;m<r.batchSize;++m)for(let y=0;y<r.inChannels;++y)for(let b=0;b<r.outHeight;++b){const v=b*a-d;let x=v;for(;x<0;)x+=l;const w=Math.min(r.inHeight,f+v);for(let C=0;C<r.outWidth;++C){const $=C*u-p;let S=$;for(;S<0;)S+=c;const k=Math.min(r.inWidth,h+$);let E=Number.NEGATIVE_INFINITY,A=-1;for(let F=x;F<w;F+=l){const _=F-v;for(let I=S;I<k;I+=c){const T=I-$,O=g.get(m,F,I,y);O>E&&(E=O,i?A=s?((m*r.inHeight+F)*r.inWidth+I)*r.inChannels+y:(F*r.inWidth+I)*r.inChannels+y:A=_*h+T)}}o.set(A,m,b,C,y)}}return o}function Vve(e,t,n,r,i,s){const o=i.strideDepth,a=i.strideHeight,u=i.strideWidth,l=i.dilationDepth,c=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,g=i.padInfo.front,m=i.padInfo.top,y=i.padInfo.left,b=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=nt(i.outShape,n),x=v.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],C=i.outShape[2]*i.outShape[3]*i.outShape[4],$=i.outShape[3]*i.outShape[4],S=i.outShape[4];for(let k=0;k<i.batchSize;++k){const E=k*w,A=k*r[0];for(let F=0;F<i.inChannels;++F)for(let _=0;_<i.outDepth;++_){const I=_*o-g;let T=I;for(;T<0;)T+=l;const O=Math.min(i.inDepth,h+I),L=E+_*C;for(let M=0;M<i.outHeight;++M){const P=M*a-m;let G=P;for(;G<0;)G+=c;const H=Math.min(i.inHeight,d+P),Q=L+M*$;for(let te=0;te<i.outWidth;++te){const ne=te*u-y;let oe=ne;for(;oe<0;)oe+=f;const he=Math.min(i.inWidth,p+ne),we=Q+te*S;let Ae=b,B=0,Y=0;for(let R=T;R<O;R+=l){const Ce=A+R*r[1];for(let ce=G;ce<H;ce+=c){const Ee=Ce+ce*r[2];for(let Se=oe;Se<he;Se+=f){const qe=Ee+Se*r[3],bt=e[qe+F];if(s==="max"&&bt>Ae?Ae=bt:s==="avg"&&(B+=bt,Y++),isNaN(Ae))break}if(isNaN(Ae))break}if(isNaN(Ae))break}const K=we+F;x[K]=s==="avg"?B/Math.max(Y,1):Ae}}}}return v}function ZIt(e,t){const n=nt(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,s=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let m=0;m<t.inChannels;++m)for(let y=0;y<t.outDepth;++y){const b=y*r-h;let v=b;for(;v<0;)v+=o;const x=Math.min(t.inDepth,l+b);for(let w=0;w<t.outHeight;++w){const C=w*i-d;let $=C;for(;$<0;)$+=a;const S=Math.min(t.inHeight,c+C);for(let k=0;k<t.outWidth;++k){const E=k*s-p;let A=E;for(;A<0;)A+=u;const F=Math.min(t.inWidth,f+E);let _=Number.NEGATIVE_INFINITY,I=-1;for(let T=v;T<x;T+=o){const O=T-b;for(let L=$;L<S;L+=a){const M=L-C;for(let P=A;P<F;P+=u){const G=P-E,H=e.get(g,T,L,P,m);H>=_&&(_=H,I=O*c*f+M*c+G)}}}n.set(I,g,y,w,k,m)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JIt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Te(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;D(_r(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ro(i.shape,s,o,l,a,u);let f;if(c.filterWidth===1&&c.filterHeight===1&&gt(c.inShape,c.outShape))f=Uu({inputs:{x:i},backend:n});else{const h=n.data.get(i.dataId).values,d=Re(i.shape),p=lV(h,i.shape,i.dtype,d,c,"avg");f=n.makeTensorInfo(c.outShape,i.dtype,p.values)}return f}const QIt={kernelName:P2,backendName:"cpu",kernelFunc:JIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;Te(i,"avgPool3d");const c=pc(i.shape,s,o,1,a,u,l),f=n.data.get(i.dataId).values,h=Vve(f,i.shape,i.dtype,Re(i.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const tDt={kernelName:B2,backendName:"cpu",kernelFunc:eDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nDt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;Te([i,s],"avgPool3DGrad");const c=pc(s.shape,o,a,1,u,l),f=c.strideDepth,h=c.strideHeight,d=c.strideWidth,p=c.filterDepth,g=c.filterHeight,m=c.filterWidth,y=c.dilationDepth,b=c.dilationHeight,v=c.dilationWidth,x=c.effectiveFilterDepth,w=c.effectiveFilterHeight,C=c.effectiveFilterWidth,$=x-1-c.padInfo.front,S=C-1-c.padInfo.left,k=w-1-c.padInfo.top,E=nt(s.shape,"float32"),A=1/(p*g*m),F=n.bufferSync(i);for(let _=0;_<c.batchSize;++_)for(let I=0;I<c.inChannels;++I)for(let T=0;T<c.inDepth;++T)for(let O=0;O<c.inHeight;++O)for(let L=0;L<c.inWidth;++L){const M=T-$,P=O-k,G=L-S;let H=0;for(let Q=0;Q<x;Q+=y){const te=(M+Q)/f;if(!(te<0||te>=c.outDepth||Math.floor(te)!==te))for(let ne=0;ne<w;ne+=b){const oe=(P+ne)/h;if(!(oe<0||oe>=c.outHeight||Math.floor(oe)!==oe))for(let he=0;he<C;he+=v){const we=(G+he)/d;if(we<0||we>=c.outWidth||Math.floor(we)!==we)continue;const Ae=F.get(_,te,oe,we,I);H+=Ae}}}E.set(H*A,_,T,O,L,I)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const rDt={kernelName:L_,backendName:"cpu",kernelFunc:nDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iDt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s;Te([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=Ro(o.shape,a,u,1,l),f=c.strideHeight,h=c.strideWidth,d=c.filterHeight,p=c.filterWidth,g=c.dilationHeight,m=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,v=b-1-c.padInfo.left,x=y-1-c.padInfo.top,w=nt(o.shape,"float32"),C=1/(d*p),$=n.data.get(i.dataId).values,S=nt(i.shape,"float32",$);for(let k=0;k<c.batchSize;++k)for(let E=0;E<c.inChannels;++E)for(let A=0;A<c.inHeight;++A)for(let F=0;F<c.inWidth;++F){const _=A-x,I=F-v;let T=0;for(let O=0;O<y;O+=g){const L=(_+O)/f;if(!(L<0||L>=c.outHeight||Math.floor(L)!==L))for(let M=0;M<b;M+=m){const P=(I+M)/h;if(P<0||P>=c.outWidth||Math.floor(P)!==P)continue;const G=S.get(k,L,P,E);T+=G}}w.set(T*C,k,A,F,E)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const sDt={kernelName:M_,backendName:"cpu",kernelFunc:iDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,scale:s,offset:o,mean:a,variance:u}=t;D(a.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Te([i,a,u,s,o],"batchNorm");let{varianceEpsilon:l}=r;l==null&&(l=.001);const c=n.data.get(i.dataId).values,f=n.data.get(a.dataId).values,h=n.data.get(u.dataId).values,d=s?n.data.get(s.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(c.length),m=p.length,y=d.length,b=h.length,v=f.length;let x=0,w=0,C=0,$=0;for(let S=0;S<c.length;++S)g[S]=p[x++]+(c[S]-f[w++])*d[C++]/Math.sqrt(h[$++]+l),x>=m&&(x=0),w>=v&&(w=0),C>=y&&(C=0),$>=b&&($=0);return n.makeTensorInfo(i.shape,i.dtype,g)}const aDt={kernelName:Q2,backendName:"cpu",kernelFunc:oDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:o}=r;Te([i],"batchToSpaceND");const a=s.reduce((y,b)=>y*b),u=Hw(i.shape,s,a),l=qw(u.length,s.length),c=Xw(i.shape,s,a),f=C5(o,s.length),h=S5(c,o,s.length),d=Qt({inputs:{x:i},backend:n,attrs:{shape:u}}),p=Hi({inputs:{x:d},backend:n,attrs:{perm:l}}),g=Qt({inputs:{x:p},backend:n,attrs:{shape:c}}),m=Qp({inputs:{x:g},backend:n,attrs:{begin:f,size:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const lDt={kernelName:U2,backendName:"cpu",kernelFunc:uDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o}=r,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,l=iV(a,u,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}const fDt={kernelName:P_,backendName:"cpu",kernelFunc:cDt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hDt(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=Ke(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const dDt={kernelName:B_,backendName:"cpu",kernelFunc:hDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pDt=Bt(i1,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),gDt={kernelName:i1,backendName:"cpu",kernelFunc:pDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mDt=e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(Z(t.shape)),i=n.data.get(t.dataId),s=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values;for(let l=0;l<a.length;l++){const c=a[l],f=u[l];r[l]=Math.hypot(c,f)}return n.makeOutput(r,t.shape,"float32")},yDt={kernelName:W2,backendName:"cpu",kernelFunc:mDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G0(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const bDt={kernelName:sT,backendName:"cpu",kernelFunc:G0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=it(i,t[0].shape)[0],o=t.map(g=>g.shape);v5(o,s);let a=hu(t.map(g=>g.shape),s);if(Z(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(g=>Z(g.shape)>0);if(u.length===1)return Uu({inputs:{x:u[0]},backend:n});if(u[0].dtype==="complex64"){const g=u.map(x=>Jp({inputs:{input:x},backend:n})),m=u.map(x=>G0({inputs:{input:x},backend:n})),y=H0({inputs:g,backend:n,attrs:{axis:s}}),b=H0({inputs:m,backend:n,attrs:{axis:s}}),v=ls({inputs:{real:y,imag:b},backend:n});return g.forEach(x=>n.disposeIntermediateTensorInfo(x)),m.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),v}const l=u.map(g=>{const y=[-1,Z(g.shape.slice(s))];return Qt({inputs:{x:g},backend:n,attrs:{shape:y}})}),c=l.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));a=hu(l.map(g=>g.shape),1);const f=l[0].shape[0]===1,h=Yxe(c,a,t[0].dtype,f),d=hu(u.map(g=>g.shape),s),p=n.makeTensorInfo(d,t[0].dtype,h);return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const xDt={kernelName:V2,backendName:"cpu",kernelFunc:H0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gve(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r;Te([i,s],"conv2d");const f=gc(u),h=or(i.shape,s.shape,o,l,a,c,!1,f),d=h.filterHeight,p=h.filterWidth,g=h.dilationHeight,m=h.dilationWidth,y=h.padInfo.left,b=h.padInfo.top,v=h.dataFormat==="channelsLast",x=new Rn(h.outShape,i.dtype),w=Re(i.shape),C=Re(s.shape),$=w[0],S=v?w[1]:w[2],k=v?w[2]:1,E=v?1:w[1],A=x.strides[0],F=v?x.strides[1]:x.strides[2],_=v?x.strides[2]:1,I=v?1:x.strides[1],T=n.data.get(i.dataId).values,O=n.data.get(s.dataId).values,L=x.values;for(let M=0;M<h.batchSize;++M){const P=M*$,G=M*A;for(let H=0;H<h.outHeight;++H){const Q=G+H*F,te=H*h.strideHeight-b;for(let ne=0;ne<d;++ne){const oe=te+ne*g;if(oe<0||oe>=h.inHeight)continue;const he=ne*C[0],we=P+oe*S;for(let Ae=0;Ae<h.outWidth;++Ae){const B=Q+Ae*_,Y=Ae*h.strideWidth-y;for(let K=0;K<p;++K){const R=Y+K*m;if(R<0||R>=h.inWidth)continue;const Ce=he+K*C[1],ce=we+R*k;let Ee=Ce;for(let Se=0;Se<h.inChannels;++Se){const qe=T[ce+Se*E];for(let bt=0;bt<h.outChannels;++bt)L[B+bt*I]+=qe*O[Ee+bt];Ee+=h.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,L)}const vDt={kernelName:G2,backendName:"cpu",kernelFunc:Gve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r;Te([i,s],"conv2dBackpropFilter");const f=gc(u),h=or(i.shape,c,o,1,a,l,!1,f),{strideHeight:d,strideWidth:p,filterHeight:g,filterWidth:m}=h,y=h.dataFormat==="channelsLast",b=new Rn(h.filterShape,"float32"),v=h.padInfo.left,x=h.padInfo.top,w=n.data.get(i.dataId).values,C=n.data.get(s.dataId).values,$=new Rn(i.shape,i.dtype,w),S=new Rn(s.shape,s.dtype,C);for(let k=0;k<g;++k){const E=Math.max(0,Math.ceil((x-k)/d)),A=Math.min(h.outHeight,(h.inHeight+x-k)/d);for(let F=0;F<m;++F){const _=Math.max(0,Math.ceil((v-F)/p)),I=Math.min(h.outWidth,(h.inWidth+v-F)/p);for(let T=0;T<h.inChannels;++T)for(let O=0;O<h.outChannels;++O){let L=0;for(let M=0;M<h.batchSize;++M)for(let P=E;P<A;++P){const G=k+P*d-x;for(let H=_;H<I;++H){const Q=F+H*p-v;y?L+=$.get(M,G,Q,T)*S.get(M,P,H,O):L+=$.get(M,T,G,Q)*S.get(M,O,P,H)}}b.set(L,k,F,T,O)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const $Dt={kernelName:U_,backendName:"cpu",kernelFunc:wDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CDt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r;Te([i,s],"conv2dBackpropInput");const f=Re(s.shape),h=Re(i.shape);let d=gc(l);const p=or(o,s.shape,a,1,u,c,!1,d),g=new Rn(p.inShape,"float32"),m=g.values,y=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,[v,x,w]=f,{batchSize:C,filterHeight:$,filterWidth:S,inChannels:k,inHeight:E,inWidth:A,outChannels:F,outHeight:_,outWidth:I,strideHeight:T,strideWidth:O}=p;d=p.dataFormat;const L=$-1-p.padInfo.top,M=S-1-p.padInfo.left,P=d==="channelsLast",G=g.strides[0],H=P?g.strides[1]:g.strides[2],Q=P?g.strides[2]:1,te=P?1:g.strides[1],ne=h[0],oe=P?h[1]:h[2],he=P?h[2]:1,we=P?1:h[1];for(let Ae=0;Ae<C;++Ae)for(let B=0;B<k;++B)for(let Y=0;Y<E;++Y){const K=Y-L,R=Math.max(0,Math.ceil(K/T)),Ce=Math.min(_,($+K)/T);for(let ce=0;ce<A;++ce){const Ee=ce-M,Se=Math.max(0,Math.ceil(Ee/O)),qe=Math.min(I,(S+Ee)/O);let bt=0;for(let hr=R;hr<Ce;++hr){const Nc=hr*T-K;for(let Os=Se;Os<qe;++Os){const Zh=Os*O-Ee,Wo=ne*Ae+oe*hr+he*Os,hl=v*($-1-Nc)+x*(S-1-Zh)+w*B;for(let Fc=0;Fc<F;++Fc){const Oc=y[Wo+we*Fc],Rc=b[hl+Fc];bt+=Oc*Rc}}}const fl=G*Ae+H*Y+Q*ce+te*B;m[fl]=bt}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const SDt={kernelName:H2,backendName:"cpu",kernelFunc:CDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r;Te([i,s],"conv3d");const l=$h(i.shape,s.shape,o,u,a),{filterDepth:c,filterHeight:f,filterWidth:h,dilationDepth:d,dilationHeight:p,dilationWidth:g,padInfo:m}=l,y=m.front,b=m.left,v=m.top,x=new Rn(l.outShape,i.dtype),w=n.data.get(i.dataId).values,C=n.data.get(s.dataId).values,$=x.values,S=Re(i.shape),k=Re(s.shape);for(let E=0;E<l.batchSize;++E){const A=E*S[0],F=E*x.strides[0];for(let _=0;_<l.outDepth;++_){const I=F+_*x.strides[1],T=_*l.strideDepth-y;for(let O=0;O<c;++O){const L=T+O*d;if(L<0||L>=l.inDepth)continue;const M=O*k[0],P=A+L*S[1];for(let G=0;G<l.outHeight;++G){const H=I+G*x.strides[2],Q=G*l.strideHeight-v;for(let te=0;te<f;++te){const ne=Q+te*p;if(ne<0||ne>=l.inHeight)continue;const oe=M+te*k[1],he=P+ne*S[2];for(let we=0;we<l.outWidth;++we){const Ae=H+we*l.outChannels,B=we*l.strideWidth-b;for(let Y=0;Y<h;++Y){const K=B+Y*g;if(K<0||K>=l.inWidth)continue;const R=oe+Y*k[2],Ce=he+K*l.inChannels;let ce=R;for(let Ee=0;Ee<l.inChannels;++Ee){const Se=w[Ce+Ee];for(let qe=0;qe<l.outChannels;++qe)$[Ae+qe]+=Se*C[ce+qe];ce+=l.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const EDt={kernelName:q2,backendName:"cpu",kernelFunc:kDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ADt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,filterShape:u}=r;Te([i,s],"conv3dBackpropFilterV2");const l=Re(i.shape),c=Re(s.shape),f=$h(i.shape,u,o,1,a),h=f.strideDepth,d=f.strideHeight,p=f.strideWidth,g=f.filterDepth,m=f.filterHeight,y=f.filterWidth,b=new Rn(f.filterShape,"float32"),v=b.values,[x,w,C,$]=b.strides,S=n.data.get(s.dataId).values,[k,E,A,F]=c,_=n.data.get(i.dataId).values,[I,T,O,L]=l,M=f.padInfo.front,P=f.padInfo.left,G=f.padInfo.top;for(let H=0;H<g;++H){const Q=Math.max(0,Math.ceil((M-H)/h)),te=Math.min(f.outDepth,(f.inDepth+M-H)/h),ne=H*x;for(let oe=0;oe<m;++oe){const he=Math.max(0,Math.ceil((G-oe)/d)),we=Math.min(f.outHeight,(f.inHeight+G-oe)/d),Ae=oe*w+ne;for(let B=0;B<y;++B){const Y=Math.max(0,Math.ceil((P-B)/p)),K=Math.min(f.outWidth,(f.inWidth+P-B)/p),R=B*C+Ae;for(let Ce=0;Ce<f.inChannels;++Ce){const ce=Ce*$+R;for(let Ee=0;Ee<f.outChannels;++Ee){let Se=0;for(let qe=0;qe<f.batchSize;++qe){const bt=qe*I,fl=qe*k;for(let hr=Q;hr<te;++hr){const Os=(H+hr*h-M)*T+bt,Zh=hr*E+fl;for(let Wo=he;Wo<we;++Wo){const Fc=(oe+Wo*d-G)*O+Os,Oc=Wo*A+Zh;for(let Rc=Y;Rc<K;++Rc){const e3=(B+Rc*p-P)*L+Fc,t3=Rc*F+Oc;Se+=_[e3+Ce]*S[t3+Ee]}}}}v[ce+Ee]=Se}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const _Dt={kernelName:j_,backendName:"cpu",kernelFunc:ADt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TDt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:o,strides:a,inputShape:u}=r;Te([i],"conv3dBackpropInputV2");const l=Re(i.shape),c=Re(s.shape),f=$h(u,s.shape,a,1,o),h=new Rn(f.inShape,"float32"),d=h.values,[p,g,m,y]=h.strides,b=n.data.get(i.dataId).values,[v,x,w,C]=l,$=n.data.get(s.dataId).values,[S,k,E,A]=c,{batchSize:F,filterDepth:_,filterHeight:I,filterWidth:T,inChannels:O,inDepth:L,inHeight:M,inWidth:P,outChannels:G,outDepth:H,outHeight:Q,outWidth:te,strideDepth:ne,strideHeight:oe,strideWidth:he}=f,we=_-1-f.padInfo.front,Ae=I-1-f.padInfo.top,B=T-1-f.padInfo.left;for(let Y=0;Y<F;++Y)for(let K=0;K<O;++K)for(let R=0;R<L;++R){const Ce=R-we,ce=Math.max(0,Math.ceil(Ce/ne)),Ee=Math.min(H,(_+Ce)/ne);for(let Se=0;Se<M;++Se){const qe=Se-Ae,bt=Math.max(0,Math.ceil(qe/oe)),fl=Math.min(Q,(I+qe)/oe);for(let hr=0;hr<P;++hr){const Nc=hr-B,Os=Math.max(0,Math.ceil(Nc/he)),Zh=Math.min(te,(T+Nc)/he);let Wo=0;for(let hl=ce;hl<Ee;++hl){const Fc=hl*ne-Ce;for(let Oc=bt;Oc<fl;++Oc){const Rc=Oc*oe-qe;for(let Gy=Os;Gy<Zh;++Gy){const e3=Gy*he-Nc,t3=v*Y+x*hl+w*Oc+C*Gy,V2e=S*(_-1-Fc)+k*(I-1-Rc)+E*(T-1-e3)+A*K;for(let AC=0;AC<G;++AC){const G2e=b[t3+AC],H2e=$[V2e+AC];Wo+=G2e*H2e}}}}d[p*Y+g*R+m*Se+y*hr+K]=Wo}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const IDt={kernelName:W_,backendName:"cpu",kernelFunc:TDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DDt=Bt(s1,e=>Math.cos(e)),NDt={kernelName:s1,backendName:"cpu",kernelFunc:DDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FDt=Bt(o1,e=>Math.cosh(e)),ODt={kernelName:o1,backendName:"cpu",kernelFunc:FDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RDt(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=r,[c,f,h,d]=i.shape,p=s.shape[0],[g,m]=a,y=nt([p,g,m,d],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(o.dataId).values,x=n.data.get(i.dataId).values,w=Re(i.shape),C=Re(y.shape);for(let $=0;$<p;$++){const S=$*4,k=b[S],E=b[S+1],A=b[S+2],F=b[S+3],_=v[$];if(_>=c)continue;const I=g>1?(A-k)*(f-1)/(g-1):0,T=m>1?(F-E)*(h-1)/(m-1):0;for(let O=0;O<g;O++){const L=g>1?k*(f-1)+O*I:.5*(k+A)*(f-1);if(L<0||L>f-1){for(let M=0;M<m;M++)for(let P=0;P<d;P++){const G=P+M*C[2]+O*C[1]+$*C[0];y.values[G]=l}continue}if(u==="bilinear"){const M=Math.floor(L),P=Math.ceil(L),G=L-M;for(let H=0;H<m;H++){const Q=m>1?E*(h-1)+H*T:.5*(E+F)*(h-1);if(Q<0||Q>h-1){for(let he=0;he<d;he++){const we=he+H*C[2]+O*C[1]+$*C[0];y.values[we]=l}continue}const te=Math.floor(Q),ne=Math.ceil(Q),oe=Q-te;for(let he=0;he<d;he++){let we=he+te*w[2]+M*w[1]+_*w[0];const Ae=x[we];we=he+ne*w[2]+M*w[1]+_*w[0];const B=x[we];we=he+te*w[2]+P*w[1]+_*w[0];const Y=x[we];we=he+ne*w[2]+P*w[1]+_*w[0];const K=x[we],R=Ae+(B-Ae)*oe,Ce=Y+(K-Y)*oe;we=he+H*C[2]+O*C[1]+$*C[0],y.values[we]=R+(Ce-R)*G}}}else for(let M=0;M<m;++M){const P=m>1?E*(h-1)+M*T:.5*(E+F)*(h-1);if(P<0||P>h-1){for(let Q=0;Q<d;Q++){const te=Q+M*C[2]+O*C[1]+$*C[0];y.values[te]=l}continue}const G=Math.round(P),H=Math.round(L);for(let Q=0;Q<d;Q++){const te=Q+G*w[2]+H*w[1]+_*w[0],ne=Q+M*C[2]+O*C[1]+$*C[0];y.values[ne]=x[te]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const MDt={kernelName:G_,backendName:"cpu",kernelFunc:RDt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;Te(i,"cumprod");const u=xn([s],i.shape.length);let l=i;u!=null&&(l=Hi({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=In(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const f=Bi(l.dtype,"int32"),h=N_(Z(l.shape),f),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<d.length;y+=p)for(let b=0;b<p;b++){const v=g(y,b);if(b===0)h[v]=o?1:d[v];else{const x=g(y,b-1);h[v]=o?d[x]*h[x]:d[v]*h[x]}}const m=n.makeTensorInfo(l.shape,f,h);if(u!=null){const y=Ch(u),b=Hi({inputs:{x:m},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),b}return m}const PDt={kernelName:V_,backendName:"cpu",kernelFunc:LDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;Te(i,"cumsum");const u=xn([s],i.shape.length);let l=i;u!=null&&(l=Hi({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=In(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const f=Bi(l.dtype,"int32"),h=Sr(Z(l.shape),f),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<d.length;y+=p)for(let b=0;b<p;b++){const v=g(y,b);if(b===0)h[v]=o?0:d[v];else{const x=g(y,b-1);h[v]=o?d[x]+h[x]:d[v]+h[x]}}const m=n.makeTensorInfo(l.shape,f,h);if(u!=null){const y=Ch(u),b=Hi({inputs:{x:m},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),b}return m}const zDt={kernelName:X2,backendName:"cpu",kernelFunc:BDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=iV(u,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}else if(i.shape.length===2){const u=n.bufferSync(i),l=n.bufferSync(s),c=Hxe(u,l,o,a);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const jDt={kernelName:H_,backendName:"cpu",kernelFunc:UDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:o}=r;D(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=i.shape[0],u=i.shape[1],l=i.shape[2],c=i.shape[3],f=u*s,h=l*s,d=c/(s*s),p=n.data.get(i.dataId).values,g=new Float32Array(a*f*h*d);let m=0;for(let y=0;y<a;++y)for(let b=0;b<f;++b){const v=Math.floor(b/s),x=b%s;for(let w=0;w<h;++w){const C=Math.floor(w/s),$=w%s,S=(x*s+$)*d;for(let k=0;k<d;++k){const A=k+S+c*(C+l*(v+u*y));g[m++]=p[A]}}}return n.makeTensorInfo([a,f,h,d],i.dtype,g)}const VDt={kernelName:q_,backendName:"cpu",kernelFunc:WDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hve(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;Te([i,s],"depthwiseConv2DNative");const c=Re(i.shape),f=Re(s.shape);let h=u;h==null&&(h=[1,1]),D(_r(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=or(i.shape,s.shape,o,h,a,l,!0),{filterHeight:p,filterWidth:g,dilationHeight:m,dilationWidth:y,padInfo:b}=d,v=b.left,x=b.top,w=d.outChannels/d.inChannels,C=new Rn(d.outShape,i.dtype),$=n.data.get(i.dataId).values,S=n.data.get(s.dataId).values,k=C.values;for(let E=0;E<d.batchSize;++E){const A=E*c[0],F=E*C.strides[0];for(let _=0;_<d.outHeight;++_){const I=F+_*C.strides[1],T=_*d.strideHeight-x;for(let O=0;O<p;++O){const L=T+O*m;if(L<0||L>=d.inHeight)continue;const M=O*f[0],P=A+L*c[1];for(let G=0;G<d.outWidth;++G){const H=I+G*C.strides[2],Q=G*d.strideWidth-v;for(let te=0;te<g;++te){const ne=Q+te*y;if(ne<0||ne>=d.inWidth)continue;const oe=M+te*f[1],he=P+ne*d.inChannels;let we=H,Ae=oe;for(let B=0;B<d.inChannels;++B){const Y=$[he+B];for(let K=0;K<w;++K)k[we+K]+=Y*S[Ae+K];we+=w,Ae+=w}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const GDt={kernelName:Y2,backendName:"cpu",kernelFunc:Hve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HDt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r;Te([i,s],"depthwiseConv2dNativeBackpropFilter");const f=or(i.shape,c,o,a,u,l,!0),{strideHeight:h,strideWidth:d,filterHeight:p,filterWidth:g}=f,m=new Rn(f.filterShape,"float32"),y=f.padInfo.left,b=f.padInfo.top,v=f.outChannels/f.inChannels,x=n.data.get(i.dataId).values,w=new Rn(i.shape,i.dtype,x),C=n.data.get(s.dataId).values,$=new Rn(s.shape,s.dtype,C);for(let S=0;S<p;++S){const k=Math.max(0,Math.ceil((b-S)/h)),E=Math.min(f.outHeight,(f.inHeight+b-S)/h);for(let A=0;A<g;++A){const F=Math.max(0,Math.ceil((y-A)/d)),_=Math.min(f.outWidth,(f.inWidth+y-A)/d);for(let I=0;I<f.outChannels;++I){const T=Math.trunc(I/v),O=I%v;let L=0;for(let M=0;M<f.batchSize;++M)for(let P=k;P<E;++P){const G=S+P*h-b;for(let H=F;H<_;++H){const Q=A+H*d-y;L+=w.get(M,G,Q,T)*$.get(M,P,H,I)}}m.set(L,S,A,T,O)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const qDt={kernelName:X_,backendName:"cpu",kernelFunc:HDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XDt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r;Te([i,s],"depthwiseConv2DNativeBackpropInput");const f=Re(i.shape),h=Re(s.shape),d=or(c,s.shape,o,a,u,l,!0),p=new Rn(d.inShape,"float32"),g=p.values,[m,y,b]=p.strides,v=n.data.get(i.dataId).values,[x,w,C]=f,$=n.data.get(s.dataId).values,[S,k,E]=h,{batchSize:A,filterHeight:F,filterWidth:_,inChannels:I,inHeight:T,inWidth:O,outChannels:L,outHeight:M,outWidth:P,strideHeight:G,strideWidth:H}=d,Q=F-1-d.padInfo.top,te=_-1-d.padInfo.left,ne=L/I;for(let oe=0;oe<A;++oe)for(let he=0;he<I;++he)for(let we=0;we<T;++we){const Ae=we-Q,B=Math.max(0,Math.ceil(Ae/G)),Y=Math.min(M,(F+Ae)/G);for(let K=0;K<O;++K){const R=K-te,Ce=Math.max(0,Math.ceil(R/H)),ce=Math.min(P,(_+R)/H);let Ee=0;for(let Se=B;Se<Y;++Se){const qe=Se*G-Ae;for(let bt=Ce;bt<ce;++bt){const fl=bt*H-R,hr=x*oe+w*Se+C*bt,Nc=S*(F-1-qe)+k*(_-1-fl)+E*he;for(let Os=0;Os<ne;++Os){const Zh=he*ne+Os,Wo=v[hr+Zh],hl=$[Nc+Os];Ee+=Wo*hl}}}g[m*oe+y*we+b*K+he]=Ee}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const YDt={kernelName:Y_,backendName:"cpu",kernelFunc:XDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KDt(e){const{inputs:t,backend:n}=e,{x:r}=t,i=Z(r.shape),s=n.data.get(r.dataId).values,o=nt([i,i],r.dtype),a=o.values;for(let l=0;l<s.length;l++)a[l*i+l]=s[l];const u=[...r.shape,...r.shape];return n.makeTensorInfo(u,o.dtype,o.values)}const ZDt={kernelName:K_,backendName:"cpu",kernelFunc:KDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JDt={kernelName:K2,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i}=e,{strides:s,pad:o,dilations:a}=n,u=t,l=u.data.get(r.dataId).values,c=r.shape.length,f=u.data.get(i.dataId).values,h=i.shape.length,{batchSize:d,inHeight:p,inWidth:g,inChannels:m,outHeight:y,outWidth:b,padInfo:v,strideHeight:x,strideWidth:w,filterHeight:C,filterWidth:$,dilationHeight:S,dilationWidth:k,outShape:E}=Bw(r.shape,i.shape,s,o,"NHWC",a),A=Z(E),F=E.length,_=$n(r.dtype,A);for(let T=0;T<d;++T)for(let O=0;O<y;++O){const L=O*x-v.top;for(let M=0;M<b;++M){const P=M*w-v.left;for(let G=0;G<m;++G){let H=Number.MIN_SAFE_INTEGER;for(let te=0;te<C;++te){const ne=L+te*S;if(ne>=0&&ne<p)for(let oe=0;oe<$;++oe){const he=P+oe*k;if(he>=0&&he<g){const we=pa([T,ne,he,G],c,Re(r.shape)),Ae=pa([te,oe,G],h,Re(i.shape)),B=l[we]+f[Ae];B>H&&(H=B)}}}const Q=pa([T,O,M,G],F,Re(E));_[Q]=H}}}return{dataId:u.write(vh(_,r.dtype),E,r.dtype),shape:E,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QDt={kernelName:Mk,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:s}=e,{strides:o,pad:a,dilations:u}=n,l=t,c=$o(r.shape,l.data.get(r.dataId).values),f=$o(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:x,filterHeight:w,filterWidth:C,dilationHeight:$,dilationWidth:S,outShape:k}=Bw(r.shape,i.shape,o,a,"NHWC",u);D(s.rank===k.length,()=>`Error in ${Mk}, dy must have the same rank as output ${k.length}, but got ${s.rank}`);const E=$o(k,l.data.get(s.dataId).values),A=lB(i.shape,i.dtype);for(let _=0;_<h;++_)for(let I=0;I<m;++I){const T=I*v-b.top;for(let O=0;O<y;++O){const L=O*x-b.left;for(let M=0;M<g;++M){let P=Number.MIN_SAFE_INTEGER,G=0,H=0;for(let Q=0;Q<w;++Q){const te=T+Q*$;if(te>=0&&te<d)for(let ne=0;ne<C;++ne){const oe=L+ne*S;if(oe>=0&&oe<p){const he=c[_][te][oe][M]+f[Q][ne][M];he>P&&(P=he,G=Q,H=ne)}}}A[G][H][M]+=E[_][I][O][M]}}}return{dataId:l.write(vh(A,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eNt={kernelName:Rk,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:s}=e,{strides:o,pad:a,dilations:u}=n,l=t,c=$o(r.shape,l.data.get(r.dataId).values),f=$o(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:x,filterHeight:w,filterWidth:C,dilationHeight:$,dilationWidth:S,outShape:k}=Bw(r.shape,i.shape,o,a,"NHWC",u);D(s.rank===k.length,()=>`Error in ${Rk}, dy must have the same rank as output ${k.length}, but got ${s.rank}`);const E=$o(k,l.data.get(s.dataId).values),A=lB(r.shape,r.dtype);for(let _=0;_<h;++_)for(let I=0;I<m;++I){const T=I*v-b.top;for(let O=0;O<y;++O){const L=O*x-b.left;for(let M=0;M<g;++M){let P=Number.MIN_SAFE_INTEGER,G=T<0?0:T,H=L<0?0:L;for(let Q=0;Q<w;++Q){const te=T+Q*$;if(te>=0&&te<d)for(let ne=0;ne<C;++ne){const oe=L+ne*S;if(oe>=0&&oe<p){const he=c[_][te][oe][M]+f[Q][ne][M];he>P&&(P=he,G=te,H=oe)}}}A[_][G][H][M]+=E[_][I][O][M]}}}return{dataId:l.write(vh(A,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tNt(e){const{inputs:t,backend:n,attrs:r}=e,{image:i}=t,{canvas:s,options:o}=r,{contextOptions:a,imageOptions:u}=o||{},l=(u==null?void 0:u.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=s.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${c} type.`);const[h,d]=i.shape.slice(0,2),p=i.shape.length===2?1:i.shape[2],g=n.data.get(i.dataId).values,m=i.dtype==="float32"?255:1,y=new Uint8ClampedArray(d*h*4);for(let v=0;v<h*d;++v){const x=[0,0,0,255*l];for(let C=0;C<p;C++){const $=g[v*p+C];if(i.dtype==="float32"){if($<0||$>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${$}.`)}else if(i.dtype==="int32"&&($<0||$>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${$}.`);p===1?(x[0]=$*m,x[1]=$*m,x[2]=$*m):x[C]=$*m}const w=v*4;y[w+0]=Math.round(x[0]),y[w+1]=Math.round(x[1]),y[w+2]=Math.round(x[2]),y[w+3]=Math.round(x[3])}s.width=d,s.height=h;const b=new ImageData(y,d,h);return f.putImageData(b,0,0),i}const nNt={kernelName:Z_,backendName:"cpu",kernelFunc:tNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wC(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"sum");let a;i.dtype==="bool"?a=xh({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):a=Uu({inputs:{x:i},backend:n});const u=a.shape.length,l=it(s,a.shape),c=xn(l,u);let f=l,h=a;c!=null&&(h=Hi({inputs:{x:a},backend:n,attrs:{perm:c}}),f=In(f.length,u)),Tr("sum",f,h.shape.length);const[d,p]=ar(h.shape,f),g=Bi(h.dtype,"int32");let m=v_(n,d,g);const y=Z(p),b=n.data.get(m.dataId).values,v=n.data.get(h.dataId).values;for(let x=0;x<b.length;++x){const w=x*y;let C=0;for(let $=0;$<y;++$)C+=v[w+$];b[x]=C}if(o){const x=Tn(m.shape,l),w=m;m=Qt({inputs:{x:m},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(w)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(h),m}const rNt={kernelName:Tw,backendName:"cpu",kernelFunc:wC};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iNt(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:o,summedDims:a,idDims:u}=N5(i,s.length);O5(o.length,u,s);const{path:l,steps:c}=R5(a,u),f=c.length;let h=null,d=o.length;const p=[];for(let g=0;g<f;++g){for(const m of c[g]){const{permutationIndices:y,expandDims:b}=F5(d,u[m]);let v;M5(y)?v=s[m]:(v=Hi({inputs:{x:s[m]},backend:n,attrs:{perm:y}}),p.push(v));const x=v.shape.slice();for(let w=0;w<b.length;++w)x.splice(b[w],0,1);gt(v.shape,x)||(v=Qt({inputs:{x:v},backend:n,attrs:{shape:x}}),p.push(v)),h===null?h=v:(h=XF({inputs:{a:v,b:h},backend:n}),p.push(h))}g<f-1&&(l[g]>=0&&(h=wC({inputs:{x:h},backend:n,attrs:{axis:l[g]-(o.length-d),keepDims:!1}}),p.push(h)),d--)}for(const g of p)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const sNt={kernelName:J_,backendName:"cpu",kernelFunc:iNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oNt(e){const{inputs:t,backend:n}=e,{dy:r,y:i}=t;Te([r,i],"eluGrad");const s=new Float32Array(Z(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values;for(let u=0;u<o.length;++u){const l=o[u];l>=0?s[u]=a[u]:s[u]=a[u]*(l+1)}return n.makeTensorInfo(i.shape,"float32",s)}const aNt={kernelName:Q_,backendName:"cpu",kernelFunc:oNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uNt=k5,lNt=E5,cNt=A5,fNt=_5,hNt=T5,dNt=I5,pNt=Bt(l1,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+uNt*n);return t*(1-((((dNt*r+hNt)*r+fNt)*r+cNt)*r+lNt)*r*Math.exp(-n*n))}),gNt={kernelName:l1,backendName:"cpu",kernelFunc:pNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_(e){const{inputs:t,backend:n,attrs:r}=e,{input:i}=t,{dim:s}=r,o=i.shape.length,a=i.shape.slice();let u=s;return s<0&&(D(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+s+1),a.splice(u,0,1),Qt({inputs:{x:i},backend:n,attrs:{shape:a}})}const mNt={kernelName:J2,backendName:"cpu",kernelFunc:C_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yNt=Nn((e,t)=>e/t),cV=Xn(a1,yNt),KP={kernelName:a1,backendName:"cpu",kernelFunc:cV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qve(e,t,n){const r=e.shape,i=r[0],s=r[1],o=n.data.get(e.dataId),a=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[i,s],c=Z(l),f=sr("float32",c),h=sr("float32",c);for(let m=0;m<i;m++){const y=Qp({inputs:{x:a},backend:n,attrs:{begin:[m,0],size:[1,s]}}),b=Qp({inputs:{x:u},backend:n,attrs:{begin:[m,0],size:[1,s]}}),v=ls({inputs:{real:y,imag:b},backend:n}),{real:x,imag:w}=bNt(v,t,n),C=nc(x,w);for(let $=0;$<s;$++){const S=D5(C,$);f[m*s+$]=S.real,h[m*s+$]=S.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v)}const d=n.makeTensorInfo(l,"float32",f),p=n.makeTensorInfo(l,"float32",h),g=ls({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),g}function bNt(e,t,n){const r=Z(e.shape),i=n.data.get(e.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(xNt(r)){const a=ZP(s,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){const l=n.makeTensorInfo(u,"float32",a.real),c=n.makeTensorInfo(u,"float32",a.imag),f=n.makeTensorInfo([],"float32",dc(r,"float32")),h=Uu({inputs:{x:f},backend:n}),d=KP.kernelFunc({inputs:{a:l,b:f},backend:n}),p=KP.kernelFunc({inputs:{a:c,b:h},backend:n}),g=n.data.get(d.dataId).values,m=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:g,imag:m}}return a}else{const a=nc(s,o),u=vNt(a,r,t);return Wne(u)}}function xNt(e){return(e&e-1)===0}function ZP(e,t,n,r,i){if(n===1)return{real:e,imag:t};const s=nc(e,t),o=n/2,a=Vne(s),u=a.real,l=a.imag,c=[u.length],f=i.makeTensorInfo(c,"float32",u),h=i.makeTensorInfo(c,"float32",l),d=ls({inputs:{real:f,imag:h},backend:i}),p=Gne(s),g=p.real,m=p.imag,y=[g.length],b=i.makeTensorInfo(y,"float32",g),v=i.makeTensorInfo(y,"float32",m),x=ls({inputs:{real:b,imag:v},backend:i}),w=ZP(u,l,o,r,i),C=w.real,$=w.imag,S=[C.length],k=i.makeTensorInfo(S,"float32",C),E=i.makeTensorInfo(S,"float32",$),A=ls({inputs:{real:k,imag:E},backend:i}),F=ZP(g,m,o,r,i),_=F.real,I=F.imag,T=[_.length],O=i.makeTensorInfo(T,"float32",_),L=i.makeTensorInfo(T,"float32",I),M=ls({inputs:{real:O,imag:L},backend:i}),P=qne(n,r),G=[P.real.length],H=i.makeTensorInfo(G,"float32",P.real),Q=i.makeTensorInfo(G,"float32",P.imag),te=ls({inputs:{real:H,imag:Q},backend:i}),ne=XF({inputs:{a:te,b:M},backend:i}),oe=V0({inputs:{a:A,b:ne},backend:i}),he=uV({inputs:{a:A,b:ne},backend:i}),we=Jp({inputs:{input:oe},backend:i}),Ae=Jp({inputs:{input:he},backend:i}),B=G0({inputs:{input:oe},backend:i}),Y=G0({inputs:{input:he},backend:i}),K=H0({inputs:[we,Ae],backend:i,attrs:{axis:0}}),R=H0({inputs:[B,Y],backend:i,attrs:{axis:0}}),Ce=i.data.get(K.dataId).values,ce=i.data.get(R.dataId).values;return i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(A),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(Q),i.disposeIntermediateTensorInfo(te),i.disposeIntermediateTensorInfo(ne),i.disposeIntermediateTensorInfo(oe),i.disposeIntermediateTensorInfo(he),i.disposeIntermediateTensorInfo(we),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(Ae),i.disposeIntermediateTensorInfo(Y),i.disposeIntermediateTensorInfo(K),i.disposeIntermediateTensorInfo(R),{real:Ce,imag:ce}}function vNt(e,t,n){const r=new Float32Array(t*2);for(let i=0;i<t;i++){let s=0,o=0;for(let a=0;a<t;a++){const u=Xne(i*a,t,n),l=D5(e,a);s+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}n&&(s/=t,o/=t),Hne(r,s,o,i)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wNt(e){const{inputs:t,backend:n}=e,{input:r}=t,i=Z(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=Qt({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),u=qve(a,!1,n),l=Qt({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),l}const $Nt={kernelName:eT,backendName:"cpu",kernelFunc:wNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(e){const{backend:t,attrs:n}=e,{shape:r,value:i,dtype:s}=n,o=s||rg(i),a=$n(o,Z(r));return SNt(a,i,o),t.makeTensorInfo(r,o,a)}const CNt={kernelName:tT,backendName:"cpu",kernelFunc:fV};function SNt(e,t,n){e.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kNt={kernelName:nT,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,i=n,s=sr(r.dtype,Z(r.shape)),[o,a,u,l]=r.shape,c=i.data.get(r.dataId).values;for(let h=0;h<o;h++){const d=h*u*a*l;for(let p=0;p<a;p++){const g=p*(u*l);for(let m=0;m<u;m++){const y=m*l;for(let b=0;b<l;b++){const v=Math.round(u-m-1),x=d+g+y+b;let w=c[x];if(v>=0&&v<u){const C=v*l,$=d+g+C+b;w=c[$]}s[x]=w}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ENt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r;let g=Gve({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){const m=g;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=Qt({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=V0({inputs:{a:g,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else g=V0({inputs:{a:g,b:o},backend:n});n.disposeIntermediateTensorInfo(m)}if(d){const m=g;if(c==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=Qt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=$_(n,g,d,y,p),n.disposeIntermediateTensorInfo(y)}else g=$_(n,g,d,a,p);n.disposeIntermediateTensorInfo(m)}return g}const ANt={kernelName:Wx,backendName:"cpu",kernelFunc:ENt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Nt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r;let g=Hve({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){const m=g;g=V0({inputs:{a:g,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){const m=g;g=$_(n,g,d,a,p),n.disposeIntermediateTensorInfo(m)}return g}const TNt={kernelName:Vx,backendName:"cpu",kernelFunc:_Nt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function INt(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=Z(r.shape),o=i.shape,a=o[o.length-1],[u,l,c,f]=mI(r,i);if(l===0)return n.makeTensorInfo(u,r.dtype,[]);const h=n.data.get(i.dataId).values,d=n.bufferSync(r),p=rve(h,d,r.dtype,l,a,c,f,r.shape,s);return n.makeTensorInfo(u,r.dtype,p.values)}const DNt={kernelName:rT,backendName:"cpu",kernelFunc:INt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NNt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:o,batchDims:a}=r;Te([i,s],"gatherV2");const u=it(o,i.shape)[0],l=n.data.get(s.dataId).values,c=i.shape[u];for(let x=0;x<l.length;++x){const w=l[x];D(w<=c-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${c-1}]`)}let f=a;a==null&&(f=0);const h=Z(s.shape),d=P5(i,s,u,f),p=Qt({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=Qt({inputs:{x:s},backend:n,attrs:{shape:[d.batchSize,h/d.batchSize]}}),m=[d.batchSize,d.outerSize,h/d.batchSize,d.sliceSize],y=n.bufferSync(g),b=n.bufferSync(p),v=ive(b,y,m);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(d.outputShape,v.dtype,v.values)}const FNt={kernelName:ew,backendName:"cpu",kernelFunc:NNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ONt(e){const{inputs:t,backend:n}=e,{input:r}=t,i=Z(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=Qt({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),u=qve(a,!0,n),l=Qt({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),l}const RNt={kernelName:iT,backendName:"cpu",kernelFunc:ONt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MNt=Bt(m1,e=>Number.isFinite(e)?1:0,"bool"),LNt={kernelName:m1,backendName:"cpu",kernelFunc:MNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PNt=Bt(y1,e=>Math.abs(e)===1/0?1:0,"bool"),BNt={kernelName:y1,backendName:"cpu",kernelFunc:PNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zNt=Bt(b1,e=>Number.isNaN(e)?1:0,"bool"),UNt={kernelName:b1,backendName:"cpu",kernelFunc:zNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jNt(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,o=lve(r,i,s);return t.makeTensorInfo([o.length],"float32",o)}const WNt={kernelName:oT,backendName:"cpu",kernelFunc:jNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VNt=Bt(v1,e=>Math.log1p(e)),GNt={kernelName:v1,backendName:"cpu",kernelFunc:VNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HNt=Nn((e,t)=>e&&t),qNt=Xn(sw,HNt,null,"bool"),XNt={kernelName:sw,backendName:"cpu",kernelFunc:qNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YNt=Bt(ow,e=>e?0:1,"bool"),KNt={kernelName:ow,backendName:"cpu",kernelFunc:YNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZNt=Nn((e,t)=>e||t),JNt=Xn(aw,ZNt,null,"bool"),QNt={kernelName:aw,backendName:"cpu",kernelFunc:JNt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:o,alpha:a,beta:u}=r;Te(i,"LRN");const l=i.shape[3],c=l-1,f=n.data.get(i.dataId).values,h=Z(i.shape),d=new Float32Array(h);function p(g){const m=g%l;let y=g-m+Math.max(0,m-s);const b=g-m+Math.min(m+s,c);let v=0;for(;y<=b;y++){const x=f[y];v+=x*x}return v}for(let g=0;g<h;g++){const m=p(g),y=f[g]*Math.pow(o+a*m,-u);d[g]=y}return n.makeTensorInfo(i.shape,i.dtype,d)}const tFt={kernelName:uw,backendName:"cpu",kernelFunc:eFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=r;Te(o,"LRNGrad");const f=Z(o.shape),h=o.shape[3],d=n.data.get(o.dataId).values,p=n.data.get(i.dataId).values,g=n.data.get(s.dataId).values,m=new Float32Array(f),y=f;for(let b=0;b<y;b++){const v=b%h,x=b-v+Math.max(0,v-a),w=b-v+Math.min(h,v+a+1);let C=0;for(let $=x;$<w;$++)C+=Math.pow(p[$],2);C=l*C+u;for(let $=x;$<w;$++){let S=-2*l*c*p[$]*g[b]/C;b===$&&(S+=Math.pow(C,-c)),S*=d[b],m[$]+=S}}return n.makeTensorInfo(o.shape,i.dtype,m)}const rFt={kernelName:aT,backendName:"cpu",kernelFunc:nFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xve(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:s,keepDims:o}=r,a=n;let u=i.shape;const l=u.length,c=it(s,u);let f=c;const h=xn(f,l);let d=a.data.get(i.dataId).values;if(h!=null){const x=new Array(l);for(let w=0;w<x.length;w++)x[w]=u[h[w]];d=oV(d,u,i.dtype,h,x),f=In(f.length,l),u=x}Te(i,"max"),Tr("max",f,l);const[p,g]=ar(u,f),m=Z(g),y=fve(d,m,p,i.dtype),b=a.write(y,p,i.dtype);let v=p;return o&&(v=Tn(p,c)),{dataId:b,shape:v,dtype:i.dtype}}const iFt={kernelName:lw,backendName:"cpu",kernelFunc:Xve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Te(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;D(_r(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ro(i.shape,s,o,l,a,u);let f;if(c.filterWidth===1&&c.filterHeight===1&&gt(c.inShape,c.outShape))f=Uu({inputs:{x:i},backend:n});else{const h=n.data.get(i.dataId).values,d=Re(i.shape),p=lV(h,i.shape,i.dtype,d,c,"max");f=n.makeTensorInfo(c.outShape,i.dtype,p.values)}return f}const oFt={kernelName:cw,backendName:"cpu",kernelFunc:sFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;Te(i,"maxPool3d");const c=pc(i.shape,s,o,1,a,u,l),f=n.data.get(i.dataId).values,h=Vve(f,i.shape,i.dtype,Re(i.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const uFt={kernelName:fw,backendName:"cpu",kernelFunc:aFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lFt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;Te([i,s],"maxPool3DGrad");const c=pc(s.shape,o,a,1,u,l),f=n.bufferSync(s),h=ZIt(f,c),d=c.strideDepth,p=c.strideHeight,g=c.strideWidth,m=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,v=c.effectiveFilterDepth,x=c.effectiveFilterHeight,w=c.effectiveFilterWidth,C=v-1-c.padInfo.front,$=w-1-c.padInfo.left,S=x-1-c.padInfo.top,k=nt(s.shape,"float32"),E=n.bufferSync(i);for(let A=0;A<c.batchSize;++A)for(let F=0;F<c.inChannels;++F)for(let _=0;_<c.inDepth;++_)for(let I=0;I<c.inHeight;++I)for(let T=0;T<c.inWidth;++T){const O=_-C,L=I-S,M=T-$;let P=0;for(let G=0;G<v;G+=m){const H=(O+G)/d;if(!(H<0||H>=c.outDepth||Math.floor(H)!==H))for(let Q=0;Q<x;Q+=y){const te=(L+Q)/p;if(!(te<0||te>=c.outHeight||Math.floor(te)!==te))for(let ne=0;ne<w;ne+=b){const oe=(M+ne)/g;if(oe<0||oe>=c.outWidth||Math.floor(oe)!==oe)continue;const he=v*x*w-1-h.get(A,H,te,oe,F),we=G*x*w+Q*w+ne,Ae=he===we?1:0;if(Ae===0)continue;const B=E.get(A,H,te,oe,F);P+=B*Ae}}}k.set(P,A,_,I,T,F)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const cFt={kernelName:lT,backendName:"cpu",kernelFunc:lFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fFt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:o}=t,a=s;Te([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:f}=r,h=Ro(a.shape,u,l,1,c,f),d=n.data.get(a.dataId).values,p=nt(h.outShape,a.dtype,Wve(d,a.shape,a.dtype,h).values),g=h.strideHeight,m=h.strideWidth,y=h.dilationHeight,b=h.dilationWidth,v=h.effectiveFilterHeight,x=h.effectiveFilterWidth,w=x-1-h.padInfo.left,C=v-1-h.padInfo.top,$=nt(a.shape,"float32"),S=n.data.get(i.dataId).values,k=nt(i.shape,"float32",S);for(let E=0;E<h.batchSize;++E)for(let A=0;A<h.inChannels;++A)for(let F=0;F<h.inHeight;++F)for(let _=0;_<h.inWidth;++_){const I=F-C,T=_-w;let O=0;for(let L=0;L<v;L+=y){const M=(I+L)/g;if(!(M<0||M>=h.outHeight||Math.floor(M)!==M))for(let P=0;P<x;P+=b){const G=(T+P)/m;if(G<0||G>=h.outWidth||Math.floor(G)!==G)continue;const H=v*x-1-p.get(E,M,G,A),Q=L*x+P,te=H===Q?1:0;if(te===0)continue;const ne=k.get(E,M,G,A);O+=ne*te}}$.set(O,E,F,_,A)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const hFt={kernelName:uT,backendName:"cpu",kernelFunc:fFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dFt(e,t,n,r,i){const s=Re(t),o=lV(e,t,n,s,i,"max"),a=Wve(e,t,n,i,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pFt={kernelName:cT,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=t,u=n;Te(r,"MaxPoolWithArgmax");const l=u.data.get(r.dataId).values,c=Ro(r.shape,i,s,[1,1],o),[f,h]=dFt(l,r.shape,r.dtype,a,c),d=u.write(f,c.outShape,r.dtype),p=u.write(h,c.outShape,r.dtype);return[{dataId:d,shape:c.outShape,dtype:r.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=it(s,i.shape),l=ar(i.shape,a)[1],c=Z(l),f=[],h=n.makeTensorInfo([],"float32",new Float32Array([c]));f.push(h);const d=xh({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});f.push(d);const p=cV({inputs:{a:d,b:h},backend:n});f.push(p);const g=wC({inputs:{x:p},backend:n,attrs:{axis:s,keepDims:o}});return f.forEach(m=>n.disposeIntermediateTensorInfo(m)),g}const mFt={kernelName:hw,backendName:"cpu",kernelFunc:gFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"min");const a=it(s,i.shape);let u=a;const l=xn(u,i.shape.length);let c=i;l!=null&&(c=Hi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=In(u.length,i.shape.length)),Tr("min",u,c.shape.length);const[f,h]=ar(c.shape,u),d=Z(h),p=Sr(Z(f),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let v=g[b];for(let x=0;x<d;++x){const w=g[b+x];(Number.isNaN(w)||w<v)&&(v=w)}p[y]=v}l!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Tn(f,a),b=Qt({inputs:{x:m},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(m),b}return m}const bFt={kernelName:dw,backendName:"cpu",kernelFunc:yFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,mode:o}=r;Te(i,"mirrorPad");const a=s.map((v,x)=>v[0]+i.shape[x]+v[1]),u=s.map(v=>v[0]),l=s.map((v,x)=>v[0]+i.shape[x]),c=o==="reflect"?0:1,f=n.data.get(i.dataId).values,h=i.shape.length,d=Re(i.shape),p=Z(a),g=a.length,m=Re(a),y=sr(i.dtype,p);for(let v=0;v<p;v++){let x=ig(v,g,m);for(let C=0;C<g;C++)x[C]<u[C]?x[C]=u[C]*2-x[C]-c:x[C]>=l[C]&&(x[C]=(l[C]-1)*2-x[C]+c);x=x.map((C,$)=>C-u[$]);const w=pa(x,h,d);y[v]=f[w]}return{dataId:n.write(y,a,i.dtype),shape:a,dtype:i.dtype}}const vFt={kernelName:pw,backendName:"cpu",kernelFunc:xFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wFt=Nn((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),$Ft=Xn(C1,wFt),CFt={kernelName:C1,backendName:"cpu",kernelFunc:$Ft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yve(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,o=i.shape.length;let a=s;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const u=it([a],i.shape),l=Xve({inputs:{x:i},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=Tn(l.shape,u),f=Qt({inputs:{x:l},backend:n,attrs:{shape:c}}),h=uV({inputs:{a:i,b:f},backend:n}),d=Qxe({inputs:{x:h},backend:n}),p=wC({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),g=Qt({inputs:{x:p},backend:n,attrs:{shape:c}}),m=cV({inputs:{a:d,b:g},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const SFt={kernelName:Nw,backendName:"cpu",kernelFunc:Yve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kFt(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:o,normalized:a}=r;Te(i,"multinomial");const u=a?i:Yve({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],f=n.data.get(u.dataId).values,h=[l,s],d=Sr(Z(h),"int32");for(let p=0;p<l;++p){const g=p*c,m=new Float32Array(c-1);m[0]=f[g];for(let v=1;v<m.length;++v)m[v]=m[v-1]+f[g+v];const y=eI.alea(o.toString()),b=p*s;for(let v=0;v<s;++v){const x=y();d[b+v]=m.length;for(let w=0;w<m.length;w++)if(x<m[w]){d[b+v]=w;break}}}return a||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",d)}const EFt={kernelName:fT,backendName:"cpu",kernelFunc:kFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AFt=hI;function _Ft(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r;Te(i,"NonMaxSuppression");const l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,{selectedIndices:f}=AFt(l,c,o,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const TFt={kernelName:hT,backendName:"cpu",kernelFunc:_Ft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IFt=dI;function DFt(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r;Te(i,"NonMaxSuppressionPadded");const c=n.data.get(i.dataId).values,f=n.data.get(s.dataId).values,{selectedIndices:h,validOutputs:d}=IFt(c,f,o,a,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const NFt={kernelName:dT,backendName:"cpu",kernelFunc:DFt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FFt=pI;function OFt(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r;Te(i,"NonMaxSuppressionWithScore");const c=n.data.get(i.dataId).values,f=n.data.get(s.dataId).values,h=o,d=a,p=u,g=l,{selectedIndices:m,selectedScores:y}=FFt(c,f,h,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const RFt={kernelName:pT,backendName:"cpu",kernelFunc:OFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MFt(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:o,onValue:a,offValue:u}=r;Te(i,"oneHot");const l=Z(i.shape),c=new Float32Array(l*o);c.fill(u);const f=n.data.get(i.dataId).values;for(let h=0;h<l;++h)f[h]>=0&&f[h]<o&&(c[h*o+f[h]]=a);return n.makeTensorInfo([...i.shape,o],s,c)}const LFt={kernelName:bw,backendName:"cpu",kernelFunc:MFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const i=Jp({inputs:{input:r},backend:n}),s=S_({inputs:{x:i},backend:n}),o=G0({inputs:{input:r},backend:n}),a=S_({inputs:{x:o},backend:n}),u=ls({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return fV({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const PFt={kernelName:Mw,backendName:"cpu",kernelFunc:S_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kve(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const i=Jp({inputs:{input:r},backend:n}),s=Kve({inputs:{x:i},backend:n}),o=G0({inputs:{input:r},backend:n}),a=S_({inputs:{x:o},backend:n}),u=ls({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return fV({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const BFt={kernelName:yw,backendName:"cpu",kernelFunc:Kve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zve(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(t.length===1)return C_({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const s=t[0].shape,o=t[0].dtype;t.forEach(c=>{Ar(s,c.shape,"All tensors passed to stack must have matching shapes"),D(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const f=C_({inputs:{input:c},backend:n,attrs:{dim:i}});return a.push(f),f}),l=H0({inputs:u,backend:n,attrs:{axis:i}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),l}const zFt={kernelName:xw,backendName:"cpu",kernelFunc:Zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UFt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:o}=r;Te(i,"pad");const a=s.map((b,v)=>b[0]+i.shape[v]+b[1]),u=s.map(b=>b[0]),l=n.data.get(i.dataId).values,c=Z(i.shape),f=i.shape.length,h=Re(i.shape),d=Z(a),p=a.length,g=Re(a),m=sr(i.dtype,d);o!==0&&m.fill(o);for(let b=0;b<c;b++){const x=ig(b,f,h).map((C,$)=>C+u[$]),w=pa(x,p,g);m[w]=l[b]}return{dataId:n.write(m,a,i.dtype),shape:a,dtype:i.dtype}}const Jve={kernelName:vw,backendName:"cpu",kernelFunc:UFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jFt=Nn((e,t)=>Math.pow(e,t)),WFt=Xn(k1,jFt),VFt={kernelName:k1,backendName:"cpu",kernelFunc:WFt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GFt(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=t,a=i.map(m=>n.data.get(m.dataId).values),u=i.map(m=>m.shape),l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values,[f,h,d]=yve(a,u,l,s.shape,s.dtype,c,o.shape),p=f.map(m=>n.makeTensorInfo([m.length],"int32",m)),g=n.makeTensorInfo(d,s.dtype,h);return p.concat([g])}const HFt={kernelName:gT,backendName:"cpu",kernelFunc:GFt};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qFt(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=bve(o,r.shape,r.dtype,a,i.shape,u,s.shape),f=n.makeTensorInfo([l.length],"int32",l),h=n.makeTensorInfo([c.length],r.dtype,c);return[f,h]}const XFt={kernelName:mT,backendName:"cpu",kernelFunc:qFt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YFt(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=r,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,f=n.data.get(o.dataId).values,h=a.map(m=>n.data.get(m.dataId).values),d=a.map(m=>m.shape),[p,g]=xve(l,i.shape,c,s.shape,s.dtype,f,o.shape,h,d,u);return n.makeTensorInfo(p,s.dtype,g)}const KFt={kernelName:yT,backendName:"cpu",kernelFunc:YFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZFt(e){const{backend:t,attrs:n}=e,{start:r,stop:i,dtype:s,step:o}=n,a=vve(r,i,o,s);return t.makeTensorInfo([a.length],s,a)}const JFt={kernelName:bT,backendName:"cpu",kernelFunc:ZFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QFt=Bt(E1,e=>1/e),e3t={kernelName:E1,backendName:"cpu",kernelFunc:QFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t3t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r;Te(i,"resizeBilinear");const u=Re(i.shape),[l,c]=a,[f,h,d,p]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(Z([f,l,c,p])),y=[s&&l>1?h-1:h,s&&c>1?d-1:d],b=[s&&l>1?l-1:l,s&&c>1?c-1:c];let v=0;const x=y[0]/b[0],w=y[1]/b[1];for(let C=0;C<f;C++)for(let $=0;$<l;$++){let S;o?S=x*($+.5)-.5:S=x*$;const k=Math.max(0,Math.floor(S)),E=S-k,A=Math.min(h-1,Math.ceil(S)),F=C*u[0]+k*u[1],_=C*u[0]+A*u[1];for(let I=0;I<c;I++){let T;o?T=w*(I+.5)-.5:T=w*I;const O=Math.max(0,Math.floor(T)),L=T-O,M=Math.min(d-1,Math.ceil(T)),P=F+O*u[2],G=_+O*u[2],H=F+M*u[2],Q=_+M*u[2];for(let te=0;te<p;te++){const ne=g[P+te],oe=g[G+te],he=g[H+te],we=g[Q+te],Ae=ne+(he-ne)*L,B=oe+(we-oe)*L,Y=Ae+(B-Ae)*E;m[v++]=Y}}}return n.makeTensorInfo([f,l,c,p],"float32",m)}const n3t={kernelName:kw,backendName:"cpu",kernelFunc:t3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r3t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r;Te([s,i],"resizeBilinearGrad");const a=Re(i.shape),[u,l,c,f]=i.shape,[,h,d]=s.shape,p=new Float32Array(u*l*c*f),g=[o&&h>1?l-1:l,o&&d>1?c-1:c],m=[o&&h>1?h-1:h,o&&d>1?d-1:d],y=g[0]/m[0],b=g[1]/m[1],v=n.data.get(s.dataId).values;let x=0;for(let w=0;w<u;w++){const C=w*a[0];for(let $=0;$<h;$++){const S=$*y,k=Math.floor(S),E=Math.min(Math.ceil(S),l-1),A=C+k*a[1],F=C+E*a[1],_=S-k,I=1-_;for(let T=0;T<d;T++){const O=T*b,L=Math.floor(O),M=Math.min(Math.ceil(O),c-1),P=O-L,G=1-P,H=A+L*a[2],Q=A+M*a[2],te=F+L*a[2],ne=F+M*a[2],oe=I*G,he=I*P,we=_*G,Ae=_*P;for(let B=0;B<f;B++){const Y=v[x++];p[H+B]+=Y*oe,p[Q+B]+=Y*he,p[te+B]+=Y*we,p[ne+B]+=Y*Ae}}}}return n.makeTensorInfo([u,c,l,f],"float32",p)}const i3t={kernelName:wT,backendName:"cpu",kernelFunc:r3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s3t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r;Te(i,"resizeNearestNeighbor");const u=Re(i.shape),[l,c]=a,[f,h,d,p]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(f*l*c*p),y=[s&&l>1?h-1:h,s&&c>1?d-1:d],b=[s&&l>1?l-1:l,s&&c>1?c-1:c],v=y[0]/b[0],x=y[1]/b[1];let w=0;for(let C=0;C<f;C++){const $=C*u[0];for(let S=0;S<l;S++){const k=o?v*(S+.5):v*S;let E=Math.min(h-1,s?Math.round(k):Math.floor(k));o&&(E=Math.max(0,E));const A=$+E*u[1];for(let F=0;F<c;F++){const _=o?x*(F+.5):x*F;let I=Math.min(d-1,s?Math.round(_):Math.floor(_));o&&(I=Math.max(0,I));const T=A+I*u[2];for(let O=0;O<p;O++){const L=g[T+O];m[w++]=L}}}}return n.makeTensorInfo([f,l,c,p],i.dtype,m)}const o3t={kernelName:Sw,backendName:"cpu",kernelFunc:s3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a3t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r;Te([s,i],"resizeNearestNeighborGrad");const a=Re(i.shape),u=Re(s.shape),[l,c,f,h]=i.shape,[,d,p]=s.shape,g=new Float32Array(l*c*f*h),m=n.data.get(s.dataId).values,y=[o&&d>1?c-1:c,o&&p>1?f-1:f],b=[o&&d>1?d-1:d,o&&p>1?p-1:p],v=y[0]/b[0],x=y[1]/b[1],w=1/v,C=1/x,$=Math.ceil(w)*2+2,S=Math.ceil(C)*2+2;for(let k=0;k<l;k++){const E=k*a[0];for(let A=0;A<c;A++){const F=E+A*a[1],_=Math.floor(A*w),I=Math.floor(_-$/2);for(let T=0;T<f;T++){const O=F+T*a[2],L=Math.floor(T*C),M=Math.floor(L-S/2);for(let P=0;P<h;P++){let G=0;for(let H=0;H<$;H++){const Q=H+I;if(Q<0||Q>=d)continue;const te=E+Q*u[1],ne=Q*v,oe=Math.min(c-1,o?Math.round(ne):Math.floor(ne));if(A===oe)for(let he=0;he<S;he++){const we=he+M;if(we<0||we>=p)continue;const Ae=te+we*u[2],B=we*x,Y=Math.min(f-1,o?Math.round(B):Math.floor(B));T===Y&&(G+=m[Ae+P])}}g[O+P]=G}}}}return n.makeTensorInfo(i.shape,i.dtype,g)}const u3t={kernelName:vT,backendName:"cpu",kernelFunc:a3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l3t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r;Te(i,"reverse");const o=i.shape.length,a=it(s,i.shape);if(o===0)return Uu({inputs:{x:i},backend:n});const u=new Rn(i.shape,i.dtype),l=n.bufferSync(i);for(let c=0;c<u.size;c++){const f=u.indexToLoc(c),h=f.slice();a.forEach(d=>h[d]=i.shape[d]-1-h[d]),u.set(l.get(...h),...f)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}const c3t={kernelName:Ew,backendName:"cpu",kernelFunc:l3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f3t={kernelName:PT,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:s,center:o}=t,a=n,u=sr(r.dtype,Z(r.shape)),[l,c,f,h]=r.shape,[d,p]=$5(o,c,f),g=255,m=Math.sin(i),y=Math.cos(i),b=a.data.get(r.dataId).values;for(let x=0;x<l;x++){const w=x*f*c*h;for(let C=0;C<c;C++){const $=C*(f*h);for(let S=0;S<f;S++){const k=S*h;for(let E=0;E<h;E++){const A=[l,C,S,E],F=A[2],_=A[1];let I=(F-d)*y-(_-p)*m,T=(F-d)*m+(_-p)*y;I=Math.round(I+d),T=Math.round(T+p);let O=s;if(typeof s!="number"&&(E===3?O=g:O=s[E]),I>=0&&I<f&&T>=0&&T<c){const M=T*(f*h),P=I*h,G=w+M+P+E;O=b[G]}const L=w+$+k+E;u[L]=O}}}}return{dataId:a.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h3t=Bt(T1,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),d3t={kernelName:T1,backendName:"cpu",kernelFunc:h3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p3t(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:s}=t,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=Eh(s,i,o),h=!0,d=n.bufferSync(i),p=n.bufferSync(s),g=Hd(d,p,o,f,l,u,a,c,0,h);return n.makeTensorInfo(o,g.dtype,g.values)}const g3t={kernelName:$T,backendName:"cpu",kernelFunc:p3t};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3t(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<t?n=i+1:r=i;return r}function y3t(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<=t?n=i+1:r=i;return r}function b3t(e,t,n,r,i,s){const o=$n("int32",n*i);for(let a=0;a<n;++a){const u=e.slice(a*r,(a+1)*r),l=a*i;for(let c=0;c<i;++c)o[l+c]=s==="left"?m3t(u,t[c+l]):y3t(u,t[c+l])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x3t(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:o}=r,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,l=b3t(a,u,i.shape[0],i.shape[1],s.shape[1],o);return n.makeTensorInfo(s.shape,"int32",l)}const v3t={kernelName:ST,backendName:"cpu",kernelFunc:x3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w3t(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t;Te([r,i,s],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=Bi(i.dtype,s.dtype),f=Sr(Z(i.shape),c);let h=0;const d=o===0||o>1||i.shape.length===1?1:Z(i.shape.slice(1));for(let p=0;p<a.length;p++)for(let g=0;g<d;g++)a[p]===1?f[h++]=u[p]:f[h++]=l[p];return n.makeTensorInfo(i.shape,c,f)}const $3t={kernelName:Aw,backendName:"cpu",kernelFunc:w3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C3t=xI,S3t=vI,k3t=Bt(D1,e=>e>=0?S3t*e:C3t*(Math.exp(e)-1)),E3t={kernelName:D1,backendName:"cpu",kernelFunc:k3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A3t=Bt(O1,e=>e<0?-1:e>0?1:0),_3t={kernelName:O1,backendName:"cpu",kernelFunc:A3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3t=Bt(N1,e=>Math.sin(e)),I3t={kernelName:N1,backendName:"cpu",kernelFunc:T3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D3t=Bt(F1,e=>Math.sinh(e)),N3t={kernelName:F1,backendName:"cpu",kernelFunc:D3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3t=11920928955078125e-23,zQ=Math.log(F3t)+2,O3t=Bt(M1,e=>{const t=e>-zQ,n=e<zQ,r=Math.exp(e);let i;return n?i=r:t?i=e:i=Math.log(1+r),i}),R3t={kernelName:M1,backendName:"cpu",kernelFunc:O3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M3t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:o}=r;Te([i],"spaceToBatchND");const a=Z(s),u=[[0,0]];u.push(...o);for(let C=1+s.length;C<i.shape.length;++C)u.push([0,0]);const l=Jve.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),c=Hw(l.shape,s,a,!1),f=qw(c.length,s.length,!1),h=Xw(l.shape,s,a,!1),g=Qt({inputs:{x:l},backend:n,attrs:{shape:c}}),b=Hi({inputs:{x:g},backend:n,attrs:{perm:f}}),w=Qt({inputs:{x:b},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),w}const L3t={kernelName:Iw,backendName:"cpu",kernelFunc:M3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P3t(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values[0],[f,h,d,p,g]=Sve(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}const B3t={kernelName:kT,backendName:"cpu",kernelFunc:P3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z3t(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(r.dataId).values,u=Array.from(n.data.get(s.dataId).values),[l,c,f]=kve(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([f.length],s.dtype,new Int32Array(f))]}const U3t={kernelName:ET,backendName:"cpu",kernelFunc:z3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j3t(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=aV(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}const W3t={kernelName:AT,backendName:"cpu",kernelFunc:j3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V3t(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=aV(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}const G3t={kernelName:_T,backendName:"cpu",kernelFunc:V3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H3t(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:s,defaultValue:o}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:f,outputSize:h}=Eh(s,i,a),d=!1,p=n.bufferSync(i);let g;switch(s.dtype){case"bool":{const m=n.bufferSync(s),y=!!n.data.get(o.dataId).values[0];g=Hd(p,m,a,h,c,l,u,f,y,d);break}case"float32":{const m=n.bufferSync(s),y=n.data.get(o.dataId).values[0];g=Hd(p,m,a,h,c,l,u,f,y,d);break}case"int32":{const m=n.bufferSync(s),y=n.data.get(o.dataId).values[0];g=Hd(p,m,a,h,c,l,u,f,y,d);break}case"string":{const m=n.bufferSync(s),y=tc(n.data.get(o.dataId).values[0]);g=Hd(p,m,a,h,c,l,u,f,y,d);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(a,g.dtype,g.values)}const q3t={kernelName:TT,backendName:"cpu",kernelFunc:H3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X3t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:o}=r,a=it(o,i.shape)[0],u=L5(i,s,a),l=new Array(i.shape.length).fill(0),c=i.shape.slice();return u.map(f=>{const h=[...c];h[a]=f;const d=Qp({inputs:{x:i},backend:n,attrs:{begin:l,size:h}});return l[a]+=f,d})}const Y3t={kernelName:Dw,backendName:"cpu",kernelFunc:X3t};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K3t={kernelName:IT,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,r=t;Te(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let a=0;a<i.length;++a){const u=i[a];s[a]=u*u}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z3t=Bt(W1,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),J3t={kernelName:W1,backendName:"cpu",kernelFunc:Z3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q3t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:f,shrinkAxisMask:h}=r;Te(i,"stridedSlice");const{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:x}=b5(i.shape,s,o,a,u,l,c,f,h);let w;if(g)w=Qt({inputs:{x:i},backend:n,attrs:{shape:p}});else if(m||y){D(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const C=g5(b,v,x),$=Qp({inputs:{x:i},backend:n,attrs:{begin:b,size:C}});w=Qt({inputs:{x:$},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo($)}else{const C=n.bufferSync(i),$=_ve(d,C,x,b);w=n.makeTensorInfo(p,$.dtype,$.values)}return w}const eOt={kernelName:DT,backendName:"cpu",kernelFunc:Q3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tOt(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:f}=t,h=n.data.get(c.dataId).values,d=n.data.get(f.dataId).values,[p,g]=Tve(h,d,i,s,o,a,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",g)]}const nOt={kernelName:NT,backendName:"cpu",kernelFunc:tOt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rOt(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[l,c,f]=Ive(a,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const iOt={kernelName:FT,backendName:"cpu",kernelFunc:rOt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sOt(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(s.dataId).values,a=Dve(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const oOt={kernelName:OT,backendName:"cpu",kernelFunc:sOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aOt=Bt(z1,e=>Math.tan(e)),uOt={kernelName:z1,backendName:"cpu",kernelFunc:aOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lOt=Bt(U1,e=>Math.tanh(e)),cOt={kernelName:U1,backendName:"cpu",kernelFunc:lOt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fOt(e){const{inputs:t,backend:n}=e,{tensor:r,indices:i,updates:s}=t,{sliceRank:o,numUpdates:a,sliceSize:u,strides:l,outputSize:c}=Eh(s,i,r.shape),f=!1,h=n.bufferSync(i),d=n.bufferSync(s),p=n.bufferSync(r),g=Hd(h,d,r.shape,c,u,a,o,l,p,f);return n.makeTensorInfo(r.shape,g.dtype,g.values)}const hOt={kernelName:CT,backendName:"cpu",kernelFunc:fOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dOt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;Te(i,"tile");const o=Fve(n.bufferSync(i),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const pOt={kernelName:j1,backendName:"cpu",kernelFunc:dOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gOt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:o}=r;Te(i,"topk");const a=n.data.get(i.dataId).values,[u,l]=Rve(a,i.shape,i.dtype,s,o);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}const mOt={kernelName:RT,backendName:"cpu",kernelFunc:gOt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yOt(e){const{inputs:t,attrs:n,backend:r}=e,{image:i,transforms:s}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=n,[c,f,h,d]=i.shape,[p,g]=l??[f,h],m=[c,p,g,d],y=Re(i.shape),b=y[0],v=y[1],x=y[2],w=Re(m),C=w[0],$=w[1],S=w[2],k=sr(i.dtype,Z(m));k.fill(u);const E=r.data.get(i.dataId).values,A=r.data.get(s.dataId).values;for(let _=0;_<c;++_){const I=s.shape[0]===1?A:A.subarray(_*8,_*8+8);for(let T=0;T<p;++T)for(let O=0;O<g;++O)for(let L=0;L<d;++L){let M;const P=I[6]*O+I[7]*T+1;if(P===0)continue;const G=(I[0]*O+I[1]*T+I[2])/P,H=(I[3]*O+I[4]*T+I[5])/P,Q=UQ(G,h,a),te=UQ(H,f,a);switch(o){case"nearest":M=COt(E,f,h,b,v,x,_,te,Q,L,u);break;case"bilinear":M=SOt(E,f,h,b,v,x,_,te,Q,L,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ne=_*C+T*$+O*S+L;k[ne]=M}return r.makeTensorInfo(m,i.dtype,k)}return{dataId:r.write(k,m,i.dtype),shape:i.shape,dtype:i.dtype}}const bOt={kernelName:MT,backendName:"cpu",kernelFunc:yOt};function UQ(e,t,n){switch(n){case"reflect":return xOt(e,t);case"wrap":return vOt(e,t);case"nearest":return $Ot(e,t);case"constant":default:return wOt(e)}}function xOt(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{const r=2*t;n-=r*Math.trunc(n/r),n>=t&&(n=r-n-1)}return _f(0,n,t-1)}function vOt(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{const r=t-1;n-=t*Math.trunc(n/r)}return _f(0,n,t-1)}function wOt(e,t){return e}function $Ot(e,t){return _f(0,e,t-1)}function fx(e,t,n,r,i,s,o,a,u,l,c){const f=o*r+a*i+u*s+l;return 0<=a&&a<t&&0<=u&&u<n?e[f]:c}function COt(e,t,n,r,i,s,o,a,u,l,c){const f=Math.round(a),h=Math.round(u);return fx(e,t,n,r,i,s,o,f,h,l,c)}function SOt(e,t,n,r,i,s,o,a,u,l,c){const f=Math.floor(a),h=Math.floor(u),d=f+1,p=h+1,g=(p-u)*fx(e,t,n,r,i,s,o,f,h,l,c)+(u-h)*fx(e,t,n,r,i,s,o,f,p,l,c),m=(p-u)*fx(e,t,n,r,i,s,o,d,h,l,c)+(u-h)*fx(e,t,n,r,i,s,o,d,p,l,c);return(d-a)*g+(a-f)*m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kOt(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;Te(s,"unique");const o=r.data.get(s.dataId).values,{outputValues:a,outputShape:u,indices:l}=Mve(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}const EOt={kernelName:LT,backendName:"cpu",kernelFunc:kOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AOt(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i.shape.length,a=i.shape[s],u=new Array(o-1);let l=0;for(let d=0;d<o;d++)d!==s&&(u[l++]=i.shape[d]);const c=new Array(o).fill(0),f=i.shape.slice();f[s]=1;const h=new Array(a);for(let d=0;d<h.length;d++){c[s]=d;const p=Qp({inputs:{x:i},backend:n,attrs:{begin:c,size:f}});h[d]=Qt({inputs:{x:p},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(p)}return h}const _Ot={kernelName:Ow,backendName:"cpu",kernelFunc:AOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TOt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:o}=r;Te(i,"unsortedSegmentSum");const a=i.shape.length,u=s.shape.length,l=[],c=[],f=a-u;let h=s;for(let p=0;p<f;++p){const g=C_({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=g,c.push(g)}for(let p=0;p<o;++p){const g=dc(p,"int32"),m=n.makeTensorInfo([],"int32",g),y=Zxe({inputs:{a:m,b:h},backend:n}),b=xh({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),v=XF({inputs:{a:b,b:i},backend:n}),x=wC({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});l.push(x),c.push(m),c.push(y),c.push(b),c.push(v),c.push(x)}const d=Zve({inputs:l,backend:n,attrs:{axis:0}});return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const IOt={kernelName:Rw,backendName:"cpu",kernelFunc:TOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DOt=[kIt,sTt,AIt,TIt,fTt,DIt,FIt,RIt,LIt,BIt,UIt,WIt,GIt,XIt,KIt,QIt,tDt,rDt,sDt,CIt,aDt,lDt,fDt,dTt,dDt,lTt,gTt,gDt,oTt,yDt,xDt,vDt,$Dt,SDt,EDt,_Dt,IDt,NDt,ODt,MDt,PDt,zDt,jDt,VDt,GDt,qDt,YDt,ZDt,JDt,QDt,eNt,nNt,sNt,mIt,aNt,mTt,gNt,yTt,mNt,xTt,$Nt,CNt,kNt,wTt,CTt,ANt,TNt,DNt,FNt,kTt,ATt,aTt,RNt,bDt,LNt,BNt,UNt,yIt,TTt,DTt,WNt,FTt,GNt,XNt,KNt,QNt,tFt,rFt,iFt,RTt,oFt,uFt,cFt,hFt,pFt,mFt,bFt,LTt,vFt,CFt,EFt,BTt,UTt,TFt,NFt,RFt,WTt,LFt,BFt,zFt,Jve,VFt,xIt,HTt,HFt,XFt,KFt,JFt,uTt,KP,e3t,vIt,wIt,$It,n3t,i3t,o3t,u3t,c3t,f3t,d3t,eIt,g3t,v3t,$3t,E3t,nIt,_3t,I3t,N3t,rIt,SFt,R3t,L3t,B3t,U3t,W3t,G3t,q3t,Y3t,oIt,K3t,uIt,cIt,J3t,eOt,nOt,iOt,oOt,pIt,rNt,uOt,cOt,hOt,pOt,mOt,bOt,VTt,EOt,_Ot,IOt,PFt];for(const e of DOt)BT(e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fd={},PS={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function NOt(e,t){Fd[e]=t}function _a(e,t){if(!(e in Fd)||t!=null){const r=OOt(e,t);if(r!==null)Fd[e]=r;else return console.log("Could not get context for WebGL version",e),null}const n=Fd[e];return n==null||n.isContextLost()?(delete Fd[e],_a(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Fd[e])}function FOt(e){if(!q().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function OOt(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=t??FOt(e);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete Fd[e]},!1),q().getBool("SOFTWARE_WEBGL_ENABLED")&&(PS.failIfMajorPerformanceCaveat=!1),e===1?n.getContext("webgl",PS)||n.getContext("experimental-webgl",PS):n.getContext("webgl2",PS)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var T2;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(T2||(T2={}));var Ws;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(Ws||(Ws={}));var mr;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(mr||(mr={}));function $C(e,t){return[t,e]}function ROt(e,t){return e*t}function BS(e){const t=Z(e),n=Math.ceil(t/4);return Nk(n)}function Ly(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function MOt(e,t){const[n,r]=Ly(e,t);return n*r*4}function hV(e,t){const n=e;let r,i,s,o,a,u,l,c,f,h;return q().getNumber("WEBGL_VERSION")===2?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,l=4,c=1,f=n.HALF_FLOAT,h=n.FLOAT,u=n.RGBA8):(r=e.RGBA,i=e.RGBA,s=e.RGBA,o=n.RGBA,a=e.RGBA,l=4,c=4,f=t!=null?t.HALF_FLOAT_OES:null,h=e.FLOAT,u=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:f,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $e(e,t){const n=t();return q().getBool("DEBUG")&&LOt(e),n}function LOt(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+UOt(e,t))}const POt=596e-10,BOt=65504;function zOt(e){return!!(q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||POt<Math.abs(e)&&Math.abs(e)<BOt)}function UOt(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function zS(e,t){return Dc(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function jOt(e,t){const n=Dc(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if($e(e,()=>e.shaderSource(n,t)),$e(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function WOt(e,t){const n=Dc(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if($e(e,()=>e.shaderSource(n,t)),$e(e,()=>e.compileShader(n)),q().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw Qve(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const VOt=/ERROR: [0-9]+:([0-9]+):/g;function Qve(e,t){const n=VOt.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}const r=+n[1],i=e.split(`
`),s=i.length.toString().length+2,o=i.map((f,h)=>qd((h+1).toString(),s)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const u=o.slice(0,r-1),l=o.slice(r-1,r),c=o.slice(r);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${qd(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function GOt(e){return Dc(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function HOt(e,t){if($e(e,()=>e.linkProgram(t)),!q().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function RR(e,t){if($e(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function qOt(e,t){const n=Dc(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return $e(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),$e(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function XOt(e,t){const n=Dc(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return $e(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),$e(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function YOt(e){return Dc(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function KOt(e,t){const n=q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const r=`[${e}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){const r=`[${e}x${t}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+i+".")}}function ZOt(e){return Dc(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function jQ(e,t,n,r,i,s,o){const a=e.getAttribLocation(t,n);return a===-1?!1:($e(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),$e(e,()=>e.vertexAttribPointer(a,i,e.FLOAT,!1,s,o)),$e(e,()=>e.enableVertexAttribArray(a)),!0)}function JOt(e,t,n){rRt(e,n),$e(e,()=>e.activeTexture(e.TEXTURE0+n)),$e(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function QOt(e,t,n){return Dc(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function eRt(e,t,n){return e.getUniformLocation(t,n)}function tRt(e,t,n,r){$e(e,()=>JOt(e,t,r)),$e(e,()=>e.uniform1i(n,r))}function MR(e,t,n){$e(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),$e(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function WQ(e,t){$e(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),$e(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function US(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+nRt(e,t))}function nRt(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function Dc(e,t,n){const r=$e(e,()=>t());if(r==null)throw new Error(n);return r}function rRt(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function q0(e,t=2){return Z(e.slice(0,e.length-t))}function X0(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function jS(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[q0(e),...X0(e)]),t}function iRt(e,t=!1){let n=q().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=q().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&q().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n=n*2,r=r*2,e=e.map((a,u)=>u>=e.length-2?D_(e[u]):e[u]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=hc(e).newShape);let i=Z(e),s=null;e.length<=1&&i<=n?s=[1,i]:e.length===2&&e[0]<=n&&e[1]<=n?s=e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);const o=s!=null&&Math.max(...s)>r&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(s==null||o)if(t){const a=q0(e);let u=2,l=2;e.length&&([u,l]=X0(e)),i=a*(u/2)*(l/2),s=Nk(i).map(c=>c*2)}else s=Nk(i);return s}function WS(e){return e%2===0}function k_(e,t){if(e=e.slice(-2),t=t.slice(-2),gt(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r||WS(n)&&WS(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&WS(e[0])&&WS(t[0])}let LR,PR;function sRt(e){if(LR==null){const t=_a(e);LR=t.getParameter(t.MAX_TEXTURE_SIZE)}return LR}function oRt(e){if(PR==null){const t=_a(e);PR=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,PR)}function aRt(e){if(e===0)return 0;let t;const n=_a(e);return wo(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:wo(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function wo(e,t){return e.getExtension(t)!=null}function VQ(e){try{if(_a(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function uRt(e){if(e===0)return!1;const t=_a(e);if(e===1){if(!wo(t,"OES_texture_float"))return!1}else if(!wo(t,"EXT_color_buffer_float"))return!1;return JP(t)}function lRt(e){if(e===0)return!1;const t=_a(e);if(e===1){if(!wo(t,"OES_texture_float")||!wo(t,"WEBGL_color_buffer_float"))return!1}else{if(wo(t,"EXT_color_buffer_float"))return JP(t);const r="EXT_color_buffer_half_float";if(wo(t,r)){const i=t.getExtension(r);return cRt(t,i)}return!1}return JP(t)}function JP(e){const t=hV(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(s),o}function cRt(e,t){const n=hV(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}function fRt(e){return e!==2?!1:_a(e).fenceSync!=null}function CC(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&D(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ie=q();Ie.registerFlag("HAS_WEBGL",()=>Ie.getNumber("WEBGL_VERSION")>0);Ie.registerFlag("WEBGL_VERSION",()=>VQ(2)?2:VQ(1)?1:0);Ie.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ie.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ie.get("WEBGL_VERSION")===2);Ie.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ie.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ie.registerFlag("WEBGL_PACK",()=>Ie.getBool("HAS_WEBGL"));Ie.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_CLIP",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_REDUCE",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_CONV_IM2COL",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ie.getBool("WEBGL_PACK"));Ie.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>sRt(Ie.getNumber("WEBGL_VERSION")));Ie.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>oRt(Ie.getNumber("WEBGL_VERSION")));Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=Ie.getNumber("WEBGL_VERSION");return e===0?0:aRt(e)});Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ie.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!gB());Ie.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>uRt(Ie.getNumber("WEBGL_VERSION")));Ie.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ie.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ie.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ie.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>lRt(Ie.getNumber("WEBGL_VERSION")));Ie.registerFlag("WEBGL_FENCE_API_ENABLED",()=>fRt(Ie.getNumber("WEBGL_VERSION")));Ie.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ie.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ie.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});Ie.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>gB()?1:-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});Ie.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ie.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ie.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ie.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ie.registerFlag("WEBGL_EXP_CONV",()=>!1);Ie.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ie.getBool("IS_TEST"));Ie.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ie.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ie.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ie.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ki(){let e,t,n,r,i,s,o,a,u,l;return q().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=q().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qg(e,t,n="index"){const r=Re(t);return r.map((i,s)=>{const o=`int ${e[s]} = ${n} / ${i}`,a=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * ${i}`:`index -= ${e[s]} * ${i}`;return`${o}; ${a};`}).join("")}function YF(e,t,n="index"){const r=Re(t);return r.map((i,s)=>{const o=`int ${e[s]} = ${n} / outShapeStrides[${s}]`,a=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * outShapeStrides[${s}]`:`index -= ${e[s]} * outShapeStrides[${s}]`;return`${o}; ${a};`}).join("")}function hRt(e,t){const n=e.length,r=e.map(s=>`${t}[${s}]`),i=new Array(n-1);i[n-2]=r[n-1];for(let s=n-3;s>=0;--s)i[s]=`(${i[s+1]} * ${r[s+1]})`;return i}function dRt(e,t,n="index"){const r=e.map((s,o)=>o),i=hRt(r,t);return i.map((s,o)=>{const a=`int ${e[o]} = ${n} / ${i[o]}`,u=o===i.length-1?`int ${e[o+1]} = ${n} - ${e[o]} * ${i[o]}`:`index -= ${e[o]} * ${i[o]}`;return`${a}; ${u};`}).join("")}function dV(e){const t=Re(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function pV(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const e2e=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:t2e}=lre;function pRt(e,t,n){const r=[];if(e.forEach(d=>{const p=Z(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push(`uniform float ${d.name}${p>1?`[${p}]`:""};`):(r.push(`uniform sampler2D ${d.name};`),r.push(`uniform int offset${d.name};`)),n.enableShapeUniforms){const{uniformShape:g}=gV(n.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(g.length){case 1:r.push(`uniform int ${d.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${d.name}Shape;`);break}r.push(`uniform ivec2 ${d.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(d=>{r.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});const i=r.join(`
`),s=e.map(d=>gRt(d,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=t.texShape,a=ki(),u=bRt(a);let l,c,f=wRt(a);return t.isPacked?(l=mRt(t.logicalShape,o,n.enableShapeUniforms),c=vRt(a)):(l=yRt(t.logicalShape,o,n.enableShapeUniforms),c=xRt(a)),n.packedInputs&&(f+=kRt),[f,u,c,i,l,s,n.userCode].join(`
`)}function Py(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return LRt(e,t);case 1:return BRt(e,t);case 2:return URt(e,t);case 3:return WRt(e,t);case 4:return GRt(e,t);case 5:return HRt(e);case 6:return qRt(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function n2e(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return MRt(e);case 1:return PRt(e,t);case 2:return zRt(e,t);case 3:return jRt(e,t);default:return VRt(e,t)}}function gRt(e,t,n=!1,r){let i="";n?i+=n2e(e,r):i+=Py(e,r);const s=e.shapeInfo.logicalShape,o=t.logicalShape;return s.length<=o.length&&(n?i+=XRt(e,t):i+=YRt(e,t)),i}function mRt(e,t,n){switch(e.length){case 0:return r2e();case 1:return ERt(e,t,n);case 2:return ORt(e,t,n);case 3:return _Rt(e,t,n);default:return IRt(e,t,n)}}function yRt(e,t,n){switch(e.length){case 0:return r2e();case 1:return ARt(e,t,n);case 2:return RRt(e,t,n);case 3:return TRt(e,t,n);case 4:return DRt(e,t,n);case 5:return NRt(e,t);case 6:return FRt(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function bRt(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function xRt(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function vRt(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function wRt(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${$Rt}
    ${CRt}
    ${SRt}
  `}const $Rt=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,CRt=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SRt=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,kRt=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function r2e(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function ERt(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function ARt(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function _Rt(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[2]/2),s=i*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function TRt(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${YF(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;const r=qg(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function IRt(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[e.length-1]/2),s=i*Math.ceil(e[e.length-2]/2);let o=s,a="",u="b, r, c";for(let l=2;l<e.length-1;l++)o*=e[e.length-l-1],a=`
      int b${l} = index / ${o};
      index -= b${l} * ${o};
    `+a,u=`b${l}, `+u;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${e.length}(${u});
    }
  `}function DRt(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${YF(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;const r=qg(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function NRt(e,t){const n=qg(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function FRt(e,t){const n=qg(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function ORt(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(gt(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const i=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function RRt(e,t,n){return gt(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function Xg(e){return`offset${e}`}function MRt(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ki();return`
    vec4 ${n}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function LRt(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=e.shapeInfo.texShape;if(i===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=Xg(n);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,u]=e.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${u}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function PRt(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,s=ki();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function BRt(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${By(e)}
      }
    `;const i=e.shapeInfo.texShape,s=i[0],o=i[1];if(o===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Xg(n);return o===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function zRt(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=s[0],a=s[1],u=ki();if(s!=null&&gt(n,s))return t?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${u.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${u.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function URt(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(s!=null&&gt(n,s)){if(t)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const h=s[0],d=s[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=hc(n),u=o;if(u.length<n.length){const h=zy(e,u),d=["row","col"];return`
      ${Py(h,t)}
      float ${i}(int row, int col) {
        return ${i}(${Uy(d,a)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${By(e)}
      }
    `;const l=s[0],c=s[1],f=Xg(r);return c===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${r}, uv);
    }
  `:l===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${f};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function jRt(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){const h=n.slice(1),d=[1,2],p=zy(e,h),g=["b","row","col"];return`
        ${n2e(p,t)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${Uy(g,d)});
        }
      `}const a=ki();if(t)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const u=o[0],l=o[1],c=Math.ceil(n[2]/2),f=c*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${l}, ${f}, ${c}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function WRt(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:u}=hc(n),l=a;if(l.length<n.length){const g=zy(e,l),m=["row","col","depth"];return`
        ${Py(g,t)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${Uy(m,u)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${o}, 1)));
        ${By(e)}
      }
    `;const c=e.shapeInfo.texShape,f=c[0],h=c[1],d=e.shapeInfo.flatOffset;if(h===s&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${f}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(h===o&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `;const p=Xg(r);return t?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${f}, ${h}, index);
        return sampleTexture(${r}, uv);
      }
  `}function VRt(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=ki();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const s=e.shapeInfo.logicalShape,o=s.length,a=e.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=u[0],c=u[1],f=Math.ceil(s[o-1]/2);let h=f*Math.ceil(s[o-2]/2),d="int b, int row, int col",p=`b * ${h} + (row / 2) * ${f} + (col / 2)`;for(let g=2;g<o-1;g++)d=`int b${g}, `+d,h*=s[o-g-1],p=`b${g} * ${h} + `+p;return`
    vec4 ${r}(${d}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});
      return ${i.texture2D}(${n}, uv);
    }
  `}function GRt(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:u,keptDims:l}=hc(n);if(u.length<n.length){const b=zy(e,u),v=["row","col","depth","depth2"];return`
      ${Py(b,t)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${Uy(v,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${s}, 1)));
        ${By(e)}
      }
    `;const c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1],p=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,m=`int stride0 = ${r}Shape[1] * stride1;`;if(d===a&&c==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${p}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===s&&c==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;const y=Xg(r);return t?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${g}
      ${m}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${h}, ${d}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function HRt(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],s=t[3]*i,o=t[2]*s,a=t[1]*o,{newShape:u,keptDims:l}=hc(t);if(u.length<t.length){const g=zy(e,u),m=["row","col","depth","depth2","depth3"];return`
      ${Py(g)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Uy(m,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${s}, ${i})) +
          depth3;
        ${By(e)}
      }
    `;const c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1];if(d===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${s}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===i&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=Xg(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${s} +
          depth2 * ${i} + depth3 + ${p};
      vec2 uv = uvFromFlat(${h}, ${d}, index);
      return sampleTexture(${n}, uv);
    }
  `}function qRt(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=hc(t);if(i.length<t.length){const m=zy(e,i),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Py(m)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Uy(y,s)});
      }
    `}const o=t[5],a=t[4]*o,u=t[3]*a,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${u}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${By(e)}
      }
    `;const f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];if(p===c&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${u}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=Xg(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${u} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${g};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function By(e){const t=e.name,n=Z(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function XRt(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,a=t2e(e.shapeInfo.logicalShape,t.logicalShape),u=Vt(o),l=o-s;let c;const f=["x","y","z","w","u","v"];s===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(b=>`coords.${f[b+l]} = 0;`).join(`
`);let h="";o<2&&s>0?h="coords":h=e.shapeInfo.logicalShape.map((b,v)=>`coords.${f[v+l]}`).join(", ");let d="return outputValue;";const g=Z(e.shapeInfo.logicalShape)===1,y=Z(t.logicalShape)===1;if(s===1&&!g&&!y)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)o===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=s-2,v=s-1;a.indexOf(b)>-1&&a.indexOf(v)>-1?d="return vec4(outputValue.x);":a.indexOf(b)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${u} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${h});
      ${d}
    }
  `}function YRt(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.texShape,o=e.shapeInfo.texShape,a=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&a===u&&e.shapeInfo.flatOffset==null&&gt(o,s))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const l=Vt(u),c=t2e(e.shapeInfo.logicalShape,t.logicalShape),f=u-a;let h;const d=["x","y","z","w","u","v"];a===0?h="":u<2&&c.length>=1?h="coords = 0;":h=c.map(g=>`coords.${d[g+f]} = 0;`).join(`
`);let p="";return u<2&&a>0?p="coords":p=e.shapeInfo.logicalShape.map((g,m)=>`coords.${d[m+f]}`).join(", "),`
    float ${i}() {
      ${l} coords = getOutputCoords();
      ${h}
      return get${r}(${p});
    }
  `}function Vt(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function gV(e,t,n){const{newShape:r,keptDims:i}=hc(t),s=t.length,o=e&&s===3&&t[0]===1,a=o?t.slice(1):r,u=!e&&s>1&&!gt(t,n)&&r.length<s||o;return{useSqueezeShape:u,uniformShape:u?a:t,keptDims:i}}function zy(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Uy(e,t){return t.map(n=>e[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KRt(e,t,n,r){const i=n.map((c,f)=>{const h={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(h.flatOffset=c.texData.slice.flatOffset),{name:t.variableNames[f],shapeInfo:h}}),s=i.map(c=>c.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=pRt(i,o,t),u=WOt(e.gl,a),l=e.createProgram(u);return q().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(l),Object.assign({program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o},i2e(e,t,l)))}function i2e(e,t,n){const r=[],i=[];let s,o,a,u=null,l=null;l=e.getUniformLocation(n,"NAN",!1),q().getNumber("WEBGL_VERSION")===1&&(u=e.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const f of t.variableNames){const h={name:f,uniform:e.getUniformLocation(n,f,c),offset:e.getUniformLocation(n,`offset${f}`,c)};t.enableShapeUniforms&&(h.shape=e.getUniformLocation(n,`${f}Shape`,c),h.texShape=e.getUniformLocation(n,`${f}TexShape`,c)),r.push(h)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(n,"outShape",c),a=e.getUniformLocation(n,"outShapeStrides",c),o=e.getUniformLocation(n,"outTexShape",c)),t.customUniforms)for(const f of t.customUniforms)i.push(e.getUniformLocation(n,f.name,c));return{variablesLocations:r,customUniformLocations:i,infLoc:u,nanLoc:l,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}}function GQ(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,r)=>{const i=n.logicalShape,s=t[r],o=s.shape;if(!gt(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(n.isUniform&&s.isUniform)return;const a=n.texShape,u=s.isUniform?null:s.texData.texShape;if(!gt(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)})}function ZRt(e,t,n,r,i){t.program.enableShapeUniforms||(GQ(t.inShapeInfos,n),GQ([t.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):e.setOutputMatrixTexture(s.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),q().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<n.length;++u){const l=n[u],{uniform:c,offset:f,shape:h,texShape:d}=t.variablesLocations[u];if(h){const{uniformShape:p}=gV(t.program.packedInputs,l.shape,l.texData.texShape);switch(p.length){case 1:e.gl.uniform1iv(h,new Int32Array(p));break;case 2:e.gl.uniform2iv(h,new Int32Array(p));break;case 3:e.gl.uniform3iv(h,new Int32Array(p));break;case 4:e.gl.uniform4iv(h,new Int32Array(p));break}}if(d&&e.gl.uniform2i(d,l.texData.texShape[0],l.texData.texShape[1]),c!=null){if(l.isUniform){if(Z(l.shape)<2)e.gl.uniform1f(c,l.uniformValues[0]);else{let p=l.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),e.gl.uniform1fv(c,p)}continue}l.texData.slice!=null&&f!=null&&e.gl.uniform1i(f,l.texData.slice.flatOffset),e.setInputMatrixTexture(l.texData.texture.texture,c,u)}}const a=t.outShapeLocation;if(a)switch(r.shape.length){case 1:e.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(a,new Int32Array(r.shape));break}if(t.outShapeStridesLocation){const u=Re(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&i)for(let u=0;u<t.program.customUniforms.length;++u){const l=t.program.customUniforms[u],c=t.customUniformLocations[u],f=i[u];if(l.type==="float")e.gl.uniform1fv(c,f);else if(l.type==="vec2")e.gl.uniform2fv(c,f);else if(l.type==="vec3")e.gl.uniform3fv(c,f);else if(l.type==="vec4")e.gl.uniform4fv(c,f);else if(l.type==="int")e.gl.uniform1iv(c,f);else if(l.type==="ivec2")e.gl.uniform2iv(c,f);else if(l.type==="ivec3")e.gl.uniform3iv(c,f);else if(l.type==="ivec4")e.gl.uniform4iv(c,f);else throw Error(`uniform type ${l.type} is not supported yet.`)}e.executeProgram()}function JRt(e,t,n){let r="";t.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!o.isUniform){const u=o.texData.texShape,{useSqueezeShape:l,uniformShape:c,keptDims:f}=gV(e.packedInputs,o.shape,u);let h="",d="",p="";if(c.length===1&&e.packedInputs){const w=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];h=`${w[0]>1}_${w[1]>1}`}else if(c.length===2&&!e.packedInputs)d=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!e.packedInputs){const w=Re(c);p=`${w[0]===u[1]}_${w[w.length-1]===u[1]}`}const g=o.shape.length,m=c.length===2&&gt(o.shape,u),y=Z(o.shape)===1,b=yp(o.shape,n.shape),v=!e.packedInputs&&g===n.shape.length&&gt(u,n.texData.texShape),x=e.packedInputs||c.length>2?"":`${u[0]>1}_${u[1]>1}`;r+=`${g}_${v}_${l?f:""}_${c.length}_${y}_${b}_${m}_${h}_${d}_${p}_${x}_${a}`}else{const u=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${u}_${a}`}});const i=e.userCode;let s=e.constructor.name;return s+="_"+r+"_"+i+`${q().getNumber("WEBGL_VERSION")}`,s}function qr(e){return q().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QRt{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=T2.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ki();this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?YF(["r","c","d"],t):qg(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eMt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=T2.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ki();this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?YF(["r","c","d"],t):qg(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tMt{constructor(t){this.variableNames=["A"],this.outTexUsage=Ws.DOWNLOAD;const n=ki();this.outputShape=t,this.userCode=`
      ${e2e}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nMt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ws.DOWNLOAD;const n=ki();this.outputShape=t,this.userCode=`
      ${e2e}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rMt={R:0,G:1,B:2,A:3};class HQ{constructor(t,n=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=ki();this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length);let s="result";n&&(s="floor(result * 255. + 0.5)");let o="";for(let a=0;a<r.length;a++){const u=r[a];o+=`
          if(offset == ${a}) {
            result = values[${rMt[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?pV():dV(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${o}
        }
        ${i.output} = vec4(${s}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iMt{constructor(t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ki();this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length);let i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const u=o*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?pV():dV(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${r.output} = ${s};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sMt(e){const t=ki(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return jOt(e,n)}function oMt(e){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return qOt(e,t)}function aMt(e){const t=new Uint16Array([0,1,2,2,1,3]);return XOt(e,t)}function SC(e,t,n,r,i,s){KOt(t,n);const o=YOt(e),a=e.TEXTURE_2D;return $e(e,()=>e.bindTexture(a,o)),$e(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),$e(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),$e(e,()=>e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)),$e(e,()=>e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST)),q().getNumber("WEBGL_VERSION")===1?$e(e,()=>e.texImage2D(a,0,r,t,n,0,i,s,null)):$e(e,()=>e.texStorage2D(a,1,r,t,n)),$e(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:o,texShape:[n,t]}}function s2e(e){return e.internalFormatFloat}function uMt(e,t,n,r){const[i,s]=$C(t,n);return SC(e,i,s,s2e(r),r.textureFormatFloat,e.FLOAT)}function o2e(e){return e.internalFormatHalfFloat}function lMt(e,t,n,r){const[i,s]=$C(t,n);return SC(e,i,s,o2e(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function a2e(e){return e.downloadTextureFormat}function cMt(e,t,n,r){const[i,s]=$C(t,n);return SC(e,i,s,a2e(r),e.RGBA,e.UNSIGNED_BYTE)}function u2e(e){return e.internalFormatPackedFloat}function fMt(e,t,n,r){const[i,s]=Ly(t,n);return SC(e,i,s,u2e(r),e.RGBA,e.FLOAT)}function l2e(e){return e.internalFormatPackedHalfFloat}function hMt(e,t,n,r){const[i,s]=Ly(t,n);return SC(e,i,s,l2e(r),e.RGBA,r.textureTypeHalfFloat)}function dMt(e,t,n){return $e(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),jQ(e,t,"clipSpacePos",n,3,20,0)&&jQ(e,t,"uv",n,2,20,12)}function pMt(e,t,n,r,i,s){$e(e,()=>e.bindTexture(e.TEXTURE_2D,t));let o,a,u;i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),a=e.FLOAT,u=s.internalFormatPackedFloat),o.set(i),q().getNumber("WEBGL_VERSION")===2?$e(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,a,o)):$e(e,()=>e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,a,o)),$e(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function gMt(e,t,n){$e(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?q().getNumber("WEBGL_VERSION")===2?$e(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):$e(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):q().getNumber("WEBGL_VERSION")===2?$e(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):$e(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),$e(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function mMt(e,t,n,r){const i=e.createBuffer();$e(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const a=4*4*t*n;return $e(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),$e(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),$e(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}function yMt(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function bMt(e,t,n,r){const[i,s]=$C(t,n),o=4,a=new Uint8Array(ROt(t*n,o));return $e(e,()=>e.readPixels(0,0,i,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function xMt(e,t,n,r,i,s,o,a){const u=e,l=new Float32Array(MOt(s,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function vMt(e,t,n){const r=new Float32Array(t*n*4);return $e(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BR{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=q().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,NOt(n,t)):this.gl=_a(n),t=this.gl,q().getNumber("WEBGL_VERSION")===2){const s=t;this.createVertexArray=()=>$e(s,()=>s.createVertexArray()),this.bindVertexArray=o=>$e(s,()=>s.bindVertexArray(o)),this.deleteVertexArray=o=>$e(s,()=>s.deleteVertexArray(o)),this.getVertexArray=()=>$e(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(t!=null){const s=t.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>$e(t,()=>s.createVertexArrayOES()),this.bindVertexArray=o=>$e(t,()=>s.bindVertexArrayOES(o)),this.deleteVertexArray=o=>$e(t,()=>s.deleteVertexArrayOES(o)),this.getVertexArray=()=>$e(t,()=>t.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),q().getNumber("WEBGL_VERSION")===1){const s="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=zS(this.gl,s),wo(this.gl,o))this.textureHalfFloatExtension=zS(this.gl,o);else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),wo(this.gl,i))this.colorBufferHalfFloatExtension=zS(this.gl,i);else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",wo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(wo(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=oMt(this.gl),this.indexBuffer=aMt(this.gl),this.framebuffer=ZOt(this.gl),this.textureConfig=hV(this.gl,this.textureHalfFloatExtension)}get debug(){return q().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;$e(t,()=>t.finish()),$e(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),$e(t,()=>t.deleteFramebuffer(this.framebuffer)),$e(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),$e(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),$e(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,n){return this.throwIfDisposed(),uMt(this.gl,t,n,this.textureConfig)}createFloat16MatrixTexture(t,n){return this.throwIfDisposed(),lMt(this.gl,t,n,this.textureConfig)}createUnsignedBytesMatrixTexture(t,n){return this.throwIfDisposed(),cMt(this.gl,t,n,this.textureConfig)}uploadPixelDataToTexture(t,n){this.throwIfDisposed(),gMt(this.gl,t,n)}uploadDenseMatrixToTexture(t,n,r,i){this.throwIfDisposed(),pMt(this.gl,t,n,r,i,this.textureConfig)}createFloat16PackedMatrixTexture(t,n){return this.throwIfDisposed(),hMt(this.gl,t,n,this.textureConfig)}createPackedMatrixTexture(t,n){return this.throwIfDisposed(),fMt(this.gl,t,n,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(WQ(this.gl,this.framebuffer),this.outputTexture=null),$e(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,n,r){return this.downloadMatrixDriver(t,()=>bMt(this.gl,n,r,this.textureConfig))}downloadPackedMatrixFromBuffer(t,n,r,i,s,o){return xMt(this.gl,t,n,r,i,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,n){return yMt(this.gl,t,n)}createBufferFromTexture(t,n,r){this.bindTextureToFrameBuffer(t);const i=mMt(this.gl,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let n,r;if(q().getBool("WEBGL_FENCE_API_ENABLED")){const i=t,s=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=()=>{const o=i.clientWaitSync(s,0,0);return o===i.ALREADY_SIGNALED||o===i.CONDITION_SATISFIED},n=s}else q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(n,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:n,isFencePassed:r}}downloadMatrixFromPackedTexture(t,n,r){return this.downloadMatrixDriver(t,()=>vMt(this.gl,n,r))}createProgram(t){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=sMt(n));const r=GOt(n);$e(n,()=>n.attachShader(r,this.vertexShader)),$e(n,()=>n.attachShader(r,t)),HOt(n,r);const i=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&RR(n,i),i}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const n=this.gl;$e(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),dMt(n,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&($e(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&RR(this.gl,this.program),$e(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,n,r=!0){return this.throwIfDisposed(),r?QOt(this.gl,t,n):eRt(this.gl,t,n)}getAttributeLocation(t,n){return this.throwIfDisposed(),$e(this.gl,()=>this.gl.getAttribLocation(t,n))}getUniformLocationNoThrow(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)}setInputMatrixTexture(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),tRt(this.gl,t,n,r)}setOutputMatrixTexture(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)}setOutputPackedMatrixTexture(t,n,r){this.throwIfDisposed();const[i,s]=Ly(n,r);this.setOutputMatrixTextureDriver(t,i,s)}setOutputMatrixWriteRegion(t,n,r,i){this.setOutputMatrixWriteRegionDriver(r,t,i,n)}setOutputPackedMatrixWriteRegion(t,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&RR(this.gl,this.program),US(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}$e(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),$e(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=zS(this.gl,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.createQuery();return r.beginQuery(i.TIME_ELAPSED_EXT,s),s}const t=this.getQueryTimerExtensionWebGL1(),n=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,n),n}endQuery(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await jR(()=>this.disposed||this.isQueryAvailable(t,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,n){if(n===0)return null;if(n===2){const r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,n){if(n===0)return!0;if(n===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),i=r.getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(t){return new Promise(n=>{this.addItemToPoll(()=>t.isFencePassed(),()=>n())})}pollItems(){const t=wMt(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=t;++n){const{resolveFn:r}=this.itemsToPoll[n];r()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,n){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in q().platform&&(r=q().platform.setTimeoutCustom.bind(q().platform)),jR(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),MR(this.gl,t,this.framebuffer),this.debug&&US(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(MR(this.gl,this.outputTexture,this.framebuffer),this.debug&&US(this.gl)):WQ(this.gl,this.framebuffer)}downloadMatrixDriver(t,n){this.bindTextureToFrameBuffer(t);const r=n();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(t,n,r){this.throwIfDisposed();const i=this.gl;MR(i,t,this.framebuffer),this.debug&&US(i),this.outputTexture=t,$e(i,()=>i.viewport(0,0,n,r)),$e(i,()=>i.scissor(0,0,n,r))}setOutputMatrixWriteRegionDriver(t,n,r,i){this.throwIfDisposed(),$e(this.gl,()=>this.gl.scissor(t,n,r,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function wMt(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:$Mt,bincountImpl:c2e,bincountReduceImpl:CMt,bitwiseAndImpl:SMt,castImpl:kMt,ceilImpl:EMt,concatImpl:AMt,equalImpl:_Mt,expImpl:TMt,expm1Impl:IMt,floorImpl:DMt,gatherNdImpl:NMt,gatherV2Impl:FMt,greaterImpl:OMt,greaterEqualImpl:RMt,lessImpl:MMt,lessEqualImpl:LMt,linSpaceImpl:PMt,logImpl:BMt,maxImpl:zMt,maximumImpl:UMt,minimumImpl:jMt,multiplyImpl:WMt,negImpl:VMt,notEqualImpl:GMt,prodImpl:HMt,raggedGatherImpl:qMt,raggedRangeImpl:XMt,raggedTensorToTensorImpl:YMt,rangeImpl:KMt,rsqrtImpl:ZMt,scatterImpl:JMt,sigmoidImpl:QMt,simpleAbsImpl:f2e,sliceImpl:e4t,sparseFillEmptyRowsImpl:t4t,sparseReshapeImpl:n4t,sparseSegmentReductionImpl:h2e,sqrtImpl:r4t,staticRegexReplaceImpl:i4t,stridedSliceImpl:s4t,stringNGramsImpl:o4t,stringSplitImpl:a4t,stringToHashBucketFastImpl:u4t,subImpl:l4t,tileImpl:c4t,topKImpl:f4t,transposeImpl:mV,uniqueImpl:h4t}=gIt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d2e(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function ui(e,t){return t===1?[e]:d2e(e,t)}function d4t(e,t){if(e===1)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p4t{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=qr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=ui("rc",this.rank),r=Vt(this.rank),i=this.getOutOfBoundsCondition(n),s=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(t){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let s=`${r===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)s=`${t[t.length-1-o]},`+s;n.push(s)}return n}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let r=this.rank-2;r<this.rank;r++)n+=`${t[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(n+="||");return n}getSetup(t){if(this.rank===1)return"";const n=t.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${i};
    `}getOutput(t){const n=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p2e{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length);let r="";for(let i=0;i<4;i++){let s="thisRC = rc;";i%2===1&&(s+="thisRC.z += 1;"),i>1&&(s+="thisRC.y += 1;"),r+=`
        ${s}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${g4t(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?pV():dV(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${r}

        setOutput(result);
      }
    `}}function g4t(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?dRt(["r","c","d"],"inputShape"):qg(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m4t{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,n,r){const i=XQ(n,r),s=YQ(t,i,r);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=qQ(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const u=this.freeTextures[s].pop();return this.usedTextures[s].push(u),u}let a;return i===mr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===mr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===mr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===mr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===mr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(t,n,r,i){if(this.freeTextures==null)return;const s=XQ(r,i),o=YQ(n,s,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=qQ(n,s,this.gpgpu.gl,this.gpgpu.textureConfig,i),u=q().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[o],c=l&&l.indexOf(t);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function y4t(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function qQ(e,t,n,r,i){const s=b4t(t,r);let o;if(i){const[u,l]=Ly(e[0],e[1]);o=u*l}else{const[u,l]=$C(e[0],e[1]);o=u*l}const a=y4t(n,s);return o*a}function b4t(e,t){switch(e){case mr.PACKED_2X2_FLOAT32:return u2e(t);case mr.PACKED_2X2_FLOAT16:return l2e(t);case mr.UNPACKED_FLOAT32:return s2e(t);case mr.UNPACKED_FLOAT16:return o2e(t);case mr.PACKED_4X1_UNSIGNED_BYTE:return a2e(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function x4t(e){return q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?mr.PACKED_2X2_FLOAT32:mr.UNPACKED_FLOAT32:e?mr.PACKED_2X2_FLOAT16:mr.UNPACKED_FLOAT16}function XQ(e,t){if(e===Ws.UPLOAD)return mr.PACKED_2X2_FLOAT32;if(e===Ws.RENDER||e==null)return x4t(t);if(e===Ws.DOWNLOAD||e===Ws.PIXELS)return mr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function YQ(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lu{constructor(t,n){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const jo="if (isnan(x)) return x;",v4t="return x;",KQ="return abs(x);",w4t="return (x >= 0.0) ? x : (exp(x) - 1.0);",$4t=jo+`
  return (x < 0.0) ? 0.0 : x;
`,C4t=jo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Xc="return x;",S4t="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k4t="return x;",E4t=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,A4t=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_4t=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,T4t="return 1.0 / (1.0 + exp(-1.0 * x));";class gf{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I4t{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length);const n=t.length,r=ui("rc",n),i=Vt(n),s=d4t(n,r),o=r.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D4t=aI,N4t=1e-7,F4t=1e-4,VS={};function O4t(e){return e in VS||(VS[e]={}),VS[e]}const R4t=q().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),M4t=600;function L4t(){return q().global.screen==null?1024:q().global.screen.height*q().global.screen.width*window.devicePixelRatio*M4t/1024/1024}class KF extends T_{nextDataId(){return KF.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof BR)n=t;else{const r=_a(q().getNumber("WEBGL_VERSION"),t);n=new BR(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=_a(q().getNumber("WEBGL_VERSION"));n=new BR(r),this.binaryCache=O4t(q().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new m4t(this.gpgpu),this.numMBBeforeWarning=L4t(),this.texData=new oB(this,Jo())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,r,i,s,o){const a=this.makeTensorInfo(n,r),u=this.texData.get(a.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[i,s]},u.texShape=[i,s];const l=jS(n),c=new HQ(l,!1,o),f=this.runWebGLProgram(c,[a],r,[[i,s]]);return f.shape=n,u.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(t,n,r){if((q().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||q().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:r,values:t,usage:Ws.UPLOAD,refCount:1}),i}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){const n=this.texData.get(t);n.refCount--}}move(t,n,r,i,s){if(q().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:i,values:n,usage:Ws.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const n=this.texData.get(t),{values:r,dtype:i,complexTensorInfos:s,slice:o,shape:a,isPacked:u}=n;if(o!=null){let h;u?h=new gf(a,Xc):h=new lu(a,Xc);const d=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:i}],i),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(r!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return r;const l=this.activeTimers!=null;let c;l&&(c=ti());let f;if(i==="complex64"){const h=this.readSync(s.real.dataId),d=this.readSync(s.imag.dataId);f=nc(h,d)}else f=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=ti()-c),this.convertAndCacheOnCPU(t,f)}async read(t){if(this.pendingRead.has(t)){const p=this.pendingRead.get(t);return new Promise(g=>p.push(g))}const n=this.texData.get(t),{values:r,shape:i,slice:s,dtype:o,complexTensorInfos:a,isPacked:u}=n;if(s!=null){let p;u?p=new gf(i,Xc):p=new lu(i,Xc);const g=this.runWebGLProgram(p,[{dataId:t,shape:i,dtype:o}],o),m=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),m}if(r!=null)return this.convertAndCacheOnCPU(t);if(q().getBool("DEBUG")&&!q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,c;if(o!=="complex64"&&q().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);const p=this.texData.get(c.dataId);l=this.gpgpu.createBufferFromTexture(p.texture.texture,...BS(i))}this.pendingRead.set(t,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=p[0],m=p[1];f=nc(g,m)}else if(l==null)f=this.getValuesFromTexture(t);else{const p=Z(i);f=this.gpgpu.downloadFloat32MatrixFromBuffer(l,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),l!=null){const p=this.gpgpu.gl;$e(p,()=>p.deleteBuffer(l))}const h=this.convertAndCacheOnCPU(t,f),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach(p=>p(h)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Jo().removeDataId(t,this),this.pendingDeletes--),h}readToGPU(t,n={}){const r=this.texData.get(t),{values:i,shape:s,slice:o,dtype:a,isPacked:u,texture:l}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let d;u?d=new gf(s,Xc):d=new lu(s,Xc);const p=this.runWebGLProgram(d,[{dataId:t,shape:s,dtype:a}],a),g=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),g}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,n.customTexShape),f=Jo().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:f},h.texture)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const r=n.map(i=>tc(i));return nt(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return nt(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){const r=t[n];if(!zOt(r))throw q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:n,dtype:r,isPacked:i}=this.texData.get(t),s=Z(n);if(q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(t),d=this.texData.get(h.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...BS(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(h),p}const o=q().getBool("WEBGL_PACK")&&i===!0,a=o?jS(n):n,u=o?new nMt(a):new tMt(a),l=this.runWebGLProgram(u,[{shape:a,dtype:r,dataId:t}],"float32"),c=this.texData.get(l.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(l),f}timerAvailable(){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const n=this.activeTimers,r=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,t();const s=Cu(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),o=Cu(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(s);a.kernelMs=yee(u),a.getExtraProfileInfo=()=>u.map((l,c)=>({name:o[c],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ti(),endMs:null}}endTimer(t){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=ti(),t)}async getQueryTime(t){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:r}=this.texData.get(t);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:n,dtype:r,texShape:i,usage:s,isPacked:o,slice:a}=this.texData.get(t),u=a&&a.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,s,o)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=R4t){return q().getBool("WEBGL_CPU_FORWARD")&&t.every(r=>this.texData.get(r.dataId).texture==null&&Z(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){Ps("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=t.dataSync();return D4t(t.shape,n)}packedUnaryOp(t,n,r){const i=new gf(t.shape,n),s=this.compileAndRun(i,[t],r);return Jo().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const i=f2e(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,i)}if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,KQ,t.dtype);const n=new lu(t.shape,KQ),r=this.compileAndRun(n,[t]);return Jo().makeTensorFromTensorInfo(r)}makeTensorInfo(t,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&ou(r[0])){const s=r.map(o=>cu(o));i=this.write(s,t,n)}else i=this.write(r,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}}makeOutput(t,n,r){return Jo().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,r),this)}unpackTensor(t){const n=new I4t(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){const n=new p4t(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)}packedReshape(t,n){const r=[q0(t.shape),...X0(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[q0(n),...X0(n)],o=new p2e(s,r),a=!0,u=[r],l=this.runWebGLProgram(o,[i],t.dtype,u,a);return{dataId:l.dataId,shape:n,dtype:l.dtype}}decode(t,n){const r=this.texData.get(t),{isPacked:i,shape:s,dtype:o}=r;if(n!=null){const h=Z(s),d=n[0]*n[1]*4;D(h<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=jS(s);let u;i?u=new eMt(a):u=new QRt(a);const l=!0,c=[n??BS(a)],f=this.runWebGLProgram(u,[{shape:a,dtype:o,dataId:t}],o,c,l,n);return{dtype:o,shape:s,dataId:f.dataId}}runWebGLProgram(t,n,r,i,s=!1,o){const a=this.makeTensorInfo(t.outputShape,r),u=this.texData.get(a.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===T2.DENSE){const y=o??BS(t.outputShape);u.texShape=y.map(b=>b*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),Z(a.shape)===0)return u.values=sr(a.dtype,0),a;const l=[],c=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!t.packedInputs&&Z(y.shape)<=q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!t.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!k_(b.shape,y.shape)){const v=y,x=y.shape;y.shape=b.shape,y=this.packedReshape(y,x),l.push(y),b=this.texData.get(y.dataId),v.shape=x}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:u,isUniform:!1},h=JRt(t,c,f),d=this.getAndSaveBinary(h,()=>KRt(this.gpgpu,t,c,f)),p=this.activeTimers!=null;let g;p&&(g=this.startTimer()),q().get("ENGINE_COMPILE_ONLY")||ZRt(this.gpgpu,d,c,f,i),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),p&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));const m=q().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const y=ti();y-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!q().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&s===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(t,n,r,i,s=!1){return r=r||n[0].dtype,this.runWebGLProgram(t,n,r,i,s)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=X(()=>{if(!q().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=q().getBool("DEBUG");q().set("DEBUG",!1);const n=this.abs(Ve(1e-8)).dataSync()[0];if(q().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?N4t:F4t}uploadToGPU(t){const n=this.texData.get(t),{shape:r,dtype:i,values:s,texture:o,usage:a,isPacked:u}=n;if(o!=null)return;const l=this.activeTimers!=null;let c;l&&(c=ti());let f=n.texShape;if(f==null&&(f=iRt(r,u),n.texShape=f),s!=null){const h=jS(r);let d,p=f[1],g=f[0];const m=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(u||!m)&&([p,g]=Ly(f[0],f[1])),u?d=new iMt(h,m):d=new HQ(h,m);const y=m?[g,p]:f,b=this.makeTensorInfo(y,i),v=this.texData.get(b.dataId);m?v.usage=Ws.PIXELS:v.usage=Ws.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),p,g,s);const x=[[g,p]],C=this.runWebGLProgram(d,[b],i,x,!0),$=this.texData.get(C.dataId);n.texShape=$.texShape,n.isPacked=$.isPacked,n.usage=$.usage,q().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=$.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=ti()-c)}else{const h=this.acquireTexture(f,a,i,u);n.texture=h}}convertAndCacheOnCPU(t,n){const r=this.texData.get(t),{dtype:i}=r;return n!=null&&(r.values=P4t(n,i)),r.values}acquireTexture(t,n,r,i){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,i)}computeBytes(t,n){return t[0]*t[1]*Ux(n)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(const[,n]of Object.entries(this.binaryCache)){const r=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(s){throw s}});t.push(r)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await x5(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Qve(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:n,customUniformLocations:r,infLoc:i,nanLoc:s,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:u}=i2e(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=r,t.infLoc=i,t.nanLoc=s,t.outShapeLocation=o,t.outShapeStridesLocation=a,t.outTexShapeLocation=u}}createTensorFromGPUData(t,n,r){t.channels=t.channels||"RGBA";const{texture:i,height:s,width:o,channels:a}=t,u=Jo().backend;if(!u.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=u.writeTexture(i,n,r,s,o,a);return Jo().makeTensorFromDataId(l,n,r,u)}}KF.nextDataId=0;function P4t(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){const n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mB()&&yB("webgl",()=>new KF,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yV=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class eg{constructor(t,n,r){this.variableNames=["A","B"],this.outputShape=Ke(n,r),this.enableShapeUniforms=qr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yg=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class jy{constructor(t,n,r,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ke(n,r);const s=this.outputShape.length;this.enableShapeUniforms=qr(s);let o="";if(i)if(s===0||Z(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Vt(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=ui("coords",s);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const B4t={kernelName:g1,backendName:"webgl",kernelFunc:_s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kh(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),a=_s({inputs:{x:r},backend:n}),u=_s({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:u},s}const z4t={kernelName:z_,backendName:"webgl",kernelFunc:Kh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2e="return (a < 0.) ? b * a : a;",m2e=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function U4t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r,o=n.makeTensorInfo([],"float32",dc(s,"float32")),a=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jy(m2e,i.shape,o.shape):new eg(g2e,i.shape,o.shape),u=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),u}const j4t={kernelName:nw,backendName:"webgl",kernelFunc:U4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y2e="return (a < 0.) ? b * a : a;",b2e=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function W4t(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,s=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jy(b2e,r.shape,i.shape):new eg(y2e,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}const V4t={kernelName:ww,backendName:"webgl",kernelFunc:W4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wy="if (isnan(x)) return x;";function yt({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:o}=i,a=s,u=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const f=a.texData.get(o.dataId),h=n(f.values,u);return a.makeTensorInfo(o.shape,u,h)}const l=q().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let c;return l?c=new gf(o.shape,t):c=new lu(o.shape,e),a.runWebGLProgram(c,[o],u)}}function Mr({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:o,backend:a})=>{const{a:u,b:l}=o,c=a;if(r&&u.dtype==="complex64"){const p=c.texData.get(u.dataId),g=c.texData.get(l.dataId),[m,y]=[[p.complexTensorInfos.real,g.complexTensorInfos.real],[p.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{const[x,w]=v,C={dataId:x.dataId,dtype:x.dtype,shape:u.shape},$={dataId:w.dataId,dtype:w.dtype,shape:l.shape},S=new eg(e,u.shape,l.shape);return c.runWebGLProgram(S,[C,$],Bi(x.dtype,w.dtype))}),b=Kh({inputs:{real:m,imag:y},backend:c});return c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(y),b}const f=s||Bi(u.dtype,l.dtype);if((u.dtype==="string"||l.dtype==="string"||c.shouldExecuteOnCPU([u,l]))&&i!=null){const p=c.texData.get(u.dataId).values,g=c.texData.get(l.dataId).values,m=u.dtype==="string"?rc(p):p,y=u.dtype==="string"?rc(g):g,[b,v]=i(u.shape,l.shape,m,y,f),x=c.makeTensorInfo(v,f),w=c.texData.get(x.dataId);return w.values=b,x}const h=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let d;return h?d=new jy(t,u.shape,l.shape,n):d=new eg(e,u.shape,l.shape),c.runWebGLProgram(d,[u,l],f)}}function I2(e,t=!1){if(e==="linear")return t?k4t:v4t;if(e==="relu")return t?A4t:$4t;if(e==="elu")return t?E4t:w4t;if(e==="relu6")return t?_4t:C4t;if(e==="prelu")return t?b2e:y2e;if(e==="leakyrelu")return t?m2e:g2e;if(e==="sigmoid")return t?T4t:S4t;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x2e{constructor(t,n,r,i=!1,s=!1,o=!1,a=null,u=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=qr(this.outputShape.length);const c=i?t[1]:t[2],f=Math.ceil(c/2),h=i?"i * 2, rc.y":"rc.y, i * 2",d=s?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",y="";a&&(u?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:m=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",x="rc.x";t[0]<n[0]?v=`imod(rc.x, ${t[0]})`:n[0]<t[0]&&(x=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${m}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${x};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${g[0]});
          result += (${p[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZQ={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class JQ{constructor(t,n,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ke(n,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QQ="return a * b;";function bV(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,s=Bi(r.dtype,i.dtype);if(r.dtype==="complex64"){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),l=new JQ(ZQ.REAL,r.shape,i.shape),c=new JQ(ZQ.IMAG,r.shape,i.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],h=n.runWebGLProgram(l,f,"float32"),d=n.runWebGLProgram(c,f,"float32"),p=Kh({inputs:{real:h,imag:d},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),p}if(n.shouldExecuteOnCPU([r,i])){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),[l,c]=WMt(r.shape,i.shape,a.values,u.values,s),f=n.makeTensorInfo(c,s),h=n.texData.get(f.dataId);return h.values=l,f}let o;return q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new jy(QQ,r.shape,i.shape):o=new eg(QQ,r.shape,i.shape),n.runWebGLProgram(o,[r,i],s)}const G4t={kernelName:S1,backendName:"webgl",kernelFunc:bV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4t(e,t,n){const r=[q0(e.shape),...X0(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},s=[q0(t),...X0(t)],o=new p2e(s,r),a=!0,u=[r],l=n.runWebGLProgram(o,[i],e.dtype,u,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function be(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,o=n,a=Z(i.shape),u=aB(s,a),l=Z(u);D(a===l,()=>`The new shape (${u}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(i.dataId);return c.isPacked&&!k_(i.shape,u)&&!(c.texture!==null&&k_(c.shape,u))?H4t(i,u,o):(o.incRef(i.dataId),{dataId:i.dataId,shape:u,dtype:i.dtype})}const q4t={kernelName:Cw,backendName:"webgl",kernelFunc:be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eee{constructor(t,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=t;this.outputShape=[i,o];const a=Math.floor(r/4)*4,u=r%4;let l="sumValue += dot(values, ones);";if(n!=null){const f=1/n;l=`sumValue += dot(values * ${hp(f)?f.toPrecision(2):f}, ones);`}let c="";s%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X4t{constructor(t,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=t;this.outputShape=[i,o];let a="0.0",u="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",u="min"):n==="max"&&(a="-1.0 / 1e-20",u="max");let l=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?l="sumValue":n==="prod"?l="prodValue":n==="all"?l="allValue":n==="any"&&(l="anyValue");const c=Math.floor(r/4)*4,f=r%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${f===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${f===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${f===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4t(e){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const n=t.length?t[t.length-1].outSize:e[1],r=bI(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function Kg(e,t,n,r){const i=Y4t(e.shape);let s=e;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:u,outSize:l}=i[o];let c,f;n==="mean"?c=o===0?new eee({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l},a):new eee({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l}):c=new X4t({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l},n),f=s,s=r.runWebGLProgram(c,[s],t),f.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(f)}return s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K4t{constructor(t,n){this.variableNames=["A"];const r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[n[o]];this.outputShape=r,this.rank=r.length;const i=Vt(this.rank),s=Z4t(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}function Z4t(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J4t{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(t.length);for(let c=0;c<r.length;c++)r[c]=t[n[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=Vt(this.rank),s=d2e("rc",this.rank),o=new Array(this.rank);for(let c=0;c<n.length;c++)o[n[c]]=s[c];const a=`vec2(${o.slice(-2).join()})`,u=`++${s[this.rank-1]} < ${r[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${u}) {
        result[1] = ${l};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${l};
        if(${u}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZF(e,t,n){const r=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new J4t(e.shape,t):new K4t(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4t(e,t,n,r){const i=t,s=e.shape.length,o=it(i,e.shape);let a=o;const u=xn(a,s),l=u!=null;let c=e;l&&(c=ZF(e,u,r),a=In(a.length,s)),Tr("sum",a,s);const[f,h]=ar(c.shape,a);let d=f;n&&(d=Tn(f,o));const p=Z(h),m=Z(e.shape)/p,y=be({inputs:{x:c},attrs:{shape:[m,p]},backend:r}),b=zT(e.dtype),v=Kg(y,b,"sum",r),x=be({inputs:{x:v},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(v),l&&r.disposeIntermediateTensorInfo(c),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;return Q4t(i,s,o,n)}const eLt={kernelName:Tw,backendName:"webgl",kernelFunc:JF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ci(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{perm:s}=r,o=n,a=i.shape.length,u=new Array(a);for(let c=0;c<u.length;c++)u[c]=i.shape[s[c]];let l;if(o.shouldExecuteOnCPU([i])){const f=o.texData.get(i.dataId).values,h=mV(f,i.shape,i.dtype,s,u);l=o.makeTensorInfo(u,i.dtype);const d=o.texData.get(l.dataId);d.values=h}else l=ZF(i,s,o);return l}const tLt={kernelName:Xd,backendName:"webgl",kernelFunc:Ci};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v2e=1e3;function E_({a:e,b:t,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:u=null}){const l=e.shape.length,c=t.shape.length,f=n?e.shape[l-2]:e.shape[l-1],h=r?t.shape[c-1]:t.shape[c-2],d=n?e.shape[l-1]:e.shape[l-2],p=r?t.shape[c-2]:t.shape[c-1],g=e.shape.slice(0,-2),m=t.shape.slice(0,-2),y=Z(g),b=Z(m),x=Ke(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([d,p]);D(f===h,()=>`Error in matMul: inner shapes (${f}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);const w=n?[y,f,d]:[y,d,f],C=r?[b,p,h]:[b,h,p],$=be({inputs:{x:e},backend:i,attrs:{shape:w}}),S=be({inputs:{x:t},backend:i,attrs:{shape:C}}),k=[$,S],E=Math.max(y,b),A=n?$.shape[1]:$.shape[2],F=s!=null,_=o!=null,I=u==="leakyrelu",T=u!=null?I2(u,!0):null,O=F||_||I||T!=null;let L;if((d===1||p===1)&&A>v2e&&O===!1){let P=$,G=S;n&&(P=Ci({inputs:{x:$},backend:i,attrs:{perm:[0,2,1]}}),k.push(P)),r&&(G=Ci({inputs:{x:S},backend:i,attrs:{perm:[0,2,1]}}),k.push(G));const H=p!==1,Q=p===1;let te=P;H&&(te=be({inputs:{x:P},backend:i,attrs:{shape:[E,A,1]}}),k.push(te));const ne=p===1?2:1;let oe=G;Q&&(oe=be({inputs:{x:G},backend:i,attrs:{shape:[E,1,A]}}),k.push(oe));const he=bV({inputs:{a:te,b:oe},backend:i});L=JF({inputs:{x:he},backend:i,attrs:{axis:ne,keepDims:!0}}),k.push(he)}else{const P=Bi(e.dtype,t.dtype),G=new x2e(w,C,[E,d,p],n,r,F,T,_,I),H=[$,S];if(s!=null&&H.push(s),_&&H.push(o),I){const Q=i.makeTensorInfo([],"float32",dc(a,"float32"));H.push(Q),k.push(Q)}L=i.runWebGLProgram(G,H,P)}const M=be({inputs:{x:L},backend:i,attrs:{shape:x}});k.push(L);for(const P of k)i.disposeIntermediateTensorInfo(P);return M}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nLt(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:f}=r;return E_({a:i,b:s,transposeA:u,transposeB:l,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:c})}const rLt={kernelName:jx,backendName:"webgl",kernelFunc:nLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tee="return abs(x);";function iLt(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const s=n.texData.get(r.dataId),o=f2e(s.values);return n.makeTensorInfo(r.shape,r.dtype,o)}let i;return q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new gf(r.shape,tee):i=new lu(r.shape,tee),n.runWebGLProgram(i,[r],r.dtype)}const sLt={kernelName:O2,backendName:"webgl",kernelFunc:iLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oLt=jo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,aLt=yt({opSnippet:oLt}),uLt={kernelName:Y0,backendName:"webgl",kernelFunc:aLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lLt=jo+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,cLt=yt({opSnippet:lLt}),fLt={kernelName:K0,backendName:"webgl",kernelFunc:cLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nee="return a + b;",hLt=Mr({opSnippet:nee,packedOpSnippet:nee,supportsComplex:!0,cpuKernelImpl:$Mt}),dLt={kernelName:sg,backendName:"webgl",kernelFunc:hLt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pLt{constructor(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`float v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gLt{constructor(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`vec4 v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dk(e){const{inputs:t,backend:n}=e,r=t;if(r.length===1)return _s({inputs:{x:r[0]},backend:n});if(r.length>q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(r.length/2),l=Dk({inputs:r.slice(0,u),backend:n}),c=Dk({inputs:r.slice(u),backend:n});return Dk({inputs:[l,c],backend:n})}const i=r.map(u=>u.dtype).reduce((u,l)=>Bi(u,l)),s=r.map(u=>u.shape),a=q().getBool("WEBGL_PACK")?new gLt(r[0].shape,s):new pLt(r[0].shape,s);return n.runWebGLProgram(a,r,i)}const mLt={kernelName:R2,backendName:"webgl",kernelFunc:Dk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yLt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=it(s,i.shape);let l=u;const c=xn(l,a);let f=i;c!=null&&(f=Ci({inputs:{x:i},backend:n,attrs:{perm:c}}),l=In(l.length,a)),Tr("all",l,a);const[h,d]=ar(f.shape,l),p=Z(d),g=be({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),m=Kg(g,g.dtype,"all",n);let y;if(o){const b=Tn(h,u);y=be({inputs:{x:m},backend:n,attrs:{shape:b}})}else y=be({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(f),y}const bLt={kernelName:O_,backendName:"webgl",kernelFunc:yLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xLt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=it(s,i.shape);let l=u;const c=xn(l,a);let f=i;c!=null&&(f=Ci({inputs:{x:i},backend:n,attrs:{perm:c}}),l=In(l.length,a)),Tr("any",l,a);const[h,d]=ar(f.shape,l),p=Z(d),g=be({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),m=Kg(g,g.dtype,"any",n);let y;if(o){const b=Tn(h,u);y=be({inputs:{x:m},backend:n,attrs:{shape:b}})}else y=be({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(f),y}const vLt={kernelName:R_,backendName:"webgl",kernelFunc:xLt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wLt{constructor(t,n,r){this.variableNames=["A"];const{windowSize:i,batchSize:s,outSize:o}=t;r||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const a=n==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Lt{constructor(t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,D(t.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const s=t[t.length-1],o=Math.ceil(s/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,u=a.length,l=Vt(u),c=ui("coords",u);let f,h;if(o===1){h=u+1;const S=Vt(h);f=`
        ${S} sourceLocR = ${S}(${c.join()}, 0);
        ++${c[u-1]};
        ${S} sourceLocG = ${S}(${c.join()}, 0);
        ++${c[u-2]};
        ${S} sourceLocA = ${S}(${c.join()}, 0);
        --${c[u-1]};
        ${S} sourceLocB = ${S}(${c.join()}, 0);
        --${c[u-2]};`}else h=u,f=`
        ${l} sourceLocR = coords;
        ++${c[u-1]};
        ${l} sourceLocG = coords;
        ++${c[u-2]};
        ${l} sourceLocA = coords;
        --${c[u-1]};
        ${l} sourceLocB = coords;
        --${c[u-2]};`;const d=["x","y","z","w","u","v"].slice(0,h),p="."+d[h-1],g=d.map(S=>"int "+S),m=ui("sourceLocR",h-1).concat("inIdx.r"),y=ui("sourceLocG",h-1).concat("inIdx.g"),b=ui("sourceLocB",h-1).concat("inIdx.b"),v=ui("sourceLocA",h-1).concat("inIdx.a"),x=r==="max"?"greaterThan":"lessThan",w=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${v.join()})));`,C=`vec4(
            getAChannel(${m.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,$=i?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${$}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${c[u-1]} < ${a[u-1]-1};
        bool hasNextRow = ${c[u-2]} < ${a[u-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w2e(e,t,n,r=null){let i=t.shape[0],s=t.shape[1];r!=null&&(i=r.shape[0],s=r.shape[1]);const o=bI(s),a={windowSize:o,inSize:s,batchSize:i,outSize:Math.ceil(s/o)},u=new wLt(a,n,r==null),l=[t];r!=null&&l.push(r);const c=e.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;const f=w2e(e,t,n,c);return e.disposeIntermediateTensorInfo(c),f}function $2e(e,t,n,r=null){const i=r!=null?r.shape:t.shape,s=i[i.length-1],o=bI(s),a=new $Lt(i,o,n,r==null),u=r==null?[t]:[t,r],l=e.runWebGLProgram(a,u,"int32");if(l.shape.length===t.shape.length){const c=$2e(e,t,n,l);return e.disposeIntermediateTensorInfo(l),c}return l}function C2e(e,t,n,r){const i=[n];if(Tr("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,t.shape.length),!q().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const s=[],o=e.texData.get(t.dataId),a=o!==null&&o.isPacked;let u=t;a&&(u=e.unpackTensor(t),s.push(u));const[l,c]=ar(u.shape,i),f=Z(c),h=be({inputs:{x:u},backend:e,attrs:{shape:[-1,f]}});s.push(h);const d=w2e(e,h,r);s.push(d);const p=be({inputs:{x:d},backend:e,attrs:{shape:l}});return s.forEach(g=>e.disposeIntermediateTensorInfo(g)),p}return $2e(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CLt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;let o=it(s,i.shape);const a=xn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Ci({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=In(o.length,u.shape.length)),Tr("argMax",[o[0]],u.shape.length);const c=C2e(n,u,o[0],"max");return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),c}const SLt={kernelName:M2,backendName:"webgl",kernelFunc:CLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kLt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;let o=it(s,i.shape);const a=xn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Ci({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=In(o.length,u.shape.length)),Tr("argMin",[o[0]],u.shape.length);const c=C2e(n,u,o[0],"min");return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),c}const ELt={kernelName:L2,backendName:"webgl",kernelFunc:kLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ALt=jo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,_Lt=yt({opSnippet:ALt}),TLt={kernelName:Z0,backendName:"webgl",kernelFunc:_Lt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ILt=jo+"return log(x + sqrt(x * x + 1.0));",DLt=yt({opSnippet:ILt}),NLt={kernelName:J0,backendName:"webgl",kernelFunc:DLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FLt=jo+`
  return atan(x);
`,OLt=yt({opSnippet:FLt}),RLt={kernelName:Q0,backendName:"webgl",kernelFunc:OLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MLt=yV+`
  return atan(a, b);
`,LLt=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yg+`
  return result;
`,PLt=Mr({opSnippet:MLt,packedOpSnippet:LLt}),BLt={kernelName:t1,backendName:"webgl",kernelFunc:PLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zLt=jo+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,ULt=yt({opSnippet:zLt}),jLt={kernelName:e1,backendName:"webgl",kernelFunc:ULt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D2{constructor(t,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const g=n==="avg",m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let b="0.0";if(g||(b="-1.0 / 1e-20"),r){const S=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${u});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${S} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?s?m:y:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let x=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(x="avgValue / max(count, 1.0)");const w=Math.floor(o/4)*4,C=o%4,$=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${$}
          }

          int xC = xCCorner + ${w};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${$}
          }
        }
        setOutput(${x});
      }
    `}}class xV{constructor(t,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideDepth,u=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,f=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,g=t.effectiveFilterWidth,m=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;const v=n==="avg";let x="0.0";if(v||(x="-1.0 / 1e-20"),r){const E=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${u}, ${l});
        const ivec3 pads = ivec3(${m}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${E} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?s?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const $=Math.floor(o/4)*4,S=o%4,k=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${u}, ${l});
      const ivec3 pads = ivec3(${m}, ${y}, ${b});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${$}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${k}
            }

            int xC = xCCorner + ${$};
            if (${S===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${S===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${S===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${k}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WLt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;CC(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;D(_r(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ro(i.shape,s,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&gt(c.inShape,c.outShape))return _s({inputs:{x:i},backend:n});const f=new D2(c,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const VLt={kernelName:P2,backendName:"webgl",kernelFunc:WLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GLt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r,c=[1,1,1],f=pc(i.shape,s,o,c,a,u,l),h=new xV(f,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}const HLt={kernelName:B2,backendName:"webgl",kernelFunc:GLt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qLt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=u-1-t.padInfo.top,f=l-1-t.padInfo.left,h=1/(n*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${f});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class XLt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterDepth,r=t.filterHeight,i=t.filterWidth,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=f-1-t.padInfo.front,g=h-1-t.padInfo.top,m=d-1-t.padInfo.left,y=1/(n*r*i);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${g}, ${m});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YLt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,f=[1,1,1],h=pc(o.shape,a,u,f,l,c),d=new XLt(h);return n.runWebGLProgram(d,[i],o.dtype)}const KLt={kernelName:L_,backendName:"webgl",kernelFunc:YLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZLt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s;CC([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=Ro(o.shape,a,u,1,l),f=new qLt(c);return n.runWebGLProgram(f,[i],o.dtype)}const JLt={kernelName:M_,backendName:"webgl",kernelFunc:ZLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QLt(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:o,transposeB:a}=r;return E_({a:i,b:s,transposeA:o,transposeB:a,backend:n})}const ePt={kernelName:z2,backendName:"webgl",kernelFunc:QLt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tPt{constructor(t,n,r,i,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ke(t,n),Ke(t,r);let a="0.0";i!=null&&(Ke(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="1.0";s!=null&&(Ke(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nPt{constructor(t,n,r,i,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ke(t,n),Ke(t,r);let a="vec4(0.0)";i!=null&&(Ke(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="vec4(1.0)";s!=null&&(Ke(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rPt=({inputs:e,backend:t,attrs:n})=>{const{x:r,mean:i,variance:s,offset:o,scale:a}=e;D(i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=n;u==null&&(u=.001);const l=[r,i,s];let c=null;o!=null&&(c=o.shape,l.push(o));let f=null;a!=null&&(f=a.shape,l.push(a));const h=q().getBool("WEBGL_PACK_NORMALIZATION")?new nPt(r.shape,i.shape,s.shape,c,f,u):new tPt(r.shape,i.shape,s.shape,c,f,u);return t.runWebGLProgram(h,l,l[0].dtype)},iPt={kernelName:Q2,backendName:"webgl",kernelFunc:rPt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sPt{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const n=Vt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=oPt(this.rank);let i;const s=t.map((o,a)=>`sourceLoc.${QP[a]} = start[${a}] + coords.${QP[a]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${r}));
      }
    `}}const QP=["x","y","z","w","u","v"];function oPt(e){if(e===1)return"sourceLoc";if(e<=6)return QP.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aPt{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Vt(this.rank),r=ui("coords",this.rank),i=ui("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${s})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${o};
        --${i[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${t[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${o};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${n}(${t.map((c,f)=>`start[${f}]`).join()});`:t.map((c,f)=>`${i[f]} = ${r[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uPt(e,t,n,r){const i=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),o=r.texData.get(s.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=e.dtype;let a=y5(t,Re(e.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||e.dataId};const u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),s}function Vy(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:o}=r,[a,u]=yI(i,s,o);if(p5(i,a,u),Z(u)===0)return n.makeTensorInfo(u,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const f=n.texData.get(i.dataId),h=e4t(f.values,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,h)}const{isPacked:l}=n.texData.get(i.dataId),c=m5(i.shape,a,u);if(l||!c){const f=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aPt(u):new sPt(u),h=[a];return n.runWebGLProgram(f,[i],i.dtype,h)}return n.uploadToGPU(i.dataId),uPt(i,a,u,n)}const lPt={kernelName:_w,backendName:"webgl",kernelFunc:Vy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cPt=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:o}=r;D(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((b,v)=>b*v),u=Hw(i.shape,s,a),l=qw(u.length,s.length),c=Xw(i.shape,s,a),f=C5(o,s.length),h=S5(c,o,s.length),d=[],p=be({inputs:{x:i},backend:n,attrs:{shape:u}}),g=Ci({inputs:{x:p},backend:n,attrs:{perm:l}}),m=be({inputs:{x:g},backend:n,attrs:{shape:c}}),y=Vy({inputs:{x:m},backend:n,attrs:{begin:f,size:h}});return d.push(p),d.push(g),d.push(m),d.forEach(b=>n.disposeIntermediateTensorInfo(b)),y},fPt={kernelName:U2,backendName:"webgl",kernelFunc:cPt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hPt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o}=r,a=n.readSync(i.dataId),u=n.readSync(s.dataId),l=c2e(a,u,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}const dPt={kernelName:P_,backendName:"webgl",kernelFunc:hPt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pPt=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,gPt=`
  return float(int(a.r) & int(b.r));
`;function mPt(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,s=q().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=q().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,i])||o===1){const u=n.texData.get(r.dataId).values,l=n.texData.get(i.dataId).values,[c,f]=SMt(r.shape,i.shape,u,l,r.dtype),h=n.makeTensorInfo(f,r.dtype),d=n.texData.get(h.dataId);return d.values=c,h}let a;return s?a=new jy(pPt,r.shape,i.shape,!1):a=new eg(gPt,r.shape,i.shape),n.runWebGLProgram(a,[r,i],r.dtype)}const yPt={kernelName:j2,backendName:"webgl",kernelFunc:mPt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bPt(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.readSync(r.dataId),o=n.readSync(i.dataId),a=Ke(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const xPt={kernelName:B_,backendName:"webgl",kernelFunc:bPt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vPt="return float(a != b);",S2e=Mr({opSnippet:vPt,cpuKernelImpl:GMt,dtype:"bool"}),wPt={kernelName:mw,backendName:"webgl",kernelFunc:S2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kC(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.texData.get(r.dataId);return _s({inputs:{x:i.complexTensorInfos.real},backend:n})}const $Pt={kernelName:xT,backendName:"webgl",kernelFunc:kC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CPt="return float(int(x));";function SPt(e,t){const n=new lu(e.shape,CPt),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return _s({inputs:{x:i},backend:n});const o=zn(i.shape),a=eB({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),u=Kh({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),u}if(i.dtype==="complex64"){const o=kC({inputs:{input:i},backend:n}),a=eB({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),a}if(!uB(i.dtype,s)){const o=_s({inputs:{x:i},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(n.shouldExecuteOnCPU([i])){const o=n.texData.get(i.dataId).values,[a,u,l]=kMt(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,u,l)}if(s==="int32")return SPt(i,n);if(s==="bool"){const o=n.makeTensorInfo([],"bool",sr("bool",1)),u=S2e({inputs:{a:i,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),u}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}const kPt={kernelName:n1,backendName:"webgl",kernelFunc:eB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ree="return ceil(x);",EPt=yt({opSnippet:ree,packedOpSnippet:ree,cpuKernelImpl:EMt}),APt={kernelName:r1,backendName:"webgl",kernelFunc:EPt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Pt{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TPt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IPt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:s,clipValueMax:o}=r;let a;q().getBool("WEBGL_PACK_CLIP")?a=new TPt(i.shape):a=new _Pt(i.shape);const u=[[s],[o]];return n.runWebGLProgram(a,[i],i.dtype,u)}const DPt={kernelName:i1,backendName:"webgl",kernelFunc:IPt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NPt{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iee(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function FPt(e){const{inputs:t,backend:n}=e,{x:r}=t,i=n.texData.get(r.dataId),s=new NPt(r.shape),o=[iee(r,i.complexTensorInfos.real),iee(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}const OPt={kernelName:W2,backendName:"webgl",kernelFunc:FPt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RPt{constructor(t){this.outputShape=[],this.outputShape=hu(t,1),this.variableNames=t.map((o,a)=>`T${a}`);const n=new Array(t.length-1);n[0]=t[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+t[o][1];const r=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];r.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const i=n.length,s=n[n.length-1];r.push(`else setOutput(getT${i}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MPt{constructor(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=hu(t,n);const r=this.outputShape,i=r.length,s=Vt(i),o=ui("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=t.map((g,m)=>`T${m}`);const u=new Array(t.length-1);u[0]=t[0][n];for(let g=1;g<u.length;g++)u[g]=u[g-1]+t[g][n];const l=a[n],c=a.slice(-2),f=a.join();let h=`if (${l} < ${u[0]}) {
        return getChannel(
            getT0(${f}), vec2(${c.join()}));
        }`;for(let g=1;g<u.length;g++){const m=u[g-1];h+=`
        if (${l} < ${u[g]}  && ${l} >= ${u[g-1]}) {
          return getChannel(
            getT${g}(${GS(a,l,m)}),
            vec2(${GS(c,l,m)}));
        }`}const d=u.length,p=u[u.length-1];h+=`
        return getChannel(
          getT${d}(${GS(a,l,p)}),
          vec2(${GS(c,l,p)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${h}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[i-1]} = ${o[i-1]} + 1;
        if (${o[i-1]} < ${r[i-1]}) {
          result.g = getValue(${o});
        }

        ${o[i-2]} = ${o[i-2]} + 1;
        if (${o[i-2]} < ${r[i-2]}) {
          result.a = getValue(${o});
        }

        ${o[i-1]} = ${o[i-1]} - 1;
        if (${o[i-2]} < ${r[i-2]} &&
            ${o[i-1]} < ${r[i-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function GS(e,t,n){const r=e.indexOf(t);return e.map((s,o)=>o===r?`${s} - ${n}`:s).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QF(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.texData.get(r.dataId);return _s({inputs:{x:i.complexTensorInfos.imag},backend:n})}const LPt={kernelName:sT,backendName:"webgl",kernelFunc:QF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hx(e,t,n){const r=e[0].dtype;if(r==="complex64"){const d=e.map(b=>kC({inputs:{input:b},backend:n})),p=e.map(b=>QF({inputs:{input:b},backend:n})),g=hx(d,t,n),m=hx(p,t,n),y=Kh({inputs:{real:g,imag:m},backend:n});return d.forEach(b=>n.disposeIntermediateTensorInfo(b)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),y}let i=n.shouldExecuteOnCPU(e);if(r==="string"&&(i=!0),i){const d=e.map(x=>{const C=[-1,Z(x.shape.slice(t))];return be({inputs:{x},backend:n,attrs:{shape:C}})}),p=d.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),g=hu(d.map(x=>x.shape),1),m=d[0].shape[0]===1,y=AMt(p,g,r,m),b=hu(e.map(x=>x.shape),t),v=n.makeTensorInfo(b,r,y);return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),v}const s=e.filter(d=>Z(d.shape)>0),o=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){const d=o?new lu(e[0].shape,Xc):new gf(e[0].shape,Xc);return n.runWebGLProgram(d,e,r)}const a=q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){const d=[];for(let g=0;g<s.length;g+=a){const m=s.slice(g,g+a);d.push(hx(m,t,n))}const p=hx(d,t,n);for(const g of d)n.disposeIntermediateTensorInfo(g);return p}if(o){const d=new MPt(s.map(p=>p.shape),t);return n.runWebGLProgram(d,s,r)}const{tensors2D:u,outShape:l}=PPt(s,t,n),c=new RPt(u.map(d=>d.shape)),f=n.runWebGLProgram(c,u,r);u.forEach(d=>n.disposeIntermediateTensorInfo(d));const h=be({inputs:{x:f},attrs:{shape:l},backend:n});return n.disposeIntermediateTensorInfo(f),h}function PPt(e,t,n){const r=hu(e.map(s=>s.shape),t);return{tensors2D:e.map(s=>be({inputs:{x:s},attrs:{shape:[-1,Z(s.shape.slice(t))]},backend:n})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k2e(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=it(i,t[0].shape)[0],o=t.map(l=>l.shape);v5(o,s);const a=hu(t.map(l=>l.shape),s);if(Z(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(l=>Z(l.shape)>0);return u.length===1?_s({inputs:{x:u[0]},backend:n}):hx(u,s,n)}const BPt={kernelName:V2,backendName:"webgl",kernelFunc:k2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E2e{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,f=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,g=t.inChannels%4,m=t.dataFormat==="channelsLast",y=m?1:2,b=m?2:3,v=m?3:1;let x="",w="";r&&(i?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:x=`
          float activation(float x) {
            ${r}
          }
        `,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${u}, ${l});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${m}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${m}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${m}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${m}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${w}
        setOutput(result);
      }
    `}}class zPt{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const n=t.padInfo.front,r=t.padInfo.top,i=t.padInfo.left,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,f=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,g=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${r}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A2e{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=qr(this.outputShape.length);const o=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,f=c;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<c;m++)h+=`
           vec4 xTexelC${m*2};
           int xTexelC${m*2}Ready;
           vec4 xTexelC${m*2+1};
           int xTexelC${m*2+1}Ready;
           vec4 xC${m};`;h+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let m=0;m<c;m++)h+=`
           xTexelC${m*2} = vec4(0.0);
           xTexelC${m*2}Ready = 0;
           xTexelC${m*2+1} = vec4(0.0);
           xTexelC${m*2+1}Ready = 0;
           xC${m} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let m=0;m<(f+1)/2;m++){const y=m*2;if(h+=`
           xC = xCCorner + ${y*u};
           `,a===1){if(y<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,u===1&&y>0?h+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){const b=o%2===0?D_(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:h+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?h+=`
                     xC${y+1} = xTexelC${y};
                     `:h+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(h+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(h+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(h+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let d="",p="";r&&(i?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:s?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:d=`vec4 activation(vec4 x) {
           ${r}
         }`,p="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UPt{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=qr(this.outputShape.length);const{dataFormat:r}=n,i=ki(),s=r==="channelsLast",o=s?1:2,a=s?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let c=0;c<=1;c++)for(let f=0;f<=1;f++)l+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${c};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&n===1&&e[0]>1?[e[0],1]:null}function _2e({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,f=u[0]*u[1]*u[2],h=n.outChannels,d=n.dataFormat==="channelsLast",p=!1,g=!1;let m;const y=[];if(s!=null){const x=A_(s.shape,d);x!=null&&(s=be({inputs:{x:s},backend:r,attrs:{shape:x}}),y.push(s))}if(i!=null){const x=A_(i.shape,d);x!=null&&(i=be({inputs:{x:i},backend:r,attrs:{shape:x}}),y.push(i))}if(!((f===1||h===1)&&c>v2e)&&l.isPacked&&d&&l.texture!=null&&u[2]%2!==0&&gt(l.shape.slice(-3),u.slice(-3))){const x=u[0]*u[1]*(u[2]+1),w={dataId:e.dataId,shape:[1,x,n.inChannels],dtype:e.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,D(k_(l.shape,w.shape),()=>`packed reshape ${l.shape} to ${w.shape} isn't free`);const $=be({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push($);const S=E_({a:w,b:$,backend:r,transposeA:p,transposeB:g,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),k=r.texData.get(S.dataId);D(k.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=C,k.shape=n.outShape,m=_s({inputs:{x:S},backend:r}),m.shape=n.outShape,y.push(S)}else{const x=n.outHeight*n.outWidth,w=be({inputs:{x:e},backend:r,attrs:{shape:d?[n.batchSize,x,n.inChannels]:[n.batchSize,n.inChannels,x]}}),C=be({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),$=E_({a:d?w:C,b:d?C:w,transposeA:!d,transposeB:g,backend:r,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o});m=be({inputs:{x:$},backend:r,attrs:{shape:n.outShape}}),y.push(w),y.push(C),y.push($)}for(const x of y)r.disposeIntermediateTensorInfo(x);return m}function T2e({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:f,outHeight:h,dataFormat:d}=n,p=d==="channelsLast",g=u*l*c,m=h*f,y=[n.batchSize,g,m],b=!0,v=!1,x=[];if(s!=null){const M=A_(s.shape,p);M!=null&&(s=be({inputs:{x:s},backend:r,attrs:{shape:M}}),x.push(s))}if(i!=null){const M=A_(i.shape,p);M!=null&&(i=be({inputs:{x:i},backend:r,attrs:{shape:M}}),x.push(i))}const w=be({inputs:{x:t},backend:r,attrs:{shape:[1,g,Z(t.shape)/g]}});x.push(w);const C=new UPt(y,n),$=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],S=r.runWebGLProgram(C,[e],"float32",$),k=be({inputs:{x:S},backend:r,attrs:{shape:y}});x.push(S),x.push(k);const E=i!=null,A=s!=null,F=a==="leakyrelu",_=a?I2(a,!0):null,I=new x2e(p?k.shape:w.shape,p?w.shape:k.shape,p?[n.batchSize,m,n.outChannels]:[n.batchSize,n.outChannels,m],b,v,E,_,A,F),T=p?[k,w]:[w,k];if(i&&T.push(i),A&&T.push(s),F){const M=r.makeTensorInfo([],"float32",dc(o,"float32"));T.push(M),x.push(M)}const O=r.runWebGLProgram(I,T,"float32"),L=be({inputs:{x:O},backend:r,attrs:{shape:n.outShape}});x.push(O);for(const M of x)r.disposeIntermediateTensorInfo(M);return L}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jPt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r,f=gc(u),h=or(i.shape,s.shape,o,l,a,c,!1,f);let d;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))d=_2e({x:i,filter:s,convInfo:h,backend:n});else if(h.strideWidth<=2&&f==="channelsLast"&&q().getBool("WEBGL_EXP_CONV")){const g=new A2e(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];d=n.runWebGLProgram(g,[i,s],"float32",m)}else if(q().getBool("WEBGL_CONV_IM2COL"))d=T2e({x:i,filter:s,convInfo:h,backend:n});else{const g=new E2e(h);d=n.runWebGLProgram(g,[i,s],"float32")}const p=be({inputs:{x:d},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(d),p}const WPt={kernelName:G2,backendName:"webgl",kernelFunc:jPt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VPt{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,r=t.strideWidth,i=t.padInfo.top,s=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class GPt{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=t.dataFormat==="channelsLast",a=n-1-t.padInfo.top,u=r-1-t.padInfo.left,l=o?1:2,c=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class HPt{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideDepth,r=t.strideHeight,i=t.strideWidth,s=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${s};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qPt{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterDepth,r=t.filterHeight,i=t.filterWidth,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=n-1-t.padInfo.front,l=r-1-t.padInfo.top,c=i-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${l}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XPt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r,f=gc(u),h=or(i.shape,c,o,1,a,l,!1,f),d=new VPt(h);return n.runWebGLProgram(d,[i,s],"float32")}const YPt={kernelName:U_,backendName:"webgl",kernelFunc:XPt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KPt{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=qr(this.outputShape.length);const n=t.filterHeight,r=t.filterWidth,i=n-1-t.padInfo.top,s=r-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZPt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r,f=gc(l),h=or(o,s.shape,a,1,u,c,!1,f);if(q().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const d=[[h.strideHeight,h.strideWidth]],p=new KPt(h);return n.runWebGLProgram(p,[i,s],"float32",d)}else{const d=new GPt(h);return n.runWebGLProgram(d,[i,s],"float32")}}const JPt={kernelName:H2,backendName:"webgl",kernelFunc:ZPt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QPt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r,l=$h(i.shape,s.shape,o,u,a),c=new zPt(l);return n.runWebGLProgram(c,[i,s],"float32")}const eBt={kernelName:q2,backendName:"webgl",kernelFunc:QPt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tBt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,filterShape:u}=r,l=$h(i.shape,u,o,1,a),c=new HPt(l);return n.runWebGLProgram(c,[i,s],"float32")}const nBt={kernelName:j_,backendName:"webgl",kernelFunc:tBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rBt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:o,strides:a,inputShape:u}=r,l=$h(u,s.shape,a,1,o),c=new qPt(l);return n.runWebGLProgram(c,[i,s],"float32")}const iBt={kernelName:W_,backendName:"webgl",kernelFunc:rBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sBt=Wy+`
  return cos(x);
`,oBt=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Yg}
  return result;
`,aBt=yt({opSnippet:sBt,packedOpSnippet:oBt}),uBt={kernelName:s1,backendName:"webgl",kernelFunc:aBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lBt=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,cBt=yt({opSnippet:lBt}),fBt={kernelName:o1,backendName:"webgl",kernelFunc:cBt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hBt{constructor(t,n,r,i,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,u,l]=t,[c]=n,[f,h]=r;this.outputShape=[c,f,h,l];const d=i==="bilinear"?1:0,[p,g]=[`${a-1}.0`,`${u-1}.0`],[m,y,b]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,x,w]=h>1?[`${(u-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${m});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${x};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dBt=e=>{const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=r,c=new hBt(i.shape,s.shape,a,u,l);return n.runWebGLProgram(c,[i,s,o],"float32")},pBt={kernelName:G_,backendName:"webgl",kernelFunc:dBt};var N2;(function(e){e.Prod="*",e.Sum="+"})(N2||(N2={}));class see{constructor(t,n,r,i){this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,o=this.op===N2.Prod?"1.0":"0.0",a=r?o:`getX(${oee(s,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let l="",c="";r?(l=i?`end != ${u-1}`:"end != 0",c=i?"end + 1":"end - 1"):(l=i?`end + pow2 < ${u}`:"end >= pow2",c=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Vt(s)} coords = getOutputCoords();
        int end = ${aee(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${c};
          ${aee(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${oee(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function oee(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function aee(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2e(e,t,n,r,i,s){const o=t.shape.length,a=xn([r],o);let u=t;a!=null&&(u=Ci({inputs:{x:t},backend:n,attrs:{perm:a}}));const l=In(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);const c=u.shape[l];let f=_s({inputs:{x:u},backend:n});for(let h=0;h<=Math.ceil(Math.log2(c))-1;h++){const d=new see(e,u.shape,!1,s),p=[[h]],g=f;f=n.runWebGLProgram(d,[f],f.dtype,p),n.disposeIntermediateTensorInfo(g)}if(i){const h=new see(e,u.shape,i,s),d=f;f=n.runWebGLProgram(h,[f],f.dtype),n.disposeIntermediateTensorInfo(d)}if(a!=null){const h=Ch(a),d=Ci({inputs:{x:f},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(u),d}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gBt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;return I2e(N2.Prod,i,n,s,o,a)}const mBt={kernelName:V_,backendName:"webgl",kernelFunc:gBt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yBt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;return I2e(N2.Sum,i,n,s,o,a)}const bBt={kernelName:X2,backendName:"webgl",kernelFunc:yBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xBt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const u=n.readSync(i.dataId),l=n.readSync(s.dataId),c=c2e(u,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}else if(i.shape.length===2){const u=n.bufferSync(i),l=n.bufferSync(s),c=CMt(u,l,o,a);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const vBt={kernelName:H_,backendName:"webgl",kernelFunc:xBt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wBt{constructor(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Bt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:o}=r,a=i.shape[0],u=o==="NHWC"?i.shape[1]:i.shape[2],l=o==="NHWC"?i.shape[2]:i.shape[3],c=o==="NHWC"?i.shape[3]:i.shape[1],f=u*s,h=l*s,d=c/(s*s),p=o==="NHWC"?[a,f,h,d]:[a,d,f,h],g=new wBt(p,s,o);return n.runWebGLProgram(g,[i],i.dtype)}const CBt={kernelName:q_,backendName:"webgl",kernelFunc:$Bt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D2e{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=qr(this.outputShape.length);const o=t.filterHeight,a=t.filterWidth,u=t.outChannels/t.inChannels;let l="",c="";r&&(i?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:l=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");const f=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N2e{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=qr(this.outputShape.length);const o=t.outChannels/t.inChannels,a=t.padInfo.left,u=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,f=t.filterWidth,h=f;let d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<f;y++)d+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;d+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<f;y++)d+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(h+1)/2;y++){const b=y*2;if(d+=`
          xC = xCCorner + ${b*l};
          `,u===1){if(b<f&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?d+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<f)){const v=a%2===0?D_(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:d+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):v===1?d+=`
                    xC${b+1} = xTexelC${b};
                    `:d+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<f&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<f&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<f&&(d+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<f&&(d+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<f&&(d+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let p="",g="";r&&(i?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`vec4 activation(vec4 x) {
          ${r}
        }`,g="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${m}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SBt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;let c=u;c==null&&(c=[1,1]),D(_r(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const f=or(i.shape,s.shape,o,c,a,l,!0);let h;q().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new N2e(f):h=new D2e(f);const d=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(h,[i,s],"float32",d)}const kBt={kernelName:Y2,backendName:"webgl",kernelFunc:SBt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EBt{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,r=t.strideWidth,i=t.padInfo.top,s=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ABt{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=n-1-t.padInfo.top,a=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Bt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r,f=or(i.shape,c,o,a,u,l,!0),h=new EBt(f);return n.runWebGLProgram(h,[i,s],"float32")}const TBt={kernelName:X_,backendName:"webgl",kernelFunc:_Bt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IBt(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r,f=or(c,s.shape,o,a,u,l,!0),h=new ABt(f);return n.runWebGLProgram(h,[i,s],"float32")}const DBt={kernelName:Y_,backendName:"webgl",kernelFunc:IBt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NBt{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FBt(e){const{inputs:t,backend:n}=e,{x:r}=t,i=[...r.shape,...r.shape],s=Z(r.shape),o=be({inputs:{x:r},backend:n,attrs:{shape:[s]}}),a=new NBt(s),u=n.runWebGLProgram(a,[o],o.dtype),l=be({inputs:{x:u},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),l}const OBt={kernelName:K_,backendName:"webgl",kernelFunc:FBt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RBt{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:n,inWidth:r,padInfo:i,strideHeight:s,strideWidth:o,filterHeight:a,filterWidth:u,dilationHeight:l,dilationWidth:c}=t,{top:f,left:h}=i;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${o});
      const ivec2 pads = ivec2(${f}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MBt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r,l=Bw(i.shape,s.shape,o,a,"NHWC",u);let c;const f=new RBt(l);c=n.runWebGLProgram(f,[i,s],"float32");const h=be({inputs:{x:c},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(c),h}const LBt={kernelName:K2,backendName:"webgl",kernelFunc:MBt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PBt(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:o,summedDims:a,idDims:u}=N5(i,s.length);O5(o.length,u,s);const{path:l,steps:c}=R5(a,u),f=c.length;let h=null,d=o.length;const p=[];for(let g=0;g<f;++g){for(const m of c[g]){const{permutationIndices:y,expandDims:b}=F5(d,u[m]);let v;M5(y)?v=s[m]:(v=Ci({inputs:{x:s[m]},backend:n,attrs:{perm:y}}),p.push(v));const x=v.shape.slice();for(let w=0;w<b.length;++w)x.splice(b[w],0,1);gt(v.shape,x)||(v=be({inputs:{x:v},backend:n,attrs:{shape:x}}),p.push(v)),h===null?h=v:(h=bV({inputs:{a:v,b:h},backend:n}),p.push(h))}g<f-1&&(l[g]>=0&&(h=JF({inputs:{x:h},backend:n,attrs:{axis:l[g]-(o.length-d),keepDims:!1}}),p.push(h)),d--)}for(const g of p)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const BBt={kernelName:J_,backendName:"webgl",kernelFunc:PBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zBt="return (x >= 0.0) ? x : (exp(x) - 1.0);",UBt=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,jBt=yt({opSnippet:zBt,packedOpSnippet:UBt}),WBt={kernelName:u1,backendName:"webgl",kernelFunc:jBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VBt="return (b >= 0.0) ? a : a * (b + 1.0);",GBt=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,HBt=e=>{const{inputs:t,backend:n}=e,{dy:r,y:i}=t,s=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jy(GBt,r.shape,i.shape):new eg(VBt,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)},qBt={kernelName:Q_,backendName:"webgl",kernelFunc:HBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XBt=`
  return vec4(equal(a, b));
`,YBt="return float(a == b);",KBt=Mr({opSnippet:YBt,packedOpSnippet:XBt,dtype:"bool",cpuKernelImpl:_Mt}),ZBt={kernelName:Z2,backendName:"webgl",kernelFunc:KBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JBt=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${k5};
  float a1 = ${E5};
  float a2 = ${A5};
  float a3 = ${_5};
  float a4 = ${T5};
  float a5 = ${I5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,QBt=yt({opSnippet:JBt}),e5t={kernelName:l1,backendName:"webgl",kernelFunc:QBt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t5t=Wy+`
  return exp(x);
`,n5t=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,F2e=yt({opSnippet:t5t,packedOpSnippet:n5t,cpuKernelImpl:TMt,dtype:"float32"}),r5t={kernelName:c1,backendName:"webgl",kernelFunc:F2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tB(e){const{inputs:t,attrs:n,backend:r}=e,{dim:i}=n,{input:s}=t,o=s.shape.length,a=s.shape.slice();let u=i;return i<0&&(D(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+i+1),a.splice(u,0,1),be({inputs:{x:s},backend:r,attrs:{shape:a}})}const i5t={kernelName:J2,backendName:"webgl",kernelFunc:tB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uee="return exp(x) - 1.0;",s5t=yt({opSnippet:uee,packedOpSnippet:uee,cpuKernelImpl:IMt}),o5t={kernelName:f1,backendName:"webgl",kernelFunc:s5t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lee{constructor(t,n,r){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const s=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${i}.0`:"1.0";let a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O2e(e,t,n){const r=n.texData.get(e.dataId),i=Z(e.shape),s=e.shape[e.shape.length-1],o=i/s,a=be({inputs:{x:e},backend:n,attrs:{shape:[o,s]}}),u=a.shape,l=new lee("real",u,t),c=new lee("imag",u,t),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],h=n.runWebGLProgram(l,f,"float32"),d=n.runWebGLProgram(c,f,"float32"),p=Kh({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const g=be({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5t(e){const{inputs:t,backend:n}=e,{input:r}=t;return O2e(r,!1,n)}const u5t={kernelName:eT,backendName:"webgl",kernelFunc:a5t};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l5t{constructor(t,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EC(e){const{backend:t,attrs:n}=e,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||rg(i),s==="string"){const o=$n(s,Z(r));return o.fill(i),t.makeTensorInfo(r,s,o)}else{const o=new l5t(r,i),a=[[i]];return t.runWebGLProgram(o,[],s,a)}}const c5t={kernelName:tT,backendName:"webgl",kernelFunc:EC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f5t{constructor(t){this.variableNames=["Image"],this.outputShape=[];const n=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h5t={kernelName:nT,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,i=new f5t(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cee="return floor(x);",d5t=yt({opSnippet:cee,packedOpSnippet:cee,cpuKernelImpl:DMt}),p5t={kernelName:h1,backendName:"webgl",kernelFunc:d5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g5t=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,m5t=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,y5t=Mr({opSnippet:g5t,packedOpSnippet:m5t,dtype:"int32"}),b5t={kernelName:d1,backendName:"webgl",kernelFunc:y5t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x5t{constructor(t){this.variableNames=["A"];const n=ki(),[r,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${r}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v5t{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=ki(),[r,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${r}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w5t={kernelName:Lk,backendName:"webgl",kernelFunc:$5t};let dm,zR=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function $5t(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:i}=t;const{numChannels:s}=r,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[u,l]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[l,u],f=[l,u,s];if(a||o){const g=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(dm==null||g!==zR)&&(zR=g,dm=document.createElement("canvas").getContext("2d",{willReadFrequently:zR})),dm.canvas.width=u,dm.canvas.height=l,dm.drawImage(i,0,0,u,l),i=dm.canvas}const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=Ws.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);const d=q().getBool("WEBGL_PACK")?new v5t(f):new x5t(f),p=n.runWebGLProgram(d,[h],"int32");return n.disposeData(h.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r,g=gc(c),m=or(i.shape,s.shape,u,f,l,h,!1,g);let y;const b=[],v=o!=null,x=a!=null,w=d==="leakyrelu",C=()=>{const S=[i,s],k=(E,A)=>{if(A==="NCHW"&&E.shape.length===1&&E.shape[0]!==1){const F=be({inputs:{x:E},backend:n,attrs:{shape:[E.shape[0],1,1]}});return b.push(F),F}return E};if(v&&S.push(k(o,c)),x&&S.push(k(a,c)),w){const E=n.makeTensorInfo([],"float32",dc(p,"float32"));S.push(E),b.push(E)}return S};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))y=_2e({x:i,filter:s,convInfo:m,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else if(m.strideWidth<=2&&g==="channelsLast"&&q().getBool("WEBGL_EXP_CONV")){const S=d?I2(d,!0):null,k=new A2e(m,v,S,x,w),E=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],A=C();y=n.runWebGLProgram(k,A,"float32",E)}else if(q().getBool("WEBGL_CONV_IM2COL"))y=T2e({x:i,filter:s,convInfo:m,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else{const S=d?I2(d,!1):null,k=new E2e(m,v,S,x,w),E=C();y=n.runWebGLProgram(k,E,"float32")}const $=be({inputs:{x:y},backend:n,attrs:{shape:m.outShape}});return b.push(y),b.forEach(S=>n.disposeIntermediateTensorInfo(S)),$}const S5t={kernelName:Wx,backendName:"webgl",kernelFunc:C5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:f,activation:h,leakyreluAlpha:d}=r,p=[];let g=c;g==null&&(g=[1,1]),D(_r(u,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${g}'`);const m=or(i.shape,s.shape,u,g,l,f,!0),y=q().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,b=h?I2(h,y):null,v=[i,s],x=o!=null,w=a!=null,C=h==="leakyrelu";if(x&&v.push(o),w&&v.push(a),C){const E=n.makeTensorInfo([],"float32",dc(d,"float32"));v.push(E),p.push(E)}let $;y?$=new N2e(m,x,b,w,C):$=new D2e(m,x,b,w,C);const S=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],k=n.runWebGLProgram($,v,"float32",S);return p.forEach(E=>n.disposeIntermediateTensorInfo(E)),k}const E5t={kernelName:Vx,backendName:"webgl",kernelFunc:k5t};class A5t{constructor(t,n,r,i){this.sliceDim=t,this.strides=n,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=r;const s=Vt(r.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5t(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=i.shape,o=s[s.length-1],a=Z(r.shape),[u,l,c,f]=mI(r,i),h=be({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),d=be({inputs:{x:r},backend:n,attrs:{shape:[Z(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const y=n.readSync(i.dataId),b=n.bufferSync(r),v=NMt(y,b,r.dtype,l,o,c,f,r.shape,a);return n.makeTensorInfo(u,r.dtype,v.values)}const p=new A5t(o,f,[l,c],r.shape),g=n.runWebGLProgram(p,[d,h],d.dtype),m=be({inputs:{x:g},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(g),m}const T5t={kernelName:rT,backendName:"webgl",kernelFunc:_5t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I5t{constructor(t,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const r=Vt(this.rank),i=D5t(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function D5t(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let i=0;i<e.length;i++)i===2?r.push("index"):r.push(`${n[i]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R2e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:o,batchDims:a}=r,u=it(o,i.shape)[0];if(q().get("DEBUG")){const b=n.readSync(s.dataId),v=i.shape[u];for(let x=0;x<b.length;++x){const w=b[x];D(w<=v-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${v-1}]`)}}const l=P5(i,s,u,a),c=Z(s.shape),f=[],h=be({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),d=be({inputs:{x:s},backend:n,attrs:{shape:[l.batchSize,c/l.batchSize]}});f.push(h),f.push(d);const p=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,s])||i.dtype==="string"){const b=n.bufferSync(d),v=n.bufferSync(h),x=FMt(v,b,p);return f.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(l.outputShape,x.dtype,x.values)}const g=new I5t(h.shape,p),m=n.runWebGLProgram(g,[h,d],h.dtype);f.push(m);const y=be({inputs:{x:m},backend:n,attrs:{shape:l.outputShape}});return f.forEach(b=>n.disposeIntermediateTensorInfo(b)),y}const N5t={kernelName:ew,backendName:"webgl",kernelFunc:R2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F5t="return float(a > b);",O5t=`
  return vec4(greaterThan(a, b));
`,R5t=Mr({opSnippet:F5t,packedOpSnippet:O5t,cpuKernelImpl:OMt,dtype:"bool"}),M5t={kernelName:tw,backendName:"webgl",kernelFunc:R5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L5t="return float(a >= b);",P5t=`
  return vec4(greaterThanEqual(a, b));
`,B5t=Mr({opSnippet:L5t,packedOpSnippet:P5t,dtype:"bool",cpuKernelImpl:RMt}),z5t={kernelName:p1,backendName:"webgl",kernelFunc:B5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5t(e){const{inputs:t,backend:n}=e,{input:r}=t;return O2e(r,!0,n)}const j5t={kernelName:iT,backendName:"webgl",kernelFunc:U5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W5t="return float(!isnan(x) && !isinf(x));",V5t=yt({opSnippet:W5t,dtype:"bool"}),G5t={kernelName:m1,backendName:"webgl",kernelFunc:V5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5t="return float(isinf(x));",q5t=yt({opSnippet:H5t,dtype:"bool"}),X5t={kernelName:y1,backendName:"webgl",kernelFunc:q5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y5t="return float(isnan(x));",K5t=yt({opSnippet:Y5t,dtype:"bool"}),Z5t={kernelName:b1,backendName:"webgl",kernelFunc:K5t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J5t="return float(a < b);",Q5t=`
  return vec4(lessThan(a, b));
`,e6t=Mr({opSnippet:J5t,packedOpSnippet:Q5t,cpuKernelImpl:MMt,dtype:"bool"}),t6t={kernelName:rw,backendName:"webgl",kernelFunc:e6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n6t="return float(a <= b);",r6t=`
  return vec4(lessThanEqual(a, b));
`,i6t=Mr({opSnippet:n6t,packedOpSnippet:r6t,cpuKernelImpl:LMt,dtype:"bool"}),s6t={kernelName:iw,backendName:"webgl",kernelFunc:i6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6t(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,o=PMt(r,i,s);return t.makeTensorInfo([o.length],"float32",o)}const a6t={kernelName:oT,backendName:"webgl",kernelFunc:o6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u6t=Wy+`
  return x < 0.0 ? 0./0. : log(x);
`,l6t=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,c6t=yt({opSnippet:u6t,packedOpSnippet:l6t,cpuKernelImpl:BMt}),f6t={kernelName:x1,backendName:"webgl",kernelFunc:c6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h6t=Wy+`
  return log(1.0 + x);
`,d6t=yt({opSnippet:h6t}),p6t={kernelName:v1,backendName:"webgl",kernelFunc:d6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g6t="return float(a >= 1.0 && b >= 1.0);",m6t=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,y6t=Mr({opSnippet:g6t,packedOpSnippet:m6t,dtype:"bool"}),b6t={kernelName:sw,backendName:"webgl",kernelFunc:y6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x6t="return float(!(x >= 1.0));",v6t=yt({opSnippet:x6t}),w6t={kernelName:ow,backendName:"webgl",kernelFunc:v6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $6t="return float(a >= 1.0 || b >= 1.0);",C6t=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,S6t=Mr({opSnippet:$6t,packedOpSnippet:C6t,dtype:"bool"}),k6t={kernelName:aw,backendName:"webgl",kernelFunc:S6t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E6t{constructor(t,n,r,i,s){this.variableNames=["x"],this.outputShape=[];const o=n,a=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${i}) * sum`;s===.5?u=`inversesqrt(${l})`:s===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A6t{constructor(t,n,r,i,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${i}) * sum`;s===.5?u=`inversesqrt(${l})`:s===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _6t=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:o,alpha:a,beta:u}=r,l=q().getBool("WEBGL_PACK_NORMALIZATION")?new A6t(i.shape,s,o,a,u):new E6t(i.shape,s,o,a,u);return n.runWebGLProgram(l,[i],i.dtype)},T6t={kernelName:uw,backendName:"webgl",kernelFunc:_6t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I6t{constructor(t,n,r,i,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=i,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D6t=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=r,f=new I6t(i.shape,a,u,l,c);return n.runWebGLProgram(f,[i,s,o],i.dtype)},N6t={kernelName:aT,backendName:"webgl",kernelFunc:D6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6t(e,t,n,r){const i=Z(t),o=Z(e.shape)/i,a=be({inputs:{x:e},attrs:{shape:[o,i]},backend:r}),u=Kg(a,e.dtype,"max",r),l=be({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M2e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:s,keepDims:o}=r,a=i.shape.length,u=it(s,i.shape);let l=u;const c=xn(l,a),f=c!=null,h=n.shouldExecuteOnCPU([i]);let d=i;if(f){if(h){const v=n.texData.get(d.dataId).values,x=new Array(a);for(let $=0;$<x.length;$++)x[$]=i.shape[c[$]];const w=mV(v,i.shape,i.dtype,c,x);d=n.makeTensorInfo(x,i.dtype);const C=n.texData.get(d.dataId);C.values=w}else d=ZF(i,c,n);l=In(l.length,a)}Tr("max",l,a);const[p,g]=ar(d.shape,l);let m=p;o&&(m=Tn(p,u));let y;if(h){const v=n.texData.get(d.dataId).values,x=zMt(v,Z(g),m,i.dtype);y=n.makeTensorInfo(m,i.dtype);const w=n.texData.get(y.dataId);w.values=x}else y=F6t(d,g,m,n);return f&&n.disposeIntermediateTensorInfo(d),y}const O6t={kernelName:lw,backendName:"webgl",kernelFunc:M2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R6t=yV+`
  return max(a, b);
`,M6t=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yg+`
  return result;
`,L6t=Mr({opSnippet:R6t,packedOpSnippet:M6t,cpuKernelImpl:UMt}),P6t={kernelName:w1,backendName:"webgl",kernelFunc:L6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;CC(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;D(_r(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ro(i.shape,s,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&gt(c.inShape,c.outShape))return _s({inputs:{x:i},backend:n});const f=new D2(c,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const z6t={kernelName:cw,backendName:"webgl",kernelFunc:B6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dataFormat:u,dimRoundingMode:l}=r,c=[1,1,1],f=pc(i.shape,s,o,c,a,l,u),h=new xV(f,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}const j6t={kernelName:fw,backendName:"webgl",kernelFunc:U6t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W6t{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideHeight,r=t.strideWidth,i=t.dilationHeight,s=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=s-1-t.padInfo.top,u=o-1-t.padInfo.left,l=s*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class V6t{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideDepth,r=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,f=u-1-t.padInfo.front,h=l-1-t.padInfo.top,d=c-1-t.padInfo.left,p=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${h}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G6t(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,f=[1,1,1],h=pc(o.shape,a,u,f,l,c),d=new xV(h,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),g=new V6t(h),m=n.runWebGLProgram(g,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}const H6t={kernelName:lT,backendName:"webgl",kernelFunc:G6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6t(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:o}=t,a=s;CC([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:f}=r,h=Ro(a.shape,u,l,1,c,f),d=!0,p=new D2(h,"max",d),g=n.runWebGLProgram(p,[a],a.dtype),m=new W6t(h),y=n.runWebGLProgram(m,[i,g],a.dtype);return n.disposeIntermediateTensorInfo(g),y}const X6t={kernelName:uT,backendName:"webgl",kernelFunc:q6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6t(e,t,n,r){let i=new D2(n,"max",!1);const s=r.runWebGLProgram(i,[e],"float32");i=new D2(n,"max",!0,!0,t);const o=r.runWebGLProgram(i,[e],"float32");return[s,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K6t={kernelName:cT,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=t,u=n;D(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const l=[1,1];D(_r(s,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`);const c=Ro(r.shape,i,s,l,o),[f,h]=Y6t(r,a,c,u);return[f,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6t(e,t,n,r){const i=Z(t),o=Z(e.shape)/i,a=be({inputs:{x:e},attrs:{shape:[o,i]},backend:r}),u=Kg(a,"float32","mean",r),l=be({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J6t={kernelName:hw,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:i,axis:s}=t,o=n,a=r.shape.length,u=it(s,r.shape);let l=u;const c=xn(l,a),f=c!=null,h=o.shouldExecuteOnCPU([r]),d=[];let p=r;if(f){if(h){const x=o.texData.get(p.dataId).values,w=new Array(a);for(let S=0;S<w.length;S++)w[S]=r.shape[c[S]];const C=mV(x,r.shape,r.dtype,c,w);p=o.makeTensorInfo(w,r.dtype);const $=o.texData.get(p.dataId);$.values=C}else p=ZF(r,c,o);d.push(p),l=In(l.length,a)}Tr("sum",l,a);const[g,m]=ar(p.shape,l);let y=g;i&&(y=Tn(g,u));const b=Z6t(p,m,y,o);for(const v of d)o.disposeIntermediateTensorInfo(v);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=it(s,i.shape);let l=u;const c=xn(l,a);let f=i;c!=null&&(f=Ci({inputs:{x:i},backend:n,attrs:{perm:c}}),l=In(l.length,i.shape.length)),Tr("min",l,a);const[h,d]=ar(f.shape,l),p=Z(d),g=be({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),m=Kg(g,g.dtype,"min",n);let y;if(o){const b=Tn(h,u);y=be({inputs:{x:m},backend:n,attrs:{shape:b}})}else y=be({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(f),y}const ezt={kernelName:dw,backendName:"webgl",kernelFunc:Q6t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tzt=yV+`
  return min(a, b);
`,nzt=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yg+`
  return result;
`,rzt=Mr({opSnippet:tzt,packedOpSnippet:nzt,cpuKernelImpl:jMt}),izt={kernelName:$1,backendName:"webgl",kernelFunc:rzt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class szt{constructor(t,n,r){this.variableNames=["x"],this.outputShape=n.map((c,f)=>c[0]+t[f]+c[1]);const i=t.length,s=Vt(i),o=n.map(c=>c[0]).join(","),a=n.map((c,f)=>c[0]+t[f]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l=r==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ozt{constructor(t,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,g)=>p[0]+t[g]+p[1]);const i=t.length,s=Vt(i),o=n.map(p=>p[0]).join(","),a=n.map((p,g)=>p[0]+t[g]).join(","),u=ui("rc",i),l=ui("source",i),c=`${u[i-1]} < ${this.outputShape[i-1]}`,f=i===1?"source":`vec2(${l.slice(-2).join()})`,h=r==="reflect"?0:1;let d="";if(i===1){const p=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${f});
        ${u[i-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${f});
        }
      `}else{const p=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${f});
        ${u[i-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${f});
        }
        rc = outputLoc;
        ${u[i-2]} += 1;
        if(${u[i-2]} < ${this.outputShape[i-2]}) {
          ${p}
          result[2] = getChannel(getX(${l.join()}), ${f});
          ${u[i-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${l.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const azt=({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{paddings:i,mode:s}=n,o=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ozt(r.shape,i,s):new szt(r.shape,i,s);return t.runWebGLProgram(o,[r],r.dtype)},uzt={kernelName:pw,backendName:"webgl",kernelFunc:azt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lzt=`if (b == 0.0) return NAN;
  return mod(a, b);`,czt=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Yg+`
  return result;
`,fzt=Mr({opSnippet:lzt,packedOpSnippet:czt}),hzt={kernelName:C1,backendName:"webgl",kernelFunc:fzt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dzt{constructor(t,n,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pzt=`
if (a == b) {
  return 1.0;
};
return a / b;`,gzt=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,L2e=Mr({opSnippet:pzt,packedOpSnippet:gzt,checkOutOfBounds:!0}),mzt={kernelName:a1,backendName:"webgl",kernelFunc:L2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fee="return a - b;",P2e=Mr({opSnippet:fee,packedOpSnippet:fee,supportsComplex:!0,cpuKernelImpl:l4t}),yzt={kernelName:B1,backendName:"webgl",kernelFunc:P2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B2e(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,o=it([s],i.shape),a=M2e({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Tn(a.shape,o),l=be({inputs:{x:a},backend:n,attrs:{shape:u}}),c=P2e({inputs:{a:i,b:l},backend:n}),f=F2e({inputs:{x:c},backend:n}),h=JF({inputs:{x:f},backend:n,attrs:{axis:o,keepDims:!1}}),d=be({inputs:{x:h},backend:n,attrs:{shape:u}}),p=L2e({inputs:{a:f,b:d},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),p}const bzt={kernelName:Nw,backendName:"webgl",kernelFunc:B2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xzt(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:o,normalized:a}=r,u=a?i:B2e({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),l=u.shape[0],c=u.shape[1],f=new dzt(l,c,s),h=[[o]],d=n.runWebGLProgram(f,[u],"int32",h);return a||n.disposeIntermediateTensorInfo(u),d}const vzt={kernelName:fT,backendName:"webgl",kernelFunc:xzt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wzt=jo+`
  return -x;
`,$zt=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Czt(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const s=n.texData.get(r.dataId),[o,a]=VMt(s.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,o)}let i;return q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new gf(r.shape,$zt):i=new lu(r.shape,wzt),n.runWebGLProgram(i,[r],r.dtype)}const Szt={kernelName:gw,backendName:"webgl",kernelFunc:Czt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kzt=hI;function Ezt(e){Ps("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),{selectedIndices:f}=kzt(l,c,o,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const Azt={kernelName:hT,backendName:"webgl",kernelFunc:Ezt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _zt=dI;function Tzt(e){Ps("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r,c=n.readSync(i.dataId),f=n.readSync(s.dataId),{selectedIndices:h,validOutputs:d}=_zt(c,f,o,a,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const Izt={kernelName:dT,backendName:"webgl",kernelFunc:Tzt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dzt=pI;function Nzt(e){Ps("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r,c=n.readSync(i.dataId),f=n.readSync(s.dataId),h=o,d=a,p=u,g=l,{selectedIndices:m,selectedScores:y}=Dzt(c,f,h,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Fzt={kernelName:pT,backendName:"webgl",kernelFunc:Nzt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ozt{constructor(t,n,r,i){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rzt=e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:o,onValue:a,offValue:u}=r,l=Z(i.shape),c=new Ozt(l,o,a,u),f=be({inputs:{x:i},backend:n,attrs:{shape:[l]}}),h=n.runWebGLProgram(c,[f],s);n.disposeIntermediateTensorInfo(f);const d=[...i.shape,o],p=be({inputs:{x:h},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(h),p},Mzt={kernelName:bw,backendName:"webgl",kernelFunc:Rzt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="complex64"){const i=kC({inputs:{input:r},backend:n}),s=__({inputs:{x:i},backend:n}),o=QF({inputs:{input:r},backend:n}),a=__({inputs:{x:o},backend:n}),u=Kh({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return EC({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}const Lzt={kernelName:Mw,backendName:"webgl",kernelFunc:__};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z2e(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const i=kC({inputs:{input:r},backend:n}),s=z2e({inputs:{x:i},backend:n}),o=QF({inputs:{input:r},backend:n}),a=__({inputs:{x:o},backend:n}),u=Kh({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return EC({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}const Pzt={kernelName:yw,backendName:"webgl",kernelFunc:z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bzt(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(t.length===1)return tB({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const s=t[0].shape,o=t[0].dtype;t.forEach(c=>{Ar(s,c.shape,"All tensors passed to stack must have matching shapes"),D(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const f=tB({inputs:{input:c},backend:n,attrs:{dim:i}});return a.push(f),f}),l=k2e({inputs:u,backend:n,attrs:{axis:i}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),l}const zzt={kernelName:xw,backendName:"webgl",kernelFunc:Bzt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uzt{constructor(t,n,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((l,c)=>l[0]+t[c]+l[1]);const i=t.length,s=Vt(i),o=n.map(l=>l[0]).join(","),a=n.map((l,c)=>l[0]+t[c]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jzt{constructor(t,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((g,m)=>g[0]+t[m]+g[1]);const i=t.length,s=Vt(i),o=n.map(g=>g[0]).join(","),a=n.map((g,m)=>g[0]+t[m]).join(","),u=ui("rc",i),l=ui("source",i),c=`${u[i-1]} < ${this.outputShape[i-1]}`,f=i===1?"source":`vec2(${l.slice(-2).join()})`,h=[`${s} rc = outputLoc;`,`${u[i-1]} += 1;
       if(${c}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${u[i-2]} += 1;
       if(${u[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${u[i-1]} += 1;
         if(${c}) {`],d=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let g=0,m=i===1?2:4;g<m;g++)p+=`
        ${h[g]}
        if (${d}) {
          result[${g}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${g}] = getChannel(getX(${l.join()}), ${f});
        }
      `;p+=i===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U2e=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:o}=r;if(Z(i.shape)===0){const l=s.map((c,f)=>c[0]+i.shape[f]+c[1]);return EC({backend:n,attrs:{shape:l,value:o,dtype:i.dtype}})}const a=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jzt(i.shape,s,o):new Uzt(i.shape,s,o),u=[[o]];return n.runWebGLProgram(a,[i],i.dtype,u)},Wzt={kernelName:vw,backendName:"webgl",kernelFunc:U2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vzt=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Gzt=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Yg+`
  return result;
`,Hzt=Mr({opSnippet:Vzt,packedOpSnippet:Gzt}),qzt={kernelName:k1,backendName:"webgl",kernelFunc:Hzt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xzt(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=[],l=it(s,i.shape);let c=l;const f=xn(c,a);let h=i;f!=null&&(h=Ci({inputs:{x:i},backend:n,attrs:{perm:f}}),c=In(c.length,a),u.push(h)),Tr("prod",c,a);let d;if(n.shouldExecuteOnCPU([h])){const p=n.texData.get(h.dataId).values,{outVals:g,outShape:m,outDtype:y}=HMt(h.shape,h.dtype,p,c);d=n.makeTensorInfo(m,y,g)}else{const[p,g]=ar(h.shape,c),m=Z(g),y=be({inputs:{x:h},backend:n,attrs:{shape:[-1,m]}}),b=zT(i.dtype),v=Kg(y,b,"prod",n);d=be({inputs:{x:v},backend:n,attrs:{shape:p}}),u.push(y),u.push(v)}if(o){u.push(d);const p=Tn(d.shape,l);d=be({inputs:{x:d},backend:n,attrs:{shape:p}})}return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const Yzt={kernelName:$w,backendName:"webgl",kernelFunc:Xzt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kzt(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=t,{outputRaggedRank:a}=r,u=i.map(y=>n.readSync(y.dataId)),l=i.map(y=>y.shape),c=n.readSync(s.dataId),f=n.readSync(o.dataId),[h,d,p]=qMt(u,l,c,s.shape,s.dtype,f,o.shape,a),g=h.map(y=>n.makeTensorInfo([y.length],"int32",y)),m=n.makeTensorInfo(p,s.dtype,d);return g.concat([m])}const Zzt={kernelName:gT,backendName:"webgl",kernelFunc:Kzt};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jzt(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=XMt(o,r.shape,r.dtype,a,i.shape,u,s.shape),f=n.makeTensorInfo([l.length],"int32",l),h=n.makeTensorInfo([c.length],r.dtype,c);return[f,h]}const Qzt={kernelName:mT,backendName:"webgl",kernelFunc:Jzt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8t(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),f=n.readSync(o.dataId),h=a.map(m=>n.readSync(m.dataId)),d=a.map(m=>m.shape),[p,g]=YMt(l,i.shape,c,s.shape,s.dtype,f,o.shape,h,d,u);return n.makeTensorInfo(p,s.dtype,g)}const t8t={kernelName:yT,backendName:"webgl",kernelFunc:e8t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j2e=e=>{const{backend:t,attrs:n}=e,{start:r,stop:i,step:s,dtype:o}=n,a=KMt(r,i,s,o);return t.makeTensorInfo([a.length],o,a)},n8t={kernelName:bT,backendName:"webgl",kernelFunc:j2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8t="return 1.0 / x;",i8t=yt({opSnippet:r8t}),s8t={kernelName:E1,backendName:"webgl",kernelFunc:i8t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o8t=jo+`
  return (x < 0.0) ? 0.0 : x;
`,a8t=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,u8t=yt({opSnippet:o8t,packedOpSnippet:a8t}),l8t={kernelName:A1,backendName:"webgl",kernelFunc:u8t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8t=jo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,f8t=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,h8t=yt({opSnippet:c8t,packedOpSnippet:f8t}),d8t={kernelName:_1,backendName:"webgl",kernelFunc:h8t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p8t{constructor(t,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r];let h;s?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/f[0]},
          ${c[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g8t{constructor(t,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r];let h;s?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/f[0]},
          ${c[1]/f[1]},
          ${c[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m8t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new g8t(i.shape,u,l,s,o):new p8t(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],"float32")}const y8t={kernelName:kw,backendName:"webgl",kernelFunc:m8t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b8t{constructor(t,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=t,u=[r&&o>1?i-1:i,r&&a>1?s-1:s],l=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=u[0]/l[0],f=u[1]/l[1],h=1/c,d=1/f,p=Math.ceil(h)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${f});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x8t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r,a=new b8t(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const v8t={kernelName:wT,backendName:"webgl",kernelFunc:x8t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w8t{constructor(t,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r],h=i?"0.5":"0.0";let d;s?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/f[0]},
          ${c[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $8t{constructor(t,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r],h=i?"0.5":"0.0";let d;s?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/f[0]},
          ${c[1]/f[1]},
          ${c[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new $8t(i.shape,u,l,s,o):new w8t(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],i.dtype)}const S8t={kernelName:Sw,backendName:"webgl",kernelFunc:C8t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k8t{constructor(t,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=t,u=[r&&o>1?i-1:i,r&&a>1?s-1:s],l=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=u[0]/l[0],f=u[1]/l[1],h=1/c,d=1/f,p=Math.ceil(h)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${f});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8t(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r,a=new k8t(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const A8t={kernelName:vT,backendName:"webgl",kernelFunc:E8t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _8t{constructor(t,n){this.variableNames=["x"];const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=t,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const i=a=>n.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,s=t.map((a,u)=>i(u)).join(","),o=Vt(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T8t{constructor(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=t;const i=ui("rc",r),s=`${i[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${i[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Vt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(i.slice())};
          if(${s}){
            result.g = ${l(i.slice())};
          }
          if(${o}) {
            result.b = ${c(i.slice())};
            if(${s}) {
              result.a = ${f(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(p){return h(p)}function l(p){return p[r-1]="("+p[r-1]+" + 1)",h(p)}function c(p){return p[r-2]="("+p[r-2]+" + 1)",h(p)}function f(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",h(p)}function h(p){const g=t.map((b,v)=>d(v,p)),m=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${m}), vec2(${y}))`}function d(p,g){return n.indexOf(p)!==-1&&t[p]!==1?`${t[p]} - ${g[p]} - 1`:`${g[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r,o=i.shape.length,a=it(s,i.shape);if(o===0)return _s({inputs:{x:i},backend:n});const u=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new T8t(i.shape,a):new _8t(i.shape,a);return n.runWebGLProgram(u,[i],i.dtype)}const D8t={kernelName:Ew,backendName:"webgl",kernelFunc:I8t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N8t{constructor(t,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=t[1],i=t[2];this.outputShape=t;let s="";typeof n=="number"?s=`float outputValue = ${n.toFixed(2)};`:s=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8t={kernelName:PT,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:s,center:o}=t,a=n,u=new N8t(r.shape,s),[l,c]=$5(o,r.shape[1],r.shape[2]),f=[[l,c,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(u,[r],r.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8t=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,R8t=yt({opSnippet:O8t}),M8t={kernelName:T1,backendName:"webgl",kernelFunc:R8t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8t="return inversesqrt(x);",P8t=yt({opSnippet:L8t,cpuKernelImpl:ZMt}),B8t={kernelName:I1,backendName:"webgl",kernelFunc:P8t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vV{constructor(t,n,r,i,s,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=Vt(s.length),c=Vt(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const h=`getIndices(${f})`;let d="";i===1?d="i":i===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";u&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${m}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z8t{constructor(t,n,r,i,s,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const l=Vt(s.length),c=Vt(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const h=`getIndices(${f})`;let d="";i===1?d="i":i===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";u&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides",b=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${m}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8t(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:s}=t,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=Eh(s,i,o),h=[f/l,l];if(f===0)return n.makeTensorInfo(o,i.dtype);const d=be({inputs:{x:i},backend:n,attrs:{shape:[u,a]}}),p=be({inputs:{x:s},backend:n,attrs:{shape:[u,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;q().getBool("WEBGL_PACK")?m=new z8t(u,a,d.shape.length,p.shape.length,c,h):m=new vV(u,a,d.shape.length,p.shape.length,c,h);const y=n.runWebGLProgram(m,[p,d,g],p.dtype),b=be({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}const j8t={kernelName:$T,backendName:"webgl",kernelFunc:U8t};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W8t{constructor(t,n,r,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];const s="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=q().getNumber("WEBGL_VERSION")===2?s:o,u=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8t(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:o}=r,a=new W8t(i.shape[0],i.shape[1],s.shape[1],o),u=[[i.shape[1]]];return n.runWebGLProgram(a,[i,s],"int32",u)}const G8t={kernelName:ST,backendName:"webgl",kernelFunc:V8t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H8t{constructor(t,n,r){this.variableNames=["c","a","b"],this.outputShape=n;let i,s;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)s="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],l=[];for(let c=0;c<n.length;c++)l.push(`${a[c]}`),c<t&&u.push(`${a[c]}`);i=u.join(),s=l.join()}const o=Vt(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8t(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t,o=new H8t(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,s],Bi(i.dtype,s.dtype))}const X8t={kernelName:Aw,backendName:"webgl",kernelFunc:q8t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8t=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${xI};
  float scale = ${vI};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,K8t=yt({opSnippet:Y8t}),Z8t={kernelName:D1,backendName:"webgl",kernelFunc:K8t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8t=Wy+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Q8t=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,e7t=yt({opSnippet:J8t,packedOpSnippet:Q8t,cpuKernelImpl:QMt}),t7t={kernelName:R1,backendName:"webgl",kernelFunc:e7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n7t=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,r7t=yt({opSnippet:n7t}),i7t={kernelName:O1,backendName:"webgl",kernelFunc:r7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s7t=Wy+`
  return sin(x);
`,o7t=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Yg}
  return result;
`,a7t=yt({opSnippet:s7t,packedOpSnippet:o7t}),u7t={kernelName:N1,backendName:"webgl",kernelFunc:a7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l7t=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,c7t=yt({opSnippet:l7t}),f7t={kernelName:F1,backendName:"webgl",kernelFunc:c7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h7t=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,d7t=yt({opSnippet:h7t}),p7t={kernelName:M1,backendName:"webgl",kernelFunc:d7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g7t=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:o}=r;D(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((y,b)=>y*b),u=[[0,0]];u.push(...o);for(let y=1+s.length;y<i.shape.length;++y)u.push([0,0]);const l=[],c=U2e({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),f=Hw(c.shape,s,a,!1),h=qw(f.length,s.length,!1),d=Xw(c.shape,s,a,!1),p=be({inputs:{x:c},backend:n,attrs:{shape:f}}),g=Ci({inputs:{x:p},backend:n,attrs:{perm:h}}),m=be({inputs:{x:g},backend:n,attrs:{shape:d}});return l.push(c),l.push(p),l.push(g),l.forEach(y=>n.disposeIntermediateTensorInfo(y)),m},m7t={kernelName:Iw,backendName:"webgl",kernelFunc:g7t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7t(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(r.dataId),u=n.readSync(i.dataId),l=n.readSync(s.dataId),c=n.readSync(o.dataId)[0],[f,h,d,p,g]=t4t(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}const b7t={kernelName:kT,backendName:"webgl",kernelFunc:y7t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7t(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),u=Array.from(n.readSync(s.dataId)),[l,c,f]=n4t(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([f.length],s.dtype,new Int32Array(f))]}const v7t={kernelName:ET,backendName:"webgl",kernelFunc:x7t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7t(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=h2e(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}const $7t={kernelName:AT,backendName:"webgl",kernelFunc:w7t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7t(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=h2e(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}const S7t={kernelName:_T,backendName:"webgl",kernelFunc:C7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7t(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:s,defaultValue:o}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:f,outputSize:h}=Eh(s,i,a),d=!1;if(s.dtype==="string"){const y=n.bufferSync(i),b=n.bufferSync(s),v=tc(n.readSync(o.dataId)[0]),x=JMt(y,b,a,h,c,l,u,f,v,d);return n.makeTensorInfo(a,x.dtype,x.values)}const p=new vV(l,u,i.shape.length,s.shape.length,f,[h,1],d),g=n.runWebGLProgram(p,[s,i,o],s.dtype),m=be({inputs:{x:g},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(g),m}const E7t={kernelName:TT,backendName:"webgl",kernelFunc:k7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:o}=r,a=it(o,i.shape)[0],u=L5(i,s,a),l=i.shape.length,c=new Array(l).fill(0),f=i.shape.slice();return u.map(h=>{const d=[...f];d[a]=h;const p=Vy({inputs:{x:i},backend:n,attrs:{begin:c,size:d}});return c[a]+=h,p})}const _7t={kernelName:Dw,backendName:"webgl",kernelFunc:A7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hee="return sqrt(x);",T7t=yt({opSnippet:hee,packedOpSnippet:hee,cpuKernelImpl:r4t}),I7t={kernelName:L1,backendName:"webgl",kernelFunc:T7t};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7t="return x * x;",N7t=yt({opSnippet:D7t}),F7t={kernelName:IT,backendName:"webgl",kernelFunc:N7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dee="return (a - b) * (a - b);",O7t=Mr({opSnippet:dee,packedOpSnippet:dee}),R7t={kernelName:P1,backendName:"webgl",kernelFunc:O7t};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const s=n.readSync(i.dataId),o=rc(s),a=i4t(o,"string",r);return n.makeTensorInfo(i.shape,"string",a)}const L7t={kernelName:Fw,backendName:"webgl",kernelFunc:M7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7t({inputs:e,attrs:t,backend:n}){const{x:r}=e,i=jo+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new lu(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}const B7t={kernelName:W1,backendName:"webgl",kernelFunc:P7t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z7t{constructor(t,n,r){this.variableNames=["x"],this.outputShape=r;const i=r.length,s=Vt(r.length),o=Vt(r.length);let a="";if(i===1)a="coords * strides + begin";else{let u=0;a=r.map((l,c)=>(u++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${u-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${t});
      ${s} strides = ${s}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:f,shrinkAxisMask:h}=r,{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:x}=b5(i.shape,s,o,a,u,l,c,f,h);let w;if(g)w=be({inputs:{x:i},backend:n,attrs:{shape:p}});else if(m||y){D(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const $=g5(b,v,x),S=Vy({inputs:{x:i},backend:n,attrs:{begin:b,size:$}});w=be({inputs:{x:S},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(S)}else if(n.shouldExecuteOnCPU([i])){const S=n.readSync(i.dataId),k=nt(i.shape,i.dtype,S),E=s4t(d,k,x,b);w=n.makeTensorInfo(p,i.dtype,E.values)}else{const S=new z7t(b,x,d);w=n.runWebGLProgram(S,[i],i.dtype)}const C=be({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),C}const j7t={kernelName:DT,backendName:"webgl",kernelFunc:U7t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7t(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:f}=t,h=n.readSync(c.dataId),d=n.readSync(f.dataId),[p,g]=o4t(h,d,i,s,o,a,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",g)]}const V7t={kernelName:NT,backendName:"webgl",kernelFunc:W7t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G7t(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[l,c,f]=a4t(a,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const H7t={kernelName:FT,backendName:"webgl",kernelFunc:G7t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7t(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=u4t(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const X7t={kernelName:OT,backendName:"webgl",kernelFunc:q7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7t="return tan(x);",K7t=yt({opSnippet:Y7t}),Z7t={kernelName:z1,backendName:"webgl",kernelFunc:K7t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7t=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Q7t=yt({opSnippet:J7t}),e9t={kernelName:U1,backendName:"webgl",kernelFunc:Q7t};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9t(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:i,indices:s,updates:o}=t,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=Eh(o,s,i.shape),h=[f/l,l];if(f===0)return n.makeTensorInfo(i.shape,s.dtype);const d=be({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),p=be({inputs:{x:o},backend:n,attrs:{shape:[u,l]}}),g=be({inputs:{x:i},backend:n,attrs:{shape:h}}),m=new vV(u,a,d.shape.length,p.shape.length,c,h,!1,!0),y=n.runWebGLProgram(m,[p,d,g],g.dtype),b=be({inputs:{x:y},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}const n9t={kernelName:CT,backendName:"webgl",kernelFunc:t9t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r9t{constructor(t,n){this.variableNames=["A"];const r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[o]*n[o];this.outputShape=r,this.rank=r.length;const i=Vt(this.rank),s=i9t(t);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}function i9t(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<e.length;i++)r.push(`imod(${n[i]}, ${e[i]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;if(i.dtype==="string"||i.shape.length>5){const u=n.readSync(i.dataId),l=i.dtype==="string"?u.map(h=>tc(h)):u,c=nt(i.shape,i.dtype,l),f=c4t(c,s);return n.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new r9t(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const s9t={kernelName:j1,backendName:"webgl",kernelFunc:W2e};class o9t{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class a9t{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dd(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function pee(e){let t=1;for(;t<e;)t*=2;return t}function u9t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:o}=r,a=q().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=q().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=i.shape,c=l[l.length-1];if(n.shouldExecuteOnCPU([i])||c<a||s>u){const E=n.readSync(i.dataId),[A,F]=f4t(E,l,i.dtype,s,o);return[n.makeTensorInfo(A.shape,A.dtype,A.values),n.makeTensorInfo(F.shape,F.dtype,F.values)]}if(s===0)return l[l.length-1]=0,[n.makeTensorInfo(l,i.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(c===1)return[i,EC({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const f=n.texData.get(i.dataId),h=f!==null&&f.isPacked,d=h?n.unpackTensor(i):i,g=Z(l)/c,m=be({inputs:{x:d},attrs:{shape:[g,c]},backend:n});h&&dd(n,d);const y=pee(s),b=pee(c);let v=null;const x=()=>v===null?[m,m]:[m,v],w=(E,A,F)=>{const _=x(),I=new o9t(F),O=[[c],[v===null?1:0],[Number.NEGATIVE_INFINITY],[E],[A]],L=v;v=n.runWebGLProgram(I,_,"int32",O),dd(n,L)};for(let E=1;E<y;E*=2){const A=E*2;for(let F=E;F>=1;F/=2)w(A,F,[g,b])}for(let E=b;E>y;E/=2){const A=x(),F=new a9t([g,E/2]),I=[[c],[v===null?1:0],[y]],T=v;v=n.runWebGLProgram(F,A,"int32",I),dd(n,T);const O=y/2,L=O*2;for(let M=O;M>=1;M/=2)w(L,M,v.shape)}let C=v;v=Vy({inputs:{x:v},backend:n,attrs:{begin:0,size:[g,s]}}),dd(n,C);let $=R2e({inputs:{x:m,indices:v},backend:n,attrs:{axis:1,batchDims:1}});dd(n,m);const S=l.slice(0,-1);S.push(s),C=v,v=be({inputs:{x:v},attrs:{shape:S},backend:n}),dd(n,C);const k=$;return $=be({inputs:{x:$},attrs:{shape:S},backend:n}),dd(n,k),[$,v]}const l9t={kernelName:RT,backendName:"webgl",kernelFunc:u9t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c9t{constructor(t,n,r,i,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let u;switch(i){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9t(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,transforms:s}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=r,[c,f,h,d]=i.shape,[p,g]=l??[f,h],m=[c,p,g,d],y=new c9t(f,h,o,a,u,m);return n.runWebGLProgram(y,[i,s],"float32")}const h9t={kernelName:MT,backendName:"webgl",kernelFunc:f9t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9t(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;CC(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(s.dataId),{outputValues:a,outputShape:u,indices:l}=h4t(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}const p9t={kernelName:LT,backendName:"webgl",kernelFunc:d9t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9t(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i,a=o.shape.length,u=i.shape[s],l=new Array(a-1);let c=0;for(let g=0;g<a;g++)g!==s&&(l[c++]=o.shape[g]);const f=[],h=new Array(a).fill(0),d=o.shape.slice();d[s]=1;const p=new Array(u);for(let g=0;g<p.length;g++){h[s]=g;const m=Vy({inputs:{x:o},backend:n,attrs:{begin:h,size:d}}),y=be({inputs:{x:m},backend:n,attrs:{shape:l}});p[g]=y,f.push(m)}return f.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const m9t={kernelName:Ow,backendName:"webgl",kernelFunc:g9t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y9t{constructor(t,n){this.variableNames=["x","segmentIds"];const r=t.windowSize,i=t.batchSize,s=t.inSize,o=t.numSegments,a=o*Math.ceil(s/r);this.outputShape=[i,a];const u="0.0",l="sumValue",c=Math.floor(r/4)*4,f=r%4,h=`
        sumValue += dot(values, segFilter);
    `;let d="";s%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9t(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:o}=r,a=i.shape.length,u=[];let l=0;const c=xn([l],a);let f=i;c!=null&&(f=Ci({inputs:{x:i},backend:n,attrs:{perm:c}}),u.push(f),l=In(1,a)[0]);const h=are(f.shape,l,o),d=Z([f.shape[l]]),p=be({inputs:{x:f},backend:n,attrs:{shape:[-1,d]}});u.push(p);const g=zT(i.dtype),m=(x,w,C,$,S)=>{const k=x.shape[0],E=x.shape[1],A=ore(E,S),F={windowSize:A,inSize:E,batchSize:k,numSegments:S},_=new y9t(F,w),I=n.compileAndRun(_,[x,C],$);if(u.push(I),I.shape[1]===S)return I;const T=j2e({backend:n,attrs:{start:0,stop:S,step:1,dtype:"float32"}}),O=W2e({inputs:{x:T},backend:n,attrs:{reps:[E/A]}});return u.push(T),u.push(O),m(I,w,O,$,S)},y=m(p,"unsortedSegmentSum",s,g,o),b=be({inputs:{x:y},backend:n,attrs:{shape:h}});let v=b;if(c!=null){u.push(b);const x=Ch(c);v=Ci({inputs:{x:v},backend:n,attrs:{perm:x}})}return u.forEach(x=>n.disposeIntermediateTensorInfo(x)),v}const x9t={kernelName:Rw,backendName:"webgl",kernelFunc:b9t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v9t=[rLt,sLt,uLt,fLt,dLt,mLt,bLt,vLt,SLt,ELt,TLt,NLt,RLt,BLt,jLt,VLt,HLt,KLt,JLt,ePt,iPt,fPt,dPt,yPt,xPt,kPt,APt,DPt,z4t,OPt,BPt,WPt,YPt,JPt,eBt,nBt,iBt,uBt,fBt,pBt,mBt,bBt,vBt,CBt,kBt,TBt,DBt,OBt,LBt,BBt,WBt,qBt,ZBt,e5t,r5t,i5t,o5t,u5t,c5t,h5t,p5t,b5t,w5t,S5t,E5t,T5t,N5t,M5t,z5t,B4t,j5t,LPt,G5t,X5t,Z5t,j4t,t6t,s6t,a6t,f6t,p6t,b6t,w6t,k6t,T6t,N6t,O6t,P6t,z6t,j6t,H6t,X6t,K6t,J6t,ezt,izt,uzt,hzt,vzt,G4t,Szt,Azt,Izt,Fzt,wPt,Mzt,Pzt,zzt,Wzt,qzt,V4t,Yzt,Zzt,Qzt,t8t,n8t,$Pt,mzt,s8t,l8t,d8t,q4t,y8t,v8t,S8t,A8t,D8t,F8t,M8t,B8t,j8t,G8t,X8t,Z8t,t7t,i7t,u7t,f7t,lPt,bzt,p7t,m7t,b7t,v7t,$7t,S7t,E7t,_7t,I7t,F7t,R7t,L7t,B7t,j7t,V7t,H7t,X7t,yzt,eLt,Z7t,e9t,n9t,s9t,l9t,h9t,tLt,p9t,m9t,x9t,Lzt];for(const e of v9t)BT(e);const w9t=ua("div",null,"如果提供汽车的“马力”，模型将学习预测“每加仑的英里数”(MPG)。",-1),$9t=rB({__name:"Lesson1",setup(e){const t=_l(null),n=_l(null),r=_l(null),i=_l(null),s=_l(null),o=async()=>(await(await fetch("https://storage.googleapis.com/tfjs-tutorials/carsData.json")).json()).map(g=>({mpg:g.Miles_per_Gallon,horsepower:g.Horsepower})).filter(g=>g.mpg!=null&&g.horsepower!=null),a=async()=>{const h=await o(),d=h.map(b=>({x:b.horsepower,y:b.mpg}));ao.render.scatterplot(n.value,{values:d},{xLabel:"Horsepower(马力)",yLabel:"MPG(每加仑的英里数)",height:300});const p=u();ao.show.modelSummary(r.value,p);const g=l(h),{inputs:m,labels:y}=g;await c(p,m,y),console.log("Done Training"),f(p,h,g)},u=()=>{const h=gbe();return h.add(Ik({inputShape:[1],units:1,useBias:!0})),h.add(Ik({units:50,activation:"sigmoid"})),h.add(Ik({units:1,useBias:!0})),h},l=h=>X(()=>{I_(h);const d=h.map($=>$.horsepower),p=h.map($=>$.mpg),g=ql(d,[d.length,1]),m=ql(p,[p.length,1]),y=g.max(),b=g.min(),v=m.max(),x=m.min(),w=g.sub(b).div(y.sub(b)),C=m.sub(x).div(v.sub(x));return{inputs:w,labels:C,inputMax:y,inputMin:b,labelMax:v,labelMin:x}}),c=async(h,d,p)=>(h.compile({optimizer:vl.adam(),loss:vne.meanSquaredError,metrics:["mse"]}),await h.fit(d,p,{batchSize:32,epochs:50,shuffle:!0,callbacks:ao.show.fitCallbacks(i.value,["loss","mse"],{height:200,callbacks:["onEpochEnd"]})})),f=(h,d,p)=>{const{inputMax:g,inputMin:m,labelMin:y,labelMax:b}=p,[v,x]=X(()=>{const $=jte(0,1,100),S=h.predict($.reshape([100,1])),k=$.mul(g.sub(m)).add(m),E=S.mul(b.sub(y)).add(y);return[k.dataSync(),E.dataSync()]}),w=Array.from(v).map(($,S)=>({x:$,y:x[S]})),C=d.map($=>({x:$.horsepower,y:$.mpg}));ao.render.scatterplot(s.value,{values:[C,w],series:["original","predicted"]},{xLabel:"Horsepower",yLabel:"MPG",height:300})};return gee(async()=>{a()}),(h,d)=>(iB(),sB(mee,null,[w9t,ua("div",{ref_key:"container",ref:t,class:"container"},[ua("div",{ref_key:"container1",ref:n},null,512),ua("div",{ref_key:"container2",ref:r},null,512),ua("div",{ref_key:"container3",ref:i},null,512),ua("div",{ref_key:"container4",ref:s},null,512)],512)],64))}});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ho=784,Bc=10,nB=65e3,xm=55e3,C9t=nB-xm,S9t="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png",k9t="https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8";class E9t{constructor(){this.shuffledTrainIndex=0,this.shuffledTestIndex=0}async load(){const t=new Image,n=document.createElement("canvas"),r=n.getContext("2d"),i=new Promise((u,l)=>{t.crossOrigin="",t.onload=()=>{t.width=t.naturalWidth,t.height=t.naturalHeight;const c=new ArrayBuffer(nB*Ho*4),f=5e3;n.width=t.width,n.height=f;for(let h=0;h<nB/f;h++){const d=new Float32Array(c,h*Ho*f*4,Ho*f);r.drawImage(t,0,h*f,t.width,f,0,0,t.width,f);const p=r.getImageData(0,0,n.width,n.height);for(let g=0;g<p.data.length/4;g++)d[g]=p.data[g*4]/255}this.datasetImages=new Float32Array(c),u()},t.src=S9t}),s=fetch(k9t),[o,a]=await Promise.all([i,s]);this.datasetLabels=new Uint8Array(await a.arrayBuffer()),this.trainIndices=UR(xm),this.testIndices=UR(C9t),this.trainImages=this.datasetImages.slice(0,Ho*xm),this.testImages=this.datasetImages.slice(Ho*xm),this.trainLabels=this.datasetLabels.slice(0,Bc*xm),this.testLabels=this.datasetLabels.slice(Bc*xm)}nextTrainBatch(t){return this.nextBatch(t,[this.trainImages,this.trainLabels],()=>(this.shuffledTrainIndex=(this.shuffledTrainIndex+1)%this.trainIndices.length,this.trainIndices[this.shuffledTrainIndex]))}nextTestBatch(t){return this.nextBatch(t,[this.testImages,this.testLabels],()=>(this.shuffledTestIndex=(this.shuffledTestIndex+1)%this.testIndices.length,this.testIndices[this.shuffledTestIndex]))}nextBatch(t,n,r){const i=new Float32Array(t*Ho),s=new Uint8Array(t*Bc);for(let u=0;u<t;u++){const l=r(),c=n[0].slice(l*Ho,l*Ho+Ho);i.set(c,u*Ho);const f=n[1].slice(l*Bc,l*Bc+Bc);s.set(f,u*Bc)}const o=ql(i,[t,Ho]),a=ql(s,[t,Bc]);return{xs:o,labels:a}}}const A9t=ua("div",null,"使用 CNN 识别手写数字",-1),_9t=rB({__name:"Lesson2",setup(e){const t=_l(null),n=_l(null),r=_l(null),i=async h=>{const d=ao.visor(),p=d.surface({name:"Input Data Examples",tab:"Input Data"}),g=h.nextTestBatch(20),m=g.xs.shape[0];for(let y=0;y<m;y++){const b=X(()=>g.xs.slice([y,0],[1,g.xs.shape[1]]).reshape([28,28,1])),v=document.createElement("canvas");v.width=28,v.height=28,v.style="margin: 4px;",await _ne(b,v),p.drawArea.appendChild(v),b.dispose()}n.value.appendChild(d.el)},s=()=>{const h=gbe();h.add(DQ({inputShape:[28,28,1],kernelSize:5,filters:8,strides:1,activation:"relu",kernelInitializer:"varianceScaling"})),h.add(NQ({poolSize:[2,2],strides:[2,2]})),h.add(DQ({kernelSize:5,filters:16,strides:1,activation:"relu",kernelInitializer:"varianceScaling"})),h.add(NQ({poolSize:[2,2],strides:[2,2]})),h.add(tTt()),h.add(Ik({units:10,kernelInitializer:"varianceScaling",activation:"softmax"}));const y=vl.adam();return h.compile({optimizer:y,loss:"categoricalCrossentropy",metrics:["accuracy"]}),h},o=async(h,d)=>{const p=["loss","val_loss","acc","val_acc"],g={name:"Model Training",tab:"Model",styles:{height:"1000px"}},m=ao.show.fitCallbacks(g,p),y=512,b=5500,v=1e3,[x,w]=X(()=>{const S=d.nextTrainBatch(b);return[S.xs.reshape([b,28,28,1]),S.labels]}),[C,$]=X(()=>{const S=d.nextTestBatch(v);return[S.xs.reshape([v,28,28,1]),S.labels]});return h.fit(x,w,{batchSize:y,validationData:[C,$],epochs:10,shuffle:!0,callbacks:m})},a=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],u=(h,d,p=500)=>{const y=d.nextTestBatch(p),b=y.xs.reshape([p,28,28,1]),v=y.labels.argMax(-1),x=h.predict(b).argMax(-1);return b.dispose(),[x,v]},l=async(h,d)=>{const[p,g]=u(h,d),m=await ao.metrics.perClassAccuracy(g,p),y={name:"Accuracy",tab:"Evaluation"};ao.show.perClassAccuracy(y,m,a),g.dispose()},c=async(h,d)=>{const[p,g]=u(h,d),m=await ao.metrics.confusionMatrix(g,p),y={name:"Confusion Matrix",tab:"Evaluation"};ao.render.confusionMatrix(y,{values:m,tickLabels:a}),g.dispose()},f=async()=>{const h=new E9t;await h.load(),await i(h);const d=s();ao.show.modelSummary(r.value,d),await o(d,h),await l(d,h),await c(d,h)};return gee(()=>{f()}),(h,d)=>(iB(),sB(mee,null,[A9t,ua("div",{ref_key:"container",ref:t,class:"container"},[ua("div",{ref_key:"container1",ref:n},null,512),ua("div",{ref_key:"container2",ref:r},null,512)],512)],64))}}),T9t=e=>(K2e("data-v-954bf357"),e=e(),Z2e(),e),I9t=T9t(()=>ua("div",null,"利用tensorflow.js可以直接在web上训练各种模型，进行数据和图像的预测",-1)),D9t=rB({__name:"index",setup(e){const t=_l("lesson-one"),n=r=>{t.value=r.props.name};return(r,i)=>{const s=J2e,o=Y2e;return iB(),sB("main",null,[I9t,Hy(o,{modelValue:q2e(t),"onUpdate:modelValue":i[0]||(i[0]=a=>X2e(t)?t.value=a:null),class:"demo-tabs",onTabClick:n},{default:n3(()=>[Hy(s,{label:"数据预测",name:"lesson-one"},{default:n3(()=>[Hy($9t)]),_:1}),Hy(s,{label:"识别数字",name:"lesson-two"},{default:n3(()=>[Hy(_9t)]),_:1})]),_:1},8,["modelValue"])])}}}),W9t=Q2e(D9t,[["__scopeId","data-v-954bf357"]]);export{W9t as default};
